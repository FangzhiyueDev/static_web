define("douyu/com/vcode-v3",["jquery","shark/class","shark/observer"],function(e,t,a){var i={type:null,fast:{idpre:"gt-captcha-",count:0}},s=t({init:function(t){this.config=e.extend(!0,{},{target:null},t),this.render()},nextId:function(){var e=this.config.idpre||i.fast.idpre;return e+ ++i.fast.count},getResult:function(){return this.config.result},check:function(t){var a=e.isFunction(t.error)?t.error:function(){},i=function(t){0===t.error&&e.isPlainObject(t.data)?this.buildAsync(t.data):a()},s=function(){a()};t.checkOptions?this.buildAsync(t.checkOptions):e.ajax("/member/cpSecurity/check_geetest_status",{type:"post",data:{op_type:t.op_type||""},dataType:"json",timeout:5e3,success:e.proxy(i,this),error:e.proxy(s,this)})},render:function(){this.config.$el=this.config.target},build:function(t){var a=this.nextId(),i=this,s=e.isFunction(i.config.success)?i.config.success:function(){},n=e.isFunction(i.config.error)?i.config.error:function(){},o="zh-cn";"en"===$SYS.lang&&(o=$SYS.lang),this.config.$el.html('<div id="'+a+'"></div>'),this.config.result=null;var r={gt:t.gt,challenge:t.challenge,offline:!t.success,new_captcha:!0,product:"float",lang:o};return window.initGeetest?(this.config.gtObj&&this.config.gtObj.product&&(r=e.extend(!0,r,this.config.gtObj)),void window.initGeetest(r,function(e){e.appendTo("#"+a),e.onSuccess(function(){i.config.result=i.plugin.getValidate(),s(i.config.result)}),e.onError(function(){i.config.result=null}),i.plugin=e})):(n(),!1)},buildAsync:function(e){var t=this,a=location.protocol;require.use([a+"//static.geetest.com/static/tools/gt.js"],function(){t.build(e)})},refresh:function(){this.plugin&&this.plugin.reset(),this.config.result=null},show:function(){this.config.$el.show()},hide:function(){this.config.$el.hide()},destroy:function(){this.plugin&&this.plugin.destroy()}}),n={init:function(t,a,n){var o=e.extend(!0,{product:"custom",width:"100%",area:".v3-area",next_width:"260px",bg_color:"transparent"},n||{}),r={target:t,gtObj:o,idpre:a.idpre||"",success:a.success||function(){},error:a.error||function(){}},l=new s(r);return l.check(a),{refresh:function(){l.refresh()},isFast:function(){return"fast"===i.type},getFastResult:function(){return l.getResult()},destroy:function(){return l.destroy()}}}};return n}),define("douyu/com/get-gift-configs",["jquery","shark/util/cookie/1.0","shark/util/storage/1.0","douyu/context","douyu/com/exjsonp"],function(e,t,a,i,s){var n={initConfigs:function(){this.configs={webconfUrl:i.get("sys.webconfUrl"),lastReqTimestamp:0,propCBName:"propGiftConfig",giftCBName:"roomGiftConfig",listenReqDefered:null,loadProgress:[],urls:{getGiftConfigs:"resource/common/gift/gift_template/"+i.get("room.giftTempId")+".json",getPropConfigs:"resource/common/prop_gift_list/prop_gift_config.json",getGiftConf:i.get("room.giftHost")+"/lapi/gift/webProp/getPropGift"},giftConfigArray:[],giftConfigsData:null,propConfigsData:null,allConfigsData:null}},handleGiftConfig:function(){var e,t,a=this.configs,i=0;if(a.giftConfigsData={},a.giftConfigArray&&a.giftConfigArray.length)for(e=a.giftConfigArray.length;e>i;i++)t=a.giftConfigArray[i],t&&(a.giftConfigsData[t.id]=t)},listenReqStatus:function(){var t=this,a=t.configs;a.loadProgress&&a.loadProgress.length>=2&&(a.allConfigsData=e.extend(!0,{},a.propConfigsData,a.giftConfigsData),a.listenReqDefered.resolve(a.allConfigsData))},reqPropJson:function(){var t=this,a=t.configs,i=e.Deferred();return a.propConfigsData?i.resolve(a.propConfigsData):(s.load(a.webconfUrl+a.urls.getPropConfigs,a.propCBName,function(e){return a.propConfigsData=e||{},i.resolve(a.propConfigsData)}),i)},reqGiftJson:function(){var t=this,a=t.configs,n=e.Deferred();return void 0===i.get("room.giftTempId")?n.reject():a.giftConfigsData?n.resolve(a.giftConfigsData):(s.load(a.webconfUrl+a.urls.getGiftConfigs,a.giftCBName,function(e){return a.giftConfigArray=e,t.handleGiftConfig(),n.resolve(a.giftConfigsData)}),n)},reqAllConfig:function(){var t=this,a=t.configs;return a.listenReqDefered=e.Deferred(),t.reqPropJson().done(function(e){a.loadProgress.push(1),t.listenReqStatus()}),t.reqGiftJson().done(function(e){a.loadProgress.push(1),t.listenReqStatus()}),a.listenReqDefered},reqGiftConfig:function(t){var a=this,i=a.configs,s=e.Deferred();return e.ajax({url:i.urls.getGiftConf,type:"GET",dataType:"json",data:{gid:t}}).done(function(e){return e&&0==e.error?s.resolve(e.data):s.reject()}).fail(function(){return s.reject()}),s},getGiftConfig:function(t){var a=this,i=a.configs,s=i.allConfigsData[t],n=e.Deferred();return s?n.resolve(s):(a.reqGiftConfig(t).done(function(e){return s=e||{},e&&(i.giftConfigsData[t]=e,i.allConfigsData[t]=e),n.resolve(s)}),n)},load:function(){var t=n,a=e.Deferred();return t.configs?"":t.initConfigs(),t.configs.allConfigsData?a.resolve(t.configs.allConfigsData):(t.reqAllConfig().done(function(e){return a.resolve(e)}),a)},getGift:function(){var t=n,a=e.Deferred();return t.configs?"":t.initConfigs(),t.reqGiftJson().done(function(e){return a.resolve(e)}),a},getProp:function(){var t=n,a=e.Deferred();return t.configs?"":t.initConfigs(),t.reqPropJson().done(function(e){return a.resolve(e)}),a},get:function(t){var a=n,i=e.Deferred();return a.configs?"":a.initConfigs(),a.configs.allConfigsData?a.getGiftConfig(t).done(function(e){return i.resolve(e)}):a.reqAllConfig().done(function(e){a.getGiftConfig(t).done(function(e){return i.resolve(e)})}),i}},o={data:null,promise:e.Deferred(),isLoading:0,load:function(){var e=this,t=e.promise,a=i.get("sys.webconfUrl")+"resource/common/return_coin/web_return_switch.json";return e.data?t.resolve(e.data):e.isLoading?t:(e.isLoading=1,s.load(a,"yuwanReturnSwitch",function(a){a?(e.data=a,t.resolve(e.data)):t.reject()},function(){t.reject()}),t.promise())}};return{getGift:n.getGift,getProp:n.getProp,load:n.load,get:n.get,loadYwReturnSwitch:function(){return o.load()}}}),define("douyu/page/room/normal/mod/gift-queue",["jquery","douyu/com/get-gift-configs"],function(e,t){var a=function(a){var i=this;t.getGift().done(function(t){i.config=e.extend(!0,{giftConfig:t},a||{}),i.init(a)})};e.extend(a.prototype,{init:function(e){var t,a=this.config.giftConfig;this.queue={},this.types={all:[],yw:[],yc:[]},this.locks={},this.timers={};for(var i in a)t=a[i],this.queue[i]=[],this.types.all.push(i),1===t.type?this.types.yw.push(i):2===t.type&&this.types.yc.push(i),this.locks[i]=!1},push:function(t,a){if(t=String(t),"undefined"!==t&&e.isPlainObject(a)&&!e.isEmptyObject(a)&&a.count&&this.queue[t]){for(var i,s=0===this.queue[t].length,n=[],o=0;o<a.count;o++)i=e.extend(!0,{},a),s&&0===o&&(i.delay=null),n.push(i);this.queue[t]=this.queue[t].concat(n)}},next:function(t,a){if(t=String(t),"undefined"!==t&&e.isFunction(a)&&!this.islock(t)){var i=this.queue[t].shift();i&&(i.delay?(this.lock(t),this.timers[t]=setTimeout(function(){a(i)},i.delay)):a(i))}},hasNext:function(e){if(e=String(e),"undefined"!==e&&void 0!==this.queue[e])return!!this.queue[e].length;for(var t in this.queue)if(this.queue[t].length)return!0;return!1},islock:function(e){return this.locks[String(e)]},lock:function(e){e=String(e),this.queue[e]&&(this.locks[e]=!0)},unlock:function(e){e=String(e),this.queue[e]&&(this.locks[e]=!1)},clear:function(e){var t=this.types.all;"yw"===e?t=this.types.yw:"yc"===e&&(t=this.types.yc);for(var a=0,i=t.length;i>a;a++)this.queue[t[a]]=[],this.unlock(t[a])}});var i=new a;return i}),define("douyu/com/room-gift-tmp",["jquery","shark/observer","shark/util/lang/1.0","shark/util/flash/data/1.0","shark/util/template/2.0","douyu/context","douyu/com/exjsonp","douyu/page/room/base/api"],function(e,t,a,i,s,n,o,r){var l={isGetData:!1,isTplRender:!1,reqDefered:null,configUrl:n.get("sys.webconfUrl")+"resource/common/gift/gift_template/"+n.get("room.giftTempId")+".json",callbackName:"roomGiftConfig",$giftListWrap:e("#gift-content"),cqSwitch:n.get("room.cqSwitch")||0,isFlashInit:!1,isConfigInit:!1,isPostData:!1,isEvtBind:!1,configData:[]},d={};return e("body").data("cq")||e("body").data("cq",l.cqSwitch),l.reqDefered=e.Deferred(),d={impl:function(){l.isEvtBind||(d.bindEvt(),l.isEvtBind=!0)},init:function(){return d.regData(),l.reqDefered.promise()},regData:function(){var e=this;return l.isTplRender?l.reqDefered.resolve():void 0===$ROOM.giftTempId?l.reqDefered.reject():void o.load(l.configUrl,l.callbackName,function(t){l.configData=t,l.isConfigInit=!0,e.postData(),e.handleData(l.configData)})},bindEvt:function(){var e=this;r.reg("room_data_login",function(){l.isFlashInit=!0,e.postData()}),r.reg("room_data_req_gift_config",function(){d.init().done(function(){r.exe("js_gift_config",l.configData)})})},postData:function(){l.isConfigInit&&l.isFlashInit&&!l.isPostData&&(r.exe("js_gift_config",l.configData),l.isPostData=!0)},handleData:function(e){var t,a=this,i=e.length,s={visibleGift:[],invisible:{normal:[],noble:[]}},n=0;for(n;i>n;n++)t=e[n],t.isAlipay||(7>n?s.visibleGift.push(t):1!==parseInt(t.gt,10)?s.invisible.normal.push(t):s.invisible.noble.push(t));return l.isTplRender?l.reqDefered.resolve():void a.initGiftTpl(s)},initGiftTpl:function(e){var i,o,r;i=a.string.join('<div class="g-list clearfix" data-slider="slider">','<div class="gift-info-panel" data-type="gift-info-panel">','<div class="gift-info-panel-cont clearfix" data-type="gift-info-panel-cont"></div>','<i class="gift-info-panel-fill"></i>','<i class="gift-info-panel-arrow1"></i>','<i class="gift-info-panel-arrow2"></i>',"</div>",'<ul class="clearfix fl" data-slider="list">',"{{ each initGift as item }}",'<li class="gift-item" data-type="gift" data-noble="{{item.gt}}" data-send="{{item.type}}" data-giftid="{{item.id}}" data-giftname="{{item.name}}" data-name="{{item.price_name}}" data-gifticon="{{item.himg}}" data-exp="{{item.exp}}" data-devote="{{item.devote}}" data-intro="{{item.intro}}" data-explain="{{item.desc}}" data-bi="{{item.batch_interval}}" data-intimate="{{item.devote}}" data-returnyw="{{item.ry}}">','<img class="g-img" src="{{ item.gift_pic }}">',"{{ if (item.gift_active_icon_style && item.gift_active_icon_style > 0 && item.gift_web_active_text) }}",'<div class="icon--conner-mark icon--conner-mark-s{{ item.gift_active_icon_style}}">',"<span>{{ item.gift_web_active_text}}</span>","</div>","{{ else }}","{{ if ((!item.gift_active_icon_style || item.gift_active_icon_style == 0) && (item.gt == 1)) }}",'<div class="icon--conner-mark icon--conner-mark-s1">',"<span>贵</span>","</div>","{{ else if ((!item.gift_active_icon_style || item.gift_active_icon_style == 0) && (item.gt == 2)) }}",'<div class="icon--conner-mark icon--conner-mark-s1">',"<span>周</span>","</div>","{{ /if }}","{{ /if }}","</li>","{{ /each }}","</ul>",'<div class="item-expand-panel expand-gift-panel">','<a class="expand-gift-panel-close" href="javascript:;">×</a>','<div class="item-expand-tran-outer">','<div class="item-expand-tran-inner">',"</div>","</div>","{{ if popInitGift.length }}",'<div class="gift--box">','<div class="box--title">',"<strong>普通礼物</strong>","<span>","拥有数：<em>{{ popInitGift.length }}</em>","</span>","</div>",'<div class="box--content">','<ul class="item-expand-cont clearfix" data-slider="list">',"{{ each popInitGift as item }}",'<li class="gift-item" data-type="gift" data-noble="{{ item.gt }}" data-send="{{ item.type }}" data-giftid="{{ item.id }}" data-giftname="{{ item.name }}" data-name="{{ item.price_name }}" data-gifticon="{{ item.himg }}" data-exp="{{ item.exp }}" data-devote="{{ item.devote }}" data-intro="{{ item.intro }}" data-explain="{{ item.desc }}" data-bi="{{ item.batch_interval }}" data-intimate="{{ item.devote }}" data-returnyw="{{ item.ry }}">','<img class="g-img" src="{{ item.gift_pic }}" />',"{{ if (item.gift_active_icon_style && item.gift_active_icon_style > 0 && item.gift_web_active_text) }}",'<div class="icon--conner-mark icon--conner-mark-s{{ item.gift_active_icon_style || ""}}">',"<span>{{ item.gift_web_active_text }}</span>","</div>","{{ else if ((!item.gift_active_icon_style || item.gift_active_icon_style == 0) && item.gt == 2) }}",'<div class="icon--conner-mark icon--conner-mark-s1">',"<span>周</span>","</div>","{{ /if }}","</li>","{{ /each }}","</ul>","</div>","</div>","{{ /if }}","{{ if nobleGift.length }}",'<div class="gift--box gift--noble-box">','<div class="box--title">',"<strong>贵族礼物</strong>","<span>","拥有数：<em>{{ nobleGift.length }}</em>","</span>","</div>",'<div class="box--content">','<ul class="item-expand-cont clearfix" data-slider="list">',"{{ each nobleGift as item }}",'<li class="gift-item" data-type="gift" data-noble="{{ item.gt }}" data-send="{{ item.type }}" data-giftid="{{ item.id }}" data-giftname="{{ item.name }}" data-name="{{ item.price_name }}" data-gifticon="{{ item.himg }}" data-exp="{{ item.exp }}" data-devote="{{ item.devote }}" data-intro="{{ item.intro }}" data-explain="{{ item.desc }}" data-bi="{{ item.batch_interval }}" data-intimate="{{ item.devote }}" data-returnyw="{{ item.ry }}">','<img class="g-img" src="{{ item.gift_pic }}" />',"{{ if (item.gift_active_icon_style && item.gift_active_icon_style > 0 && item.gift_web_active_text) }}",'<div class="icon--conner-mark icon--conner-mark-s{{ item.gift_active_icon_style || ""}}">',"<span>{{ item.gift_web_active_text}}</span>","</div>","{{ else }}",'<div class="icon--conner-mark icon--conner-mark-s1">',"<span>贵</span>","</div>","{{ /if }}","</li>","{{ /each }}","</ul>","</div>","</div>","{{ /if }}","</div>","{{ if popInitGift.length || nobleGift.length}}",'<div class="more-gift-btn fl"></div>',"{{ /if }}","{{ if (isOpenCq == 1) }}",'<div class="gift-item" data-type="cq" data-point-2="0" data-send="0" data-giftid="cq"','data-giftname="酬勤" data-name="15/30/50 鱼翅" data-gifticon="'+$SYS.web_url+'app/douyu/res/page/room-normal/gift/chouqin_90.gif" data-exp="0"','data-devote="0" data-intro="0"','data-explain="可获得鱼丸奖励/可获得贡献值奖励/','可获得30天酬勤头衔">','<img class="g-img" src="'+$SYS.web_url+'app/douyu/res/page/room-normal/gift/chouqin_48.png" />',"</div>","{{ /if }}","</div>"),o=s.compile(i),r=o({initGift:e.visibleGift||[],popInitGift:e.invisible.normal||[],nobleGift:e.invisible.noble||[],isOpenCq:l.cqSwitch}),l.$giftListWrap.html(r),l.isTplRender=!0,l.reqDefered.resolve(),n.get("room.owner_uid")==n.get("sys.uid")&&l.$giftListWrap.find('[data-slider="slider"]').hide(),t.trigger("mod.normal.gift.expand")}},d.impl(),{render:d.init}}),define("douyu/page/room/normal/mod/account-security",["jquery","shark/observer","shark/util/lang/1.0","shark/util/template/2.0","shark/util/cookie/1.0","douyu/context","douyu/com/vcode-v3","douyu/page/room/base/api"],function(e,t,a,i,s,n,o,r){var l={getInfoUrl:"/member/accountVerify/verifyInfo",smsUrl:"   /member/accountVerify/sendPhoneCaptcha",submitUrl:"/member/accountVerify/verifyValidate",csrfUrl:"/curl/csrfApi/getCsrfCookie",type:0,pre:"account-security",v3Instance:null,lock:{},timer:null,time:60},d={success:"账号安全验证成功",error:"网络故障，请求失败",v3Error:"极验验证码加载失败，请稍后重试",v3Empty:"请点击按钮进行验证",codeEmpty:"请输入验证码"},c={init:function(e){this.option=e||{},this.resouce=e.dys_type,this.getInfoReq()},getDoms:function(){var t=e("#account-security-wrap");this.doms={wrap:t,phoneInput:t.find(".js-account-security-input"),smsBtn:t.find(".js-account-security-sms"),submitBtn:t.find(".js-account-security-button"),v3Box:t.find(".account-security-captcha")}},getCSRFCookie:function(t){var a=this,i=s.get(n.get("sys.tvk")),o=n.get("sys.tn");return i?void(t&&t({name:o,value:i})):void e.ajax({url:l.csrfUrl,type:"GET",dataType:"json",success:function(e){0===e.error&&a.getCSRFCookie(t)}})},sendAjax:function(t){this.getCSRFCookie(function(a){t.data||(t.data={}),t.data[a.name]=a.value,e.ajax({url:t.url,type:"POST",dataType:"json",data:t.data,complete:t.complete||e.noop,success:t.success||e.noop,error:t.error||e.noop})})},getInfoReq:function(){var t=this;t.sendAjax({url:l.getInfoUrl,success:function(a){0===+a.error?(l.type=+a.data.validate_type,t.show(a.data)):a.msg&&e.dialog.tips_black(a.msg)},error:function(){e.dialog.tips_black(d.error)}})},show:function(a){if(!e("."+l.pre).length){var i=this,s=i.tpl(a);r.exe("js_exitFullScreen"),e.dialog({skin:l.pre,content:s,title:"",close:function(){i.v3Destroy()}}),i.getDoms(),i.v3Init(a.validate_str||{}),i.bindEvt(),t.trigger("dys",{key:"dys.room.account.security.show.type"+l.type,resouce:i.resouce})}},hide:function(){e("."+l.pre).length&&(e("."+l.pre).hide().remove(),this.v3Destroy())},tpl:function(e){var t=+e.validate_type||1,s="",n="";switch(t){case 1:s=a.string.join('<div class="account-security-row">','<div class="account-security-area"></div>','<div class="account-security-captcha"></div>',"</div>"),n="极验验证";break;case 2:s=a.string.join('<div class="account-security-row">','<div class="account-security-area"></div>','<div class="account-security-captcha type-sms"></div>',"</div>",'<div class="account-security-row">','<div class="account-security-box clearfix">','<input type="text" class="account-security-input fl js-account-security-input" maxlength="6" placeholder="请输入验证码"/>','<button class="account-security-sms button fl js-account-security-sms">',"{{ if data.is_foreign === 0 }}","短信","{{ else }}","语音","{{ /if }}","验证</button>","</div>","</div>",'<button class="account-security-submit button js-account-security-button">提交验证</button>'),n="手机验证（"+(e.phone||"")+"）",this.dysIsForeign=0===e.is_foreign?"2":"1";break;case 3:s=a.string.join('<div class="account-security-row account-security-666">','请编辑短信： <span class="account-security-f70 account-security-text">{{ data.code }}</span>','发送到： <span class="account-security-f70">{{ data.douyu_phone }}</span>',"</div>",'<div class="account-security-row">','<span class="account-security-999 account-security-tip">',"短信费用一般为0.1元/条，全部由运营商收取","</span>","</div>",'<button class="account-security-submit account-security-next button js-account-security-button">我已发送短信，下一步</button>'),n="手机验证（"+(e.phone||"")+"）"}var o=i.compile(s),r=o({data:e});return['<div class="account-security-wrap" id="account-security-wrap">','<div class="account-security-content">','<div class="account-security-main">','<div class="account-security-row">','<span class="account-security-type">验证方式：</span>','<span class="account-security-666">',n,"</span>","</div>",r,"</div>","</div>","</div>"].join("")},v3Init:function(e){var t=this,a=e.success&&e||null,i=this.doms.v3Box;!l.v3Instance&&i.length&&(l.v3Instance=o.init(i,{idpre:l.pre,checkOptions:a,success:function(e){1===l.type&&t.sendSubmitReq(e)},error:function(){t.v3Error(i)}},{area:".account-security-area"}))},v3Error:function(e){e.text(d.v3Error)},v3refresh:function(){l.v3Instance&&l.v3Instance.refresh()},v3getResult:function(){return l.v3Instance?l.v3Instance.getFastResult():null},v3Destroy:function(){l.v3Instance&&l.v3Instance.destroy(),l.v3Instance=null},countDown:function(e,t,a){var i=this;a>=0?(e.attr("disabled",!0).text(t+"("+a+")").addClass("gray"),a--,clearTimeout(l.timer),l.timer=setTimeout(function(){i.countDown(e,t,a)},1e3)):i.clearSmsTimer(e)},clearSmsTimer:function(e){clearTimeout(l.timer),e.attr("disabled",!1).text("重新获取").removeClass("gray")},restore:function(){var e=this;switch(l.type){case 1:e.v3refresh();break;case 2:e.v3refresh(),e.clearSmsTimer(e.doms.smsBtn)}},sendSmsReq:function(t,a){var i=this,s=t.text();l.lock.smsCode=!0,i.sendAjax({url:l.smsUrl,data:a,complete:function(){l.lock.smsCode=!1},success:function(a){a&&0===+a.error?i.countDown(t,s,l.time):(i.restore(),a.msg&&e.dialog.tips_black(a.msg))},error:function(){i.restore(),e.dialog.tips_black(d.error)}})},sendSubmitReq:function(a){var i=c;a.rid=n.get("room.room_id"),a.resource=i.resouce,l.lock.submit=!0,i.sendAjax({url:l.submitUrl,data:a,complete:function(){l.lock.submit=!1},success:function(a){a&&0===+a.error?(e.dialog.tips_black(d.success),i.hide(),t.trigger("dys",{key:"dys.room.account.security.submit"+l.type+".succ",resouce:i.resouce})):(a.msg&&e.dialog.tips_black(a.msg),i.restore(),t.trigger("dys",{key:"dys.room.account.security.submit"+l.type+".fail",resouce:i.resouce}))},error:function(){e.dialog.tips_black(d.error),i.restore(),t.trigger("dys",{key:"dys.room.account.security.submit"+l.type+".fail",resouce:i.resouce})}})},bindEvt:function(){var a=this,i=a.doms;i.wrap.on("click.get.sms.code",".js-account-security-sms",function(){var i=a.v3getResult();if(!i)return void e.dialog.tips_black(d.v3Empty);var s=e(this);l.lock.smsCode||s.hasClass("gray")||(a.sendSmsReq(s,i),t.trigger("dys",{key:"dys.room.account.security.getsms",verify_type:a.dysIsForeign,resouce:a.resouce}))}).on("click.account.security.submit",".js-account-security-button",function(){if(!l.lock.submit){var s={};if(2===l.type){if(!a.v3getResult())return void e.dialog.tips_black(d.v3Empty);if(s.code=i.phoneInput.val(),!s.code)return void e.dialog.tips_black(d.codeEmpty)}a.sendSubmitReq(s),t.trigger("dys",{key:"dys.room.account.security.submit"+l.type+".click",resouce:a.resouce})}})}};return{init:function(e){c.init(e)}}}),define("douyu/page/room/normal/mod/gift",["jquery","shark/class","shark/observer","shark/util/cookie/1.0","shark/util/flash/data/1.0","shark/util/template/1.0","shark/util/date/1.0/date","douyu/context","douyu/com/sign","douyu/com/user","douyu/com/exjsonp","douyu/com/get-gift-configs","douyu/page/room/base/api","douyu/page/room/normal/mod/gift-queue","shark/util/storage/1.0","douyu/com/room-gift-tmp","douyu/page/room/normal/mod/account-security"],function(e,t,a,i,s,n,o,r,l,d,c,u,g,m,p,f,h){var v="",b="";a.on("mod.room.spring.activity.stage",function(e){b=e}),a.on("mod.room.spring.gift.config",function(e){v=e.giftId});var y,k,w=function(e){var t=e||0,a=1e4,i=1e8,s=Math.pow(10,2);return t>=i?Math.floor(t/i*s)/s+"亿":t>=a?Math.floor(t/a*s)/s+"万":t>0?Math.floor(t*s)/s:t},_={CGIFT:{},ERR:{207:"参数错误",218:"请先绑定手机！",284:"请稍后尝试。。",357:"没有找到礼物",291:"请稍后尝试。"},batchSwitch:!0,timer:null,panelWidth:0,delay:100,currentGiftId:null,prevGiftId:null,currentNumber:0,slider:{prevActionWidth:0,padding:400,offset:0,sliderWidth:0,itemLength:0,itemWidth:0,listWidth:0,visibleLength:0,currentIndex:0,delay:300},nobleInfo:{load:!1,nl:0},giftBatterData:{},giftConfigData:{},propConfigData:{},ywReturnSwitch:0},x=null,T=null,C={data:null,promise:e.Deferred(),isLoading:0,load:function(){var e=this,t=e.promise,a=r.get("sys.webconfUrl")+"resource/common/return_coin/web_return_switch.json";return e.data?t.resolve(e.data):e.isLoading?t:(e.isLoading=1,c.load(a,"yuwanReturnSwitch",function(a){a?(e.data=a,t.resolve(e.data)):t.reject()},function(){t.reject()}),t.promise())}};C.load().then(function(e){var t=e||{};1===t.show_switch&&(_.ywReturnSwitch=1)}),k=t({getDoms:function(){var t=e("#gift-content");this.doms={body:e("body"),giftContent:t,actions:e("#js-stats-and-actions"),giftSlider:t.find('[data-slider="slider"]'),giftSliderPrev:t.find('[data-slider="prev"]'),giftSliderNext:t.find('[data-slider="next"]'),giftSliderCont:t.find('[data-slider="cont"]'),giftSliderList:t.find('[data-slider="list"]'),giftInfoPanel:t.find('[data-type="gift-info-panel"]'),giftInfoCont:t.find('[data-type="gift-info-panel-cont"]')}},init:function(){return this.getDoms(),this.config={giftConfigData:{}},r.get("sys.uid")==r.get("room.owner_uid")?void this.doms.giftContent.hide():void this.addEvent()},checkUser:function(e){if(d.check())return!0;switch(e){case"cq":d.show("login",{source:"click_gift_chouqin"});break;case"gift":d.show("login",{source:"click_gift_send"});break;case"batch-send":d.show("login",{source:"click_gift_batch_send"});break;default:d.show("login")}return!1},addEvent:function(){var t=this,i=this.doms;i.giftContent.on({click:function(){var i=e(this),s=i.data("type"),n=i.data("noble")||0;if("gift"===s&&a.trigger("dys",{key:"dys.room.gift.click",gfid:i.data("giftid")}),"cq"===s&&a.trigger("dys",{key:"dys.room.gift.chouqin.click"}),!t.checkUser(e(this).data("type")))return!1;_.nobleInfo.nl;return!_.nobleInfo.load||1!==n||0!=_.nobleInfo.nl&&0!=_.nobleInfo.noble_gift?("gift"===s&&t.giftSend({target:i,number:1,batch:0}),void("cq"===s&&a.trigger("mod.gift.openCQWindowAndInit",{}))):void t.showNobleError()},mouseenter:function(){var a=e(this),s=(a.data("send"),parseFloat(a.data("name")),e("#gift-content")),n=s.find('[data-type="gift-info-panel"]');_.panelWidth=n.outerWidth();var o=s.find(".firstpay-warp"),r=0;clearTimeout(_.timer),_.currentGiftId=a.data("giftid"),n.css("width","auto"),_.prevGiftId!==_.currentGiftId&&u.getGift().done(function(e){_.giftConfigData=e,t.config.giftConfigData=e,t.updateGiftInfo()}),o&&o.length&&!o.is(":hidden")&&(r=o.outerWidth(!0)),_.panelWidth=n.outerWidth(),n.find(".icon--conner-mark").length&&(_.panelWidth+=12),_.panelWidth<345?_.panelWidth=345:"",_.panelWidth>500?_.panelWidth=500:"",n.stop(!0,!0).removeClass("out");var l=i.giftContent.offset(),d=a.offset(),c=d.left-(l.left+r)-_.panelWidth/2+a.width()/2+4,g=d.top-l.top-a.height()-5;return n.animate({width:_.panelWidth,left:c,bottom:-g},_.delay,function(){n.show()}),!1},mouseleave:function(){var t=e("#gift-content"),a=t.find('[data-type="gift-info-panel"]');return clearTimeout(_.timer),_.timer=setTimeout(function(){a.stop(!0,!0).hide().addClass("out")},_.delay),!1}},"[data-giftid]"),i.giftContent.on("click",'[data-type="toggle"]',function(t){var i=e("#gift-content"),s=i.find('[data-type="gift-info-panel"]');s.find('[data-type="gift-info-panel-form"]').stop(!0,!0).slideToggle(200),e(this).toggleClass("slideDown"),a.trigger("dys",{key:"dys.room.giftSend.multi.send.show",gfid:_.currentGiftId}),t.stopPropagation()}).on({mouseenter:function(){clearTimeout(_.timer)},mouseleave:function(){var t=e("#gift-content"),a=t.find('[data-type="gift-info-panel"]');clearTimeout(_.timer),_.timer=setTimeout(function(){a.stop(!0,!0).hide().addClass("out")},_.delay)}},'[data-type="gift-info-panel"]'),i.giftContent.on("click","[data-gift-number]",function(t){t.stopPropagation(),e(this).addClass("cur").siblings().removeClass("cur"),_.currentNumber=e(this).data("gift-number"),_.batchSwitch&&i.giftInfoPanel.find('[data-type="batch-send"]').removeClass("disabled")}).on("click",'[data-type="batch-send"]',function(){if(e(this).hasClass("disabled")||!_.batchSwitch||!t.checkUser(e(this).data("type")))return!1;var s=i.giftContent.find('[data-giftid="'+_.currentGiftId+'"]'),n=s.data("noble")||0;return 1!==n||_.nobleInfo.nl?(t.giftSend({target:s,number:_.currentNumber||0,batch:1}),void a.trigger("mod.gift.batch.switch.close")):(i.giftInfoPanel.stop(!0,!0).hide().addClass("out"),void t.showNobleError())})},giftSend:function(t){if(r.get("sys.uid")==r.get("room.owner_uid"))return void e.dialog.tips_black("不能给自己赠送礼物");var i=this,s=e(t.target),n=s.data("giftid"),o=s.data("send"),l=s.data("exp"),d={gid:n,send:o,exp:l,count:t.number,sid:r.get("sys.uid"),did:r.get("room.owner_uid"),rid:r.get("room.room_id"),batch:t.batch,num:1},c="full"===a.fire("mod.video.state.get")?2:1,u=_.giftConfigData[n];_.CGIFT.current=n,(1===t.batch||m.hasNext(n))&&(d.delay=s.data("bi")||0),m.push(n,d),1==o&&m.next(n,function(e){i.sendYW(e)}),2==o&&m.next(n,function(e){i.sendYC(e)}),1==t.batch&&a.trigger("dys",{key:"dys.room.giftSend.multi.send",gfid:t.gid,yc:u&&u.pc||"",num:t.number,name:t.target.data("giftname"),src_type:c})},sendYW:function(e){var t=s.encode([{name:"type",value:"dn_s_gf"},{name:"gfid",value:e.gid},{name:"num",value:e.num}]);_.CGIFT[e.gid]={type:"dn_s_gf",gid:e.gid,sid:e.sid,did:e.did,rid:e.rid,exp:e.exp,dy:r.get("room.device_id"),num:e.num},g.exe("js_giveGift",t)},sendYC:function(t){var s,n,o,l,d=this,c="full"===a.fire("mod.video.state.get")?2:1,u=_.giftConfigData[t.gid];n=function(){e.dialog.tips_black("赠送礼物失败！",1.5),m.clear(),a.trigger("mod.gift.batch.switch.open"),a.trigger("dys",{key:"dys.room.giftSend.send.fail",gfid:t.gid,yc:u&&u.pc||""})},s=function(i){var s=i.result,n={},o=i.data&&i.data.ry||0;0==s?(this.fxPopGX({gid:i.data.gid||t.gid,num:i.data.gx*i.data.num,ywnum:o}),1===+i.data.relive&&(g.exe("js_get_relive_card"),a.trigger("room.activity.get.lifecard"),e.dialog.tips_black("复活卡+1，请等待题目推送")),a.trigger("dys",{key:"dys.room.giftSend.send.success",gfid:t.gid,yc:u&&u.pc||"",src_type:c}),m.unlock(i.data.gid),m.hasNext()?m.next(i.data.gid,function(e){d.sendYC(e)}):(m.clear(),a.trigger("mod.gift.batch.switch.open")),n={gold:i.data.sb/100,ngold:i.data.noble_gold/100},o&&(n.silver=(parseInt(e("#js-stats-and-actions").find('[data-login-user="silver"]').text(),10)||0)+(parseInt(o,10)||0)),a.trigger("mod.userinfo.change",{current:n}),parseInt(i.data.noble_gold_black)&&e('[data-login-content="yes"] .y3').hide(),4===+b&&+t.gid===+v&&a.trigger("mod.room.spring.activity.follow"),a.trigger("room.giftprop.send.success.land",i.data.gid),a.trigger("room.gift.send.success.finalyear",{val:i.data.gid,isProp:!1}),a.trigger("room.giftprop.send.success.loveheadline",i.data.gid),a.trigger("room.giftprop.send.success.valentine2018",i.data.gid)):3==s?(this.remindYCLow(),a.trigger("mod.gift.batch.switch.open")):170001==s?h.init({dys_type:2}):(e.dialog.tips_black(i.msg,1.5),m.clear(),a.trigger("mod.gift.batch.switch.open"))},l={num:t.num,sid:t.sid,did:t.did,rid:t.rid,exp:t.exp,dy:r.get("room.device_id")},o=e.extend(!0,{gid:t.gid},l),o[$SYS.tn]=i.get($SYS.tvk)||"",_.CGIFT[t.gid]=o,e.ajax("/member/gift/send/"+t.gid,{type:"post",dataType:"json",data:l,success:e.proxy(s,this),error:n})},showYWLowDlg:function(){var t=this,i=t.adInfo,s='<div class="aui_content">',n=[];if(i){var o=i.srcid.replace(/鱼丸/g,'<span class="highlight">鱼丸</span>');s+='<i class="ad-img"></i><p>赠送失败，鱼丸不足！</p><div class="ad-content" data-dysign="30013" data-dysign-gid="'+i.gid+'" data-dysign-mid="'+i.mid+'"><p class="ad-title">'+o+"</p></div>",n=[{content:"立即前往",className:"ok-btn",callback:function(){t.isNoYCFloatHide=!1,window.open(i.link),this.hide(),a.trigger("mod.sign.dot","30013")}},{content:"暂时不了",className:"cancel-btn",callback:function(){t.isNoYCFloatHide=!1,this.hide()}}]}else s+='<i class="ad-img no-btn"></i><p>赠送失败，鱼丸不足！</p><div>';e.dy_dialog(s,{title:"提示",className:"gift-error",mask:1,width:"420px",height:"283px",buttons:n,afterHide:function(){t.isNoYCFloatHide=!1}})},remindYWLow:function(){var e=this;e.isNoYCFloatHide||(e.isNoYCFloatHide=!0,e.showYWLowDlg=x.showYWLowDlg,e.adInfo?e.showYWLowDlg():l.getAdInfo("30013",function(t){if(t[0]){var a=t[0]||{},i=l.helper.innerLink(a);e.adInfo={srcid:a.srcid,gid:a.gid,mid:a.mid,link:i}}e.showYWLowDlg(),l.exposure()}))},remindYCLow:function(){var t=this;t.isNoYCFloatHide||(t.isNoYCFloatHide=!0,e.dialog({title:"提示",content:"<p>赠送失败<br/>鱼翅不足，点击获取！</p><i></i>",okVal:"充值",skin:"gift-error",lock:!0,ok:function(){try{DYS.storage.save("_dypay_fp",6)}catch(e){}window.open("/web_game/welcome/18"),a.trigger("dys",{key:"dys.room.giftSend.charge.action",gfid:_.currentGiftId})},cancelVal:"取消",cancel:function(){t.isNoYCFloatHide=!1},close:function(){t.isNoYCFloatHide=!1}}),m.clear("yc"),a.trigger("dys",{key:"dys.room.giftSend.charge.show",gfid:_.currentGiftId}))},fxPopGX:function(t){var a,i,s,n,o,r=this.doms.giftContent.find("[data-giftid="+t.gid+"]"),l=r.offset(),d=t.ywnum>0;d?(a=e('<span class="gift-success-tip-num">+'+t.ywnum+"鱼丸</span>"),e("body").append(a),i=l.top-a.height(),s=l.left+(r.width()-a.width())/2,n="-=10px",o=500):(a=e('<span class="gift-success-tip">赠送成功</span>'),e("body").append(a),i=l.top+r.height()-a.height(),s=l.left-a.outerWidth(!0),n="-=50px",o="slow"),a.show(),a.css({top:i,left:s}).animate({top:n},o).fadeOut("slow",function(){e(this).remove()})},updateGiftInfo:function(){var t,a,i,s,o,l,d,c=e("#gift-content"),u=c.find('[data-type="gift-info-panel-cont"]'),g=_.giftConfigData[_.currentGiftId],m=this.doms.giftContent.find('[data-giftid="'+_.currentGiftId+'"]'),f=m.data("type")||"",h=m.data("explain")||"",v=m.data("noble")||0,b=[],y=[],k=T.searchGiftBatter(_.currentGiftId),x=m.data("devote")||0,C=m.data("exp")||0,$=m.data("intimate")||0;g?(l=g.batch_preset.split(","),d=g.hit||[]):(l="".split(","),d=[]);for(var I=0,j=l.length;j>I;I++)""!==l[I]&&b.push(l[I]);for(var D=0,R=d.length;R>D;D++)d[D].is_show&&y.push(d[D]);t=["<%if ( batchPreset.length > 0 ) { %>","<div>","<% } else { %>",'<div class="gift-not-batch">',"<% } %>",'<% if ( type === "gift" ) { %>',"<% if (giftFlagData) { %>",'<div class="icon--conner-mark <%= giftFlagData.flagClass %>">',"<span><%= giftFlagData.flagName %></span>","</div>","<% } %>",'<div class="gift-info-panel-brief">','<div class="gift-info-panel-img">','<img src="<%= gifticon %>"><i></i>',"</div>","<h4><strong><%= giftname %></strong><em>(<%= name %>","<% if (returnYw) { %> 可返<%=returnYw  %>鱼丸<% } %>",")</em>","<% if (isDoubleIntimacy == 1 && exp > 0 && isDoubleIntimacyShow) { %>",'<span class="intimacy-label intimacy-label-show">(亲密度X2)</span>',"<% } %>","</h4>","<p>","<% if(devote >0){%>",'<b>贡献 +<span title="<%= devote %>"><%= devote4Short %></span> </b>',"<% } %>","<% if(exp >0){%>",'<b>经验 +<span title="<%= exp %>"><%= exp4Short %></span> </b>',"<% } %>","<% if(intimate >0 ){%>",'<b>亲密度 +<span title="<%= intimate %>"><%= intimate4Short %></span> </b>',"<% } %>","</p>",'<p class="gift-info-intro"><%= explain %></p>',"<p><em><%= intro %></em></p>","</div>","<% if ( batchPreset.length <= 0) { %>",'<span class="gift-countdown hide"><em>--:--</em>内可连击</span>',"<% } %>","<% if ( effect.length > 0 ) { %>",'<div class="gift-info-panel-explain">',"<% for (var i = 0, length = effect.length; i < length; i++) { %>","<% var item = effect[i]; %>","<p>连击<b><%= item.count %></b>次将","<% if ( item.bt == 1 ) { %>","触发房间广播特效","<% } else if ( item.bt == 2 ) { %>","触发网站广播特效","<% } %>","<% if ( item.bt > 0 && item.type > 0) { %>","，并","<% } %>","<% if ( item.type > 0 ) { %>","获得<em><%= item.name %></em><%= item.time_str %>","<% } %>","</p>","<% } %>","</div>","<% } %>","<% if(freeList.length > 0){%>",'<div class="double-hit" data-id="<%= giftid%>">','<div class="double-hit-info">',"<% for( var j = 0; j< freeList.length&& j< 3; j++){ %>","<% var giveitem = freeList[j];%>",'<p>连击<span class="double-hit-sign">&times;<%= giveitem.combo_num%></span>可获得<span class="double-hit-sign"><%= giveitem.name %></span>',"</p>","<%}%>",'<a class="double-hit-more" href="javascript:;">奖品数量有限哦！点击查看活动详情&gt;</a>',"</div>","</div>","<%}%>","<% } else { %>",'<div class="gift-info-panel-brief">','<div class="gift-info-panel-img">','<img src="<%= gifticon %>"><i></i>',"</div>","<h4><strong><%= giftname %></strong><em>(<%= name %>)</em></h4>","<% for (var i = 0, len = explain.length; i < len; i++) { %>","<p><%= explain[i] %></p>","<% } %>","</div>","<% } %>","</div>","<% if ( batchPreset.length > 0 ) { %>","<% if ( effect.length > 0 ) { %>",'<div class="gift-info-panel-give" data-type="gift-info-give">',"<% } else { %>",'<div class="gift-info-panel-give gift-info-panel-give-not-explain" data-type="gift-info-give">',"<% } %>",'<span class="gift-countdown hide"><em>--:--</em>内可连击</span>','<a href="javascript:;" class="gift-info-panel-toggle" data-type="toggle"><span><em>批量赠送</em><i class="gift-info-panel-toggle-arrow1"></i><i class="gift-info-panel-toggle-arrow2"></i></span></a>','<div class="gift-info-panel-form" data-gid="<%=giftid%>" data-type="gift-info-panel-form">',"<% for (var i = 0, length = batchPreset.length; i < length; i++) { %>",'<a href="javascript:;" data-gift-number="<%= batchPreset[i] %>"><%= batchPreset[i] %></a>'," \r\n ","<% } %>","<% if ( batchSwitch ) { %>",'<a href="javascript:;" class="gift-info-panel-form-send" data-type="batch-send">赠送</a>',"<% } else { %>",'<a href="javascript:;" class="gift-info-panel-form-send disabled" data-type="batch-send" title="请等待批量赠送效果结束后，方可开始下一次批量赠送">赠送</a>',"<% } %>"," \r\n ",'<span class="justify-fix"></span>',"</div>","</div>","<% } %>"].join(""),
a=n.compile(t);var P=S.getFreeGiftList(_.currentGiftId,!0)||[];s=this.getGiftFlagData(_.currentGiftId),s?o={flagClass:s,flagName:g.gift_active_text||"礼物"}:1==v?o={flagClass:"icon--conner-mark-b1",flagName:"贵族"}:2==v&&(o={flagClass:"icon--conner-mark-b3",flagName:"周星"}),i=a({type:f,gifticon:m.data("gifticon")||r.get("sys.web_url")+"app/douyu/res/page/room-normal/loading.gif",giftname:m.data("giftname")||"",giftid:_.currentGiftId,name:m.data("name")||"",devote:x,exp:C,intimate:$,devote4Short:w(x),exp4Short:w(C),intimate4Short:w($),intro:m.data("intro")||"",explain:"gift"!=f?h.split("/"):h,effect:y,batchPreset:b,batchSwitch:_.batchSwitch,isNoble:v,freeList:P,isDoubleIntimacy:p.get("doubleIntimacy"),giftFlagData:o,returnYw:_.ywReturnSwitch&&m.data("returnyw")||""}),u.html(i),k&&u.find(".gift-countdown").removeClass("hide"),_.prevGiftId=_.currentGiftId,u.find("[data-gift-number]").eq(0).click()},getGiftFlagData:function(e){var t,a=_.giftConfigData[e];if(!a)return!1;switch(parseInt(a.gift_active_icon_style,10)){case 1:t="icon--conner-mark-b1";break;case 2:t="icon--conner-mark-b2";break;case 3:t="icon--conner-mark-b3";break;default:t=!1}return t},showNobleError:function(){var t="开通贵族",i=_.nobleInfo;0==i.noble_gift?t="升级贵族":0==i.nl&&i.npl>0&&(t="续费贵族");var s=['<div class="noble--error">','<a class="noble-error--close" href="javascript:;">×</a>','<div class="nobel-error--main">','<i class="nobel-error--icon"></i>','<div class="error-main--content">','<h3 class="content--title">',"您还不是贵族用户","</h3>","<p>","贵族礼物-你的贵族专属特权","</p>",'<a class="btn" href="javascript:;">',t,"</a>","</div>","</div>","</div>"].join("");if(!this.nobleErrorPanel){var n=this;this.nobleErrorPanel=e(s),this.doms.giftContent.find(".g-list").append(this.nobleErrorPanel),this.nobleErrorPanel.on("click",".noble-error--close",function(){n.hideNobleError()}).on("click",".btn",function(){n.hideNobleError(),a.trigger("mod.normal.noble.buy")})}this.nobleErrorPanel.fadeIn(),y.hideExpandGiftPanel()},hideNobleError:function(){this.nobleErrorPanel.fadeOut()}});var S={init:function(){S.giftMap={},S.config={giftConfigData:{}},S.getConfig(),S.bindEvent()},getConfig:function(t){var a=$SYS.webconfUrl+"resource/common/gift_cdk/gift_cdk_config.json";c.load(a,"freeGiftConfig",function(e){S.config=e||{},t&&t()},e.noop,e.noop,!0)},renderTips:function(t){var a=S.getGiftInfo(t.gfid),i=a.name,s=t.cmc;if(s){var n=['<div class="double-hit-pop">','<div class="hit-pop-bg"></div>','<div class="hit-list-close"><span></span></div>','<div class="hit-pop-info">',"<h3>哇！"+i+"&times;"+s+"连击</h3>",'<p>您获得了<span class="hit-list-type">连击礼物赠品</span>，将发放到您的私信请稍后查收</p>','<a href="/member/pm" target="_blank">立即查看</a>',"</div>","</div>"].join("");e("#js-stats-and-actions").append(n)}},getListRender:function(){var e=['<div class="gift-info-panel-cont clearfix">','<div class="hit-list-close"><span></span></div>',"<div>","<h3><%= name %>连击得奖励</h3>",'<div class="hit-list-content">',"<ul>","<%for(var i =0; i< list.length; i++){%>","<% var item = list[i]%>","<li>",'<div class="hit-list-title">','<div class="list-title-txt">连击','<span class="hit-list-type">&times;<%= item.combo_num%></span>获得','<span class="hit-list-type"><%= item.name%></span>',"</div>","</div>",'<div class="hit-list-info">','<p><span class="hit-list-dot"></span>活动说明：<%= item.note%></p>','<p><span class="hit-list-dot"></span>剩余数量：<span class="hit-list-type"><%= item.remain_sum %></span><span>（数据每两分钟更新1次）</span></p>','<p><span class="hit-list-dot"></span>活动时间：<span><%= item.date%></span></p>',"</div>","</li>","<%}%>","</ul>","</div>","</div>","</div>"].join("");S.listRender=n.compile(e)},renderAll:function(t){var a=e(".hit-more-list");0===a.length?a=e('<div class="gift-info-panel hit-more-list"></div>'):a.find(".hit-list-content").mCustomScrollbar("destroy");var i=S.getFreeGiftList(t);if(0!==i.length){S.listRender||S.getListRender();var s=S.getGiftInfo(t),n=S.listRender({list:i,name:s.name,id:t});a.html(n),e("#js-stats-and-actions").append(a),a.show(),a.find(".hit-list-content").mCustomScrollbar()}},bindEvent:function(){g.reg("room_data_handler",function(e){var t=s.decode(e).too();"multiclickres"===t.type&&u.getGift().done(function(e){_.giftConfigData=e,S.renderTips(t)})}),e("#js-stats-and-actions").on("click",".hit-more-list .hit-list-close",function(){e(".hit-more-list").hide()}).on("click",".double-hit-pop .hit-list-close",function(){e(this).closest(".double-hit-pop").fadeOut(function(){e(this).remove()})}).on("click",".double-hit-more",function(){var t=e(".double-hit").data("id");S.getConfig(function(){u.getGift().done(function(e){_.giftConfigData=e,S.renderAll(t)})})}),a.on("mod.room.normal.gift.freegift.show",function(){return e("#gift-content .double-hit-pop").length>0})},getGiftInfo:function(e){var t=_.giftConfigData[e]||{};return t},getFreeGiftList:function(t,a){var i=S.giftMap[t];if(i&&a===!0)return i;if(!S.config[t])return[];i=[];for(var s=S.config[t],n=e(".gift-item[data-giftid="+t+"] .g-img").attr("src"),r=0;r<s.length;r++){var l=s[r],d=l.combo_range.split(":"),c=d[0],u=(d[1]+"").split(",");("0"===c||"1"===c&&-1!==e.inArray($ROOM.category_id+"",u)||"2"===c&&-1!==e.inArray($ROOM.cate_id+"",u))&&(l.icon=n,l.end_time=1e3*parseInt(l.end_time,10),l.start_time=1e3*parseInt(l.start_time,10),0===l.end_time?l.date="永久":(l.date=o.format(new Date(l.start_time),"yyyy.MM.dd"),l.date+=" - ",l.date+=o.format(new Date(l.end_time),"yyyy.MM.dd")),i.push(l))}return S.giftMap[t]=i,i}};y={giftTipsKey:"moreGiftTipsShowed",cacheList:[],$actions:e("#js-stats-and-actions"),$giftContent:e("#gift-content"),maxFoldLength:45,actionExpandStatus:!1,actionOuterWidth:70,actionLayout:function(){if(y.moreActionBtnWrap){var t=y.$actions.find(".action-item");if(y.actionList.hide().append(t),y.moreActionBtnWrap.hide(),0!==t.length){var i=0,s=0;y.$giftContent.is(":visible")?(i=y.$giftContent.outerWidth(),s=parseInt(y.$giftContent.css("marginLeft"),10)||0):i=e(".room-waring-close").outerWidth();var n=y.$actions.width(),o=e(".task-Getyw").width(),r=0;"full"===a.fire("mod.video.state.get")&&(r=e(".uinfo-ywyc").width()+10);var l=n-i-s-o-r,d=e(".action-item[data-fold=0][data-hide!=1]"),c=e(".action-item[data-fold=1][data-hide!=1]"),u=c.length,g=d.length,m=Math.floor(l/y.actionOuterWidth);m>=g+u?(c.show(),d.show(),y.actionList.show()):m>g?(y.moreActionBtnWrap.show(),y.resizeFoldCont(u),y.foldCont.append(c),c.show(),d.show(),y.actionList.show()):(d.slice(m).hide(),y.foldCont.append(c),d.slice(0,m).show(),y.actionList.show()),y.collectActionDys(y.$actions.find(".action-list .action-item")),y.packActionGift()}}},resizeFoldCont:function(e){var t=e>9?9:e,a=t*y.actionOuterWidth;y.foldCont.width(a),y.foldPanel.width(a-10)},render:function(){var t=['<div class="action-list fl">',"</div>",'<div class="more-action-btn-wrap fl">','   <div class="more-action-btn">',"   </div>",'   <div class="item-expand-panel expand-action-panel">','       <div class="item-expand-cont clearfix">',"       </div>",'       <div class="expand-arrow">','           <div class="expand-arrow-bg"></div>','           <div class="expand-arrow-over"></div>',"       </div>",'       <div class="cover"></div>',"   </div>","</div>"].join("");e(".task-Getyw").after(t),y.renderActionList()},renderActionList:function(){var t=["<% for ( var i=0; i<list.length ;i++ ){%>","<% var item = list[i];  %>","<% if(item){ %>","<% if (item.activity_link.length > 0){ %>",'<a href="<%= item.activity_link %>" target="_blank"',"<% }else{ %>","<div","<% } %>",' class="action-item" data-fold="<%= item.fold %>" data-flag="<%=item.activity_flag%>" data-hide="<% if(item.activity_flag){ %>1<%} else {%>0<%}%>" data-id="<%=item.id%>">',"<% if( item.icon_default ) {%>",'<img class="action-img" src="<%= item.icon_default %>" width="60" height="40" data-default="<%= item.icon_default %>"  data-hover="<%= item.icon_hover || item.icon_default %>"/>',"<%}%>","<% if (item.icon_hover_title.length > 0){%>",'<span class="tips"><%= item.icon_hover_title%></span>',"<%}%>","<% if (item.activity_link.length > 0){ %>","</a>","<% }else{ %>","</div>","<% } %>","<% } %>","<% } %>"].join("");y.addActionList(r.get("room.giftActivity.unfold")||[],0),y.addActionList(r.get("room.giftActivity.fold")||[],1);var a=n.compile(t),i=a({list:y.cacheList});e("#js-stats-and-actions .action-list").html(i)},getDoms:function(){y.moreActionBtnWrap=e(".more-action-btn-wrap"),y.moreActionBtn=e(".more-action-btn"),y.foldCont=y.moreActionBtnWrap.find(".item-expand-cont"),y.foldPanel=y.moreActionBtnWrap.find(".expand-action-panel"),y.actionList=y.$actions.find(".action-list")},init:function(){this.render(),this.getDoms(),e("#container").on("click.actionExpand",function(t){var a=e(t.target).closest(".gift-info-panel,.item-expand-panel,.more-gift-btn,.more-action-btn-wrap");0===a.length&&y.packActionGift()}),e("#room-task-trigger,.get-yw .get-box,.backpack-btn").on("click",y.packActionGift),y.moreActionBtn.on("click",function(e){if(y.moreActionBtnWrap.hasClass("expand"))y.hideActionPanel(),a.trigger("dys",{key:"dys.room.normal.action.expand",stat:2});else{var t=y.foldPanel.outerWidth(),i=y.moreActionBtn.offset(),s=y.$actions.offset(),n=i.left-s.left;n>t&&(n=t-70),y.foldPanel.css({left:-n}),y.foldPanel.find(".expand-arrow").css({left:n+30}),y.moreActionBtnWrap.addClass("expand"),a.trigger("dys",{key:"dys.room.normal.action.expand",stat:1}),y.actionExpandStatus!==!0&&(y.collectActionDys(y.moreActionBtnWrap.find(".action-item")),y.actionExpandStatus=!0)}return y.hideExpandGiftPanel(),!1}),e("#gift-content").on("click",".more-gift-btn",function(e){return y.toggleExpandGiftPanel(),a.trigger("dys",{key:"dys.room.gift.more.click"}),!1}).on("mouseenter",".more-gift-btn",function(){var t=e(this);return t.hasClass("expand")?t.attr("title","点击收起礼物"):t.attr("title","点击查看更多礼物"),!1}),e("#gift-content").on("click",".expand-gift-panel-close",function(){return y.toggleExpandGiftPanel(),!1}),y.$actions.on({mouseenter:function(){var t=e(this),a=t.find(".tips"),i=a.outerWidth()/2,s=t.offset().left;i=s+30>i?i:30+s,a.css({left:-i}),t.stop().animate({top:-4},200);var n=t.find(".action-img");n.attr("src",n.data("hover"))},mouseleave:function(){var t=e(this);t.stop().animate({top:0},200);var a=t.find(".action-img");a.attr("src",a.data("default"))},click:function(){a.trigger("dys",{key:"dys.room.normal.action.click",active_id:e(this).data("id"),is_fold:e(this).data("fold")})}},".action-item"),y.actionLayout()},collectActionDys:function(t){t.each(function(){var t=e(this);"1"===t.data("dysshow")||t.is(":hidden")||(t.data("dysshow","1"),a.trigger("dys",{key:"dys.room.normal.action.activity",active_id:t.data("id")}))})},packActionGift:function(){y.hideActionPanel(),y.hideExpandGiftPanel()},hideActionPanel:function(){y.moreActionBtnWrap.removeClass("expand")},hideExpandGiftPanel:function(){e(".giftInfoPanel").hide(),e(".more-gift-btn").removeClass("expand"),y.foldPanel.removeClass("expand")},toggleExpandGiftPanel:function(){e(".more-gift-btn").toggleClass("expand"),e('[data-type="gift-info-panel"]').hide(),e(".expand-gift-panel").toggleClass("expand"),y.hideActionPanel()},showExpandGiftPanel:function(){e(".more-gift-btn").addClass("expand"),e('[data-type="gift-info-panel"]').hide(),e(".expand-gift-panel").addClass("expand"),y.hideActionPanel()},addActionList:function(e,t){for(var a=0;a<e.length;a++){var i=e[a];i.fold=t,y.cacheList.push(i)}},addAction:function(t){var a=e(".action-item[data-flag="+t.flag+"]");if(0===a.length)e(t.dom).hide();else{var i=a.find(".tips");a.html(t.dom),t.tips&&t.tips.length>0?a.append('<span class="tips">'+t.tips+"</span>"):a.append(i),a.attr("data-hide","0")}y.actionLayout()},hideAction:function(t){e(".action-item[data-flag="+t.flag+"]").hide().attr("data-hide","1"),y.actionLayout()}},T={hoverPropStatus:!1,doms:{giftBox:e("#gift-content"),propBox:e(".backpack")},config:{hoverIndex:"",giftBattertimer:"",roundBatterTimer:"",cssTimer:"",giftBatterData:{},propConfigData:{}},init:function(){this.bindEvent(),this.initYwReturnTip()},getRestTime:function(e){var t,a;return e=e?parseInt(e,10):0,t=new Date,t.setDate(t.getDate()+e),t.setHours(24),t.setMinutes(0),t.setSeconds(0),a=t.getTime()-(new Date).getTime()},initYwReturnTip:function(){var t=this;p.get("ywreturn-tip")||e.when(C.load(),f.render()).then(function(a){var i,s=a||{};1===s.show_switch&&(i=e('<div class="ywreturntip"></div>'),e("#gift-content").append(i),i.fadeIn(700),setTimeout(function(){i.fadeOut(500,function(){e(this).remove()})},5e3),p.set("ywreturn-tip",1,t.getRestTime()/1e3))})},formatTime:function(e){return 0==e?"00":10>e?"0"+e:e},refrushPropPos:function(e){var t=this.doms;t.$panel=t.propBox.find(".prop-info-panel");var a,i,s,n,o=(t.$panel.find(".gift-countdown"),t.$panel.find(".prop-info-panel-cont")),r=this.doms.propBox.find(".prop-page .prop").eq(this.config.hoverIndex),l=r.index();o&&o.length&&(clearTimeout(this.cssTimer),this.cssTimer=setTimeout(function(){a=t.$panel.outerWidth()<280?280:t.$panel.outerWidth(),i=t.$panel.outerHeight(),s=(a-280)/2,n=i-132,t.$panel.css({left:-47-s+l%5*68,top:-62-n+68*Math.floor(l/5)}).fadeIn("fast")},10))},hidePropInfoBatter:function(){this.doms.propBox.find(".gift-countdown").addClass("hide")},addGiftBatter:function(e){var t=this.doms.giftBox.find('.gift-item[data-giftid="'+e+'"]'),a=this.doms.propBox.find('.prop-page .prop[data-giftid="'+e+'"]'),i=t.find(".gift-mask"),s=a.find(".gift-mask");_.currentGiftId==e&&this.doms.giftBox.find(".gift-countdown").removeClass("hide"),a&&a.length&&(this.doms.propBox.find(".gift-countdown").removeClass("hide"),this.refrushPropPos(e)),i&&i.length?i.fadeIn():t.append('<em class="gift-mask"></em>'),s&&s.length?s.fadeIn():a.prepend('<em class="gift-mask"></em>')},removeGiftBatter:function(e){var t=this.doms.giftBox.find('.gift-item[data-giftid="'+e+'"]'),a=this.doms.propBox.find('.prop-page .prop[data-giftid="'+e+'"]'),i=this.doms.propBox.find(".prop-info-panel .gift-countdown");_.currentGiftId==e&&this.doms.giftBox.find(".gift-countdown").addClass("hide"),i.data("gid")==e&&(this.doms.propBox.find('.prop-info-panel .gift-countdown[data-gid="'+e+'"]').addClass("hide"),this.refrushPropPos(e)),t.find(".gift-mask").fadeOut(),a.find(".gift-mask").fadeOut()},showGiftBatterTime:function(e,t){var a=this.doms.giftBox.find(".gift-countdown").find("em"),i=this.doms.propBox.find(".prop-info-panel .gift-countdown").find("em"),s=parseInt(e/1e3,10),n=parseInt(s/60,10),o=s-60*n;n=this.formatTime(n),o=this.formatTime(o),a.text(n+":"+o).parent().attr("data-gid",t),i.text(n+":"+o).parent().attr("data-gid",t)},giftBatterTimeRun:function(e,t){var a=this,i=+new Date;0>=e-i||(a.showGiftBatterTime(e-i,t),clearTimeout(this.config.giftBattertimer),this.config.giftBattertimer=setTimeout(function(){a.giftBatterTimeRun(e,t)},500))},searchGiftBatter:function(e){var t,a=this,i=a.config.propConfigData||{},s=this.config.giftBatterData,n=+(new Date).getTime();return s?s[e]?(t=s[e].giftEndTime-n,0>=t?(delete s[e],!1):(this.addGiftBatter(e),(_.currentGiftId==e||i[e]||a.hoverPropStatus)&&this.giftBatterTimeRun(s[e].giftEndTime,e),s[e].giftEndTime)):!1:void 0},roundStatusGiftBatter:function(){var e=this,t=this.config.giftBatterData,a=+(new Date).getTime(),i=!1;for(var s in t)t[s]&&(i=!0,a=(new Date).getTime(),a>=t[s].giftEndTime&&(this.removeGiftBatter(s),delete t[s]));i&&(clearTimeout(this.config.roundBatterTimer),this.config.roundBatterTimer=setTimeout(function(){e.roundStatusGiftBatter()},1e3))},roundStatusPropBatter:function(){var e=this,t=this.config.giftBatterData,a=+(new Date).getTime();for(var i in t)t[i]&&(a=(new Date).getTime(),a<t[i].giftEndTime&&e.addGiftBatter(i))},updateGiftBatterData:function(e){var t=this;e&&(t.config.giftBatterData[e.giftId]={giftId:e.giftId,giftBatterTime:e.giftBatterTime,giftEndTime:(new Date).getTime()+parseInt(e.giftBatterTime,10)},t.roundStatusGiftBatter(),t.searchGiftBatter(e.giftId))},getGiftBatterData:function(e){for(var t,a=[],i=s.isArray(e.lst)?s.decode(e.lst):[{value:e.lst}],n=0;n<i.length;n++)t=i[n],t&&t.value&&(t=s.decode(t.value).too(),a.push(t),this.updateGiftBatterData({giftId:t.gid,giftBatterTime:1e3*t.st}));return a},bindEvent:function(){var e=this;g.reg("room_data_handler",function(t){var a=s.decode(t).too();"gst"==a.type&&f.render().done(function(){u.getProp().done(function(t){e.config.propConfigData=t||{},e.getGiftBatterData(a)})})}),a.on("mod.gift.send.batter.update",function(t){u.getProp().done(function(a){e.config.propConfigData=a||{},e.updateGiftBatterData(t)})}),a.on("mod.prop.hover.batter.search",function(t,a){var i;e.config.hoverIndex=a,e.hoverPropStatus=!0,e.hoverPropStatus=!1,u.getProp().done(function(a){e.config.propConfigData=a||{},i=e.searchGiftBatter(t),i||e.hidePropInfoBatter()})}),a.on("mod.prop.open.batter.update",function(t){e.roundStatusPropBatter()})}},a.on("mod.normal.gift.expand",function(){y.actionLayout()}),a.on("mod.chat.action.view.add",function(e){y.addAction(e)}),a.on("mod.chat.action.view.hide",function(e){y.hideAction(e)}),a.on("mod.chat.expandGiftPanel.show",function(e){y.showExpandGiftPanel()}),a.on("mod.chat.expandGiftPanel.hide",function(e){y.hideExpandGiftPanel()}),a.on("mod.gift.batch.switch.open",function(){x&&(_.batchSwitch=!0,x.doms.giftInfoPanel.find('[data-type="batch-send"]').removeClass("disabled").removeAttr("title"))}),a.on("mod.gift.batch.switch.close",function(){x&&(_.batchSwitch=!1,x.doms.giftInfoPanel.find('[data-type="batch-send"]').addClass("disabled").attr({title:"请等待批量赠送效果结束后，方可开始下一次批量赠送"}))}),a.on("mod.gift.yw.res",function(t){var i="full"===a.fire("mod.video.state.get")?2:1,n=null,o=function(){x&&(t=s.decode(t).too(),n=_.giftConfigData[t.gfid],"dsgr"===t.type&&(0==t.r?(a.trigger("dys",{key:"dys.room.giftSend.send.success",gfid:t.gfid,yw:n&&n.pc||"",src_type:i}),x.fxPopGX({gid:t.gfid,num:t.ms/100}),m.unlock(t.gfid),m.hasNext()?m.next(t.gfid,function(e){x.sendYW(e)}):(m.clear(),a.trigger("mod.gift.batch.switch.open")),a.trigger("mod.userinfo.update.yw",t.sb)):283==t.r?x.remindYWLow():(e.dialog.tips_black(_.ERR[t.r]||"未知错误："+t.r,1.5),m.clear(),a.trigger("mod.gift.batch.switch.open"))))};u.getGift().done(function(e){_.giftConfigData=e,o()})}),a.on("mod.gift.exp.up",function(e){var t=_.CGIFT[e.gid];if(t&&t.exp){var i=null;e&&(i=e.silver),a.trigger("mod.userinfo.change",{change:{exp:t.exp,silver:i,type:"yuwan"}})}}),a.on("mod.gift.auto.send.set",function(e){e||m.clear()}),a.on("mod.room.chat.gift.noble.info",function(e){var t=_.nobleInfo;if(t.load=!0,t.nl=e.nl,e.nl>0){var a=$ROOM.nobleConfig[e.nl]||{};t.noble_gift=a.noble_gift,t.npl=e.npl}}),a.on("mod.gift.draw.batch.send",function(e){u.getGift().done(function(t){_.giftConfigData=t,x.giftSend(e)})}),a.on("mod.gift.spring.activity.send",function(e){u.getGift().done(function(t){_.giftConfigData=t,x.giftSend(e)})}),a.on("mod.gift.draw.fish.dialog",function(){x.remindYWLow()});var $={init:function(e){return x=new k(e),y.init(),S.init(),T.init(),x},loadYwReturnSwitch:function(){return C.load()}};return $}),define("douyu/page/room/normal/mod/gift/controller/vcode-user-v3",["jquery","shark/class","shark/observer"],function(e,t,a){var i={type:null,fast:{idpre:"gt-captcha-",count:0}},s=t({init:function(t){this.config=e.extend(!0,{},{target:null},t),this.render()},nextId:function(){return i.fast.idpre+ ++i.fast.count},getResult:function(){return this.config.result},check:function(e){this.buildAsync(e)},render:function(){this.config.$tar=e(this.config.target),this.config.$el=this.config.$tar.find(".captcha-gt")},build:function(e){var t=this.nextId(),i=this,s="zh-cn";"en"===$SYS.lang&&(s=$SYS.lang),this.config.$el.html('<div id="'+t+'"></div>'),this.config.result=null;var n={gt:e.gt,challenge:e.challenge,offline:!e.success,new_captcha:!0,product:"float",lang:s};window.initGeetest(n,function(e){e.appendTo("#"+t),e.onSuccess(function(){i.config.result=i.plugin.getValidate(),a.trigger("com.vcode.fast.check.success",{value:i.config.result,target:i.config.$tar})}),e.onError(function(){i.config.result=null}),i.plugin=e})},buildAsync:function(e){var t=this,a=location.protocol;require.use([a+"//static.geetest.com/static/tools/gt.js"],function(){t.build(e)})},refresh:function(){this.plugin.reset(),this.config.result=null},show:function(){this.config.$el.show()},hide:function(){this.config.$el.hide()},destroy:function(){this.plugin.destroy()}}),n={init:function(e,t){var a=new s({target:e,product:"float"});return a.check(t),{refresh:function(){a.refresh()},isFast:function(){return"fast"===i.type},getFastResult:function(){return a.getResult()},destroy:function(){return a.destroy()}}}};return n}),define("douyu/page/room/normal/mod/gift/constants",function(){var e={VERSION:"room.gift."},t={GIFT_BEGIN:"begin",GIFT_ROCKET:"rocket",GIFT_ROCKET_SIMPLE:"rocketSimple",GIFT_OWNER_ROCKET:"ownerRocket",GIFT_OWNER_ROCKET_SIMPLE:"ownerRocketSimple",GIFT_PLANE:"plane",GIFT_PLANE_SIMPLE:"planeSimple",GIFT_OWNER_PLANE:"ownerPlane",GIFT_OWNER_PLANE_SIMPLE:"ownerPlaneSimple",GIFT_COMMON:"common",GIFT_COMMON_SIMPLE:"commonSimple",GIFT_OWNER_COMMON:"ownerCommon",GIFT_OWNER_COMMON_SIMPLE:"ownerCommonSimple",GIFT_SUPER:"super",GIFT_SUPER_SIMPLE:"superSimple",GIFT_OWNER_SUPER:"ownerSuper",GIFT_OWNER_SUPER_SIMPLE:"ownerSuperSimple",GIFT_NORMAL:"normal",GIFT_NORMAL_SIMPLE:"normalSimple",GIFT_PECK:"peck",GiFT_USENTER_LIST:"userEnterList",GiFT_BANNER_LIST:"userEnterBanners",OPEN_NOBLE_PUSH:"openNoblePush",OPEN_NOBLE:"openNoble",OPEN_NOBLE_SIMPLE:"openNobleSimple",RAISE_UP:"raiseUp",RAISE_SMALL_UP:"raiseSmallUp",PLANE_UP:"planeUp",PLANE_SMALL_UP:"planeSmallUp",COMMON_UP:"commonUp",COMMON_SMALL_UP:"commonSmallUp",SUPER_UP:"superUp",SUPER_SMALL_UP:"superSmallUp",BANNER:"banner",DROP_DOWN:"dropDown",TREASURE_BOX:"treasureBox",NOBLE_TREASURE_BOX:"nobleTreasureBOx",RAISE_UP_CONTROLLER:"raiseUpController",BANNER_CONTROLLER:"bannerController",DROP_DOWN_CONTROLLER:"dropDownController",TREASURE_BOX_CONTROLLER:"treasureBoxController",IS_LOGIN_CONTROLLER:"isLoginStatus",RAISE_UP_VIEW:"raiseUpView",BANNER_VIEW:"bannerView",DROP_DOWN_VIEW:"dropDownView",TREASURE_BOX_VIEW:"treasureBoxView",TREASURE_OVER_TIME:"treasureOverTime",TREASURE_ALL_EMPTY:"allGiftOver",GET_GIFT_DATA:"getgiftdata",GET_GIFT_BACK:"getGiftBack",GIFT_DESTORY:"giftDestory",GIFT_GET_LUCYKING:"giftGetLuckKing"},a=function(){for(var a in t)t[a]=e.VERSION+t[a];return t.VERSION=e.VERSION,t}();return a}),define("douyu/page/room/normal/mod/gift/base/extends",function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();return e}),define("douyu/page/room/normal/mod/gift/base/model",["douyu/page/room/normal/mod/gift/base/extends"],function(e){var t=function(){function e(e,t){this.data=e,this.localMapping=t}return e.prototype.toBackendModel=function(){},e.prototype.fromBackendModel=function(e){var t={};for(var a in this.backendModelMap){var i=this.backendModelMap[a];"string"==typeof i?t[a]=e[i]:"function"==typeof i&&(t[a]=i(e))}return this.data=t,this},e}();return t}),define("douyu/page/room/normal/mod/gift/base/queue",function(){var e=function(){function e(){var e=this;this.jobs=[],this.dfd=$.Deferred(),this.dfd.then(function(){e.feed()}),this.currentJobDfd=null}return e.prototype.addJob=function(e){this.jobs.push(e),this.currentJobDfd||this.feed()},e.prototype.removeJob=function(e){},e.prototype.feed=function(){var e=this.jobs.shift(),t=this;e?this.dfd.then(function(){return this.currentJobDfd=e(),this.currentJobDfd}).then(function(){t.feed()}):this.currentJobDfd=null},e.prototype.run=function(){this.dfd.resolve()},e.prototype.stop=function(){alert("stop queue"),this.currentJobDfd&&this.currentJobDfd.reject()},e.prototype.pause=function(){},e}();return e}),define("douyu/page/room/normal/mod/gift/model/commonmodel",["jquery","douyu/context","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/base/model","douyu/page/room/normal/mod/gift/constants"],function(e,t,a,i,s){var n=t.get("sys.web_url"),o=function(t){function i(a,i){var s=t.call(this,a,i)||this;return this.useFullData={},s.backendModelMap=e.extend({effect:"ef",smallGiftAnimateImg:function(e){var t=e.small_effect_icon;if(e.small_effect_icon)return e.small_effect_icon;switch(parseInt(e.ef,10)){case 1:t=n+"app/douyu/res/page/room-normal/gift/rocketSmall.png?v=20170616";break;case 2:t=n+"app/douyu/res/page/room-normal/gift/planeSmall.png?v=20170616";break;case 3:t=n+"app/douyu/res/page/room-normal/gift/kissSmall.png?v=20170616";break;case 4:t=n+"app/douyu/res/page/room-normal/gift/carSmall.png?v=20170616";break;case 5:t=n+"app/douyu/res/page/room-normal/gift/shipSmall.png?v=20170616";break;case 101:t=n+"app/douyu/res/page/room-normal/gift/superRocketSmall.png?v=20170616"}return t},bigGiftAnimateImg:function(e){var t=e.big_effect_icon;if(e.big_effect_icon)return e.big_effect_icon;switch(parseInt(e.ef,10)){case 1:t=n+"app/douyu/res/page/room-normal/gift/rocket.gif?v=20160322";break;case 2:t=n+"app/douyu/res/page/room-normal/gift/plane.png?v=20160322";break;case 3:break;case 4:break;case 5:break;case 101:}return t},giftAnimateAttachImg:function(e){return e.swf?e.swf:"/common/douyu/images/giftbatter/frog.swf?v=20170616"},giftAnimateAttachSwf:function(e){var t=e.web_flash;if(e.web_flash)return e.web_flash=e.web_flash.replace(/https?:/,""),e.web_flash;switch(parseInt(e.ef,10)){case 101:t="/common/douyu/images/giftbatter/super-rocket.swf?v=20170616"}return t},giftIconImg:"gift_pic",bannerSenderNameColor:"urgb",giftName:"name",bannerGiftNameColor:"grgb",bannerBgImg:"bimg",bannerGiftImg:"himg",bannerWordColor:"drgb",bannerGiftBorderColor:"brgb",contribution:"devote",isBannerStay:"is_stay",bannerStayTime:"stay_time",effectType:"type",isNobleEffectShow:"is_special",openNobleBg:function(e){var t=e.nobleBg;return e.nobleBg?e.nobleBg:t=n+"/app/douyu/res/page/noble/noble-"+parseInt(e.nobleLev,10)+".png?v=20170916"},openNobleLev:"nobleLev",openNobleEffectFlash:function(e){var t=e.nobleFlash;return e.nobleFlash?(e.nobleFlash=e.nobleFlash.replace(/https?:/,""),e.nobleFlash):t="/common/douyu/images/giftbatter/open-noble-"+parseInt(e.nobleLev,10)+".swf?v=20170916"}},i),s.fromBackendModel(a),s}return a(i,t),i.prototype.mergeData=function(t){var a={};e.extend(!0,a,this.data,t.data),this.useFullData=a},i}(i);return o}),define("douyu/page/room/normal/mod/gift/base/view",["jquery","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/base/queue","douyu/page/room/normal/mod/gift/model/commonmodel","douyu/com/get-gift-configs"],function(e,t,a,i,s){var n=function(){function e(t){this.element=t,this.giftConfig=e.giftDictionary,this.propConfig=e.propDictionary}return e.prototype.render=function(){throw new Error("子类必须实现该方法")},e}();return n.giftDictionary=function(){var t,a={},n=e.Deferred();return s.getGift().done(function(e){t=e||{};for(var s in t)a[s]=new i(t[s]);return a}),n}(),n.propDictionary=function(){var t,a={},n=e.Deferred();return s.getGift().done(function(e){t=e||{};for(var s in t)a[s]=new i(t[s]);return a}),n}(),n}),define("douyu/page/room/normal/mod/gift/timer",function(){var e=function(){function e(){this.time=0,this.isRunning=!1,this._callback=null,this._interval=0,this.last=0}return e.prototype.increase=function(e,t,a,i){return this._run(0)(e,t,a,i),this},e.prototype.decrease=function(e,t,a,i){return this._run(1)(e,t,a,i),this},e.prototype._run=function(e){var t=this;return e&&(t._set=t.time),function(a,i,s,n){if(t.isRunning)return!1;t.isRunning=!0,t._callback=s,t._interval=a,t._tick=i||1e3,t._finish=n||function(){},t.last=e;var o=+new Date;!function r(){var n=+new Date,l=parseInt((n-o)/1e3);return s(t.time/1e3),e?t.time-=i:t.time+=i,t.time<0||a&&l>=a?(t.stop(),void t._finish()):void(t.times=setTimeout(function(){r()},i))}()}},e.prototype.set=function(e){return this.isRunning?!1:(this.time=1e3*e,void(this._time=this.time))},e.prototype.stop=function(){clearTimeout(this.times),this.time=null,this.isRunning=!1},e.prototype.parse=function(){clearTimeout(this.times),this.isRunning=!1},e.prototype.restore=function(){this.last?this.decrease(this._interval,this._tick,this._callback,this._finish):this.increase(this._interval,this._tick,this._callback,this._finish)},e.prototype.restart=function(){this.stop(),this._time&&(this.time=this._time),this.restore()},e}();return e}),define("douyu/page/room/normal/mod/gift/controller/treasure",["jquery","shark/util/lang/1.0","shark/util/template/1.0","shark/util/storage/1.0","douyu/context","shark/observer"],function(e,t,a,i,s,n){var o=function(e,t){for(var a,i=0,s=e.length,n=new String,o=0;s>o;o++)if(a=e.charAt(o),i++,escape(a).length>4&&i++,n=n.concat(a),i>=t)return n=n.concat("...");return t>i?e:void 0},r=function(e){for(var t=i.get("hasGetGift"),a=t?t.split(","):[],s=e,n=0;n<a.length;n++)for(var o=a[n],r=0;r<s.length;r++)parseInt(o,10)===parseInt(s[r].giftBoxId,10)&&(s.splice(r,1),r--);return s},l={init:function(t){var a=e("#right_col_peck"),i=a.find(".peck-tip");a.on("mouseenter",function(){t>0||e(".peck-check-box").is(":visible")||i.stop(!0,!0).fadeIn(400)}).on("mouseleave",function(){t>0||i.stop(!0,!0).fadeOut(400)})}},d=function(t){var a=e.extend(!0,{},t),i=parseInt(a.endTime,10)+a.delayTime+(new Date).getTime()+500,s=parseInt(a.surplusTime,10)+a.delayTime+(new Date).getTime()+500;return a.endTime=parseInt(i,10),a.backTime=parseInt(s,10),a},c={getDoms:function(){this.doms={$giftBox:e("#right_col_peck"),$container:e("#container")}},bindEvent:function(e){var i,s,n,s,n,o=this,r=this.doms;if(i=t.string.join("<% if ( status > 0 ) { %>",'<div class="peck-tips">','<a href="javascript:;" data-type="close" class="peck-tips-close"></a>',"<p>","绑定","<% if ( status === 1 ) { %>","<span>手机</span>","<% } %>","后，才可以领取宝箱里的鱼丸哦！","</p>",'<p class="link"><a href="/member/cp/cpBindPhone">立即绑定</a></p>',"</div>","<% } %>"),s=a.compile(i),n=s({status:e}),this.config.isBindShow=e>0,r.$giftBox.find(".peck-tips").length||r.$giftBox.append(n),r.$giftBox.data("bind",e>0)[e>0?"addClass":"removeClass"]("noBind").find(".peck-cdn")[e>0?"addClass":"removeClass"]("noBind"),this.config.isBindShow){var l=r.$giftBox.find(".peck-tips");o.config.isBindShow=!1,r.$giftBox.on("click",".peck-tips",function(e){e.stopPropagation()}).on("click",function(e){e.stopPropagation(),"block"===l.css("display")?l.stop(!0,!0).fadeOut(400):l.stop(!0,!0).fadeIn(400)}),r.$container.on("click",function(){l.stop(!0,!0).fadeOut(400)}),l.on("click",'[data-type="close"]',function(e){e.preventDefault(),e.stopPropagation(),l.stop(!0,!0).fadeOut(400)})}},init:function(e){this.config={isBindShow:!1,isUnbind:!1},this.getDoms(),this.bindEvent(e)}},u=function(e){var t,a;return e>6e4?(t=parseInt(e/6e4,10).toString(),a=parseInt(e%6e4/1e3,10).toString()):(t="00",a=parseInt(e/1e3,10).toString()),t=t.length>1?t:"0"+t,a=a.length>1?a:"0"+a,t+":"+a},g=function(e){var t,a=i.get("hasGetGift");e&&e[0].giftBoxId&&(t=e[0].giftBoxId,a&&a.indexOf(t)>=0||(a=null===a?"":a,a+=t+",",i.set("hasGetGift",a,150)))};return{handleData:r,giftMsgShow:l,timeHandle:d,isBind:c,changeUserNameByLen:o,timeFormat:u,saveRecord:g}}),define("douyu/page/room/normal/mod/gift/controller/collect-treasure",["jquery","shark/observer","shark/util/lang/1.0","shark/util/template/1.0","shark/util/storage/1.0","douyu/context","douyu/page/room/base/api","douyu/com/user","douyu/page/room/normal/mod/gift/controller/vcode-user-v3","douyu/page/room/normal/mod/gift/constants"],function(e,t,a,i,s,n,o,r,l,d){var c=(new Date).getTime(),u={gee:null,getDoms:function(){var t=e(".chat");this.doms={$giftBox:t.find("#right_col_peck"),$checkBox:t.find("#geettest-box")}},isHover:function(){var e=this.doms,t=this;e.$giftBox.on("mouseenter",function(){t.config.isHover=!0}).on("mouseleave",function(){t.config.isHover=!1})},destoryNode:function(){this.curNode.giftBoxId="",t.trigger(d.GIFT_DESTORY)},initGeeTest:function(){var a=this;t.on("com.vcode.fast.check.success",function(t){
var i=t.value;t&&t.target[0]==e("#geettest-box")[0]&&a.postData(i),a.config.isPassCheck=!0})},postData:function(a){var i,s=this,o=t.fire(d.GET_GIFT_BACK)||{};s.config.isGet=o.isGet||!0,s.node=o.giftQueue||[],s.node.length<=0||(""===s.curNode.giftBoxId&&(s.curNode=e.extend(!0,{},s.node[0])),i=e.extend(!0,{room_id:n.get("room.room_id"),device_id:n.get("room.device_id"),packerid:s.curNode.giftBoxId||0,packettyp:s.curNode.pecktype||1,version:1},a),s.config.picking||(s.config.picking=!0,e.ajax({url:"/member/task/redPacketReceive",type:"POST",dataType:"json",data:i,error:function(){e.dialog.tips_black("网络错误")},success:function(e){s.response(e),s.config.picking=!1}})))},showCheckBox:function(){var e=this.doms.$giftBox.find(".peck-tip");e.hide(),this.config.isPassCheck=!1,this.doms.$checkBox.show()},hideCheckBox:function(){this.doms.$checkBox.hide(),this.config.isPassCheck=!0},showGetYwTips:function(a){var i=this,s=Math.abs(6-parseInt(a.gt,10))||0,n=e(".chat"),o=e('<div class="peck-back-tip"></div>'),r={top:i.doms.$giftBox.css("top").split("px")[0]},l="";if(0!==parseInt(a.code,10)||0===parseInt(a.silver,10)&&0===parseInt(a.prop_count,10))o.addClass("peck-back-error").html("<p><span>"+(i.config.isGet?"宝箱已被洗劫一空T_T":"运气不佳，您没有领到宝箱礼物")+"</span></p>");else if(2===parseInt(a.award_type,10))o.addClass("peck-back-success").html('<p><span>恭喜您，领取了</span><strong title="'+a.src_nick+'">'+a.src_nick+"</strong></p><p><span>派送的</span><strong>"+a.prop_count+"个"+a.prop_name+"</strong><span>~</span></p>");else{switch(s){case 1:case 2:case 3:case 4:case 5:l='<div class="bonus-tip-box"><p><span>获得</span><strong>'+a.silver+'鱼丸</strong></p></div><div class="bonus-rate bonus-rate-'+s+'"><i class="bonus-icon"></i><div class="bonus-n"><i></i></div></div>',o.addClass("peck-back-success peck-bonus").html(l);break;case 6:l='<p><span>恭喜您，领取了</span><strong title="'+a.src_nick+'">'+a.src_nick+"</strong></p><p><span>派送的</span><strong>"+a.silver+"个鱼丸</strong><span>~</span></p></div>",o.addClass("peck-back-success").html(l)}t.trigger("mod.userinfo.change",{current:{silver:a.silver_balance}})}n.append(o),o.css({top:r.top-o.height()-110,marginLeft:-(o.outerWidth(!0)/2)}).fadeIn(400).delay(3e3).fadeOut(400,function(){o.remove()}),e(window).off("resize.pecktips").on("resize.pecktips",function(){o.css({top:r.top-o.height()-10,marginLeft:-(o.width()/2)})})},response:function(e){var a,i,s=this,n=e.geetest||{};return(1===e.validate||-2===parseInt(e.code,10))&&0===parseInt(n.code,10)?(s.gee?s.gee.refresh():s.gee=l.init("#geettest-box",JSON.parse(e.geetest.validate_str)),a=t.fire(d.GET_GIFT_BACK)||{},i=a.giftQueue||[],i.length<=0?(s.curNode.giftBoxId="",s.config.isGet=!0,s.gee.destroy(),s.gee=null,s.hideCheckBox(),void s.showGetYwTips({code:1})):void s.showCheckBox()):(s.hideCheckBox(),s.showGetYwTips(e),void s.destoryNode())},isOverTime:function(){var e=this;t.on(d.TREASURE_OVER_TIME,function(){e.config.isReloadGeet=!1,e.config.isPassCheck=!0}),t.on(d.TREASURE_ALL_EMPTY,function(t){e.config.isGet=!0,e.gee&&(e.gee.destroy(),e.gee=null),!t&&e.curNode.giftBoxId&&(e.hideCheckBox(),e.showGetYwTips({code:1})),e.curNode.giftBoxId=""})},bindEvt:function(){var a=this,i=this.doms,s=i.$giftBox,n=0,l=function(e){e.preventDefault(),e.stopPropagation()};a.isHover(),i.$checkBox.on("click",function(e){l(e)}).on("click",'[data-geetbox="off"]',function(){a.hideCheckBox(),s.data("isGiftCanGet",!0),a.config.isReloadGeet=!0}),s.on("click",function(){var i=e(this),s=(new Date).getTime(),o=t.fire(d.GET_GIFT_BACK)||{},l=o.giftQueue&&o.giftQueue[0]||{},u=l.endTime||s;return r.check()?i.data("isGiftCanGet")&&!(i.data("isBindPhone")>0)&&a.config.isHover&&a.config.isPassCheck?!(document.referrer.indexOf(location.host)>0)&&l&&u+1e4-s>=s-c&&!n?(n=1,a.hideCheckBox(),a.showGetYwTips({code:1}),void a.destoryNode()):void(a.config.isReloadGeet?a.showCheckBox():a.postData()):void 0:r.show("login",{source:"click_ywbox_get"})}),o.reg("room_data_validate_peck",function(){i.$giftBox.click()})},init:function(t){this.curNode={},this.curNode.giftBoxId="",this.config=e.extend(!0,{isPassCheck:!0,isGet:!1,picking:!1,isHover:!1,isReloadGeet:!1},t),this.getDoms(),this.initGeeTest(),this.isOverTime(),this.bindEvt()}},g={getDoms:function(){this.doms={$wrapDom:e("#js-chat-cont")}},backHtml:function(){var e,t;return e=a.string.join('<div class="gift-box-2000" data-gift="king">',"<% if (num <= 4 && num > 0) { %>",'<div class="bonus-enter">','恭喜<span class="bonus-name"><%= getName %></span>领取了','<span class="bonus-name"><%= sendName %></span>派送的宝箱触发<span class="bonus-detail">暴击',"<% if (num > 1) { %>","X<%= num %>","<% } %>","</span>获得",'<span class="bonus-detail"><%= ywNum %>鱼丸</span>',"</div>","<% } else if (num == 5){ %>",'<div class="bonus-enter-wang">','<div class="bonus-enter-wang-top"></div>','<div class="bonus-enter-wang-bottom">','恭喜<span class="bonus-name"><%= getName %></span>领取了','<span class="bonus-name"><%= sendName %></span>派送的宝箱！获得<span class="bonus-detail"><%= ywNum %>鱼丸</span>，成为本场手气王！',"</div>","</div>","<% } %>","</div>"),t=i.compile(e)},renderTips:function(e){var t=this,a=Math.abs(6-parseInt(e.gt,10))||0,i="",s=t.doms.$wrapDom,n=s.find(".gift-box-2000");0>=a||a>=6||(n.length>0&&n.remove(),i=t.temHtml.backHtml({num:a,getName:e.dnk,sendName:e.snk,ywNum:e.sl}),s.append(i),t.doms.tipsBox=s.find('[data-gift="king"]'),t.doms.tipsBox.animate({bottom:0},300),clearTimeout(t.timer),t.timer=setTimeout(function(){t.doms.tipsBox.remove()},5e3))},init:function(){var e=this;e.timer=null,e.temHtml={backHtml:e.backHtml()},e.getDoms(),t.on(d.GIFT_GET_LUCYKING,function(t){e.renderTips(t.giftData)})}};return{init:function(){u.init(),g.init()}}}),define("douyu/com/preload-file",["jquery","shark/util/storage/1.0"],function(e,t){var a={startLoadTime:0,loadTimeOut:5e3,expiredTime:2592e3,movieIdOuter:"preload-movie-outer",movieIdInner:"preload-movie-inner",loadUrl:"",preloadFlag:"DY_preload_file",loopTimer:null,loopCheck:200,deferred:null,fileTypes:{jpg:0,jpeg:0,png:0,gif:0,swf:1}},i={isIE:function(){return!!(window.ActiveXObject||"ActiveXObject"in window)},isPreloadFile:function(){var e=a.loadUrl.substring(a.loadUrl.indexOf("/")+1),i=t.get(a.preloadFlag)||{};return!!i[e]},savePreloadFlag:function(){var e=a.loadUrl.substring(a.loadUrl.indexOf("/")+1),i=t.get(a.preloadFlag)||{};i[e]=1,t.set(a.preloadFlag,i,a.expiredTime)},addFlashTemplate:function(){var t=a,i=['<object style="position:absolute; left:-9999px;" id="'+t.movieIdOuter+'" name="'+t.movieIdOuter+'" class="preload-movie-file" border="0" type="application/x-shockwave-flash" ','width="200" ','height="200">','<param name="movie" value=" '+t.loadUrl+' ">',"</object>",'<embed style="position:absolute; left:-9999px;" src="'+t.loadUrl+'" id="'+t.movieIdInner+'" name="'+t.movieIdInner+'" ',' width="200" height="200"></embed>'].join("");e("body").append(i)},removeFlashTemplate:function(){var t=e("#"+a.movieIdOuter);t&&t.length&&t.remove()},getLoadPrecent:function(e){var t=0;try{t=e.PercentLoaded()}catch(a){}return t},listenFlashState:function(){var e=a,t=this.isIE(),i=t?a.movieIdOuter:a.movieIdInner,s=document.getElementById(i),n=(new Date).getTime();return n-a.startLoadTime>=a.loadTimeOut?e.deferred.resolve():this.getLoadPrecent(s)>=100?(clearInterval(e.loopTimer),this.removeFlashTemplate(),this.savePreloadFlag(),e.deferred.resolve()):void 0},loadPng:function(){var e=new Image,t=a;return e.src=t.loadUrl,e.complete?t.deferred.resolve():void(e.onload=function(){return t.deferred.resolve()})},loadMovie:function(e){var t=a,i=this;t.startLoadTime=(new Date).getTime(),i.addFlashTemplate(),t.loopTimer=setInterval(function(){i.listenFlashState()},t.loopCheck)},checkFile:function(t){var s,n=a,o=i;if(n.loadUrl=t,n.deferred=e.Deferred(),o.removeFlashTemplate(),!n.loadUrl)return n.deferred.reject();if(o.isPreloadFile())return n.deferred.resolve();switch(s=n.loadUrl.indexOf("?")>0?n.loadUrl.substring(0,n.loadUrl.lastIndexOf("?")):n.loadUrl,s=s.substring(s.lastIndexOf(".")+1).toLowerCase(),n.fileTypes[s]){case 0:o.loadPng();break;case 1:o.loadMovie()}return n.deferred}};return{load:i.checkFile}}),define("douyu/page/room/normal/mod/gift/view/open-noble",["shark/util/lang/1.0","shark/util/template/2.0","shark/util/storage/1.0","douyu/context","douyu/com/preload-file","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/base/view","douyu/page/room/normal/mod/gift/base/queue"],function(e,t,a,i,s,n,o,r){var l={isIE8:!("addEventListener"in window),webUrl:i.get("sys.web_url")},d=function(a){function i(e){var t=a.call(this,e)||this;return t.nobleEffectTime={7:4e3,1:4e3,2:4e3,3:5e3,4:6e3,5:8e3,6:1e4},t.chatBox=e&&e.chatBox||$("#js-chat-cont"),t.chatNobleEffectBox=$('<div class="noble-open-animation"></div>'),t.nobleHtml={openNoble:i.prototype.effectTemp()},t.chatBox.append(t.chatNobleEffectBox),t.chatNobleEffectBox.hide(),t.queue=new r,t.queue.run(),t}return n(i,a),i.prototype.effectTemp=function(){var a,i;return i=e.string.join('<div class="noble-open-effect-wrap">','<div class="flash-wrap">','<object id="open-noble-chat-flash" class="open-noble-chat-flash" border="0" type="application/x-shockwave-flash" ','align="middle" ','allowscriptaccess="always" ','allowfullscreen="true" ','allowfullscreeninteractive="true" ','wmode="transparent" ','width="100%" ','height="100%">','<param name="src" value="{{ giftData.openNobleEffectFlash }}">','<param name="quality" value="high">','<param name="allowscriptaccess" value="always">','<param name="allowfullscreen" value="true">','<param name="wmode" value="transparent">','<param name="allowFullScreenInteractive" value="true">','<param name="flashvars" value="">',"</object>","</div>",'<div class="noble-open-info">','<span class="noble-pic">','<img src="{{ giftData.openNobleAvatar }}" />',"</span>",'<img class="noble-open-info-bg" src="{{ giftData.openNobleBg }}" />','<div class="noble-name">','<span class="noble-name-txt" title="{{ giftData.senderName }}">{{ giftData.senderName }}</span>','<span class="noble-id">开通{{ giftData.giftName }}</span>',"</div>","</div>","</div>"),a=t.compile(i)},i.prototype.render=function(e,t){var a,i=this,s=e.useFullData,n=i.nobleEffectTime[s.openNobleLev]||4e3;l.isIE8&&(s.openNobleBg=l.webUrl+"/app/douyu/res/page/noble/noble-ie-"+parseInt(s.openNobleLev,10)+".png?v=20170916"),a=function(){var e=$.Deferred();return i.chatNobleEffectBox.animate({left:0},{duration:n,start:function(){var e=i.nobleHtml.openNoble({giftData:s});i.chatNobleEffectBox.html(e).show()},complete:function(){i.chatNobleEffectBox.hide().html(""),e.resolve(),t()}}),e.name="openNoble",e},this.queue.addJob(a)},i}(o);return{OpenNobleView:d}}),define("douyu/page/room/normal/mod/gift/view/super",["shark/util/lang/1.0","shark/util/template/2.0","shark/util/storage/1.0","douyu/context","douyu/com/preload-file","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/base/view","douyu/page/room/normal/mod/gift/base/queue"],function(e,t,a,i,s,n,o,r){var l=function(e){function t(t){var a=e.call(this,t)||this;return a.chatbox=$("body"),a.queue=new r,a.queue.run(),a}return n(t,e),t.prototype.render=function(e,t){var a,i=this,s=e.useFullData,n=$("#js-stats-and-actions").find('[data-giftid="'+s.giftId+'"]'),o=n.offset(),r={w:70,h:120},l={x:(n.width()-r.w)/2+o.left+2,y:o.top-r.h};this.superUpBlock=$('<div class="gift-super-up-show"></div>'),this.chatbox.append(this.superUpBlock),this.superUpBlock.css({left:l.x,top:l.y,"background-image":"url("+s.smallGiftAnimateImg+")"}),a=function(){var e=$.Deferred();return i.superUpBlock.animate({top:2*-r.h},1500,"swing",function(){$(this).remove(),e.resolve(),t()}),e.name="ownerSuper",e},this.queue.addJob(a)},t}(o),d=function(a){function i(e){var t=a.call(this,e)||this;return t.bodyBox=$("body"),t.chatBox=e&&e.chatBox||$("#js-chat-cont"),t.superPlayTimer=null,t.superRocketTip=$('<div class="super-rocket-info"></div>'),t.superChatBox=$('<div class="gift-super-chat-show"></div>'),t.superHtml={superSwfTemp:i.prototype.superGiftSwfRender(),superMsgTemp:i.prototype.superMsgRender()},t.chatBox.append(t.superRocketTip),t.superRocketTip.hide(),t.chatBox.prepend(t.superChatBox),t.superChatBox.hide(),t.queue=new r,t.queue.run(),this}return n(i,a),i.prototype.superMsgRender=function(){var a,i;return i=e.string.join("<div>",'<strong class="super-rocket-zbname">{{ giftData.senderName }}</strong>',"</div>",'<span class="super-rocket-tips">为主播发射了一枚{{ giftData.giftName }}</span>'),a=t.compile(i)},i.prototype.render=function(e,t){var a,i,n=this,o=e.useFullData;a=function(){var e=$.Deferred();return s.load(o.giftAnimateAttachSwf).done(function(){n.superChatBox.animate({bottom:0},{duration:6e3,start:function(){var e=n.superHtml,t=e.superMsgTemp({giftData:o});i=n.superHtml.superSwfTemp({giftData:o}),n.superRocketTip.html(t).css({bottom:0,left:10}),n.superRocketTip.fadeIn(800),n.superChatBox.css({opacity:1}),n.superChatBox.html(i).show()},complete:function(){n.superChatBox.html("").hide(),n.superRocketTip.html("").hide(),e.resolve(),t()}})}),e.name="ownerSuper",e},n.queue.addJob(a)},i.prototype.superGiftSwfRender=function(){var a,i;return i=e.string.join('<object id="gift-super-chat-flash" class="gift-super-chat-flash" border="0" type="application/x-shockwave-flash" ','align="middle" ','allowscriptaccess="always" ','allowfullscreen="true" ','allowfullscreeninteractive="true" ','wmode="transparent" ','width="100%" ','height="100%">','<param name="src" value="{{ giftData.giftAnimateAttachSwf }}">','<param name="quality" value="high">','<param name="allowscriptaccess" value="always">','<param name="allowfullscreen" value="true">','<param name="wmode" value="transparent">','<param name="allowFullScreenInteractive" value="true">','<param name="flashvars" value="">',"</object>"),a=t.compile(i)},i}(o);return{SuperSmallView:l,SuperBigView:d}}),define("douyu/page/room/normal/mod/gift/view/commonfly",["shark/util/lang/1.0","shark/util/template/2.0","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/base/view","douyu/page/room/normal/mod/gift/base/queue"],function(e,t,a,i,s){var n=function(e){function t(t){var a=e.call(this,t)||this;return a.queue=new s,a.queue.run(),a}return a(t,e),t.prototype.render=function(e,t){var a,i=this,s=e.useFullData,n=$('[data-giftid="'+s.giftId+'"],[data-giftid]'),o=n.offset(),r={w:110,h:66},l={x:(n.width()-r.w)/2+o.left+2,y:o.top-r.h};switch(i.chatbox=$("body"),parseInt(s.effect,10)){case 3:this.commonUpBlock=$('<div class="gift-smallKiss"></div>');break;case 4:this.commonUpBlock=$('<div class="gift-smallCar"></div>');break;case 5:this.commonUpBlock=$('<div class="gift-smallShip"></div>')}this.chatbox.append(this.commonUpBlock),this.commonUpBlock.css({left:l.x,top:l.y,"background-image":"url("+s.smallGiftAnimateImg+")"}),a=function(){var e=$.Deferred();return i.commonUpBlock.animate({top:l.y-300,opacity:0},1e3,"easeOutCubic",function(){$(this).remove(),e.resolve()}),t(),e.name="ownerCommon",e},this.queue.addJob(a)},t}(i),o=function(e){function t(t){var a=e.call(this,t)||this;return a.chatbox=t&&t.chatBox||$("#js-chat-cont"),a.queue=new s,a.queue.run(),this}return a(t,e),t.prototype.render=function(e,t){},t}(i);return{CommonSmallView:n,CommonBigView:o}}),define("douyu/page/room/normal/mod/gift/view/plane",["shark/util/lang/1.0","shark/util/template/2.0","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/base/view","douyu/page/room/normal/mod/gift/base/queue"],function(e,t,a,i,s){var n=function(e){function t(t){var a=e.call(this,t)||this;return this.chatbox=$("body"),a.queue=new s,a.queue.run(),a}return a(t,e),t.prototype.render=function(e,t){var a,i=this,s=e.useFullData,n=$("#js-stats-and-actions").find('[data-giftid="'+s.giftId+'"]'),o=n.offset(),r={w:40,h:25},l={x:(n.width()-r.w)/2+o.left+2,y:o.top-r.h};this.planeUpBlock=$('<div class="gift-smallPlane"></div>'),this.chatbox.append(this.planeUpBlock),this.planeUpBlock.css({left:l.x,top:l.y,"background-image":"url("+s.smallGiftAnimateImg+")"}),a=function(){var e=$.Deferred();return i.planeUpBlock.animate({top:l.y/4,left:2*-r.w},2e3,"easeOutCubic",function(){$(this).remove(),e.resolve(),t()}),e.name="ownerPlane",e},this.queue.addJob(a)},t}(i),o=function(e){function t(t){var a=e.call(this,t)||this;return a.chatbox=t&&t.chatBox||$("#js-chat-cont"),a.queue=new s,a.queue.run(),this}return a(t,e),t.prototype.render=function(e,t){var a,i,s,n=this,o=e.useFullData,r=this.chatbox,l={w:100,h:50};n.$plane=$('<div class="gift-bigPlane"></div>'),n.chatbox.append(n.$plane),i=n.$plane,s={x:r.width(),y:(r.height()-l.h)/2},a=function(){var e=$.Deferred();return n.$plane.css({left:s.x,top:s.y,"background-image":"url("+o.bigGiftAnimateImg+")"}),i.animate({left:-l.w},{duration:3e3,complete:function(){$(this).remove(),e.resolve(),t()}}),e.name="plane",e},this.queue.addJob(a)},t}(i);return{PlaneSmallView:n,PlaneBigView:o}}),define("douyu/page/room/normal/mod/gift/view/rocket",["shark/util/lang/1.0","shark/util/template/2.0","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/base/view","douyu/page/room/normal/mod/gift/base/queue"],function(e,t,a,i,s){var n=function(e){function t(t){var a=e.call(this,t)||this;return a.queue=new s,a.queue.run(),a}return a(t,e),t.prototype.render=function(e,t){var a,i=this,s=e.useFullData,n=$("#js-stats-and-actions").find('[data-giftid="'+s.giftId+'"]'),o=n.offset(),r={w:30,h:105},l={x:(n.width()-r.w)/2+o.left+2,y:o.top-r.h};i.chatbox=$("body"),this.raiseUpBlock=$('<div class="gift-small-rocket"></div>'),this.chatbox.append(this.raiseUpBlock),this.raiseUpBlock.css({left:l.x,top:l.y,"background-image":"url("+s.smallGiftAnimateImg+")"}),a=function(){var e=$.Deferred();return i.raiseUpBlock.animate({top:2*-r.h},1500,"swing",function(){$(this).remove(),e.resolve(),t()}),e.name="ownerRocket",e},this.queue.addJob(a)},t}(i),o=function(i){function n(e){var t=i.call(this,e)||this;return t.chatbox=e&&e.chatBox||$("#js-chat-cont"),t.rocketTip=$('<div class="rocket-info"></div>'),t.rocket=$('<div class="gift-big-rocket" style="top: 100%; transform:translateZ(0);"></div>'),t.chatboxHeight=this.chatbox.append(this.rocket).height(),t.rocketHeight=t.rocket.height(),t.rocketHtml={rocketFrog:n.prototype.rocketFrogRender(),rocketMsg:n.prototype.rocketMsgRender()},t.chatbox.append(t.rocketTip),t.queue=new s,t.queue.run(),this}return a(n,i),n.prototype.rocketFrogRender=function(a){var i,s;return s=e.string.join('<div class="gift-frog">','<object type="application/x-shockwave-flash" ','align="middle" ','allowscriptaccess="always" ','allowfullscreen="true" ','allowfullscreeninteractive="true" ','wmode="transparent" ','data="{{ giftData.giftAnimateAttachImg }}" ','width="100%" ','height="100%">','<param name="src" value="{{ giftData.giftAnimateAttachImg }}">','<param name="quality" value="high">','<param name="bgcolor" value="#fff">','<param name="allowscriptaccess" value="always">','<param name="allowfullscreen" value="true">','<param name="wmode" value="transparent">','<param name="allowFullScreenInteractive" value="true">','<param name="flashvars" value="">',"</object>","</div>"),i=t.compile(s)},n.prototype.rocketMsgRender=function(a){var i,s;return s=e.string.join("<div><strong>{{ giftData.senderName }}</strong></div><span>为主播发射了一枚{{ giftData.giftName }}</span>"),i=t.compile(s)},n.prototype.render=function(e,t){var a,i=this,s=e.useFullData,n=this.rocket;a=function(){var e=$.Deferred();return n.animate({top:i.chatboxHeight-i.rocketHeight},{start:function(){var e,t=i.rocketHtml,a=t.rocketMsg({giftData:s});n.css({top:"100%","background-image":"url("+s.bigGiftAnimateImg+")"}),e=t.rocketFrog({giftData:s}),i.chatbox.append(e),i.$rocketFrog=$(".gift-frog"),i.rocketTip.html(a).css({bottom:0,left:10}),i.rocketTip.fadeIn(800)},duration:1e3,easing:"easeOutCirc",complete:function(){var e=setTimeout(function(){i.$rocketFrog.remove(),i.rocketTip.fadeOut(400),clearTimeout(e)},1500)}}).delay(1e3).animate({top:-i.rocketHeight},{duration:2e3,easing:"easeInExpo",complete:function(){n.css("top","100%"),e.resolve(),t()}}),e.name="rocket",e},this.queue.addJob(a)},n}(i);return{RocketSmallView:n,RocketBigView:o}}),define("douyu/page/room/normal/mod/gift/controller/rocket",["shark/observer","douyu/page/room/normal/mod/gift/base/view","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/base/queue","douyu/page/room/normal/mod/gift/constants","douyu/page/room/normal/mod/gift/view/rocket"],function(e,t,a,i,s,n){var o=function(e){function t(t,a){e.call(this,t,a)||this}return a(t,e),t}(t),r=new n.RocketSmallView,l=new n.RocketBigView({chatBox:$("#js-chat-cont")});return e.on(s.RAISE_UP,function(e,t){l.render(e,t)}),e.on(s.RAISE_SMALL_UP,function(e,t){r.render(e,t)}),o}),define("douyu/page/room/normal/mod/gift/view/banner",["jquery","shark/observer","douyu/context","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/constants","douyu/page/room/normal/mod/gift/base/view","shark/util/lang/1.0","shark/util/template/2.0"],function(e,t,a,i,s,n,o,r){var l={isIE:navigator.appVersion.indexOf("MSIE")>0||navigator.appVersion.indexOf("Trident/7.0")>0,isFF:navigator.userAgent.indexOf("Firefox")>0},d=function(s){function n(i){var n=s.call(this,i)||this;return n.target=i.bannerBox,n.drawBanner=r.compile(o),n.bannerList=[],n.isTimerRunning=!1,n.defaultUsedHeight=45,n.usedHeight=n.defaultUsedHeight,n.defaultChannelsLen=6,n.maxChannelsLen=n.defaultChannelsLen,n.currentUid=a.get("sys.uid"),n.createDom=function(t,a){var i=n.drawBanner({data:t,hitTimesArray:a}),s=e(i);return n.target.append(s),s},this.getBannerId=function(e){return"banner-"+e.senderId+"-"+e.giftId},n.sort=function(e,t){e.sort(function(e,a){var i,s=t?e.bannerData:e,n=t?a.bannerData:a;return s.contribution!==n.contribution?i=n.contribution-s.contribution:s.hitTimes!==n.hitTimes?i=n.hitTimes-s.hitTimes:s.createTime!==n.createTime&&(i=n.createTime-s.createTime),i})},this.isSubscribedLayout||(t.on("mod.chat.gift.layout",function(){var t=0,a=0,i=n.bannerList,s=i.length,o=n.defaultChannelsLen;if(n.totalHeight=e("#js-chat-cont").height()-n.defaultUsedHeight,!(n.totalHeight<=0)&&(n.maxChannelsLen=Math.floor(n.totalHeight/100),n.maxChannelsLen=n.maxChannelsLen>o?o:n.maxChannelsLen,a=s-n.maxChannelsLen,a>0))for(;a>t;t++)n.destroyBanner(i.length-1)}),this.isSubscribedLayout=!0),n}var o=['{{ if data.effectType === "noble" }}','<div id="banner-{{ data.senderId }}-{{ data.giftId }}" class="noble-banner-item item-{{ data.styleNumber }}">','<div class="item-back">','<img src="{{ data.bannerBgImg }}">',"</div>",'<div class="item-head">','<img src="{{ data.bannerGiftImg }}">',"</div>",'<div class="item-name">','<span class="item-name-inner" title="{{ data.senderName }}">{{ data.senderName }}</span>',"</div>",'<div class="item-action-wrap clearfix">','<span class="item-action fl">开通</span>','<span class="noble-name fr">{{ data.giftName }}</span>',"</div>","</div>","{{ else }}",'<div id="banner-{{ data.senderId }}-{{ data.giftId }}" class="giftbatter-item giftbatter-item-right item-{{ data.styleNumber }}">','<div class="item-back item-back-{{ data.styleNumber }}"><img src="{{ data.bannerBgImg }}"></div>',"{{ if data.bannerGiftImg }}",'<div class="item-head item-head-{{ data.styleNumber }}" style="border-color:{{ data.bannerGiftBorderColor }};">','<img src="{{ data.bannerGiftImg }}">',"</div>","{{ /if }}",'<div class="item-name item-name-{{ data.styleNumber }}">','<span style="color:{{ data.bannerSenderNameColor }};"  class="item-name-inner" title="{{ data.senderName }}">{{ data.senderName }}</span>',"{{ if data.harmFans }}",'<span class="js-from-fans from-fans">来自【<i class="from-fans-name" title="{{ data.harmFans }}">{{ data.harmFans }}</i>】亲友团</span>',"{{ else }}",'<span class="js-from-fans from-fans hide"></span>',"{{ /if }}","</div>",'<div class="item-gift item-gift-{{ data.styleNumber }} clearfix">','<span class="fl" style="color:{{ data.bannerWordColor }};">送出</span>','<span class=" fr" style="color:{{ data.bannerGiftNameColor }};">{{ data.giftName }}</span>',"</div>",'<div class="item-bat item-bat-{{ data.styleNumber }}"></div>','<div class="item-count item-count-{{ data.styleNumber }} clearfix">','<div class="js-hittimes nbox">',"{{ each hitTimesArray as item }}",'<span class="n n{{ item }}"></span>',"{{ /each }}","</div>","</div>","</div>","{{ /if }}"].join("");return i(n,s),n.prototype.render=function(t,a){var i,s=this,n=s.bannerList,o="",r=0,l=null,d=+new Date,c=s.defaultChannelsLen;if(s.totalHeight=e("#js-chat-cont").height()-s.defaultUsedHeight,!(s.totalHeight<=0)){if(s.maxChannelsLen=Math.floor(s.totalHeight/100),s.maxChannelsLen=s.maxChannelsLen>c?c:s.maxChannelsLen,t instanceof Array)return s.showBannerList(t),s.isTimerRunning||s.runExpireTimer(),s;for(i=t.useFullData,o=s.getBannerId(i);r<n.length;r++)if(o===n[r].bannerId){l=n[r];break}return l?(l.bannerData.hitTimes=i.hitTimes,l.createTime=d,l.expireTime=d+(i.bannerStayTime||0)+300,l.harmFans=i.harmFans,s.sort(s.bannerList,1),s.setHit(l),a(),s):(s.addBanner(i,0,a),s.isTimerRunning||s.runExpireTimer(),s)}},n.prototype.addBanner=function(t,i,s){var n,o,r,l=this,d=[],c=l.getBannerId(t),u=l.maxChannelsLen,g=(""+(t.hitTimes||1)).split(""),m=+new Date;o={bannerId:c,bannerData:t,callback:s,createTime:m,expireTime:m+(t.bannerStayTime||0)+300},i?(r=l.createDom(t,g),r.css({top:l.usedHeight,right:0}),l.usedHeight+=t.bannerHeight+15,o.$banner=r,l.bannerList.push(o)):(d=l.bannerList.slice(0,u),d.unshift(o),l.sort(d,1),d.length>u?(d=d.slice(0,u),n=e.inArray(o,d),n>-1?(r=l.createDom(t,g),l.target.append(r),o.$banner=r,l.destroyBanner(u-1),l.bannerList.unshift(o),l.sort(l.bannerList,1),l.sortAnimate(o)):t.senderId===a.get("sys.uid")?(r=l.createDom(t,g),l.target.append(r),o.$banner=r,l.destroyBanner(u-1,o),l.sort(l.bannerList,1),l.sortAnimate(o)):s&&s()):(r=l.createDom(t,g),l.target.append(r),o.$banner=r,l.bannerList.unshift(o),l.sort(l.bannerList,1),l.sortAnimate(o)))},n.prototype.showBannerList=function(t){var a=this,i=a.maxChannelsLen;a.sort(t),e.each(t,function(e){return e===i?!1:void a.addBanner(this,1,null)})},n.prototype.setHit=function(t){var a,i,s=(""+(t.bannerData.hitTimes||1)).split(""),n="",o=t.$banner,r=o.find(".js-hittimes"),d=1.3,c=1,u=0,g=5;e.each(s,function(){n+='<span class="n n'+this+'"></span>'}),l.isIE?(a={transform:"scale("+d+")","transform-origin":"left bottom",bottom:g+7,right:u-7},i={transform:"scale("+c+")","transform-origin":"left bottom",bottom:g,right:u},"addEventListener"in window||(a.zoom=d,i.zoom=c)):(d=1.1,a={transform:"scale("+d+")","transform-origin":"left bottom",bottom:g+7,right:u-7},i={transform:"scale("+c+")","transform-origin":"left bottom",bottom:g,right:u}),r.html(n).css(a).animate(i,300,function(){e(this).removeAttr("style")}),t.harmFans?o.find(".js-from-fans").html('来自【<i class="from-fans-name" title="'+t.harmFans+'">'+t.harmFans+"</i>】亲友团</span>").removeClass("hide"):o.find(".js-from-fans").html("").addClass("hide"),this.sortAnimate()},n.prototype.sortAnimate=function(t){var a=this.defaultUsedHeight,i=t&&t.bannerId;e.each(this.bannerList,function(){var e=this.$banner;i===this.bannerId?e.css("top",a).animate({right:0},300,function(){var e=t.callback;e&&e(),t.callback=null}):e.stop(!0,!0).animate({top:a},300),a+=this.bannerData.bannerHeight+15})},n.prototype.runExpireTimer=function(){function t(){e.each(a.bannerList,function(e){var t=+new Date;t>=this.expireTime&&(a.destroyBanner(e),a.sortAnimate())}),a.bannerList.length>0?setTimeout(function(){t()},1e3):a.isTimerRunning=!1}var a=this;a.isTimerRunning=!0,t()},n.prototype.destroyBanner=function(e,t){var a=this,i=a.bannerList[e],s=i.$banner,n=i.callback;s&&(a.usedHeight-=i.bannerData.bannerHeight+15,s.finish().remove(),n&&(n(),i.callback=null)),t?a.bannerList.splice(e,1,t):a.bannerList.splice(e,1)},n}(n);return d}),define("douyu/page/room/normal/mod/gift/controller/plane",["shark/observer","douyu/page/room/normal/mod/gift/base/view","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/base/queue","douyu/page/room/normal/mod/gift/constants","douyu/page/room/normal/mod/gift/view/plane"],function(e,t,a,i,s,n){var o=function(e){function t(t,a){e.call(this,t,a)||this}return a(t,e),t}(t),r=new n.PlaneSmallView,l=new n.PlaneBigView({chatBox:$("#js-chat-cont")});return e.on(s.PLANE_UP,function(e,t){l.render(e,t)}),e.on(s.PLANE_SMALL_UP,function(e,t){r.render(e,t)}),o}),define("douyu/page/room/normal/mod/gift/controller/commonfly",["shark/observer","douyu/page/room/normal/mod/gift/base/view","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/base/queue","douyu/page/room/normal/mod/gift/constants","douyu/page/room/normal/mod/gift/view/commonfly"],function(e,t,a,i,s,n){var o=function(e){function t(t,a){e.call(this,t,a)||this}return a(t,e),t}(t),r=new n.CommonSmallView,l=new n.CommonBigView({chatBox:$("#js-chat-cont")});return e.on(s.COMMON_UP,function(e,t){l.render(e,t)}),e.on(s.COMMON_SMALL_UP,function(e,t){r.render(e,t)}),o}),define("douyu/page/room/normal/mod/gift/controller/super",["shark/observer","douyu/page/room/normal/mod/gift/base/view","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/base/queue","douyu/page/room/normal/mod/gift/constants","douyu/page/room/normal/mod/gift/view/super"],function(e,t,a,i,s,n){var o=function(e){function t(t,a){e.call(this,t,a)||this}return a(t,e),t}(t),r=new n.SuperSmallView({chatBox:$("#js-chat-cont"),videoBox:$("#js-room-video")}),l=new n.SuperBigView({chatBox:$("#js-chat-cont"),videoBox:$("#js-room-video")});return e.on(s.SUPER_UP,function(e,t){l.render(e,t)}),e.on(s.SUPER_SMALL_UP,function(e,t){r.render(e,t)}),o}),define("douyu/page/room/normal/mod/gift/controller/open-noble",["shark/observer","douyu/page/room/normal/mod/gift/base/view","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/base/queue","douyu/page/room/normal/mod/gift/constants","douyu/page/room/normal/mod/gift/view/open-noble"],function(e,t,a,i,s,n){var o=function(e){function t(t,a){e.call(this,t,a)||this}return a(t,e),t}(t),r=new n.OpenNobleView({chatBox:$("#js-chat-cont")});return e.on(s.OPEN_NOBLE,function(e,t){r.render(e,t)}),o}),define("douyu/page/room/normal/mod/gift/controller/banner",["shark/observer","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/constants"],function(e,t,a){var i=function(){function t(){this.bannerList=[]}return t.prototype.add=function(t,i){e.trigger(a.BANNER_VIEW,t,i)},t}();return i}),define("douyu/page/room/normal/mod/gift/model/banner",["shark/observer","douyu/context","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/base/model"],function(e,t,a,i){var s={};e.on("room.activity.anchor.list.config",function(e){s=e});var n={timeTransform:function(e){return 1e3*e}},o=function(e){function i(a,i){var o=[52,56,60,78,96,106,0,52,54,56],r={7:78,1:96,2:106,3:106,4:106,5:106,6:106},l=e.call(this,a,i)||this;return l.backendModelMap=$.extend({harmFans:function(e){var t="";return s[e.prid]&&(t=s[e.prid].badgename||""),t},senderId:"uid",senderName:"nn",senderAvatar:function(e){var a=e.ic;return a?t.get("sys.avatar_url")+"upload/"+a+"_small.jpg":t.get("sys.web_url")+"app/douyu/res/com/defaultAvatar.png"},giftId:"gfid",hitTimes:function(e){return e.hits>0?e.hits:1},styleNumber:"gs",bannerHeight:function(e){return"noble"===e.effectType?r[e.gs]:o[e.gs-1]},className:function(e){return"banner-style-"+e.gs},anchorWeight:"dw",senderIcon:"ic",senderLv:"level",giftBoxId:function(e){return e.rpid||e.rpidn},pecktype:function(e){return void 0!==e.rpt?parseInt(e.rpt,10):0},danmucontent:function(e){return e.dct||""},surplusTime:function(e){return n.timeTransform(e.slt?parseInt(e.slt,10):0)},endTime:function(e){return n.timeTransform(e.elt?parseInt(e.elt,10):0)},delayTime:function(){return 1e3*(Math.floor(5*Math.random())+1)},treasureImg:function(e){var a=i,s=t.get("sys.web_url")+"app/douyu/res/page/room-normal/gift/peck-close.png?v=20170922";return e.gfid&&a&&a.gift_icon?a.gift_icon:s;
},treasureOpenedImg:function(e){var a=i,s=t.get("sys.web_url")+"app/douyu/res/page/room-normal/gift/peck-open.png?v=20170922";return e.gfid&&a&&a.gift_open_icon?a.gift_open_icon:s},openNobleAvatar:"openNobleAvatar"},i),l.fromBackendModel(a),l}return a(i,e),i}(i);return o}),define("douyu/page/room/normal/mod/gift/model/treasure",["douyu/context","douyu/com/exjsonp","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/base/model"],function(e,t,a,i){var s={timeTransform:function(e){return 1e3*e}},n=[],o={},r=e.get("sys.webconfUrl")+"/resource/noble/opennotify/web.json",l={};t.load(r,"nobleOpenNotify",function(e){l=e});var d=function(t){var a,i;if(t.nl){var s=l[t.nl+""]||{};s.web_chest_pic&&(a=e.get("sys.resource_url")+s.web_chest_pic),s.web_chest_open_pic&&(i=e.get("sys.resource_url")+s.web_chest_open_pic)}return{giftCloseBg:a||e.get("sys.web_url")+"app/douyu/res/page/room-normal/gift/peck-close.png?v=20170922",giftOpenBg:i||e.get("sys.web_url")+"app/douyu/res/page/room-normal/gift/peck-open.png?v=20170922"}},c=function(t){function i(a,i,o){for(var r=t.call(this,a,i)||this,l=r.data.length,o=o||{},d=0;l>d;d++)r.backendModelMap=$.extend({senderId:"sid",senderName:"snk",senderAvatar:function(t){var a=t.sic;return a?e.get("sys.avatar_url")+"upload/"+a+"_small.jpg":e.get("sys.web_url")+"app/douyu/res/com/defaultAvatar.png"},danmucontent:function(e){return e.dct||""},giftBoxId:function(e){return e.rpid||e.rpidn},pecktype:function(e){return void 0!==e.rpt?parseInt(e.rpt,10):0},surplusTime:function(e){return s.timeTransform(void 0!==e.stl?parseInt(e.stl,10):0)},endTime:function(e){return s.timeTransform(void 0!==e.etl?parseInt(e.etl,10):0)},delayTime:function(){return 1e3*(Math.floor(5*Math.random())+1)},treasureImg:function(t){var a={},i=e.get("sys.web_url");return t.gid?(a=o[t.gid],a&&a.gift_icon?a.gift_icon:i+"app/douyu/res/page/room-normal/gift/peck-close.png?v=20170922"):i+"app/douyu/res/page/room-normal/gift/peck-close.png?v=20170922"},treasureOpenedImg:function(t){var a,i=e.get("sys.web_url");return t.gid?(a=o[t.gid],a?a.gift_open_icon?a.gift_open_icon:e.get("sys.web_url")+"app/douyu/res/page/room-normal/gift/peck-open.png?v=20170922":i+"app/douyu/res/page/room-normal/gift/peck-open.png?v=20170922"):i+"app/douyu/res/page/room-normal/gift/peck-open.png?v=20170922"}},i),r.fromBackendModel(a[d]),n.push(r.data);return n.sort(function(e,t){return e.surplusTime>t.surplusTime?1:-1}),n}return a(i,t),i}(i),u=function(e){function t(t,a,i){var n=e.call(this,t,a)||this;return n.backendModelMap=$.extend({senderId:"suid",senderName:"snk",senderIcon:"sic",giftBoxId:function(e){return e.rpid||e.rpidn},senderAvatar:function(e){var t=e.sic;return t?$SYS.avatar_url+"upload/"+t+"_small.jpg":$SYS.web_url+"app/douyu/res/com/defaultAvatar.png"},pecktype:function(e){return void 0!==e.rpt?parseInt(e.rpt,10):0},surplusTime:function(e){return s.timeTransform(void 0!==e.ocd?parseInt(e.ocd,10):0)},endTime:function(e){return s.timeTransform(void 0!==e.dcd?parseInt(e.dcd,10):0)},delayTime:function(){return 1e3*(Math.floor(5*Math.random())+1)},treasureImg:function(e){return d(e).giftCloseBg},treasureOpenedImg:function(e){return d(e).giftOpenBg}},a),n.fromBackendModel(t),o.useFullData=n.data,o}return a(t,e),t}(i);return{TreasureModel:c,NobleTreasureModel:u}}),define("douyu/page/room/normal/mod/gift/chainManager",["douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/constants","douyu/page/room/normal/mod/gift/controller/banner"],function(e,t){var a=function(){function e(e){this.gift=null,this.nextManager=null,this.stepPool=e}return e.prototype.goNext=function(e){if(!e)throw new Error("没有礼物被处理");this.nextManager.applyGift(e)},e.prototype.applyGift=function(e){this.validGift(e),this.handleGift(e)},e.prototype.validGift=function(e){},e.prototype.handleGift=function(){throw new Error("子类必须实现该方法")},e.prototype.setNextManager=function(e){return this.nextManager=e,this.nextManager},e}(),i=function(a){function i(e){return a.call(this,e)||this}return e(i,a),i.prototype.handleGift=function(e){this.goNext(e)},i.prototype.toString=function(){return t.GIFT_BEGIN},i}(a),s=function(t){function a(e){return t.call(this,e)||this}return e(a,t),a.prototype.handleGift=function(e){var t=this;this.stepPool.add(e,function(){t.goNext(e)})},a}(a);s.toString=function(){return t.RAISE_SMALL_UP};var n=function(t){function a(e){return t.call(this,e)||this}return e(a,t),a.prototype.handleGift=function(e){var t=this;this.stepPool.add(e,function(){t.goNext(e)})},a}(a);n.toString=function(){return t.RAISE_UP};var o=function(t){function a(e){return t.call(this,e)||this}return e(a,t),a.prototype.handleGift=function(e){var t=this;this.stepPool.add(e,function(){t.goNext(e)})},a}(a);o.toString=function(){return t.PLANE_SMALL_UP};var r=function(t){function a(e){return t.call(this,e)||this}return e(a,t),a.prototype.handleGift=function(e){var t=this;this.stepPool.add(e,function(){t.goNext(e)})},a}(a);r.toString=function(){return t.PLANE_UP};var l=function(t){function a(e){return t.call(this,e)||this}return e(a,t),a.prototype.handleGift=function(e){var t=this;this.stepPool.add(e,function(){t.goNext(e)})},a}(a);l.toString=function(){return t.COMMON_SMALL_UP};var d=function(t){function a(e){return t.call(this,e)||this}return e(a,t),a.prototype.handleGift=function(e){var t=this;this.stepPool.add(e,function(){t.goNext(e)})},a}(a);d.toString=function(){return t.COMMON_UP};var c=function(t){function a(e){return t.call(this,e)||this}return e(a,t),a.prototype.handleGift=function(e){var t=this;this.stepPool.add(e,function(){t.goNext(e)})},a}(a);c.toString=function(){return t.SUPER_SMALL_UP};var u=function(t){function a(e){return t.call(this,e)||this}return e(a,t),a.prototype.handleGift=function(e){var t=this;this.stepPool.add(e,function(){t.goNext(e)})},a}(a);u.toString=function(){return t.SUPER_UP};var g=function(t){function a(e){return t.call(this,e)||this}return e(a,t),a.prototype.handleGift=function(e){var t=this;this.stepPool.add(e,function(){t.goNext(e)})},a}(a);g.toString=function(){return t.BANNER};var m=function(t){function a(e){return t.call(this,e)||this}return e(a,t),a.prototype.handleGift=function(e){var t=this;this.stepPool.add(e,function(){t.goNext(e)})},a}(a);m.toString=function(){return t.DROP_DOWN};var p=function(t){function a(e){return t.call(this,e)||this}return e(a,t),a.prototype.handleGift=function(e){var t=this;this.stepPool.add(e,function(){t.goNext(e)})},a}(a);p.toString=function(){return t.TREASURE_BOX};var f=function(t){function a(e){return t.call(this,e)||this}return e(a,t),a.prototype.handleGift=function(e){var t=this;this.stepPool.add(e,function(){t.goNext(e)})},a}(a);f.toString=function(){return t.OPEN_NOBLE};var h=function(t){function a(e){return t.call(this,e)||this}return e(a,t),a.prototype.handleGift=function(e){},a}(a);return{StartManager:i,RaiseSmallUpManager:s,RaiseUpManager:n,PlaneSmallUpManager:o,PlaneUpManager:r,CommonSmallUpManager:l,CommonUpManager:d,SuperSmallUpManager:c,SuperUpManager:u,BannerManager:g,DropDownManager:m,TreasureBoxManager:p,OpenNobleManager:f,EndManager:h}}),define("douyu/page/room/normal/mod/gift/model/models",["douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/model/banner","douyu/page/room/normal/mod/gift/model/commonmodel","douyu/page/room/normal/mod/gift/model/treasure"],function(e,t,a,i){return{Banner:t,Commonmodel:a,TreasureModel:i}}),define("douyu/page/room/normal/mod/gift/stepPool",["shark/observer","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/constants","douyu/page/room/normal/mod/gift/base/queue","douyu/page/room/normal/mod/gift/controller/banner"],function(e,t,a,i,s){var n=new s($(".chat-cont-wrap")),o=function(){function e(){this.pool=[],this.isComsuming=!1}return e.prototype.handle=function(){throw new Error("子类必须实现该方法")},e.prototype.add=function(e,t){this.pool.push({gift:e,callback:t}),this.isComsuming||this.consume(e,t)},e.prototype.consume=function(){this.isComsuming=!0;for(var e;e=this.pool.shift();)this.handle(e.gift,e.callback);this.isComsuming=!1},e}(),r=function(s){function n(){var e=s.call(this)||this;return e.raiseSmallUpBlock=null,e.chatbox=null,e.queue=new i,e.queue.run(),e.num=0,e}return t(n,s),n.prototype.handle=function(t,i){e.trigger(a.RAISE_SMALL_UP,t,function(){i()})},n}(o);r.getInstance=function(){return r.pool||(r.pool=new r),r.pool},r.toString=function(){return a.RAISE_SMALL_UP};var l=function(s){function n(){var e=s.call(this)||this;return e.raiseUpBlock=null,e.chatbox=null,e.queue=new i,e.queue.run(),e}return t(n,s),n.prototype.handle=function(t,i){e.trigger(a.RAISE_UP,t,function(){i()})},n}(o);l.getInstance=function(){return l.pool||(l.pool=new l),l.pool},l.toString=function(){return a.RAISE_UP};var d=function(s){function n(){var e=s.call(this)||this;return e.planeSmallUpBlock=null,e.chatbox=null,e.queue=new i,e.queue.run(),e}return t(n,s),n.prototype.handle=function(t,i){e.trigger(a.PLANE_SMALL_UP,t,function(){i()})},n}(o);d.getInstance=function(){return d.pool||(d.pool=new d),d.pool},d.toString=function(){return a.PLANE_SMALL_UP};var c=function(s){function n(){var e=s.call(this)||this;return e.planeUpBlock=null,e.chatbox=null,e.queue=new i,e.queue.run(),e}return t(n,s),n.prototype.handle=function(t,i){e.trigger(a.PLANE_UP,t,function(){i()})},n}(o);c.getInstance=function(){return c.pool||(c.pool=new c),c.pool},c.toString=function(){return a.PLANE_UP};var u=function(s){function n(){var e=s.call(this)||this;return e.commonSmallUpBlock=null,e.chatbox=null,e.queue=new i,e.queue.run(),e}return t(n,s),n.prototype.handle=function(t,i){e.trigger(a.COMMON_SMALL_UP,t,function(){i()})},n}(o);u.getInstance=function(){return u.pool||(u.pool=new u),u.pool},u.toString=function(){return a.COMMON_SMALL_UP};var g=function(s){function n(){var e=s.call(this)||this;return e.commonUpBlock=null,e.chatbox=null,e.queue=new i,e.queue.run(),e}return t(n,s),n.prototype.handle=function(t,i){e.trigger(a.COMMON_UP,t,function(){i()})},n}(o);g.getInstance=function(){return g.pool||(g.pool=new c),g.pool},g.toString=function(){return a.COMMON_UP};var m=function(s){function n(){var e=s.call(this)||this;return e.commonSmallUpBlock=null,e.chatbox=null,e.queue=new i,e.queue.run(),e}return t(n,s),n.prototype.handle=function(t,i){e.trigger(a.SUPER_SMALL_UP,t,function(){i()})},n}(o);m.getInstance=function(){return m.pool||(m.pool=new m),m.pool},m.toString=function(){return a.SUPER_SMALL_UP};var p=function(s){function n(){var e=s.call(this)||this;return e.commonUpBlock=null,e.chatbox=null,e.queue=new i,e.queue.run(),e}return t(n,s),n.prototype.handle=function(t,i){e.trigger(a.SUPER_UP,t,function(){i()})},n}(o);p.getInstance=function(){return p.pool||(p.pool=new p),p.pool},p.toString=function(){return a.SUPER_UP};var f=function(e){function a(){return e.call(this)||this}return t(a,e),a.prototype.handle=function(e,t){var a=this;n.add(e,function(){t.apply(a)})},a}(o);f.getInstance=function(){return f.pool||(f.pool=new f),f.pool},f.toString=function(){return a.BANNER};var h=function(i){function s(){return i.call(this)||this}return t(s,i),s.prototype.handle=function(t,i){e.trigger(a.DROP_DOWN_VIEW,t,function(){i()})},s}(o);h.getInstance=function(){return h.pool||(h.pool=new h),h.pool},h.toString=function(){return a.DROP_DOWN};var v=function(i){function s(){return i.call(this)||this}return t(s,i),s.prototype.consume=function(t,i){e.trigger(a.TREASURE_BOX_VIEW,t,function(){i()})},s}(o);v.getInstance=function(){return v.pool||(v.pool=new v),v.pool},v.toString=function(){return a.TREASURE_BOX};var b=function(i){function s(){return i.call(this)||this}return t(s,i),s.prototype.consume=function(t,i){e.trigger(a.OPEN_NOBLE,t,function(){i()})},s}(o);return b.getInstance=function(){return b.pool||(b.pool=new b),b.pool},b.toString=function(){return a.OPEN_NOBLE},{RaiseSmallUpPool:r,RaiseUpPool:l,PlaneSmallUpPool:d,PlaneUpPool:c,CommonSmallUpPool:u,CommonUpPool:g,SuperSmallUpPool:m,SuperUpPool:p,BannerPool:f,DropDownPool:h,TreasureBoxPool:v,OpenNoblePool:b}}),define("douyu/page/room/normal/mod/gift/view/views",["shark/observer","douyu/page/room/normal/mod/gift/constants","douyu/page/room/normal/mod/gift/controller/rocket","douyu/page/room/normal/mod/gift/view/banner","douyu/page/room/normal/mod/gift/controller/plane","douyu/page/room/normal/mod/gift/controller/commonfly","douyu/page/room/normal/mod/gift/controller/super","douyu/page/room/normal/mod/gift/controller/open-noble"],function(e,t,a,i,s,n,o){var r=$('<div class="giftbatter-box giftbatter-box2" style="overflow:visible"></div>');$("#js-chat-cont").append(r);var l=new i({bannerBox:r});e.on(t.GiFT_BANNER_LIST,function(e){l.render(e)}),e.on(t.BANNER_VIEW,function(e,t){l.render(e,t)})}),define("douyu/page/room/normal/mod/gift/view/treasure",["jquery","shark/util/lang/1.0","shark/util/template/2.0","shark/observer","douyu/context","douyu/com/exjsonp","douyu/page/room/normal/mod/gift/base/extends","douyu/page/room/normal/mod/gift/base/queue","douyu/page/room/normal/mod/gift/base/view","douyu/page/room/normal/mod/gift/timer","douyu/page/room/normal/mod/gift/constants","douyu/page/room/normal/mod/gift/controller/treasure","douyu/page/room/normal/mod/gift/controller/collect-treasure"],function(e,t,a,i,s,n,o,r,l,d,c,u,g){var m=[],p=new d,f={isTimerRunning:!1,isDescendStatus:!1,isGiftExist:!1,userBindCase:0,isGiftShow:!1,isDropDown:!1,configDoms:{$chatWrap:e(".chat"),$chatContent:e("#js-chat-speak")}},h=function(a){function i(e){var t=a.call(this,e)||this;return t.queue=new r,t.queue.run(),t}return o(i,a),i.prototype.init=function(){this.$giftBox=f.configDoms.$chatWrap.find("#right_col_peck"),this.giftBoxBlock=this.giftBoxBlock||t.string.join('<div class="peck peck-loading" id="right_col_peck">','<div class="peck-num"><span>x</span><strong class="peck-number"></strong><i></i></div>','<div class="peck-tip">','<div class="peck-tip-container">','<div class="peck-tip-top">','<img class="peck-tip-img" src="'+$SYS.res_url+'douyu/images/defaultAvatar.png?20170622&amp;size=small"/>','<div class="peck-tip-content">','<span class="peck-tip-uname" title=""></span>','<p class="peck-tip-status"></p>','<i class="peck-tip-arrow peck-tip-arrow1"></i>','<i class="peck-tip-arrow peck-tip-arrow2"></i>',"</div>","</div>","</div>","</div>",'<div class="peck-status"><div class="peck-cd"></div><div class="peck-cdn">loading...</div></div>','<div class="peck-check-box" id="geettest-box">','<span class="peck-check-lsq"></span>','<span class="peck-check-off" data-geetbox="off">×</span>','<i class="peck-border-trg1"></i><i class="peck-border-trg2"></i>','<div class="peck-check-title"><span>验证通过</span>后可以获得宝箱礼物</div>','<div class="peck-check-inp clearfix">','    <div class="captcha-gt"></div>',"</div>","    </div>","</div>"),this.$giftBox.length||f.configDoms.$chatWrap.append(this.giftBoxBlock)},i.prototype.render=function(t){var a;a=function(){var a=e.Deferred(),i=f.configDoms,s=i.$chatWrap,n=i.$chatContent,o=s.find("#right_col_peck"),r=s.find(".peck-num"),l=s.find(".peck-number"),d=(s.find(".peck-cdn"),s.find(".peck-status")),c=s.outerHeight(!0)-(n.outerHeight(!0)||0)-o.height()-82,u=m[0].treasureImg;return l.text(m.length),m.length>1&&!f.isDropDown?r.show():r.hide(),f.isDropDown?d.hide():d.show(),m.length<=1&&!f.isGiftExist&&!f.isDescendStatus?(f.isDropDown=!0,d.hide(),r.hide(),o.show().css({top:0,backgroundImage:"url("+u+")"}).animate({top:c},1e3,function(){f.isDropDown=!1,m.length>1&&r.show(),d.show(),t&&e.isFunction(t)&&t()})):(f.isGiftExist&&!f.isGiftShow&&(f.isGiftShow=!0,o.show().css({top:c,backgroundImage:"url("+u+")"})),t&&e.isFunction(t)&&t()),a.resolve(),a.name="dropgift",a},this.queue.addJob(a)},i}(l),v=function(t){function a(e){var a=t.call(this,e)||this;return a.queue=new r,a.queue.run(),a}return o(a,t),a.prototype.load=function(t,a){var i;i=function(){var i=e.Deferred(),s=f.configDoms,n=(s.$chatWrap.find(".peck-num"),s.$chatWrap.find(".peck-number"),s.$chatWrap.find(".peck-cdn")),o=s.$chatWrap.find("#right_col_peck"),r=s.$chatWrap.outerHeight(!0)-(s.$chatContent.outerHeight(!0)||0)-o.height()-82;return o.css({top:r}),o.data("isBindPhone",f.userBindCase),o.find(".peck-tip-img").attr("src",m[0].senderAvatar),o.find(".peck-tip-uname").text(u.changeUserNameByLen(m[0].senderName,27)).attr("title",m[0].senderName),o.css({backgroundImage:"url("+m[0].treasureImg+")"}),10===m[0].pecktype?o.find(".peck-tip-status").html("神秘节奏风暴即将来袭~"):o.find(".peck-tip-status").html("领取未开始，请您耐心等待...<br />多发弹幕可提升领取几率哦~"),n.text("loading..."),o.removeClass("peck-open peck-close").addClass("peck-loading").find(".peck-cd").stop(!0,!0).css({width:0}).animate({width:"100%"},t.delayTime,function(){o.removeClass("peck-loading peck-open").addClass("peck-close"),u.isBind.init(f.userBindCase),a()}),f.userBindCase>0&&n.addClass("noBind"),i.resolve(),i.name="loading",i},this.queue.addJob(i)},a.prototype.backtime=function(t){var a;a=function(){var a=e.Deferred(),i=f.configDoms,s=i.$chatWrap.find("#right_col_peck"),n=i.$chatWrap.outerHeight(!0)-(i.$chatContent.outerHeight(!0)||0)-s.height()-82;return s.css({top:n}),parseInt(t.surplusTime/1e3,10)<=0&&!f.isEndingStatus?(f.isEndingStatus=!0,s.css({backgroundImage:"url("+t.node.treasureOpenedImg+")"}).removeClass("peck-close peck-loading").addClass("peck-open").find(".peck-cdn").text("领取"),10===t.node.pecktype?s.find(".peck-tip-status").html('神秘宝箱已开启，成功领取宝箱后，<br />将自动发送节奏弹幕:<br /><span class="rhythm"></span>').find(".rhythm").text(t.node.danmucontent):s.find(".peck-tip-status").html("神秘宝箱已开启，手慢无！~"),s.data("isGiftCanGet",!0)):parseInt(t.surplusTime/1e3,10)>0&&s.css({backgroundImage:"url("+t.node.treasureImg+")"}).find(".peck-cdn").text(t.curTime),f.userBindCase>0&&(s.data("isUnBind",!0),s.find(".peck-cdn").addClass("noBind")),a.resolve(),a.name="backtime",a},this.queue.addJob(a)},a}(l),b=new h,y=new v;b.init();var k={mapGiftListData:function(e){var t=this,a=[],s=f.configDoms.$chatWrap.find("#right_col_peck"),n=s.find(".peck-tips"),o=s.find(".peck-status"),r=s.find("#geettest-box"),l=(new Date).getTime();m.shift();for(var d=0;d<m.length;d++){var u=m[d].endTime,g=m[d].pecktype;!u||l>u?(m.splice(d,1),d--):10===g&&(a.push(m.splice(d,1)[0]),d--)}a=a.sort(function(e,t){return e.endTime>t.endTime?1:-1}),m=a.concat(m),i.trigger(c.TREASURE_OVER_TIME),f.isGiftShow=!1,m.length>=1?(1===m.length&&(f.isDescendStatus=!0),b.render(m),t.renderLoadView(m[0])):(s.hide(),o.hide(),r.hide(),n.remove(),p.stop(),i.trigger(c.TREASURE_ALL_EMPTY,e),f.isTimerRunning=!1,f.isDescendStatus=!1,f.isGiftExist=!1)},renderLoadView:function(t){var a,i,s,n=e("#right_col_peck"),o=this;return p.stop(),t&&void 0!==t.backTime&&void 0!==t.endTime?(a=(new Date).getTime(),i=parseInt((t.backTime-a-t.delayTime)/1e3,10),s=parseInt((t.endTime-a-t.delayTime)/1e3,10),f.isTimerRunning=!0,n.data("isGiftCanGet",!1),0>i?f.isGet=!1:f.isGet=!0,0>s?void o.mapGiftListData(""):void y.load(t,function(){o.renderCurView({count:i,endTime:s,node:t})})):void o.mapGiftListData("")},renderCurView:function(e){var t,a={},i=parseInt(e.node.backTime,10),s=this;e.endTime;f.isEndingStatus=!1,p.set(e.endTime),p.decrease(0,500,function(s){var n=(new Date).getTime();t=i-n,a={curTime:u.timeFormat(parseInt(t,10)),surplusTime:t,node:e.node},y.backtime(a)},function(){s.mapGiftListData("")})}};i.on(c.IS_LOGIN_CONTROLLER,function(e){f.userBindCase=e,u.giftMsgShow.init(f.userBindCase)}),i.on(c.DROP_DOWN_VIEW,function(e,t){var a={},i=[];if(e.useFullData)a=u.timeHandle(e.useFullData),m.push(a);else{if(i=u.handleData(e),i.length<=0)return void t();f.isGiftExist=!0;for(var s=0;s<i.length;s++)a=u.timeHandle(i[s]),m.push(a)}b.render(t)}),i.on(c.TREASURE_BOX_VIEW,function(e,t){t(),!f.isTimerRunning&&m[0]&&k.renderLoadView(m[0])}),i.on(c.GET_GIFT_BACK,function(){return{giftQueue:m,isGet:f.isGet}}),i.on(c.GIFT_DESTORY,function(){u.saveRecord(m),k.mapGiftListData("click")}),g.init()}),define("douyu/page/room/normal/mod/gift/app",["douyu/context","shark/observer","douyu/com/get-gift-configs","douyu/page/room/normal/mod/gift/base/view","douyu/page/room/normal/mod/gift/chainManager","douyu/page/room/normal/mod/gift/constants","douyu/page/room/normal/mod/gift/controller/banner","douyu/page/room/normal/mod/gift/model/models","douyu/page/room/normal/mod/gift/stepPool","douyu/page/room/normal/mod/gift/view/views","douyu/page/room/normal/mod/gift/view/treasure"],function(e,t,a,i,s,n,o,r,l,d,c){var u=function(){function a(){this.version="DY20170612"}return a.prototype.getgiftChainConfig=function(){return this.giftChainConfig={rocketChain:[s.RaiseUpManager,s.BannerManager,s.DropDownManager,s.TreasureBoxManager],rocketSimpleChain:[s.RaiseUpManager,s.BannerManager],ownerRocketChain:[s.RaiseSmallUpManager,s.RaiseUpManager,s.BannerManager,s.DropDownManager,s.TreasureBoxManager],ownerRocketSimpleChain:[s.RaiseSmallUpManager,s.RaiseUpManager,s.BannerManager],planeChain:[s.PlaneUpManager,s.BannerManager,s.DropDownManager,s.TreasureBoxManager],planeSimpleChain:[s.PlaneUpManager,s.BannerManager],ownerPlaneChain:[s.PlaneSmallUpManager,s.PlaneUpManager,s.BannerManager,s.DropDownManager,s.TreasureBoxManager],ownerPlaneSimpleChain:[s.PlaneSmallUpManager,s.PlaneUpManager,s.BannerManager],commonChain:[s.BannerManager,s.DropDownManager,s.TreasureBoxManager],commonSimpleChain:[s.BannerManager],ownerCommonChain:[s.CommonSmallUpManager,s.BannerManager,s.DropDownManager,s.TreasureBoxManager],ownerCommonSimpleChain:[s.CommonSmallUpManager,s.BannerManager],superChain:[s.SuperUpManager,s.BannerManager,s.DropDownManager,s.TreasureBoxManager],superSimpleChain:[s.SuperUpManager,s.BannerManager],ownerSuperChain:[s.SuperSmallUpManager,s.SuperUpManager,s.BannerManager,s.DropDownManager,s.TreasureBoxManager],ownerSuperSimpleChain:[s.SuperSmallUpManager,s.SuperUpManager,s.BannerManager],highChain:[s.BannerManager,s.DropDownManager,s.TreasureBoxManager],highSimpleChain:[s.BannerManager],normalChain:[s.BannerManager,s.DropDownManager,s.TreasureBoxManager],normalSimpleChain:[s.BannerManager],peckChain:[s.DropDownManager,s.TreasureBoxManager],treasureBoxChain:[s.DropDownManager,s.TreasureBoxManager],openNobleChain:[s.OpenNobleManager,s.BannerManager],openNobleSimpleChain:[s.BannerManager]},this.giftChainConfig},a.prototype.initGiftChain=function(e){var t,i=[],s=this.giftChainConfig||a.prototype.getgiftChainConfig();if(t=s[e],!t)throw new Error("没有对应礼物动画队列");for(var n=0;n<t.length;n++)i.push(t[n]);this[e]=a.setUpChain(i)},a.setUpChain=function(){var e=new s.StartManager,t=e;for(var a in arguments[0]){var i,n=arguments[0][a],o=!1;if(n){for(var r in l)if(l[r].toString()===n.toString()){i=l[r],o=!0;break}if(!o)throw new Error("没有对应初始化对象池");var d=new n(i.getInstance());e.setNextManager(d),e=d}}return e.setNextManager(new s.EndManager),t},a.prototype.addGift=function(e,t){var i=e.split(n.VERSION)[1];this[i+"Chain"]||a.prototype.initGiftChain(i+"Chain"),this[i+"Chain"].applyGift(t)},a.prototype.checkSenderOwner=function(t){return e.get("sys.uid")==t},a.prototype.giftShieldStatus=function(a){var i=t.fire("mod.chat.msg.shield");return i.allGift?e.get("sys.uid")!=a:!1},a}(),g=new u,m=function(e){var t,a,i,s=0;if(a=new r.Commonmodel(e.giftConfig),i=new r.Banner(e.giftData,e.giftConfig),a.mergeData(i),!g.giftShieldStatus(a.useFullData.senderId)){switch(s=a.useFullData.giftBoxId?1:0,parseInt(a.useFullData.effect,10)){case 0:t=s?n.GIFT_NORMAL:n.GIFT_NORMAL_SIMPLE;break;case 1:t=g.checkSenderOwner(a.useFullData.senderId)?s?n.GIFT_OWNER_ROCKET:n.GIFT_OWNER_ROCKET_SIMPLE:s?n.GIFT_ROCKET:n.GIFT_ROCKET_SIMPLE;break;case 2:t=g.checkSenderOwner(a.useFullData.senderId)?s?n.GIFT_OWNER_PLANE:n.GIFT_OWNER_PLANE_SIMPLE:s?n.GIFT_PLANE:n.GIFT_PLANE_SIMPLE;break;case 3:case 4:case 5:t=g.checkSenderOwner(a.useFullData.senderId)?s?n.GIFT_OWNER_COMMON:n.GIFT_OWNER_COMMON_SIMPLE:s?n.GIFT_COMMON:n.GIFT_COMMON_SIMPLE;break;case 101:t=g.checkSenderOwner(a.useFullData.senderId)?s?n.GIFT_OWNER_SUPER:n.GIFT_OWNER_SUPER_SIMPLE:s?n.GIFT_SUPER:n.GIFT_SUPER_SIMPLE;break;case 111111:t=parseInt(a.useFullData.isNobleEffectShow,10)?n.OPEN_NOBLE:n.OPEN_NOBLE_SIMPLE}g.addGift(t,a)}};t.on(n.GiFT_USENTER_LIST,function(e){var t;a.load().done(function(a){t=new r.TreasureModel.TreasureModel(e,"",a),g.addGift(n.TREASURE_BOX,t)})}),t.on(n.NOBLE_TREASURE_BOX,function(e){var t;a.load().done(function(a){t=new r.TreasureModel.NobleTreasureModel(e,"",a),g.addGift(n.TREASURE_BOX,t)})}),t.on(n.OPEN_NOBLE_PUSH,function(e){m(e)}),t.on(n.GET_GIFT_DATA,function(e){"giftCQ"==e.giftType?m(e):a.get(e.giftData.gfid).done(function(t){e.giftConfig=t,m(e)})})}),define("douyu/com/avatar",["jquery","shark/observer","shark/util/lang/1.0","shark/util/cookie/1.0","douyu/context"],function(e,t,a,i,s){var n={cacheKey:"avatar",avatarDomain:s.get("sys.avatar_url"),defaultAvatarUrl:s.get("sys.res_url")+"douyu/images/defaultAvatar.png?20160303",avatarCache:{}},o={cache:function(t,a,i){var s=n.avatarCache[t];return i?(e.isPlainObject(s)||(n.avatarCache[t]={}),void(n.avatarCache[t][a]=i)):e.isPlainObject(s)?s[a]:""},getSelfAvatar:function(t,s,r){var l=i.get(n.cacheKey);if(l){switch(l.charAt(l.length-1)){case"_":l+=s+".jpg";break;case"=":l+=s}return r(l)}e.ajax({url:a.string.format("/lapi/member/userInfo/getInfo/{0}?size={1}&icon={2}",t,s,1),type:"GET",dataType:"json",error:function(){r(n.defaultAvatarUrl)},success:function(e){var l=n.defaultAvatarUrl;if(0===parseInt(e.error,10)&&e.data.icon&&0===parseInt(e.data.icon.code,10)){l=a.string.format("{0}upload/{1}",n.avatarDomain,e.data.icon.msg);var d=l.indexOf("_small.jpg")||l.indexOf("_middle.jpg")||l.indexOf("_big.jpg")||l.indexOf("size=")+4;d&&i.set(n.cacheKey,l.substring(0,d+1),0),o.cache(t,s,l)}r(l)}})},getOthersAvatar:function(t,i,s){e.ajax({url:a.string.format("{0}lapi/member/avatar/getAvatar?uid={1}&size={2}","/",t,i),type:"GET",error:function(){s(n.defaultAvatarUrl)},success:function(e){var r=n.defaultAvatarUrl;e&&(r=a.string.format("{0}upload/{1}",n.avatarDomain,e),o.cache(t,i,r)),s(r)}})}};t.on("douyu.avatar.get",function(t,a,i){var r=n.defaultAvatarUrl;t=String(t),a=a||"small",i=e.isFunction(i)?i:function(){},n.avatarDomain&&t&&!(r=o.cache(t,a))||i(r),s.get("sys.uid")===t?o.getSelfAvatar(t,a,i):o.getOthersAvatar(t,a,i)}),t.on("douyu.avatar.url",function(t,i,s){t=t?String(t):"",i=i||"small",(s=e.isFunction(s)?s:function(){})(n.avatarDomain&&t?a.string.format("{0}upload/{1}_{2}.jpg",n.avatarDomain,t,i):n.defaultAvatarUrl)})}),define("douyu/page/room/normal/mod/chat-user-manager",["jquery","shark/observer","shark/util/flash/data/1.0","douyu/context","douyu/com/user","douyu/page/room/base/api"],function(e,t,a,i,s,n){var o={},r={},l={},d={},c={};return o.isListen=!1,o.isLocked=!1,d.stopEvt=function(e){e.preventDefault(),e.stopPropagation()},r.init=function(){r.$container=e(document),r.$chatCont=e("#js-chat-cont"),r.$menugrp=e(".user-card-action"),r.$userManager=e('[data-type="user-manager-group"]'),r.$mute=r.$menugrp.find('[data-type="mute"]'),r.$reportgrp=r.$menugrp.find('[data-type="toreport"]'),r.$report=r.$userManager.find('[data-type="report"]'),r.$shield=r.$menugrp.find('[data-type="shield"]'),r.$appoint=r.$menugrp.find('[data-type="appoint"]'),r.$closure=r.$menugrp.find('[data-type="onekeyblack"]'),r.$opnenoble=r.$menugrp.find('[data-type="opnenoble"]'),o.uid=i.get("sys.uid"),o.ugd=i.get("sys.groupid"),5!=i.get("sys.groupid")?r.$closure.remove():r.$shield.remove();var a=t.fire("mod.center.userrole.get");o.role=a.join(",")},r.showManager=function(){o.rgp.rg<4&&(o.ugp.rg>=4||5==o.ugd||2==o.ugd)?r.$mute.show():r.$mute.hide(),5==o.rgp.pg&&r.$mute.hide(),r.$report[void 0===o.cid||o.gid>=5?"hide":"show"]();var a=t.fire("mod.chat.blackList.get",o.rel),i=r.$shield.text(),s=0;if(a.index>-1?(i="取消屏蔽",s=1):a.length>=10?(i="屏蔽人数已满",s=3):(i="屏蔽用户",s=0),r.$shield.show().html('<i class="icon pb-icon"></i>'+i).attr("rel",s),o.cid||e("[data-type='report'][data-rept='0']").hide(),5==o.ugp.rg||5==o.ugd&&o.rgp.rg<5){var n=4==o.rgp.rg?1:4,l=4==o.rgp.rg?"解除房管":"任命房管";r.$appoint.show().html('<i class="icon rm-icon"></i>'+l).attr("rel",n)}else r.$appoint.hide()},l.init=function(){l.chatCont(),l.userManager(),r.$container.off("click.manager").on("click.manager",function(){r.$userManager.hide()})},l.chatCont=function(){var e=r.$userManager;return o.clt=parseInt(e.attr("clt"),10)||0,o.rel=e.attr("rel"),o.gid=parseInt(e.attr("gid"),10),o.cid=e.attr("chatid"),o.rgp=t.fire("mod.center.usergroup.get",o.rel),o.una=e.attr("nickname"),t.trigger("douyu.avatar.url",e.attr("avatar"),"big",function(e){o.avatar=e}),o.uid&&2!=o.gid&&o.uid!=o.rel&&5!=o.gid?(o.ugp||(o.ugp=t.fire("mod.center.usergroup.get",o.uid)),r.showManager(),9!==o.clt&&12!==o.clt&&15!==o.clt||(r.$reportgrp.hide(),r.$shield.hide(),r.$appoint.hide(),r.$closure.hide(),"none"!==r.$mute.css("display"))?void 0:void r.$menugrp.hide()):(e.hide(),!1)},l.userManager=function(){r.$mute.on("click",function(e){d.stopEvt(e),c.mute()}),r.$report.on("click",function(a){d.stopEvt(a),o.rept=e(this).data("rept"),c.report();var i=e(this).closest("[data-noblelvl]").data("noblelvl")||0;t.trigger("dys",{key:"dys.room.username.click",type:1,r_type:1,level:i})}),r.$shield.on("click",function(a){d.stopEvt(a),c.shield();var i=e(this).closest("[data-noblelvl]").data("noblelvl")||0;t.trigger("dys",{key:"dys.room.username.click",type:2,r_type:2,level:i})}),r.$appoint.on("click",function(e){d.stopEvt(e),c.appoint()}),r.$closure.on("click",function(e){d.stopEvt(e),c.closure()}),r.$opnenoble.on("click",function(e){d.stopEvt(e),c.opnenoble()}),o.isListen||(t.on("mod.mute.anchorwhitelist.confirm",function(e){c.muteConfirm(e.config.otype)}),t.on("mod.closure.anchorwhitelist.confirm",function(e){c.closureConfirm()}),o.isListen=!0)},c.mute=function(){if(o.isLocked=!1,2==o.ugd||!(o.ugp.rg<4&&5!=o.ugd||o.uid==o.rel)){var s="",r=0;if(9===o.clt||12===o.clt||15===o.clt)return o.role.indexOf(4)>=0?s=['<ul class="room-super-menu room-super-menu-super-admin">','<li><em>用户：</em><strong class="unser-name">'+o.una+"</strong></li>",'<li><em>是否全站：</em><span class="room-super-menu-radio"><input type="radio" name="full" value="1" id="room-super-menu-full1"><label for="room-super-menu-full1">当前房间</label></span><span class="room-super-menu-radio"><input type="radio" name="full" value="2" data-roomid="-1" checked="checked" id="room-super-menu-full2"><label for="room-super-menu-full2">全站</label></span></li>',"<li><em>时长：</em><strong>永久</strong></li>","</ul>"].join(""):(-1!=o.role.indexOf(3)||4==o.ugp.rg||o.role.indexOf(2)>=0)&&(s=['<ul class="room-super-menu room-super-menu-super-admin">','<li><em>用户：</em><strong class="unser-name">'+o.una+"</strong></li>","<li><em>范围：</em><strong>当前房间</strong></li>","<li><em>时长：</em><strong>永久</strong></li>","</ul>"].join("")),void e.dialog({title:"禁止发言",content:s,id:"black900l",ok:function(){var e=i.get("room.room_id");this.DOM.content.find('[data-roomid="-1"]').prop("checked")&&(e=-1),n.exe("js_blackuser",a.encode([{name:"type",value:"thirdblackreq"},{name:"userid",value:o.rel},{name:"dnick",value:o.una},{name:"rid",value:e},{name:"ct",value:o.clt}]))},cancelVal:"取消",cancel:!0});-1!=o.role.indexOf(4)?(s=['<ul class="room-super-menu room-super-menu-super-admin" id="room-super-menu-mute">','<li class="user-avatar"><em>头像：</em><img src="'+o.avatar+'"></li>','<li><em>用户：</em><strong class="unser-name">'+o.una+"</strong></li>","<li><em>UID：</em><strong>"+o.rel+"</strong></li>",'<li><em>是否全站：</em><span class="room-super-menu-radio"><input type="radio" name="full" value="1" id="room-super-menu-full1" /><label for="room-super-menu-full1">当前房间</label></span><span class="room-super-menu-radio"><input type="radio" name="full" value="2" checked="" id="room-super-menu-full2" /><label for="room-super-menu-full2">全站</label></span></li>','<li><em>范围：</em><span class="room-super-menu-radio"><input type="radio" name="range" value="1" checked="" id="room-super-menu-range1" /><label for="room-super-menu-range1">该用户</label></span><span class="room-super-menu-radio"><input type="radio" name="range" value="2" id="room-super-menu-range2" /><label for="room-super-menu-range2">该IP段</label></span></li>','<li><em>时长：</em><input type="text" name="blacktime" value="24" class="inn-text" /><span class="info">小时</span></li>','<li><em>原因：</em><input type="radio" name="reason_choice" checked="" class="inn-radio" /><select name="ban_reason">',"<option>恶意带节奏</option>","<option>一般地域黑</option>","<option>严重地域黑</option>","<option>黑平台</option>","<option>直播间被封禁</option>","<option>恶意刷屏</option>","</select></li>",'<li class="other-reason"><em></em><input type="radio" name="reason_choice" class="inn-radio" /><textarea name="oreason" placeholder="其他原因" maxlength="30"></textarea></li>',"</ul>"].join(""),
r=3):-1!=o.role.indexOf(2)?(s=['<ul class="room-super-menu" id="room-super-menu-mute">','<li><em>用户：</em><strong class="unser-name">'+o.una+"</strong></li>",'<li><em>范围：</em><span class="room-super-menu-radio"><input type="radio" name="range" value="1" checked="" id="room-super-menu-range1" /><label for="room-super-menu-range1">该用户</label></span><span class="room-super-menu-radio"><input type="radio" name="range" value="2" id="room-super-menu-range2" /><label for="room-super-menu-range2">该IP段</label></span></li>','<li><em>时长：</em><select name="blacktime">','<option value="60">1分钟</option>','<option value="600">10分钟</option>','<option value="1800">30分钟</option>','<option value="3600">1小时</option>','<option value="28800">8小时</option>','<option value="86400" selected="">1天</option>','<option value="259200">3天</option>','<option value="604800">7天</option>','<option value="2592000">30天</option>',"</select></li>","</ul>"].join(""),r=2):-1==o.role.indexOf(3)&&4!=o.ugp.rg||(s=['<ul class="room-super-menu" id="room-super-menu-mute">','<li><em>用户：</em><strong class="unser-name">'+o.una+"</strong></li>",'<li><em>时长：</em><select name="blacktime">','<option value="60">1分钟</option>','<option value="600">10分钟</option>','<option value="1800">30分钟</option>','<option value="3600">1小时</option>','<option value="28800">8小时</option>','<option value="86400" selected="">1天</option>','<option value="259200">3天</option>','<option value="604800">7天</option>','<option value="2592000">30天</option>',"</select></li>","</ul>"].join(""),r=1),e.dialog({title:"禁止发言",content:s,id:"black900l",init:function(){if(-1!=o.role.indexOf(4)){var t=e("#room-super-menu-mute");t.find('[name="blacktime"]').focus()}},ok:function(){return c.muteDialog=this,o.isLocked||(t.trigger("mod.anchorwhitelist.dialogshow",{anchorwhitelistData:{isShowDialog:!(!o.rel||o.rel!==i.get("room.owner_uid")),userid:o.rel,config:o,flag:"mod.mute.anchorwhitelist.confirm"},config:{otype:r}}),o.isLocked=!0),!1},cancelVal:"取消",cancel:function(){o.isLocked=!1},skin:"room-super-menu-skin"})}},c.muteConfirm=function(t){var s=e("#room-super-menu-mute"),r=e.trim(s.find('[name="full"]:checked').val()),l=e.trim(s.find('[name="range"]:checked').val())||1,d=e.trim(s.find('[name="blacktime"]').val()),u=e.trim(s.find('[name="reason_choice"]:checked').next().val())||"";if(-1!=o.role.indexOf(4)){if(isNaN(d)||0>=d)return e.dialog.tips_black("请重新输入禁言时长!"),!1;if(2==r||2==l){if(d>99)return e.dialog.tips_black("禁言时长不能超过99小时!"),!1}else if(d>720)return e.dialog.tips_black("禁言时长不能超过720小时!"),!1;if(""===u)return e.dialog.tips_black("禁言原因未填写!"),!1;if(u.length>30)return e.dialog.tips_black("禁言原因长度不能大于30个字！"),!1;d=3600*d}n.exe("js_blackuser",a.encode([{name:"type",value:"newblackreq"},{name:"uid",value:o.rel},{name:"oid",value:o.uid},{name:"otype",value:t},{name:"rid",value:2==r?-1:i.get("room.room_id")},{name:"blacktype",value:l},{name:"limittime",value:d},{name:"reason",value:u}])),c.muteDialog.close()},c.report=function(){return o.uid==o.rel?void e.dialog.alert("不能举报自已!"):(r.$userManager.hide(),void(-1!==o.cid&&n.exe("js_reportBarrage",a.encode([{name:"suid",value:o.rel},{name:"rept",value:o.rept},{name:"rid",value:i.get("room.room_id")},{name:"chatmsgid",value:o.cid}]))))},c.shield=function(){var e=parseInt(r.$shield.attr("rel"),10),a=t.fire("mod.chat.blackList.get",o.rel),i=0,s="";if(0===e){if(a.index>-1||a.length>=10)return;i=1,s="取消屏蔽",t.trigger("mod.chat.blackList.set",o.rel)}else{if(-1==a.index)return;i=0,s="屏蔽用户",t.trigger("mod.chat.blackList.del",o.rel)}r.$shield.html('<i class="icon pb-icon"></i>'+s).attr("rel",i),n.exe("js_myblacklist",a.list.join("|"))},c.appoint=function(){n.exe("js_setadmin",a.encode([{name:"type",value:"setadminreq"},{name:"userid",value:o.rel},{name:"group",value:r.$appoint.attr("rel")}])),r.$userManager.hide()},c.closure=function(){if(o.isLocked=!1,i.get("sys.uid")==o.rel||5!=i.get("sys.groupid"))return void e.dialog.alert("没有相应权限!");var t=['<ul class="room-super-menu" id="room-super-menu">','<li class="user-avatar"><em>头像：</em><img src="'+o.avatar+'"></li>','<li><em>用户：</em><strong class="unser-name">'+o.una+"</strong></li>","<li><em>UID：</em><strong>"+o.rel+"</strong></li>","<li><em>时长：</em><span>永久</span></li>",'<li><em>原因：</em><input type="radio" name="reason_choice" checked="" class="inn-radio" /><select name="ban_reason">',"<option>广告</option>","<option>地域黑</option>","<option>色情</option>","<option>违规ID</option>","<option>恶意刷屏</option>","<option>涉政</option>","<option>违法擦边内容</option>","<option>违规IP下账号</option>","<option>弹幕机器人</option>","<option>其它(跳槽、冒充官方等)</option>","</select></li>",'<li class="other-reason"><em></em><input type="radio" name="reason_choice" class="inn-radio" /><textarea name="oreason" placeholder="其他原因" maxlength="30"></textarea></li>',"</ul>"].join("");e.dialog({title:"一键封号",content:t,id:"oneKeyBlack00l",init:function(){},ok:function(){var e={anchorwhitelistData:{isShowDialog:!1,flag:"mod.closure.anchorwhitelist.confirm",config:o,userid:o.rel}};return c.closureDialog=this,c.isAnchorAccount(e,c.triggerAnchorwhitelistDiaShow),!1},cancelVal:"取消",cancel:function(){o.isLocked=!1},skin:"room-super-menu-skin room-super-menu-skin-closure"})},c.opnenoble=function(){t.trigger("mod.normal.noble.buy")},c.triggerAnchorwhitelistDiaShow=function(a,i){a="string"==typeof a?JSON.parse(a):a,e.isPlainObject(i)||(i={anchorwhitelistData:{isShowDialog:!1,config:o,flag:"mod.closure.anchorwhitelist.confirm",userid:""}}),i.anchorwhitelistData.isShowDialog=!(!a||0!==parseInt(a.error)||!a.room_id),o.isLocked||(t.trigger("mod.anchorwhitelist.dialogshow",i),o.isLocked=!0)},c.isAnchorAccount=function(t,a){var i={},s="";e.isPlainObject(t)||(t={anchorwhitelistData:{isShowDialog:!1,config:o,flag:"mod.closure.anchorwhitelist.confirm",userid:""}}),a=e.isFunction(a)?a:function(){},i=t.anchorwhitelistData,s=i.userid?i.userid:"",e.ajax({url:"/room/anchor_whitelist/getroomid",type:"GET",data:{uid:s},error:function(e){a(e,t)},success:function(e){a(e,t)}})},c.closureConfirm=function(){var t=e.trim(e('#room-super-menu input[name="reason_choice"]:checked').next().val());return""===t?(e.dialog.tips_black("封禁原因未填写！"),!1):t.length>30?(e.dialog.tips_black("封禁原因长度不能大于30个字！"),!1):(n.exe("js_keyTitles",a.encode([{name:"type",value:"gbm"},{name:"roomid",value:i.get("room.room_id")},{name:"userid",value:o.rel},{name:"username",value:o.una},{name:"limittime",value:0},{name:"reason",value:t}])),void c.closureDialog.close())},{init:function(){r.init(),l.init()}}}),define("douyu/page/room/normal/mod/get-motorcade-config",["jquery","douyu/com/exjsonp","douyu/context","shark/observer","shark/util/template/2.0","shark/util/lang/1.0"],function(e,t,a,i,s,n){var o={config:{},initMotorcadeConfig:function(){t.load(a.get("sys.webconfUrl")+"resource/common/fleet/fleet_config.json","motorcadeConfig",function(e){e&&e.list&&(o.config=e.list)})},getMotorcadeConfig:function(e){var t="",a=e.cbid;if(a&&o&&o.config){var i=o.config[a];i&&(t=i.flag)}return t}};return o.initMotorcadeConfig(),{getMotorcadeConfig:o.getMotorcadeConfig}}),define("douyu/page/room/normal/mod/chat-msg-tmp",["jquery","shark/observer","shark/util/lang/1.0","shark/util/flash/data/1.0","shark/util/template/1.0","douyu/context","douyu/page/room/normal/mod/get-motorcade-config","douyu/com/exjsonp"],function(e,t,a,i,s,n,o,r){var l={};t.on("crazy.fans.config.data",function(e){l=e});var d=[];d.length<=0&&r.load(n.get("sys.webconfUrl")+"resource/common/annual2017/nickname_color_map_web.json","annual2017ColorMap",function(e){d=e});var c={};r.load(n.get("sys.webconfUrl")+"resource/common/annual2017/web_barrage_tail.json","annual2017BarrageTail",function(e){c=e});var u=function(e){var t=d,a=0,i="";if(!e)return!1;for(a;a<t.length;a++){var s=0;for(s;s<e.length;s++)if(parseInt(t[a].effect_id,10)===parseInt(e[s].eid,10))return i=t[a].color}return i},g=10,m={},p={},f={1:{id:"1500000003",title:"银质勋章：单次充值超过600鱼翅可获得。"},2:{id:"1500000005",title:"铜质勋章：累计充值超过200鱼翅可获得。"},3:{id:"1500000004",title:"红色昵称：累计充值超过1000鱼翅可获得。"},4:{id:"1500000002",title:"金质勋章：累计充值超过6666鱼翅可获得。"},5:{id:"1500000006",title:""}},h=[],v=[{id:"101",type:"png",title:"666"},{id:"102",type:"png",title:"发呆"},{id:"103",type:"png",title:"拜拜"},{id:"104",type:"png",title:"晕"},{id:"105",type:"png",title:"弱"},{id:"106",type:"png",title:"傲慢"},{id:"107",type:"png",title:"开心"},{id:"108",type:"png",title:"奋斗"},{id:"109",type:"png",title:"很酷"},{id:"110",type:"png",title:"流泪"},{id:"111",type:"png",title:"鄙视"},{id:"112",type:"png",title:"得意"},{id:"113",type:"png",title:"抠鼻"},{id:"114",type:"png",title:"亲亲"},{id:"115",type:"png",title:"偷笑"},{id:"116",type:"png",title:"口罩"},{id:"117",type:"png",title:"委屈"},{id:"118",type:"png",title:"难过"},{id:"119",type:"png",title:"吐血"},{id:"120",type:"png",title:"大怒"},{id:"121",type:"png",title:"赞"},{id:"122",type:"png",title:"睡觉"},{id:"123",type:"png",title:"骷髅"},{id:"124",type:"png",title:"调皮"},{id:"125",type:"png",title:"惊讶"},{id:"126",type:"png",title:"撇嘴"},{id:"127",type:"png",title:"拥抱"},{id:"128",type:"png",title:"背锅"},{id:"129",type:"png",title:"闭嘴"},{id:"130",type:"png",title:"吃药"},{id:"131",type:"png",title:"可怜"},{id:"132",type:"png",title:"呕吐"},{id:"133",type:"png",title:"敲打"},{id:"134",type:"png",title:"心碎"},{id:"135",type:"png",title:"嘘"},{id:"136",type:"png",title:"中箭"},{id:"137",type:"png",title:"抓狂"},{id:"001",type:"png",title:"流汗"},{id:"002",type:"png",title:"丢药"},{id:"003",type:"png",title:"白眼"},{id:"004",type:"png",title:"火箭"},{id:"005",type:"png",title:"色"},{id:"006",type:"png",title:"点蜡"},{id:"007",type:"png",title:"抽烟"},{id:"008",type:"png",title:"可爱"},{id:"009",type:"png",title:"炸弹"},{id:"010",type:"png",title:"吃丸子"},{id:"011",type:"png",title:"害怕"},{id:"012",type:"png",title:"疑问"},{id:"013",type:"png",title:"阴险"},{id:"014",type:"png",title:"害羞"},{id:"015",type:"png",title:"笑哭"},{id:"016",type:"png",title:"猪头"},{id:"017",type:"png",title:"困"}],b=n.get("sys.resource_url"),y=n.get("colligate.madelConfig"),k=n.get("room.nobleConfig")||{};return p.createArr=function(t,a,i){if(e.isArray(t)){for(var s=0;i-a>=s;s++)t.push(+a+s+"");return t}},h=p.createArr([],1500000041,1500000064),h.push("1500000143","1500000144","1500000145"),h.push("1500000047","1500000048","1500000049"),h.push("1500000154","1500000153","1500000152"),p.processArrData=function(t){var a,s,n=[];if(!t)return n;a=t.split("/");for(var o=0,r=a.length;r>o;o++)s=i.decode(a[o]).too(),e.isPlainObject(s)&&!e.isEmptyObject(s)&&n.push(s);return n},p.handleUserEnter=function(e){var a={},i=["christmas","newYear2017"],s=[1500000213,1500000214,1500000215,1500000216,1500000217];if(e.el)for(var n=0,o=e.el.length;o>n;n++)for(var r=0;r<s.length;r++)if(parseInt(e.el[n].eid,10)===s[r])return t.fire("mod.userenter.activity.year2017",{node:e,enterId:s[r]});if(e.ceid)return t.fire("mod.chat.level120.enter",e);if(e.nl&&7!=e.nl)return t.fire("mod.chat.noble.enter",e);if(e.girlPrivilege)return t.fire("mod.userenter.get.girl",e);if(e.el)for(var l=0,o=e.el.length;o>l;l++)if(1500000123===parseInt(e.el[l].eid,10))return t.fire("mod.userenter.get.sharkKing",e);for(var d=0;d<i.length;d++){var c=p.handleEL(i[d],e.el);if(c){a=t.fire("mod.userenter.get."+c,e)||{};break}}return a},p.handleEid=function(t){return t?-1!==e.inArray(t,h)?"cataRankList":void 0:!1},p.handleEL=function(e,t){if(t.length)for(var a=0;len=t.length,a<len;a++){if("namered"===e&&t[a].eid&&f[3]&&t[a].eid===f[3].id)return e;if("taskwel"===e&&t[a].eid&&f[5]&&t[a].eid===f[5].id)return e;if("namegold"===e&&t[a].eid&&"1500000082"===t[a].eid)return e;if("christmas"===e&&t[a].eid&&("1500000092"===t[a].eid||"1500000094"===t[a].eid))return e;if("newYear2017"===e&&t[a].eid&&"1500000105"===t[a].eid)return e}return!1},p.handleJumpUrl=function(e,t){return""===e||null===e||void 0===e?"href"===t?"javascript:;":"cursor:default;":"href"===t?e:""},p.roomLinkCheck=function(t){if(!t)return 0;var a=/\[room\=([^\]]+)\]/gi,i=/\[room\=([a-z\d]+)\]/gi,s=t.match(a),n=1;return s&&e.each(s,function(e,t){return i.test(t)?void 0:(n=0,!1)}),n},p.htmlEncode=function(e){var t="";return 0===e.length?t:t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;").replace(/\s/g," ")},p.replaceFace=function(t){var i=window.faceListConfig?window.faceListConfig:v,s="",o="";return e.each(i,function(e,i){s=a.string.format("{0}app/douyu/res/page/room-normal/face/dy{1}.{2}?v={3}",n.get("sys.web_url"),i.id,i.type,20170626),o="dy"+i.id,t=t.replace(new RegExp("\\[emot:"+o+"\\]","g"),'<img rel="'+o+'" src="'+s+'" />')}),t},p.getColor=function(e){return["#ff0000","#1e87f0","#7ac84b","#ff7f00","#9b39f4","#ff69b4"][e]},p.returnUlevelClass=function(e){var t=120,i="";return i=e?a.string.format("{0}{1}","level-",t+1>e?e:t):"level-next-1",i+" "+p.imgType(e)+" "+p.imgSize(e)||""},p.imgType=function(e,t){var a="";return a=e>=70?"":"level-bgpng",t&&(a="level-bgpng"),a},p.imgSize=function(e){var t="";return t=e>=100?"level-size2":" level-size1"},p.getCqName=function(e){return 1==e?"初级酬勤":2==e?"中级酬勤":3==e?"高级酬勤":4==e?"超级酬勤":void 0},p.getUserCqName=function(e){return e=e?e:10,0==e?"酬勤用户":1==e?"初级酬勤用户":2==e?"中级酬勤用户":3==e?"高级酬勤用户":""},p.getCqLevIcon=function(e){return a.string.format("{0}app/douyu/res/page/room-normal/cq/level/cq_0{1}.gif?v=20170627",n.get("sys.web_url"),e)},p.getCqTitIcon=function(e){return a.string.format("{0}app/douyu/res/page/room-normal/cq/level/cq_no0{1}.png?v=20170627",n.get("sys.web_url"),e)},p.getRankTypeName=function(e){return 1==e?"贡献周榜":2==e?"贡献总榜":"贡献周榜"},p.handleLinkBarrage=function(e){var t,a,i=e.toString(),s=n.get("colligate.barrage_link.link_pre"),o={open:0,type:"",link:""};return!i||i.indexOf("_")<=0?o:(a=i.split("_"),t=s[a[0]],a.length>=2&&s[a[0]]&&a[1]&&(o.open=1,o.type=a[0],2==a.length?o.link=t+a[1]:(a.shift(),o.link=t+a.join("_"))),o)},m.superBarrage=function(e){e=i.decode(e).too();var t,o,r;return m.superBarrage.RENDER?o=m.superBarrage.RENDER:(t=a.string.join('<li class="jschartli high-notice" data-type="list">','<i class="icon-heart"></i>','<p class="text-cont">','<span class="super-barrage js-normal-barrage" data-sdid="<%=sdid%>" data-trid="<%=trid%>" data-type="<%=jmptp%>" data-url="<%=url%>" ><%=text%></span>',"</p>","</li>"),o=m.superBarrage.RENDER=s.compile(t)),r=o({sdid:e.sdid,trid:e.trid,text:e.content,jmptp:e.jmptp,url:e.url,attr:{web_url:n.get("sys.web_url")}})},m.superBarrage.RENDER=null,m.athenaSuperBarrage=function(e){var t,i,o,r=JSON.parse(e),l=r.isReverse;m.athenaSuperBarrage.RENDER?i=m.athenaSuperBarrage.RENDER:(t=a.string.join('<li class="jschartli high-notice" data-type="list">','<i class="icon-heart"></i>','<p class="text-cont">','<span class="super-barrage js-distribute-barrage"','data-bid="<%=bid%>" ','data-booth_id="<%=booth_id%>" ','data-ruleset_id="<%=ruleset_id%>" ','data-con_id="<%=con_id%>" ','data-rid="<%=rid%>" ','data-vid="<%=vid%>" ','data-jurl="<%=jurl%>" ','data-reverse="<%=isReverse%>" ','data-jump_type="<%=jump_type%>" ',"><%=title%></span>","</p>","</li>"),i=m.athenaSuperBarrage.RENDER=s.compile(t)),r.jump_type=parseInt(r.jump_type,10),1===r.jump_type?(r.vid="",r.rid="",r.jurl=r.jump_to):2===r.jump_type?(r.vid="",r.rid=r.jump_to,r.jurl="/"+r.jump_to):(r.rid="",r.vid=r.jump_to,r.jurl=$SYS.vsite_url+"/show/"+r.jump_to);var d={bid:r.bid,booth_id:l?10:1,ruleset_id:r.ruleset_id,con_id:r.con_id,rid:r.rid,vid:r.vid,jurl:r.jurl,ctid:n.get("room.cate_id"),title:r.title,isReverse:l,jump_type:r.jump_type};return d.attr={web_url:n.get("sys.web_url")},o=i(d)},m.athenaSuperBarrage.RENDER=null,m.barrage=function(r,d){var g,h,v,b=r,w=t.fire("mod.chat.blackList.get",parseInt(b.uid,10));if(-1===w.index&&p.roomLinkCheck(b.txt)){b.txt=p.htmlEncode(b.txt),b.txt=p.replaceFace(b.txt),b.txt=b.txt.replace(/\[room\=([a-zA-Z\d]+)\]/gi,'<a href="/$1" target="_blank" class="cont-room"><img src="'+n.get("sys.web_url")+'app/douyu/res/page/room-normal/link.png?v=20160310" />$1</a>'),r.cqt=p.getUserCqName(r.dlv)||"",r.bgt=Math.pow(10,r.gt),r.color=p.getColor(r.col-1)||"",r.ut=r.ut||"",b.ut=i.isArray(r.ut)?i.decode(r.ut):[{value:r.ut}],b.userIcon=p.returnUlevelClass(b.level),b.el=p.processArrData(b.el),b.highLevel=120,b.nl=r.nl,b.medalNickname=r.bnn,b.medalLv=r.bl,b.hc=r.hc,b.ownItRoomId=parseInt(r.brid,10),b.curRoomId=parseInt(n.get("room.room_id"),10),b.fansMedal=l||{},b.ol=parseInt(r.ol,10)||0,b.girlPrivilege=m.checkGirlPri(b.el,1500000173,b),b.girlPriCls=b.girlPrivilege?"girl-chart":"",m.barrage.RENDER?h=m.barrage.RENDER:(g=a.string.join("<% if ( node.isSender ) { %>",'<li class="jschartli chartli hy-chat <%= node.girlPriCls %> <%= nobleClass %>" data-level="<%=node.level%>" data-type="list" ',"<% if ( node.ol > 0 ) { %>",'data-anchor-level="<%=node.ol%>"',"<% } %>",">","<% if ( node.dlv > 0 && node.dc > 0 ) { %>",'<p class="my-cont cqback">',"<% } else { %>",'<p class="my-cont">',"<% } %>","<% } else { %>",'<li class="jschartli hy-chat <%= node.girlPriCls %> <%= nobleClass %>" data-level="<%=node.level%>" data-type="list" ',"<% if ( node.ol > 0 ) { %>",'data-anchor-level="<%=node.ol%>"',"<% } %>",">","<% if ( node.dlv > 0 && node.dc > 0 ) { %>",'<p class="text-cont cqback">',"<% } else { %>",'<p class="text-cont">',"<% } %>","<% } %>","<% if ( node.ct === 1 || node.ct === 2 ) { %>","<% } %>","<% if ( node.ct === 14 ) { %>",'<span class="pc-client-icon"><a href="/client?platform=3" target="_blank" title="正在使用pc客户端"><img src="<%= attr.web_url %>app/douyu/res/page/room-normal/pc_client_new_icon.png?v=<%= attr.web_ver %>" /></a></span>',"<% } %>","<% if ( (node.pg === 5 || node.pg === 2) && node.sahf ) { %>",'<span class="chat-icon-pad"><img class="icon-role" src="<%= attr.web_url %>app/douyu/res/page/room-normal/super_admin.png?v=<%= attr.web_ver %>" /></span>',"<% } else if ( node.rg === 4 ) { %>",'<span class="chat-icon-pad"><img class="icon-role" src="<%= attr.web_url %>app/douyu/res/page/room-normal/roomadmin.png?v=<%= attr.web_ver %>" /></span>',"<% } else if ( node.rg === 5 ) { %>",'<span class="chat-icon-pad"><img class="icon-role" src="<%= attr.web_url %>app/douyu/res/page/room-normal/anchor.png?v=<%= attr.web_ver %>" /></span>',"<% } %>","<% if ( nobleInfo ) { %>",'<span class="chat-icon-pad user-noble">','<img src="<%= attr.resource_url %><%= nobleInfo.symbol.web_symbol_pic1 %>" title="<%= nobleInfo.symbol.name %>" />',"</span>","<% } %>","<% if (node.el.length) { %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if (effectInfo) { %>","<% if ( el[i].etp && el[i].etp == 1 &&el[i].ef&&el[i].ef==1) { %>","<% if(effectInfo[el[i].eid]){ %>",'<span class="chat-icon-pad madel-list ticket-list">','<img src="<%= attr.resource_url %><%= effectInfo[el[i].eid].icon  %>" title="<%= effectInfo[el[i].eid].txt %>" />',"</span>","<% } %>","<% } %>","<% } %>","<% } %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if (madelConfig && isShowRankList) { %>",'<% if(handleEid(el[i].eid) === "cataRankList" && madelConfig[el[i].eid]){ %>','<span class="chat-icon-pad madel-list">','<a href="<%= handleJumpUrl(madelConfig[el[i].eid].link,"href") %>" style="<%= handleJumpUrl(madelConfig[el[i].eid].link,"style") %>" target="_blank">','<img class="madel-no-count" src="/resource/<%= madelConfig[el[i].eid].web_img %>" title="<%= madelConfig[el[i].eid].desc %>" />',"</a>","</span>","<% } %>","<% } %>","<% } %>","<% } %>","<% if ( node.dlv > 0 && node.dc > 0) { %>",'<span class="chat-icon-pad cq-level c-lv<%= node.dlv %>" title="<%= node.cqt %>"><img src="<%= attr.web_url %>app/douyu/res/page/room-normal/cq_no0<%= node.dlv %>.png?v=<%= attr.web_ver %>" /><em>×<%= node.dc %></em></span>',"<% } else if ( node.bdlv > 0 ) { %>",'<img src="<%= attr.web_url %>app/douyu/res/page/room-normal/cq_other.png?v=<%= attr.web_ver %>" class="chat-icon-pad cq-other" title="酬勤用户"/>',"<% } %>","<% if ( node.el.length && comboConfig ) { %>","<% for(var i = 0, el = node.el, len = el.length; i < len; i++){ %>","<% if ( el[i].etp && el[i].etp == 1) { %>","<% if(comboConfig[el[i].eid]){ %>",'<span class="chat-icon-pad madel-list">','<a href="<%= handleJumpUrl(comboConfig[el[i].eid].link,"href") %>" style="<%= handleJumpUrl(comboConfig[el[i].eid].link,"style") %>" target="_blank">',"<% if ( el[i].sc != 0 && comboConfig[el[i].eid].show_hits != 0 ) { %>",'<img src="<%= comboConfig[el[i].eid].web_icon %>" title="<%= comboConfig[el[i].eid].desc %>" />','<em style="background-color:<%= comboConfig[el[i].eid].medal_bg_color %>;color:<%= comboConfig[el[i].eid].medal_font_color %>;">x<%= el[i].sc %></em>',"<% } else { %>",'<img class="madel-no-count" src="<%= comboConfig[el[i].eid].web_icon %>" title="<%= comboConfig[el[i].eid].desc %>" />',"<% } %>","</a>","</span>","<% } %>","<% } %>","<% } %>","<% } %>","<% if ( node.egtt > 0 && node.egtt<=4&&node.egtt!=3) { %>",'<a class="chat-3six-title" title="<%=node.txtitle%>" >','<img class="three6tx" src="<%= attr.web_url %>app/douyu/activity/res/3six/pc/dmtx_d_<%=node.egtt%>.gif" />',"</a>","<% } %>","<% if (node.el.length) { %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if ( el[i].eid == yearFestival1) { %>",'<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[yearFestival1].web_img %>" title="<%= madelConfig[yearFestival1].name %>"></a>',"<% } %>","<% if ( el[i].eid == yearFestival2) { %>",'<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[yearFestival2].web_img %>" title="<%= madelConfig[yearFestival2].name %>"></a>',"<% } %>","<% if ( el[i].eid == yearFestival3) { %>",'<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[yearFestival3].web_img %>" title="<%= madelConfig[yearFestival3].name %>"></a>',"<% } %>","<% if ( el[i].eid == yearFestival4) { %>",'<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[yearFestival4].web_img %>" title="<%= madelConfig[yearFestival4].name %>"></a>',"<% } %>","<% } %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if ( el[i].eid == annualMedal1) { %>",'<a class="annualfestival-medal medal-1" href="/actives/YuleShengDian2017/competition" target="_blank" title="为斗鱼打call，很灵性"></a>',"<% } %>","<% if ( el[i].eid == annualMedal2) { %>",'<a class="annualfestival-medal medal-2" href="/actives/YuleShengDian2017/competition" target="_blank" title="牌面这块给你整得明明白白的"></a>',"<% } %>","<% if ( el[i].eid == annualMedal3) { %>",'<a class="annualfestival-medal medal-3" href="/actives/YuleShengDian2017/competition" target="_blank" title="这个鱼塘，我承包了"></a>',"<% } %>","<% if ( el[i].eid == annualMedal4) { %>",'<a class="annualfestival-medal medal-4" href="/actives/YuleShengDian2017/competition" target="_blank" title="带就完事了"></a>',"<% } %>","<% if ( el[i].eid == annualMedal5) { %>",'<a class="annualfestival-medal medal-5" href="/actives/YuleShengDian2017/competition" target="_blank" title="没时间解释了，快上车"></a>',"<% } %>","<% } %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if ( el[i].eid == fansJuly1 && madelConfig[fansJuly1].desc && madelConfig[fansJuly1].web_img) { %>",'<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[fansJuly1].web_img %>" title="<%= madelConfig[fansJuly1].desc %>"></a>',"<% } %>","<% if ( el[i].eid == fansJuly2 && madelConfig[fansJuly2].desc && madelConfig[fansJuly2].web_img) { %>",'<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[fansJuly2].web_img %>" title="<%= madelConfig[fansJuly2].desc %>"></a>',"<% } %>","<% if ( el[i].eid == fansJuly3 && madelConfig[fansJuly3].desc && madelConfig[fansJuly3].web_img) { %>",'<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[fansJuly3].web_img %>" title="<%= madelConfig[fansJuly3].desc %>"></a>',"<% } %>","<% if ( el[i].eid == fansJuly4 && madelConfig[fansJuly4].desc && madelConfig[fansJuly4].web_img) { %>",'<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[fansJuly4].web_img %>" title="<%= madelConfig[fansJuly4].desc %>"></a>',"<% } %>","<% if ( el[i].eid == fansJuly5 && madelConfig[fansJuly5].desc && madelConfig[fansJuly5].web_img) { %>",'<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[fansJuly5].web_img %>" title="<%= madelConfig[fansJuly5].desc %>"></a>',"<% } %>","<% } %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>",'<% if ( payTaskObj["1"] && el[i].eid === payTaskObj["1"].id ) { %>','<a href="/web_game/welcome/18" target="_blank" class="chat-task-madel">','<img src="<%= attr.web_url %>app/douyu/res/page/room-normal/task/madel-s2.png?v=<%= attr.web_ver %>"',' title="<%=payTaskObj["1"].title%>" />',"</a>","<% } %>",'<% if ( payTaskObj["2"] && el[i].eid === payTaskObj["2"].id ) { %>','<a href="/web_game/welcome/18" target="_blank" class="chat-task-madel">','<img src="<%= attr.web_url %>app/douyu/res/page/room-normal/task/madel-s1.png?v=<%= attr.web_ver %>"',' title="<%=payTaskObj["2"].title%>" />',"</a>","<% } %>",'<% if ( payTaskObj["4"] && el[i].eid === payTaskObj["4"].id ) { %>','<a href="/web_game/welcome/18" target="_blank" class="chat-task-madel">','<img src="<%= attr.web_url %>app/douyu/res/page/room-normal/task/madel-s3.png?v=<%= attr.web_ver %>"',' title="<%=payTaskObj["4"].title%>" />',"</a>","<% } %>","<% } %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if ( el[i].eid == cdkeyNewIcon1 && madelConfig) { %>",'<img class="chat-icon-pad" src="/resource/<%= madelConfig[cdkeyNewIcon1].web_img %>" title="<%= madelConfig[cdkeyNewIcon1].desc %>">',"<% } %>","<% if ( el[i].eid == cdkeyNewIcon2 ) { %>",'<img class="chat-icon-pad" src="/resource/<%= madelConfig[cdkeyNewIcon2].web_img %>" title="<%= madelConfig[cdkeyNewIcon2].desc %>">',"<% } %>","<% } %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if ( el[i].eid == act5202017 && madelConfig) { %>","<% if (act5202017Switch) {%>",'<a href="<%= madelConfig[act5202017].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[act5202017].web_img %>?20170424" title="<%= madelConfig[act5202017].desc %>" data-value="act5202017"></a>',"<% }else{ %>",'<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[act5202017].web_img %>?20170424" title="<%= madelConfig[act5202017].desc %>" data-value="act5202017"></a>',"<% } %>","<% } %>","<% } %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if ( el[i].eid == mayday2017 && madelConfig) { %>","<% if (mayday2017Switch) {%>",'<a href="<%= madelConfig[mayday2017].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[mayday2017].web_img %>?20170424" title="<%= madelConfig[mayday2017].desc %>" data-value="mayday2017"></a>',"<% }else{ %>",'<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[mayday2017].web_img %>?20170424" title="<%= madelConfig[mayday2017].desc %>" data-value="mayday2017"></a>',"<% } %>","<% } %>","<% } %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if (peopleBehalfSwitch == 1) { %>","<% if ( el[i].eid == peopleBehalf1 && madelConfig[peopleBehalf1].desc && madelConfig[peopleBehalf1].web_img && madelConfig[peopleBehalf1].link) { %>",'<a href="<%= madelConfig[peopleBehalf1].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf1].web_img %>" title="<%= madelConfig[peopleBehalf1].desc %>"></a>',"<% } %>","<% if ( el[i].eid == peopleBehalf2 && madelConfig[peopleBehalf2].desc && madelConfig[peopleBehalf2].web_img && madelConfig[peopleBehalf2].link) { %>",'<a href="<%=madelConfig[peopleBehalf2].link%>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf2].web_img %>" title="<%= madelConfig[peopleBehalf2].desc %>"></a>',"<% } %>","<% if ( el[i].eid == peopleBehalf3 && madelConfig[peopleBehalf3].desc && madelConfig[peopleBehalf3].web_img && madelConfig[peopleBehalf3].link) { %>",'<a href="<%=madelConfig[peopleBehalf3].link%>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf3].web_img %>" title="<%= madelConfig[peopleBehalf3].desc %>"></a>',"<% } %>","<% if ( el[i].eid == peopleBehalf4 && madelConfig[peopleBehalf4].desc && madelConfig[peopleBehalf4].web_img && madelConfig[peopleBehalf4].link) { %>",'<a href="<%=madelConfig[peopleBehalf4].link%>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf4].web_img %>" title="<%= madelConfig[peopleBehalf4].desc %>"></a>',"<% } %>","<% if ( el[i].eid == peopleBehalf5 && madelConfig[peopleBehalf5].desc && madelConfig[peopleBehalf5].web_img && madelConfig[peopleBehalf5].link) { %>",'<a href="<%=madelConfig[peopleBehalf5].link%>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf5].web_img %>" title="<%= madelConfig[peopleBehalf5].desc %>"></a>',"<% } %>","<% } else { %>","<% if ( el[i].eid == peopleBehalf1 && madelConfig[peopleBehalf1].desc && madelConfig[peopleBehalf1].web_img && madelConfig[peopleBehalf1].link) { %>",'<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf1].web_img %>" title="<%= madelConfig[peopleBehalf1].desc %>"></a>',"<% } %>","<% if ( el[i].eid == peopleBehalf2 && madelConfig[peopleBehalf2].desc && madelConfig[peopleBehalf2].web_img && madelConfig[peopleBehalf2].link) { %>",'<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf2].web_img %>" title="<%= madelConfig[peopleBehalf2].desc %>"></a>',"<% } %>","<% if ( el[i].eid == peopleBehalf3 && madelConfig[peopleBehalf3].desc && madelConfig[peopleBehalf3].web_img && madelConfig[peopleBehalf3].link) { %>",'<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf3].web_img %>" title="<%= madelConfig[peopleBehalf3].desc %>"></a>',"<% } %>","<% if ( el[i].eid == peopleBehalf4 && madelConfig[peopleBehalf4].desc && madelConfig[peopleBehalf4].web_img && madelConfig[peopleBehalf4].link) { %>",'<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf4].web_img %>" title="<%= madelConfig[peopleBehalf4].desc %>"></a>',"<% } %>","<% if ( el[i].eid == peopleBehalf5 && madelConfig[peopleBehalf5].desc && madelConfig[peopleBehalf5].web_img && madelConfig[peopleBehalf5].link) { %>",'<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf5].web_img %>" title="<%= madelConfig[peopleBehalf5].desc %>"></a>',"<% } %>","<% } %>","<% } %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if ( el[i].eid == girlDay2017 && madelConfig) { %>","<% if (girlDay2017Switch) {%>",'<a href="<%= madelConfig[girlDay2017].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[girlDay2017].web_img %>" title="<%= madelConfig[girlDay2017].desc %>"></a>',"<% }else{ %>",'<a href="javascript:;" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[girlDay2017].web_img %>" title="<%= madelConfig[girlDay2017].desc %>"></a>',"<% } %>","<% } %>","<% } %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if ( el[i].eid == weekStarRank1 && madelConfig[weekStarRank1].desc && madelConfig[weekStarRank1].web_img && madelConfig[weekStarRank1].link) { %>",'<a href="<%= madelConfig[weekStarRank1].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[weekStarRank1].web_img %>" title="<%= madelConfig[weekStarRank1].desc %>"></a>',"<% } %>","<% if ( el[i].eid == weekStarRank2 && madelConfig[weekStarRank2].desc && madelConfig[weekStarRank2].web_img && madelConfig[weekStarRank2].link) { %>",'<a href="<%=madelConfig[weekStarRank2].link%>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[weekStarRank2].web_img %>" title="<%= madelConfig[weekStarRank2].desc %>"></a>',"<% } %>","<% if ( el[i].eid == weekStarRank3 && madelConfig[weekStarRank3].desc && madelConfig[weekStarRank3].web_img && madelConfig[weekStarRank3].link) { %>",'<a href="<%=madelConfig[weekStarRank3].link%>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[weekStarRank3].web_img %>" title="<%= madelConfig[weekStarRank3].desc %>"></a>',"<% } %>","<% if ( el[i].eid == weekStarRank4 && madelConfig[weekStarRank4].desc && madelConfig[weekStarRank4].web_img && madelConfig[weekStarRank4].link) { %>",'<a href="<%=madelConfig[weekStarRank4].link%>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[weekStarRank4].web_img %>" title="<%= madelConfig[weekStarRank4].desc %>"></a>',"<% } %>","<% } %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>",'<% if ( node.el.length && madelConfig && isDota2Page == "DOTA2") { %>',"<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if ( el[i].eid == dotaMatch ) { %>","<% if (dotaMatchSwitch == 1) { %>",'<a href="<%= madelConfig[dotaMatch].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[dotaMatch].web_img %>" title="<%= madelConfig[dotaMatch].desc %>"></a>',"<% } else { %>",'<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[dotaMatch].web_img %>" title="<%= madelConfig[dotaMatch].desc %>"></a>',"<% } %>","<% } %>","<% } %>","<% } %>","<% } %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if ( el[i].eid == jifen && madelConfig) { %>",'<img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[jifen].web_img %>" title="<%= madelConfig[jifen].desc %>">',"<% } %>","<% } %>","<% } %>","<% if ( node.el.length && madelConfig) { %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if ( el[i].eid == aprilFool2017Icon4 ) { %>","<% if (aprilFoolSwitch) {%>",'<a style="vertical-align: middle;" href="<%= madelConfig[aprilFool2017Icon4].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[aprilFool2017Icon4].web_img %>" title="完成愚人节登榜成就&#10;每天截止零点登上【无畏霸主榜】获得！"></a>',"<% }else{ %>",'<a style="vertical-align: middle;"><img class="chat-icon-pad" src="/resource/<%= madelConfig[aprilFool2017Icon4].web_img %>" title="完成愚人节登榜成就&#10;每天截止零点登上【无畏霸主榜】获得！"></a>',"<% } %>","<% } %>","<% } %>","<% } %>","<% if ( node.el.length && madelConfig) { %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if ( el[i].eid == aprilFool2017Icon1 ) { %>","<% if (aprilFoolSwitch) {%>",'<a href="<%= madelConfig[aprilFool2017Icon1].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[aprilFool2017Icon1].web_img %>" title="<%= madelConfig[aprilFool2017Icon1].desc %>"></a>',"<% }else{ %>",'<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[aprilFool2017Icon1].web_img %>" title="<%= madelConfig[aprilFool2017Icon1].desc %>"></a>',"<% } %>","<% break; } %>","<% if ( el[i].eid == aprilFool2017Icon2 ) { %>","<% if (aprilFoolSwitch) {%>",'<a href="<%= madelConfig[aprilFool2017Icon2].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[aprilFool2017Icon2].web_img %>" title="<%= madelConfig[aprilFool2017Icon2].desc %>"></a>',"<% }else{ %>",'<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[aprilFool2017Icon2].web_img %>" title="<%= madelConfig[aprilFool2017Icon2].desc %>"></a>',"<% } %>","<% break; } %>","<% if ( el[i].eid == aprilFool2017Icon3 ) { %>","<% if (aprilFoolSwitch) {%>",'<a href="<%= madelConfig[aprilFool2017Icon3].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[aprilFool2017Icon3].web_img %>" title="<%= madelConfig[aprilFool2017Icon3].desc %>"></a>',"<% }else{ %>",'<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[aprilFool2017Icon3].web_img %>" title="<%= madelConfig[aprilFool2017Icon3].desc %>"></a>',"<% } %>","<% break; } %>","<% } %>","<% } %>","<% if (node.girlPrivilege) { %>",'<span title="小姐姐特权" class="girl-privilege-icon"></span>',"<% } %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if ( el[i].eid == fansRecharge) { %>",'<span title="首充6元专属徽章" class="firstpay-award-icon"></span>',"<% } %>","<% } %>","<% if (node.medalNickname && node.medalLv) { %>","<% if (node.curRoomId != node.ownItRoomId) { %>",'<a class="chat-icon-pad" data-msg="fans" href="/<%= node.ownItRoomId %>" target="_blank" data-fans="<%= node.ownItRoomId%>" data-hc="<%= node.hc %>">',"<% if (node.fansMedal[node.ownItRoomId]) { %>",'<span class="fans-badge-icon" data-ui-level="<%= node.medalLv %>">','<span class="fans-icon-name" style="background-image:url(',"<%= node.fansMedal[node.ownItRoomId][node.medalLv].bg %>",')"><i><%= node.medalNickname %></i></span>','<span class="fans-badge-level" style="background-image:url(',"<%= node.fansMedal[node.ownItRoomId][node.medalLv].md %>",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'<% } else if (node.fansMedal["all"]) { %>','<span class="fans-badge-icon" data-ui-level="<%= node.medalLv %>">','<span class="fans-icon-name" style="background-image:url(','<%= node.fansMedal["all"][node.medalLv].bg %>',')"><i><%= node.medalNickname %></i></span>','<span class="fans-badge-level" style="background-image:url(','<%= node.fansMedal["all"][node.medalLv].md %>',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","<% } else { %>",'<span class="fans-badge-icon" data-ui-level="<%= node.medalLv %>">','<span class="fans-icon-name"><i><%= node.medalNickname %></i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","<% } %>","</a>","<% } else { %>",'<span class="chat-icon-pad" data-msg="fans" data-fans="<%= node.ownItRoomId %>" data-hc="<%= node.hc%>">',"<% if (node.fansMedal[node.ownItRoomId]) { %>",'<span class="fans-badge-icon" data-ui-level="<%= node.medalLv %>">','<span class="fans-icon-name" style="background-image:url(',"<%= node.fansMedal[node.ownItRoomId][node.medalLv].bg %>",')"><i><%= node.medalNickname %></i></span>','<span class="fans-badge-level" style="background-image:url(',"<%= node.fansMedal[node.ownItRoomId][node.medalLv].md %>",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'<% } else if (node.fansMedal["all"]) { %>','<span class="fans-badge-icon" data-ui-level="<%= node.medalLv %>">','<span class="fans-icon-name" style="background-image:url(','<%= node.fansMedal["all"][node.medalLv].bg %>',')"><i><%= node.medalNickname %></i></span>','<span class="fans-badge-level" style="background-image:url(','<%= node.fansMedal["all"][node.medalLv].md %>',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","<% } else { %>",'<span class="fans-badge-icon" data-ui-level="<%= node.medalLv %>">','<span class="fans-icon-name"><i><%= node.medalNickname %></i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","<% } %>","</span>","<% } %>","<% } %>","<% if ( node.ol > 0 ) { %>",'<a class="chat-icon-pad anchor-level-icon" title="主播等级：<%= node.ol %>" data-anchor-levelimg="<%=node.ol%>">',"</a>","<%} else if ( node.level > 0 ) { %>",'<a class="chat-icon-pad user-level<% if ( node.level < 10 ) { %> lve-icon-1to9 <% } %> <%= node.userIcon %> " title="用户等级：<%= node.level %>">',"</a>","<% } %>",'<% if ( node.cbid && getMotorcadeConfig({cbid: node.cbid}) != "") { %>','<span class="motorcade-icon" title="<%= getMotorcadeConfig({cbid: node.cbid}) %>" data-motorcade="<%= getMotorcadeConfig({cbid: node.cbid}) %>">',"<%= getMotorcadeConfig({cbid: node.cbid}) %>","</span>","<% } %>",'<% if ( handleEL("namegold",node.el) === "namegold" ) { %>','<span class="name namegold" title="金色昵称">','<% } else if(handleEL("namered",node.el) === "namered") { %>','<span class="name namered" title="<%= payTaskObj["3"].title %>">',"<% } else { %>",'<span class="name">',"<% } %>","<% if (nameColor) { %>",'<a href="javascript:;" style="color:#<%= nameColor %>" class="nick js-nick" clt="<%= node.ct %>" rel="<%= node.uid %>" avatar="<%= node.ic %>"  gid="<%= node.pg %>" is-show-super-icon="<%= node.sahf %>" data-noble="<%= node.nl %>"><%= node.nn %>：</a></span>',"<% } else { %>",'<a href="javascript:;" class="nick js-nick" clt="<%= node.ct %>" rel="<%= node.uid %>" avatar="<%= node.ic %>"  gid="<%= node.pg %>" is-show-super-icon="<%= node.sahf %>" data-noble="<%= node.nl %>"><%= node.nn %>：</a></span>',"<% } %>","<% if (linkBarrage && linkBarrage.open) { %>",'<a class="hyperlink-chat-msg" data-msg-type="<%= linkBarrage.type %>" href="<%= linkBarrage.link %>" target="_blank">','<span class="hyperlink-brace">【</span>',"<% } %>",'<span class="chat-msg-item <% if ( node.isSender ) { %>',"m","<% } else { %>","text-cont",'<% } %>" chatid="<% if ( node.pg < 5 ) { %>',"<%= node.cid %>",'<% } %>" <% if ( node.col >= 1 && node.col <= 6) { %>','style="color:<%= node.color %>"',"<% } %>>","<%=# node.txt %>","</span>","<% if (linkBarrage && linkBarrage.open) { %>",'<span class="hyperlink-brace">】</span>',"</a>","<% } %>",'<% if (node.shark === "hjs") { %>','<a href="/cms/zt/mayday.html" target="_blank">','<img src="<%= attr.web_url %>app/douyu/activity/res/mayday/pc/shark-hjs.gif?v=<%= attr.web_ver %>"',' title="狠角色宝宝专享特权：直播间进入提示，免费\n专享彩色弹幕，限量狠角色宝宝30天出入跟随" />',"</a>","<% } %>","<% if (node.el.length && madelConfig) { %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% if ( el[i].eid == sharkKingIcon) { %>","<% if (sharkKingSwitch) {%>",'<a class="sharkbaby-animation" target="_blank" href="/t/DouyuKing"','title="完成充值或收集成就！尊享珍藏鲨鱼王萌宠" data-value="<%= sharkKingIcon %>"><img src="<%= attr.web_url %>app/douyu/res/page/room-normal/sharkbaby/sharkbaby.gif?v=<%= attr.web_ver %>" alt=""></a>',"<% }else{ %>",'<a class="sharkbaby-animation" href="javascript:;"','title="完成充值或收集成就！尊享珍藏鲨鱼王萌宠" data-value="<%= sharkKingIcon %>"><img src="<%= attr.web_url %>app/douyu/res/page/room-normal/sharkbaby/sharkbaby.gif?v=<%= attr.web_ver %>" alt=""></a>',"<% } %>","<% } %>","<% } %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<% for (var key in annualfestival) { %>","<% if ( el[i].eid == key ) { %>",'<a class="sharkbaby-animation" target="_blank" href="<%= annualfestival[key].link || "javascript:;" %>"','title="<%= annualfestival[key].name || "" %>" data-value="<%= key %>"><img src="<%= annualfestival[key].pic %>?v=<%= attr.web_ver %>" alt=""></a>',"<% } %>","<% } %>","<% } %>","<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>","<%if ( node.el[i].eid == aprilFool2017Baby1 ) { %>","<% if(aprilFoolSwitch){ %>",'<a data-uid="<%=node.uid%>" href="<%=aprilFoolUrl%>" target="_blank"><img src="<%= attr.web_url %>/app/douyu/activity/res/foolsday/foolsday-pet.gif?v=<%= attr.web_ver %>" title="老铁获得愚人节成就，没毛病！"></a>',"<% }else{ %>",'<a><img src="<%= attr.web_url %>/app/douyu/activity/res/foolsday/foolsday-pet.gif?v=<%= attr.web_ver %>" title="老铁获得愚人节成就，没毛病！"></a>',"<% } %>","<% } %>","<% } %>","<% } %>","</p>","</li>"),
h=m.barrage.RENDER=s.compile(g));var _=b.nl?k[b.nl]:null,x="";return 1===b.nc?x="js-noble-barrage-tag noble-chart":b.hl&&parseInt(b.hl,10)&&(x="js-noble-barrage-tag js-fans-chart"),v=h({node:b,comboConfig:e.isEmptyObject(d)?null:d,madelConfig:e.isEmptyObject(y)?null:y,handleJumpUrl:p.handleJumpUrl,handleEid:p.handleEid,isShowRankList:1===parseInt(n.get("room.is_show_rank_list"),10),payTaskObj:f,handleEL:p.handleEL,getMotorcadeConfig:o.getMotorcadeConfig,linkBarrage:p.handleLinkBarrage(b.lk),aprilFoolUrl:"/t/DouyuFoolsDay",aprilFoolSwitch:n.get("colligate.activitySwitch.aprilfool"),aprilFool2017Icon1:1500000134,aprilFool2017Icon2:1500000133,aprilFool2017Icon3:1500000132,aprilFool2017Icon4:1500000131,aprilFool2017Baby1:1500000135,cdkeyNewIcon1:1500000114,cdkeyNewIcon2:1500000115,effectInfo:$ROOM.effectInfo,attr:{web_url:n.get("sys.web_url"),resource_url:n.get("sys.resource_url"),web_ver:"20170706"},nobleInfo:_,nobleClass:x,girlDay2017:1500000120,girlDay2017Switch:n.get("room.rankActivity.nsj2017.activeTimeOnline"),dotaMatch:1500000122,isDota2Page:n.get("room.second_lvl_name"),dotaMatchSwitch:n.get("colligate.activitySwitch.dota2kiev"),annualfestival:c,sharkKingIcon:1500000124,sharkKingSwitch:n.get("colligate.activitySwitch.shark_kings"),weekStarRank1:1500000142,weekStarRank2:1500000141,weekStarRank3:1500000140,weekStarRank4:1500000139,peopleBehalf1:1500000146,peopleBehalf2:1500000147,peopleBehalf3:1500000148,peopleBehalf4:1500000149,peopleBehalf5:1500000150,peopleBehalfSwitch:n.get("colligate.activitySwitch.ren_min"),mayday2017:1500000151,mayday2017Switch:n.get("colligate.activitySwitch.mayday2017"),act5202017:1500000157,act5202017Switch:n.get("colligate.activitySwitch.activity520_rank"),fansRecharge:1500000160,fansJuly1:1500000163,fansJuly2:1500000164,fansJuly3:1500000165,fansJuly4:1500000166,fansJuly5:1500000167,annualMedal1:1500000208,annualMedal2:1500000209,annualMedal3:1500000210,annualMedal4:1500000211,annualMedal5:1500000212,jifen:1500000219,nameColor:u(b.el),yearFestival1:1500000225,yearFestival2:1500000226,yearFestival3:1500000227,yearFestival4:1500000228})}},m.barrage.RENDER=null,m.checkGirlPri=function(e,a,i){for(var s=0,o=e.length;o>s;s++)if(e[s].eid==a){var r=n.get("sys.uid");return r!=i.uid&&t.trigger("mod.msg.cap.girl",i),1}return 0},m.userEnter=function(r,l){var d,c,u,g={},h=r;if(h.cqt=p.getUserCqName(r.dlv)||"",h.uli=p.returnUlevelClass(r.level),h.bgt=Math.pow(10,r.gt),r.ut=r.ut||"",h.ut=i.isArray(r.ut)?i.decode(r.ut):[{value:r.ut}],h.el=p.processArrData(h.el),h.highLevel=120,h.levelWel=parseInt(h.lev/2,10)+1,h.ol=parseInt(r.ol,10)||0,h.girlPrivilege=m.checkGirlPri(h.el,1500000173,h),g=p.handleUserEnter(h),g.mark)return"";if(g.html){if(h.el)for(var v=0,b=h.el.length;b>v;v++)1500000123===parseInt(h.el[v].eid,10)&&t.fire("mod.userenter.get.sharkKing",h);return g.html}return h.crw=h.crw?parseInt(h.crw):0,h.crw?u=t.fire("mod.userenter.get.rankwel",h)||"":(m.userEnter.RENDER?c=m.userEnter.RENDER:(d=a.string.join('<li class="jschartli" data-type="list" data-level="<%=node.level%>" ',"<% if ( node.ol > 0 ) { %>",'data-anchor-level="<%=node.ol%>"',"<% } %>",">",'<% var taskwel = (handleEL("taskwel",node.el) === "taskwel") %>',"<% var taskbx = (handleBX(node.el, blizzardtvId, blizzardtvCates) === true) %>","<% if ( taskwel ) { %>",'<p class="text-cont task-wel">',"<% } else { %>",'<p class="text-cont">',"<% if (node.dlv > 0 && node.dc > 0) { %>",'<span class="chat-icon-pad cq-level c-lv<%= node.dlv %>" title="<%= node.cqt %>"><img src="<%= attr.web_url %>app/douyu/res/page/room-normal/cq_no0<%= node.dlv %>.png?v=<%= attr.web_ver %>" /><em>×<%= node.dc %></em></span>',"<% } else if (node.bdlv > 0) { %>",'<img src="<%= attr.web_url %>app/douyu/res/page/room-normal/cq_other.png?v=<%= node.web_ver %>" class="chat-icon-pad cq-other" title="酬勤用户"/>',"<% } %>","<% if ( node.el.length && comboConfig ) { %>","<% for(var i = 0, el = node.el, len = el.length; i < len; i++){ %>","<% if ( el[i].etp && el[i].etp == 1 && el[i].eid != dmxyId && el[i].eid != rioId && el[i].eid != rioFlagId) { %>","<% if(comboConfig[el[i].eid]){ %>",'<span class="chat-icon-pad madel-list">','<a href="<%= handleJumpUrl(comboConfig[el[i].eid].link,"href") %>" style="<%= handleJumpUrl(comboConfig[el[i].eid].link,"style") %>" target="_blank">',"<% if ( el[i].sc != 0 && comboConfig[el[i].eid].show_hits != 0 ) { %>",'<img src="<%= comboConfig[el[i].eid].web_icon %>" title="<%= comboConfig[el[i].eid].desc %>" />','<em style="background-color:<%= comboConfig[el[i].eid].medal_bg_color %>;color:<%= comboConfig[el[i].eid].medal_font_color %>;">x<%= el[i].sc %></em>',"<% } else { %>",'<img class="madel-no-count" src="<%= comboConfig[el[i].eid].web_icon %>" title="<%= comboConfig[el[i].eid].desc %>" />',"<% } %>","</a>","</span>","<% } %>","<% } %>","<% } %>","<% } %>","<% if ( node.egtt > 0 && node.egtt<=4&&node.egtt!=3) { %>",'<a class="chat-3six-title" title="<%=node.txtitle%>" >','<img class="three6tx-un" src="<%= attr.web_url %>app/douyu/activity/res/3six/pc/dmtx_h_<%=node.egtt%>.gif" />',"</a>","<% } %>","<% } %>","<% if ( node.ol > 0 ) { %>",'<a class="chat-icon-pad anchor-level-icon" title="主播等级：<%= node.ol %>" data-anchor-levelimg="<%=node.ol%>">',"</a>","<%} else if ( node.level > 0 ) { %>",'<a class="chat-icon-pad user-level<% if ( node.level < 10 ) { %> lve-icon-1to9 <% } %> <%= node.uli %> " title="用户等级：<%= node.level %>">',"</a>","<% } %>",'<% if ( node.cbid && getMotorcadeConfig({cbid: node.cbid}) != "") { %>','<span class="motorcade-icon" title="<%= getMotorcadeConfig({cbid: node.cbid}) %>" data-motorcade="<%= getMotorcadeConfig({cbid: node.cbid}) %>">',"<%= getMotorcadeConfig({cbid: node.cbid}) %>","</span>","<% } %>","<% if ( taskwel ) { %>",'<a href="javascript:;" class="hy-name js-nick" rel="<%= node.uid %>" is-show-super-icon="<%=node.sahf %>" avatar="<%= node.ic %>" gid="<%= node.pg %>" title="<%= node.nn %>" data-noble="<%= node.nl %>"><%= node.nn %></a>',"<span>欢迎您来到本直播间</span>","<% } else { %>","<% if ( taskbx ) { %>","<span>风暴英雄 </span>","<% } %>",'<a href="javascript:;" class="hy-name js-nick" rel="<%= node.uid %>" is-show-super-icon="<%=node.sahf %>"  avatar="<%= node.ic %>" gid="<%= node.pg %>" data-noble="<%= node.nl %>"><%= node.nn %></a>',"<span>欢迎来到本直播间</span>","<% } %>","</p>","</li>"),c=m.userEnter.RENDER=s.compile(d)),u=c({node:h,comboConfig:e.isEmptyObject(l)?null:l,getMotorcadeConfig:o.getMotorcadeConfig,handleJumpUrl:p.handleJumpUrl,dmxyId:1500000001,rioId:1500000007,rioFlagId:1500000020,payTaskObj:f,handleEL:p.handleEL,blizzardtvId:1500000078,blizzardtvCates:[148,4,32,2,35,5,55],handleBX:function(e,t,a){var i=0;for(i=0;i<e.length&&e[i].eid!=t;++i);if(i===e.length)return!1;for(i=0;i<a.length&&a[i]!=$ROOM.cate_id;++i);return i!==a.length},attr:{web_url:n.get("sys.web_url"),web_ver:"20170627"}}))},m.userEnter.RENDER=null,m.lottery=function(e){e=i.decode(e).too();var t,o,r,l,d=e.sl||0,c=e.gl/100||0;return l=d>0?c>0?"赠送过"+d+"鱼丸以上或"+c+"鱼翅以上":"赠送过"+d+"鱼丸以上":c>0?"赠送过"+c+"鱼翅以上":"",m.lottery.RENDER?o=m.lottery.RENDER:(t=a.string.join('<li class="jschartli chart-rank-up-tip chart-lottery normal-notice" data-type="list">','<i class="icon-heart"></i>','<div class="my_cont clearfix">','<div class="mycont-r">',"主播将会在","<span><%= secstr %></span>","开始从","<span><%= condition %></span>","的用户中抽取幸运观众，快来参与吧~","</div>","</div>","</li>"),o=m.lottery.RENDER=s.compile(t)),r=o({secstr:e.sec<60?e.sec+"秒后":parseInt(e.sec/60,10)+"分钟后",condition:l,attr:{web_url:n.get("sys.web_url")}})},m.lottery.RENDER=null,m.setAdmin=function(e){var t,i,n;return m.setAdmin.RENDER?i=m.setAdmin.RENDER:(t=a.string.join("<% if ( node.rescode == 0 && node.group > 1 ) { %>",'<li class="jschartli sys-msg sys-msg-success" data-level="<%=node.level%>">',"<% } else { %>",'<li class="jschartli sys-msg" data-level="<%=node.level%>">',"<% } %>",'<p class="text-cont">',"<span>系统提示：</span>","<% if ( node.rescode == 0 ) { %>",'<a href="javascript:;" class="js0nick" rel="<%= node.userid %>"><%= node.adnick %></a>',"<% if ( node.group > 1 ) { %>","<span>被任命为房管</span>","<% } else { %>","<span>被解除房管身份</span>","<% } %>","<% } else if ( node.rescode == 214 ) { %>","<span>房管数量已达上限</span>","<% } else if ( node.rescode == 206 ) { %>","<span>非法操作</span>","<% } else if ( node.rescode == 208 ) { %>","<span>用户不在房间</span>","<% } %>","</p>","</li>"),i=m.setAdmin.RENDER=s.compile(t)),n=i({node:e})},m.setAdmin.RENDER=null,m.oneKey=function(e){var t,i,n;return m.oneKey.RENDER?i=m.oneKey.RENDER:(t=a.string.join('<li class="jschartli sys-msg" data-level="<%=node.level%>">','<p class="text-cont">',"<span>系统提示：</span>","<% if ( node.ret == 0 ) { %>","<span><%= node.uname %>被封号</span>","<% } else if (node.ret == 208) { %>","<span><%= node.uname %>已被封禁或已被一键封号</span>","<% } else { %>","<span>对<%= node.uname %>进行一键封号失败，错误码：<%= node.ret %></span>","<% } %>","</p>","</li>"),i=m.oneKey.RENDER=s.compile(t)),n=i({node:e})},m.oneKey.RENDER=null,m.sysMsg=function(t){var i,n,o;if(e.trim(t.msg))return m.sysMsg.RENDER?n=m.sysMsg.RENDER:(i=a.string.join("<% if ( node.success && node.success == 1 ) { %>",'<li class="jschartli sys-msg sys-msg-success" data-level="<%=node.level%>" ',"<% if ( node.ol > 0 ) { %>",'data-anchor-levelimg="<%=node.ol%>"',"<% } %>",">","<% } else { %>",'<li class="jschartli sys-msg" data-level="<%=node.level%>" ',"<% if ( node.ol > 0 ) { %>",'data-anchor-levelimg="<%=node.ol%>"',"<% } %>",">","<% } %>",'<p class="text-cont">',"<span>系统提示: </span>","<%= node.msg %>","</p>","</li>"),n=m.sysMsg.RENDER=s.compile(i)),o=n({node:t})},m.sysMsg.RENDER=null,m.sysHtmlMsg=function(t){var i,n,o;if(e.trim(t.msg))return m.sysHtmlMsg.RENDER?n=m.sysHtmlMsg.RENDER:(i=a.string.join("<% if ( node.success && node.success == 1 ) { %>",'<li class="jschartli sys-msg sys-msg-success" data-level="<%=node.level%>" ',"<% if ( node.ol > 0 ) { %>",'data-anchor-level="<%=node.ol%>"',"<% } %>",">","<% } else { %>",'<li class="jschartli sys-msg" data-level="<%=node.level%>" ',"<% if ( node.ol > 0 ) { %>",'data-anchor-level="<%=node.ol%>"',"<% } %>",">","<% } %>",'<p class="text-cont">',"<span>系统提示: </span>","<%=# node.msg %>","</p>","</li>"),n=m.sysHtmlMsg.RENDER=s.compile(i)),o=n({node:t})},m.sysHtmlMsg.RENDER=null,m.chouqin=function(e){e=i.decode(e).too();var t,o,r,d=i.decode(e.sui).too(),c=d.level,u=e.lev;return m.chouqin.RENDER?o=m.chouqin.RENDER:(t=a.string.join('<li class="jschartli" data-type="list" data-level="<%=userLev%>">',"<% if ( nl && nobleConfig[nl] ) { %>",'<span class="chat-icon-pad user-noble">','<img src="<%= resourceUrl %><%= nobleConfig[nl].symbol.web_symbol_pic1 %>" title="<%= nobleConfig[nl].symbol.name %>" />',"</span>","<% } %>","<% if (bnn && bl && brid) {%>","<% if (brid != curRoomId) { %>",'<a class="chat-icon-pad" href="/<%= brid%>" target="_blank" data-fans="<%= brid %>" data-hc="<%= hc %>" data-msg="fans">',"<% if (fansMedal[brid]) { %>",'<span class="fans-badge-icon" data-ui-level="<%= bl %>">','<span class="fans-icon-name" style="background-image:url(',"<%= fansMedal[brid][bl].bg %>",')"><i><%= bnn %></i></span>','<span class="fans-badge-level" style="background-image:url(',"<%= fansMedal[brid][bl].md %>",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'<% } else if (fansMedal["all"]) { %>','<span class="fans-badge-icon" data-ui-level="<%= bl %>">','<span class="fans-icon-name" style="background-image:url(','<%= fansMedal["all"][bl].bg %>',')"><i><%= bnn %></i></span>','<span class="fans-badge-level" style="background-image:url(','<%= fansMedal["all"][bl].md %>',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","<% } else { %>",'<span class="fans-badge-icon" data-ui-level="<%= bl %>">','<span class="fans-icon-name"><i><%= bnn %></i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","<% } %>","</a>","<% } else { %>",'<span class="chat-icon-pad" data-fans="<%= brid %>" data-hc="<%= hc %>" data-msg="fans">',"<% if (fansMedal[brid]) { %>",'<span class="fans-badge-icon" data-ui-level="<%= bl %>">','<span class="fans-icon-name" style="background-image:url(',"<%= fansMedal[brid][bl].bg %>",')"><i><%= bnn %></i></span>','<span class="fans-badge-level" style="background-image:url(',"<%= fansMedal[brid][bl].md %>",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'<% } else if (fansMedal["all"]) { %>','<span class="fans-badge-icon" data-ui-level="<%= bl %>">','<span class="fans-icon-name" style="background-image:url(','<%= fansMedal["all"][bl].bg %>',')"><i><%= bnn %></i></span>','<span class="fans-badge-level" style="background-image:url(','<%= fansMedal["all"][bl].md %>',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","<% } else { %>",'<span class="fans-badge-icon" data-ui-level="<%= bl %>">','<span class="fans-icon-name"><i><%= bnn %></i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","<% } %>","</span>","<% } %>","<% } %>","<% if ( userLev > 0 ) { %>",'<a class="chat-icon-pad user-level<%=ulevIn1t9 ? " lve-icon-1to9" : ""%> <%=userIcon%> " title="用户等级：<%=userLev%>">',"</a>","<% } %>",'<a href="javascript:;" class="nick js-nick" rel="<%=userId%>" is-show-super-icon="<%=sahf%>" avatar="<%=ic%>" clt="<%=clt%>" gid="<%=spg%>" data-noble=<%= nl %>><%=userNick%></a>',"赠送了<%=cqName%>",'<img src="<%=cqLevIcon%>">',"<span>获得了本房间</span>",'<span class="s-cq">','<img src="<%=cqTitIcon%>">',"</span>","<span>头衔30天</span>","</li>"),o=m.chouqin.RENDER=s.compile(t)),r=o({ulevIn1t9:c>=1&&9>=c,userId:d.id,userNick:d.nick,spg:d.pg||1,clt:d.ct||0,userLev:c,userIcon:p.returnUlevelClass(c),cqName:p.getCqName(u),cqLevIcon:p.getCqLevIcon(u),cqTitIcon:p.getCqTitIcon(u),ic:d.icon||"",resourceUrl:b,nl:d.nl||0,nobleConfig:k,bnn:e.bnn||"",brid:parseInt(e.brid,10)||"",bl:e.bl||1,hc:e.hc||"",curRoomId:parseInt(n.get("room.room_id"),10),fansMedal:l||{},sahf:isNaN(e.sahf)?1:e.sahf})},m.chouqin.RENDER=null,m.gift=function(e,t){e=i.decode(e).too();var r,d,c,u={1:25,2:35,3:45,4:50,5:55,6:60},g=t[e.gfid],f=p.processArrData(e.el),h=m.checkGirlPri(f,1500000173,e),v=h?"chat-girl":"";return m.gift.RENDER?d=m.gift.RENDER:(r=a.string.join('<li class="jschartli" data-type="list" data-level="<%=userLev%>">','<p class="text-cont">',"<% if ( nl && nobleConfig[nl] ) { %>",'<span class="chat-icon-pad user-noble">','<img src="<%= attr.resourceUrl %><%= nobleConfig[nl].symbol.web_symbol_pic1 %>" title="<%= nobleConfig[nl].symbol.name %>" />',"</span>","<% } %>","<% if (dlv > 0 && dc > 0) { %>",'<span class="chat-icon-pad cq-level c-lv<%=dlv%>" title="<%=cqName%>">','<img src="<%=cqTitIcon%>">',"<em>×<%=dc%></em>","</span>","<% } else  {%>","<% if (bdl > 0) { %>",'<img src="<%=attr.web_url%>app/douyu/res/page/room-normal/cq/cq_other.png?v=20170627" class="chat-icon-pad cq-other" title="酬勤用户">',"<% } %>","<% } %>","<% if (girlPrivilege) { %>",'<span title="小姐姐特权" class="girl-privilege-icon"></span>',"<% } %>","<% if (bnn && bl && brid) {%>","<% if (brid != curRoomId) { %>",'<a class="chat-icon-pad" href="/<%= brid%>" target="_blank" data-fans="<%= brid %>" data-hc="<%= hc %>" data-msg="fans">',"<% if (fansMedal[brid]) { %>",'<span class="fans-badge-icon" data-ui-level="<%= bl %>">','<span class="fans-icon-name" style="background-image:url(',"<%= fansMedal[brid][bl].bg %>",')"><i><%= bnn %></i></span>','<span class="fans-badge-level" style="background-image:url(',"<%= fansMedal[brid][bl].md %>",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'<% } else if (fansMedal["all"]) { %>','<span class="fans-badge-icon" data-ui-level="<%= bl %>">','<span class="fans-icon-name" style="background-image:url(','<%= fansMedal["all"][bl].bg %>',')"><i><%= bnn %></i></span>','<span class="fans-badge-level" style="background-image:url(','<%= fansMedal["all"][bl].md %>',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","<% } else { %>",'<span class="fans-badge-icon" data-ui-level="<%= bl %>">','<span class="fans-icon-name"><i><%= bnn %></i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","<% } %>","</a>","<% } else { %>",'<span class="chat-icon-pad" data-fans="<%= brid %>" data-hc="<%= hc %>" data-msg="fans">',"<% if (fansMedal[brid]) { %>",'<span class="fans-badge-icon" data-ui-level="<%= bl %>">','<span class="fans-icon-name" style="background-image:url(',"<%= fansMedal[brid][bl].bg %>",')"><i><%= bnn %></i></span>','<span class="fans-badge-level" style="background-image:url(',"<%= fansMedal[brid][bl].md %>",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'<% } else if (fansMedal["all"]) { %>','<span class="fans-badge-icon" data-ui-level="<%= bl %>">','<span class="fans-icon-name" style="background-image:url(','<%= fansMedal["all"][bl].bg %>',')"><i><%= bnn %></i></span>','<span class="fans-badge-level" style="background-image:url(','<%= fansMedal["all"][bl].md %>',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","<% } else { %>",'<span class="fans-badge-icon" data-ui-level="<%= bl %>">','<span class="fans-icon-name"><i><%= bnn %></i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","<% } %>","</span>","<% } %>","<% } %>","<% if ( userLev > 0 ) { %>",'<a class="chat-icon-pad user-level<%=ulevIn1t9 ? " lve-icon-1to9" : ""%> <%=userIcon%> " title="用户等级：<%=userLev%>">',"</a>","<% } %>",'<% if ( cbid && getMotorcadeConfig({cbid: cbid}) != "") { %>','<span class="motorcade-icon" title="<%= getMotorcadeConfig({cbid: cbid}) %>" data-motorcade="<%= getMotorcadeConfig({cbid: cbid}) %>">',"<%= getMotorcadeConfig({cbid: cbid}) %>","</span>","<% } %>",'<a href="javascript:;" class="nick <%= girlCls %> js-nick" clt="<%=clt%>" rel="<%=uid%>" is-show-super-icon="<%=sahf%>" avatar="<%=ic%>" gid="<%=pg%>" data-noble="<%= nl %>"><%=nn%></a>',"<span>赠送给主播</span>",'<span class="gift-name"><%=giftName%></span>','<img class="lw-imgs" src="<%=giftCImg%>" width="<%=giftWidth%>" height="<%=giftHeight%>">',"<% if (hits > 1) { %>",'<span class="hy-org" style="display:inline-block;"><%=hits%>连击</span>',"<% } %>","</p>","</li>"),d=m.gift.RENDER=s.compile(r)),c=d({clt:e.ct||0,uid:e.uid,nn:e.nn,dlv:e.dlv||0,dc:e.dc||0,bdl:e.bdl||0,pg:e.pg||1,rg:e.rg||1,bnn:e.bnn||"",bl:parseInt(e.bl,10)||1,brid:parseInt(e.brid,10)||"",hc:e.hc,girlPrivilege:h,girlCls:v,curRoomId:parseInt(n.get("room.room_id"),10),hits:e.hits||1,userLev:e.level,userIcon:p.returnUlevelClass(e.level),ulevIn1t9:e.level>=1&&e.level<=9,cqName:p.getUserCqName(e.dlv),cqTitIcon:p.getCqTitIcon(e.dlv),giftType:g.type,giftCount:g.pc,giftCImg:g.cimg,giftName:g.name,giftWidth:u[g.style],giftHeight:u[g.style],attr:{web_url:n.get("sys.web_url"),resourceUrl:b},ic:e.ic||"",nl:e.nl||0,nobleConfig:k,fansMedal:l||{},sahf:isNaN(e.sahf)?1:e.sahf,getMotorcadeConfig:o.getMotorcadeConfig,cbid:e.cbid||""})},m.gift.RENDER=null,m.balls=function(e,t){e=i.decode(e).too();var o,r,l,d=i.decode(e.sui).too(),c=p.processArrData(e.el),u=m.checkGirlPri(c,1500000173,e),g=u?"chat-girl":"";return m.balls.RENDER?r=m.balls.RENDER:(o=a.string.join('<li class="jschartli older-balls" data-type="list" data-level="<%=userLev%>">','<p class="text-cont">',"<% if ( nl && nobleConfig[nl] ) { %>",'<span class="chat-icon-pad user-noble">','<img src="<%= attr.resourceUrl %><%= nobleConfig[nl].symbol.web_symbol_pic1 %>" title="<%= nobleConfig[nl].symbol.name %>" />',"</span>","<% } %>","<% if (girlPrivilege) { %>",'<span title="小姐姐特权" class="girl-privilege-icon"></span>',"<% } %>","<% if (dlv > 0 && dc > 0) { %>",'<span class="chat-icon-pad cq-level c-lv<%=dlv%>" title="<%=cqName%>">','<img src="<%=cqTitIcon%>">',"<em>×<%=dc%></em>","</span>","<% } else  {%>","<% if (bdl > 0) { %>",'<img src="<%=attr.web_url%>app/douyu/res/page/room-normal/cq/cq_other.png?v=20170627" class="chat-icon-pad cq-other" title="酬勤用户">',"<% } %>","<% } %>","<% if ( userLev > 0 ) { %>",'<a class="chat-icon-pad user-level<%=ulevIn1t9 ? " lve-icon-1to9" : ""%> <%=userIcon%> " title="用户等级：<%=userLev%>">',"</a>","<% } %>",'<a href="javascript:;" class="nick <%= girlCls %> js-nick" rel="<%=uid%>" avatar="<%=ic%>" gid="<%=pg%>" data-noble="<%= nl %>"><%=nn%></a>',"<span>赠送给主播</span>",'<span style="display:inline-block;"><%=giftCount%>个鱼丸</span>','<img class="lw-imgs" src="<%=attr.web_url%>app/douyu/res/page/room-normal/gift/mobile-yw-100.png?v=20160331" />',"</p>","</li>"),r=m.balls.RENDER=s.compile(o)),l=r({uid:d.id,nn:d.nick,dlv:d.cur_lev||0,dc:d.cq_cnt||0,bdl:d.best_dlev||0,pg:d.pg||1,rg:d.rg||1,hits:e.hc||1,girlPrivilege:u,girlCls:g,userLev:d.level,userIcon:p.returnUlevelClass(d.level),ulevIn1t9:d.level>=1&&d.level<=9,cqName:p.getUserCqName(d.cur_lev),cqTitIcon:p.getCqTitIcon(d.cur_lev),giftCount:e.ms,attr:{web_url:n.get("sys.web_url"),resourceUrl:b},ic:d.ic||"",nl:d.nl,nobleConfig:k})},m.balls.RENDER=null,m.rankupdate=function(e){e=i.decode(e).too();var o,r,l,d=parseInt(e.rn,10),c=t.fire("mod.center.userrole.get"),u=parseInt(e.ih),f=e.nk;return u&&(c.isAnchor()||c.isSuperAdmin()||n.get("sys.uid")==e.uid)&&(f=e.nk+"(已隐身)"),d>g?"":(m.rankupdate.RENDER?r=m.rankupdate.RENDER:(o=a.string.join('<li class="jschartli chart-rank-up-tip normal-notice" data-level="<%=level%>" data-type="list">','<i class="icon-heart"></i>','<div class="text-cont clearfix">','<div class="mycont-r">',"<% if (broadcastType == 2 || broadcastType == 4) { %>","<span>恭喜</span>",'<a class="nick js-nick <%= isVisible ? "status--invisible":"" %>" href="/<%=dstRoomId%>" target="_blank"><%=userNick%></a>',"<% } else { %>","<span>恭喜</span>",'<a class="nick js0nick <%= isVisible ? "status--invisible":"" %>"><%=userNick%></a>',"<% } %>","<span>的<%=rankTypeName%>排名上升到了第</span>",'<span class="highLight"><%=rankNum%></span>名！',"</div>","</div>","</li>"),r=m.rankupdate.RENDER=s.compile(o)),l=r({dstRoomId:"",userNick:f,level:e.level,rankNum:e.rn,isVisible:u,rankTypeName:p.getRankTypeName(e.rkt),broadcastType:e.bt,attr:{web_url:n.get("sys.web_url")}}))},m.rankupdate.RENDER=null,m.rankgap=function(e){e=i.decode(e).too();var t=parseInt(e.nz,10);if(1!==t&&3!==t)return"";var o,r,l,d=parseInt(e.urn,10);return d>g?"":(m.rankgap.RENDER?r=m.rankgap.RENDER:(o=a.string.join('<li class="jschartli chart-rank-gap-tip normal-notice" data-level="<%=level%>">','<i class="icon-heart"></i>','<div class="my-cont clearfix">','<div class="mycont-r">',"<span>继续赠送</span>",'<span class="highLight"><%=contributionGap%></span>',"点贡献值，","<span>您就可以升到<%=rankTypeName%>第</span>",'<span class="highLight highLight2"><%=urln%></span>',"<span>名</span>","</div>","</div>","</li>"),r=m.rankgap.RENDER=s.compile(o)),l=r({contributionGap:e.cg,rankTypeName:p.getRankTypeName(e.rt),urln:e.urn-1,attr:{web_url:n.get("sys.web_url")}}))},m.rankgap.RENDER=null,m.luckburst=function(e){if(e=i.decode(e).too(),!e.ur)return"";var t,o,r,l,d=parseInt(e.sil,10),c=parseInt(e.ur,10),l=d/c,u=parseInt(e.ct,10),g=parseInt(e["if"],10);return 1==u&&l>=1e3?(m.luckburst.RENDER1?o=m.luckburst.RENDER1:(t=a.string.join('<li class="jschartli normal-notice" data-type="list">','<i class="icon-heart"></i>','<div class="text-cont">','<a href="/client" target="_blank" class="text-app text-app-phone">','<span class="text-app-des">','<i>恭喜 <em class="hy-name"><%=nick%></em> </i>',"<i>使用斗鱼手机APP领取了 ",'<b><img src="<%=attr.web_url%>app/douyu/res/page/room-show/olyw/olyw-1000.png?v=20160322"></b> 鱼丸',"</i>","</span>","</a>","</div>","</li>"),o=m.luckburst.RENDER1=s.compile(t)),r=o({nick:e.nn,attr:{web_url:n.get("sys.web_url")}})):0==u&&l>0&&c>1?(m.luckburst.RENDER2?o=m.luckburst.RENDER2:(t=a.string.join('<li class="jschartli normal-notice" data-type="list" data-level="<%=userLev%>">','<i class="icon-heart"></i>','<div class="text-cont">',"<% if (level >= 10) { %>","<% if ( userLev > 0 ) { %>",'<a class="chat-icon-pad user-level<%=ulevIn1t9 ? " lve-icon-1to9" : ""%> <%=userIcon%> " title="用户等级：<%=userLev%>">',"</a>","<% } %>",'<span class="nick js-nick"><%=nick%></span>在第<%=lev%>次在线领鱼丸时触发',"<span><%=userRate%>倍暴击</span>，获得了",'<span class="hy-org"><%=gold%></span>个鱼丸','<img src="<%=attr.web_url%>app/douyu/res/page/room-normal/olyw/yw.png?20170627">',"<% } else { %>",'<span class="nick js-nick"><%=nick%></span>','在第<%=lev%>次在线领鱼丸时获得了<span class="hy-org"><%=gold%></span>个鱼丸','<img src="<%=attr.web_url%>app/douyu/res/page/room-normal/olyw/yw.png?v=20170627">',"<% } %>","</div>","</li>"),o=m.luckburst.RENDER2=s.compile(t)),r=o({gold:d,lev:e["if"],level:e.level,nick:e.nn,userIcon:p.returnUlevelClass(e.level),userLev:e.level,userRate:c,ulevIn1t9:e.level>=1&&e.level<=9,attr:{web_url:n.get("sys.web_url")},sahf:isNaN(e.sahf)?1:e.sahf})):0==u&&6==g&&l>0?(m.luckburst.RENDER3?o=m.luckburst.RENDER3:(t=a.string.join('<li class="jschartli" data-type="list" data-level="<%=userLev%>">','<img src="<%=attr.web_url%>app/douyu/res/page/room-normal/cq/cq_other.png?v=20170627" class="chat-icon-pad cq-other" title="酬勤用户">','<span class="nick js-nick"><%=nick%></span>',"<span>通过在线领鱼丸获得了</span>",'<span class="hy-org"><%=gold%></span>个','<span style="margin-right:5px;">酬勤专享鱼丸</span>','<img src="<%=attr.web_url%>app/douyu/res/page/room-normal/olyw/yw.png?v=20170627">',"</li>"),o=m.luckburst.RENDER3=s.compile(t)),r=o({gold:d,nick:e.nn,userLev:e.level,attr:{web_url:n.get("sys.web_url")},sahf:isNaN(e.sahf)?1:e.sahf})):void 0},m.luckburst.RENDER1=null,m.luckburst.RENDER2=null,m.luckburst.RENDER3=null,m.peck=function(e){e=i.decode(e).too();var t,o,r;return m.peck.RENDER?o=m.peck.RENDER:(t=a.string.join("<% if (giftType <= 4 && giftType > 0) { %>",'<li class="jschartli chartli bonus-chat">','<p class="text-cont">','恭喜<span class="nick" rel="<%= did %>"><%= dnk %></span>','领取了<span class="nick"><%= snk %></span>',"派送的宝箱！触发暴击","<% if (giftType > 1) { %>","X<%= giftType %>","<% } %>",'获得<span class="hy-org"><%= sl %>鱼丸</span>',"<% if(dct.length) {%>",'<span>。并成功发送节奏弹幕"<%=dct%>"</span>',"<% } %>","</p>","</li>","<% } else if (giftType == 5) { %>",'<li class="jschartli chartli bonus-chat normal-notice">','<i class="icon-heart"></i>','<p class="text-cont">','恭喜<span class="nick" rel="<%= did %>"><%= dnk %></span>','领取了<span class="nick"><%= snk %></span>',"派送的宝箱！",'获得<span class="hy-org"><%= sl %>鱼丸</span>','，成为本场<span class="hy-org">手气王！</span>',"<% if(dct.length) {%>",'<span>。并成功发送节奏弹幕"<%=dct%>"</span>',"<% } %>","</p>","</li>","<% } else if(giftType == 6) { %>",'<li class="jschartli" data-type="list" data-level="<%=userLev%>">','<p class="text-cont">','<% if (rpt ==  "3") { %>','<a href="javascript:;" class="nick" style="cursor:text;" rel="<%=did%>"><%=dnk%></a>',"<span> 红包拆出了 </span>",'<span class="hy-org"><%=sl%></span>',"<span>个鱼丸</span>","<% } else { %>",'<a href="javascript:;" class="nick" style="cursor:text;" rel="<%=did%>"><%=dnk%></a>',"<span> 领取了 </span>",'<span class="hy-name"><%=snk%></span>',"<span> 派送的 </span>",'<span class="hy-org"><%=sl%></span>',"<span>个鱼丸</span>","<% } %>","<% if(dct.length) {%>",'<span>。并成功发送节奏弹幕"<%=dct%>"</span>',"<% } %>","</p>","</li>","<% } %>"),o=m.peck.RENDER=s.compile(t)),r=o({did:e.did,dnk:e.dnk,snk:e.snk,sl:e.sl,rpt:e.rpt,dct:e.dct||"",userLev:e.level,giftType:Math.abs(6-parseInt(e.gt,10))||0,attr:{web_url:n.get("sys.web_url")}})},m.peck.RENDER=null,m.uplevel=function(e){e=i.decode(e).too();var o,r,l,d=e.level?e.level:0;parseInt(d/10,10);return n.get("sys.uid")==e.uid&&t.trigger("mod.chatrank.cqrankupdate",d),d%20===0?(m.uplevel.RENDER?r=m.uplevel.RENDER:(o=a.string.join('<li class="jschartli normal-notice user-level-update" data-type="list" data-level="<%=level%>">','<i class="icon-heart"></i>','<p class="text_cont">','<span style="margin-right:8px;">恭喜</span>',"<% if ( level > 0 ) { %>",'<a class="chat-icon-pad user_level  <%=ulevIn1t9 ? " lve-icon-1to9" : ""%> <%= userIcon %>" title="用户等级：<%= level %>">',"</a>","<% } %>",'<span class="name"><a href="javascript:;" class="nick js-nick"  rel="<%= uid %>" is-show-super-icon="<%=sahf%>" avatar="<%= ic %>"  gid="<%= gid %>"><%= user_nick %></a></span>','升级到<span style="margin:0 2px;" class="hy-org"><%= level %></span>级!',"</p>","</li>"),r=m.uplevel.RENDER=s.compile(o)),l=r({level:d,uid:e.uid,user_nick:e.nn,gid:e.gid,userIcon:p.returnUlevelClass(d),ulevIn1t9:d>=1&&9>=d,attr:{web_url:n.get("sys.web_url")},ic:e.ic||"",sahf:isNaN(e.sahf)?1:e.sahf})):void 0},m.uplevel.RENDER=null,m.fansLevelUp=function(e){var t,o,r,d=i.decode(e).too();return m.fansLevelUp.RENDER?o=m.fansLevelUp.RENDER:(t=a.string.join('<li class="jschartli normal-notice" data-type="list">','<i class="icon-heart"></i>','<p class="honor-yc-tips">','恭喜<a href="javascript:;" class="hy-name"><%= nn %></a>','<span class="chat-icon-pad">升级到</span>',"<% if (fansMedal[rid]) { %>",'<span class="fans-badge-icon" data-ui-level="<%= bl %>">','<span class="fans-icon-name" style="background-image:url(',"<%= fansMedal[rid][bl].bg %>",')"><i><%= bnn %></i></span>','<span class="fans-badge-level" style="background-image:url(',"<%= fansMedal[rid][bl].md %>",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'<% } else if (fansMedal["all"]) { %>','<span class="fans-badge-icon" data-ui-level="<%= bl %>">','<span class="fans-icon-name" style="background-image:url(','<%= fansMedal["all"][bl].bg %>',')"><i><%= bnn %></i></span>','<span class="fans-badge-level" style="background-image:url(','<%= fansMedal["all"][bl].md %>',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","<% } else { %>",'<span class="fans-badge-icon" data-ui-level="<%= bl %>">','<span class="fans-icon-name"><i><%= bnn %></i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","<% } %>","</p>","</li>"),o=m.fansLevelUp.RENDER=s.compile(t)),r=o({uid:d.uid||"",nn:d.nn||"",bl:d.bl||1,lbl:d.lbl,bnn:d.bnn,attr:{web_url:n.get("sys.web_url")},fansMedal:l||{},rid:n.get("room.room_id")})},m.fansLevelUp.RENDER=null,m.winAnchorFans=function(e){var t,o,r,l=i.decode(e).too(),d=l.ac,c=l.bc,u=i.decode(l.ai).too(),g=i.decode(l.bi).too(),p=i.decode(l.ua).too(),f=i.decode(l.ub).too(),h={},v={};return parseInt(d,10)!==parseInt(c,10)?(parseInt(d,10)>parseInt(c,10)?(h=u,v=p):(h=g,v=f),m.winAnchorFans.RENDER?o=m.winAnchorFans.RENDER:(t=a.string.join('<li class="jschartli lianmai-success" data-type="list" data-anchor-level="<%= winerAnchor.lv %>" data-level="1">','<p class="text-cont">','<span class="lianmai-success-text">',"<% if (nobleInfo[nl]) { %>",'<span class="chat-icon-pad user-noble">','<img src="<%= attr.resource_url %><%= nobleInfo[maxDevoteUser.nl].symbol.web_symbol_pic1 %>" title="<%= nobleInfo[maxDevoteUser.nl].symbol.name %>">',"</span>","<% } %>",'<a class="chat-icon-pad user-level level-<%= maxDevoteUser.lv %> level-bgpng level-size1 " title="用户等级：<%= maxDevoteUser.lv %>"></a>','<span class="lianmai-success-uname" data-rel="user-info" data-level="<%= maxDevoteUser.lv %>">','<a href="javascript:;" class="nick js-nick" rel="<%= maxDevoteUser.id %>" avatar="<%= maxDevoteUser.icon %>" data-noble="<%= maxDevoteUser.nl %>"><%= maxDevoteUser.nn %></a>',"</span>","为主播 ",'<a class="chat-icon-pad anchor-level-icon lianmai-success-alevel" title="主播等级：<%= winerAnchor.lv %>" data-anchor-levelimg="<%= winerAnchor.lv %>"></a>','<span class="lianmai-success-aname">','<a href="javascript:;" class="nick js-nick" rel="<%= ownerUid %>" avatar="<%= winerAnchor.icon %>" data-noble="<%= winerAnchor.nl %>"><%= winerAnchor.nn %></a>',"</span>","贡献<%= conValue %>，助力主播获取胜利！！！","</span>","</p>","</li>"),o=m.winAnchorFans.RENDER=s.compile(t)),r=o({winerAnchor:h,ownerUid:n.get("room.owner_uid"),maxDevoteUser:v,conValue:parseInt(v.cb/100,10),nobleInfo:n.get("room.nobleConfig"),attr:{resource_url:n.get("sys.resource_url")}})):void 0},m.winAnchorFans.RENDER=null,m.wbsharesuc=function(e){e=i.decode(e).too();var t,o,r;return m.wbsharesuc.RENDER?o=m.wbsharesuc.RENDER:(t=a.string.join('<li class="jschartli normal-notice" data-type="list" data-level="<%=userLev%>">','<i class="icon-heart"></i>','<p class="text_cont">','<span class="name chat-icon-pad"><a href="javascript:;" class="nick js-nick" rel="<%= uid %>" is-show-super-icon="<%=sahf%>" avatar="<%= ic %>"><%= nickname %></a></span>',"分享了该直播间","<% if (exp) { %>",'，获得<span class="hy-org"><%= exp %></span>经验值',"<% } %>","</p>","</li>"),
o=m.wbsharesuc.RENDER=s.compile(t)),r=o({uid:e.uid,rid:e.rid,nickname:e.nickname,gid:e.gid,userLev:e.level,exp:parseFloat(e.exp),attr:{web_url:n.get("sys.web_url")},ic:e.ic||"",sahf:isNaN(e.sahf)?1:e.sahf})},m.wbsharesuc.RENDER=null,m.peckprop=function(e){var t=m.peckprop.RENDER({did:e.did,dnk:e.dnk,sid:e.sid,snk:e.snk,cnt:e.cnt,pnm:e.pnm,dct:e.dct||"",webUrl:n.get("sys.web_url")});return t},m.peckprop.RENDER=function(){var e=a.string.join('<li class="jschartli" data-type="list">','<p class="text-cont">','<a href="javascript:;" class="nick" style="cursor:text;" rel="<%=did%>"><%=dnk%></a>',"<span> 领取了 </span>",'<span class="hy-name"><%=snk%></span>',"<span> 派送的 </span>",'<span class="hy-org"><%=cnt%>个<%=pnm%></span>',"<% if(dct.length) {%>",'<span> 。并成功发送节奏弹幕"<%=dct%>"</span>',"<% } %>","</p>","</li>");return s.compile(e)}(),m.useprop=function(e){var t=p.processArrData(e.el),a=m.checkGirlPri(t,1500000173,e),i=a?"chat-girl":"",s=m.useprop.RENDER({clt:e.ct,uid:e.uid,nn:e.nn,dlv:e.dlv,dc:e.dc,bdl:e.bdl||0,pg:e.pg||1,rg:e.rg||1,girlPrivilege:a,girlCls:i,hits:e.hits||1,userLev:e.level,userIcon:p.returnUlevelClass(e.level),ulevIn1t9:e.level>=1&&e.level<=9,cqName:p.getUserCqName(e.dlv),cqTitIcon:p.getCqTitIcon(e.dlv),giftCImg:giftConfig.cimg,giftName:giftConfig.name,giftWidth:giftSize[giftConfig.style],giftHeight:giftSize[giftConfig.style],attr:{web_url:n.get("sys.web_url"),resourceUrl:b},ic:e.ic||"",nl:e.nl,nobleConfig:k});return s},m.useprop.RENDER=function(){var e=a.string.join('<li class="jschartli" data-type="list" data-level="<%=userLev%>">','<p class="text-cont">',"<% if ( nl && nobleConfig[nl] ) { %>",'<span class="chat-icon-pad user-noble">','<img src="<%= attr.resourceUrl %><%= nobleConfig[nl].symbol.web_symbol_pic1 %>" title="<%= nobleConfig[nl].symbol.name %>" />',"</span>","<% } %>","<% if (dlv > 0 && dc > 0) { %>",'<span class="chat-icon-pad cq-level c-lv<%=dlv%>" title="<%=cqName%>">','<img src="<%=cqTitIcon%>">',"<em>×<%=dc%></em>","</span>","<% } else  {%>","<% if (bdl > 0) { %>",'<img src="<%=attr.web_url%>app/douyu/res/page/room-normal/cq/cq_other.png?v=20170627" class="chat-icon-pad cq-other" title="酬勤用户">',"<% } %>","<% } %>","<% if (girlPrivilege) { %>",'<span title="小姐姐特权" class="girl-privilege-icon"></span>',"<% } %>","<% if ( userLev > 0 ) { %>",'<a class="chat-icon-pad user-level<%=ulevIn1t9 ? " lve-icon-1to9" : ""%> <%=userIcon%>" title="用户等级：<%=userLev%>">',"</a>","<% } %>",'<a href="javascript:;" class="nick <%= girlCls %> js-nick" clt="<%=clt%>" rel="<%=uid%>" avatar="<%=ic%>" gid="<%=pg%>" data-noble="<%= nl %>"><%=nn%></a>',"<span>赠送给主播</span>",'<span class="gift-name"><%=giftName%></span>','<img class="lw-imgs" src="<%=giftCImg%>" width="<%=giftWidth%>" height="<%=giftHeight%>">',"<% if (hits > 1) { %>",'<span class="hy-org" style="display:inline-block;"><%=hits%>连击</span>',"<% } %>","</p>","</li>");return s.compile(e)}(),m.videoMomentRecord=function(e){if(!m.videoMomentRecord.RENDER){var t=a.string.join('<li class="jschartli hy-chat <%= isSender ? "chartli" : "" %>"',' data-level="<%=node.ul%>"',' data-type="list" ',"<% if ( node.rl > 0 ) { %>",'data-anchor-level="<%=node.rl%>"',"<% } %>",">",'<p class="my-cont">','<span class="chat-icon-pad"><img class="icon-role" src="<%= attr.web_url %>app/douyu/res/page/room-normal/anchor.png?v=<%= attr.web_ver %>" /></span>','<a class="chat-icon-pad anchor-level-icon" title="主播等级：<%= node.rl %>" data-anchor-levelimg="<%=node.rl%>"></a>','<span class="name">','<a href="javascript:;" class="nick js-nick" rel="<%= uid %>" avatar="<%= node.ic || avatar %>" ><%= name %>：</a></span>','<span class="chat-msg-item m"><a class="v-moment-cont" href="<%= attr.vsite%>/show/<%= node.vid %>" target="_blank">录制了一段<br/><i></i>精彩时刻<b>快来围观吧！</b></a></span>',"</p>","</li>");m.videoMomentRecord.RENDER=s.compile(t)}var i=+n.get("room.owner_uid"),o=n.get("room.owner_name"),r=+n.get("sys.uid"),l=n.get("room.avatar");l=l.middle||"",l=l.replace(/^[\w\W]*upload\/([\w\W]*)_middle\.jpg$/,"$1");var d=m.videoMomentRecord.RENDER({node:e,name:o,uid:i,avatar:l,isSender:r===i,attr:{web_url:n.get("sys.web_url"),resourceUrl:b,web_ver:"20170724",vsite:n.get("sys.vsite_url")}});return d},m.broadcastRecord=function(e,t){var i,n,o;return m.broadcastRecord.RENDER?n=m.broadcastRecord.RENDER:(i=a.string.join('<li class="jschartli normal-notice" data-type="list">','    <i class="icon-heart"></i>','    <p class="honor-yc-tips"><%= title %>：<a href="/<%= rid %>" target="_blank" class="hy-name"><%= onn %></a>',"    <span>开播了！快来围观吧！</span>","    </p>","</li>"),n=m.broadcastRecord.RENDER=s.compile(i)),o=n({rid:e.rid,onn:e.onn,title:t})},m.broadcastRecord.RENDER=null,m.guessGame=function(e){return m.guessGame.RENDER?render=m.guessGame.RENDER:(source=a.string.join('<li class="jschartli guess-game-notice">','<i class="icon-heart"><img style="width: 100%;height: 100%;" src="<%= data.icon %>" /></i>','<div class="my_cont clearfix">','<div class="mycont-r">',"恭喜 ",'<span class="active-name"><%= data.uname %></span>'," 参与竞猜获得 ",'<span class="active-num"><%= data.ec %></span>'," 鱼丸！为主播加热度上热门！","</div>","</div>","</li>"),render=m.guessGame.RENDER=s.compile(source)),html=render({data:e}),html},m.guessGame.RENDER=null,m}),define("douyu/com/user-view-dp",["jquery","shark/observer"],function(e,t){function a(e,t){t?DYS.sub({kernelFlag:!0},e):DYS.sub(e)}var i={"dys.com.user.login.show":function(e){a({action_code:"show_login",ext:e},!0)},"dys.com.user.login.vcode.show":function(e){a({action_code:"show_login_code",ext:e})},"dys.com.user.login.input.change":function(e){var t;switch(e.name){case"username":t="click_login_name";break;case"password":t="click_login_pw"}e&&delete e.name,a({action_code:t,ext:e})},"dys.com.user.login.password.forget":function(e){a({action_code:"click_login_forgpass",ext:e},!0)},"dys.com.user.login.submit.click":function(e){a({action_code:"click_login_tologin",ext:e})},"dys.com.user.login.submit.success":function(e){a({action_code:"show_login_succ",ext:e},!0)},"dys.com.user.login.submit.fail":function(e){a({action_code:"show_login_fail",ext:e})},"dys.com.user.login.close.click":function(e){a({action_code:"click_login_close",ext:e})},"dys.com.user.login.thirds.click":function(e){a({action_code:"click_login_other",ext:e},!0)},"dys.com.user.reg.show":function(e){a({action_code:"show_sign",ext:e},!0)},"dys.com.user.reg.input.change":function(e){var t;switch(e.name){case"nickname":t="click_sign_name";break;case"password":t="click_sign_pw";break;case"password2":t="click_sign_pw2";break;case"protocol":t="click_sign_agree"}e&&delete e.name,a({action_code:t,ext:e})},"dys.com.user.reg.submit.click":function(e){a({action_code:"click_sign_tosign",ext:e})},"dys.com.user.reg.submit.success":function(e){a({action_code:"show_sign_succ",ext:e},!0)},"dys.com.user.reg.login.fail":function(e){a({action_code:"show_sign_fail",ext:e},!0)},"dys.com.user.reg.close.click":function(e){a({action_code:"click_sign_close",ext:e})},"dys.com.user.reg.vcode9.click":function(e){a({action_code:"click_sign_code",ext:e},!0)},"dys.com.user.reg.thirds.click":function(e){a({action_code:"click_sign_other",ext:e},!0)},"dys.com.user.phone.show":function(e){a({action_code:"show_sign_phone",ext:e},!0)},"dys.com.user.phone.input.change":function(e){var t;switch(e.name){case"selectCountry":t="click_sign_phone_cou";break;case"bindphonenum":t="click_sign_phone";break;case"phonenum_captcha":t="click_sign_phone_code";break;case"change_captcha":t="click_sign_phone_newcode";break;case"yzphonenum":t="click_sign_phone_voicecode";break;case"get_yzphonenum":t="click_sign_phone_get_voicecode"}e&&delete e.name,"click_sign_phone"==t?a({action_code:t,ext:e},!0):a({action_code:t,ext:e})},"dys.com.user.phone.submit.click":function(e){a({action_code:"click_sign_phone_tophone",ext:e})},"dys.com.user.phone.submit.success":function(e){a({action_code:"show_sign_phone_succ",ext:e},!0)},"dys.com.user.phone.submit.fail":function(e){a({action_code:"show_sign_phone_fail",ext:e},!0)},"dys.com.user.phone.close.click":function(e){a({action_code:"click_sign_phone_close",ext:e})}};for(var s in i)!function(e){var a=i[e];t.on(e,function(e){a.call(this,e)})}(s);return{init:function(e){window.DYS&&DYS.sub.setPageCode(e)}}}),define("douyu/com/vcode-user",["jquery","shark/class","shark/observer","douyu/com/user-view-dp"],function(e,t,a,i){var s={type:null,input:{codesrc:"/member/task/captcha"},fast:{idpre:"gt-captcha-",count:0}},n=t({init:function(t){this.config=e.extend(!0,{},{target:null},t),this.render(),this.bindEvt(),this.refresh()},render:function(){this.config.$tar=e(this.config.target),this.config.$el=this.config.$tar.find(".captcha"),this.config.$ipt=this.config.$el.find("input"),this.config.$img=this.config.$el.find("img")},show:function(){this.config.$el.show()},hide:function(){this.config.$el.hide()},refresh:function(){var e=this.config.$img.data("vcodesrc");e||(e=passport_host+"api/captcha"),e=e+"?v="+(new Date).getTime(),this.config.$img.attr("src",e),this.config.$ipt.val("")},bindEvt:function(){var e=this;this.config.$img.click(function(t){t.stopPropagation(),t.preventDefault(),e.refresh()})}}),o=t({init:function(t){this.config=e.extend(!0,{},{target:null},t),this.render()},nextId:function(){return s.fast.idpre+ ++s.fast.count},getResult:function(){return this.config.result},check:function(t){var i=function(i){0===i.code?(this.buildAsync(e.trim(i.id)),a.trigger("dys.com.user.login.vcode.show",{type:1})):t(!1)},s=function(){t(!1)};e.ajax("/member/login/check_capcha_status",{type:"post",dataType:"json",timeout:5e3,success:e.proxy(i,this),error:e.proxy(s,this)})},render:function(){this.config.$tar=e(this.config.target),this.config.$el=this.config.$tar.find(".captcha-gt")},build:function(e){var t=this.nextId(),i=this;this.config.$el.append('<div id="'+t+'"></div>'),this.config.result=null,window.initGeetest({gt:e,product:"float"},function(e){e.appendTo("#"+t),a.trigger("com.vcode.fast.init",{value:i.config.result,target:i.config.$tar}),e.onSuccess(function(){i.config.result=i.plugin.getValidate(),a.trigger("com.vcode.fast.check.success",{value:i.config.result,target:i.config.$tar})}),e.onRefresh(function(){i.config.result=null}),e.onError(function(){i.config.result=null}),i.plugin=e})},buildAsync:function(e){var t=this,a=location.protocol;require.use([a+"//static.geetest.com/static/tools/gt.js"],function(){t.build(e)})},refresh:function(){this.plugin.refresh()},show:function(){this.config.$el.show()},hide:function(){this.config.$el.hide()}}),r={init:function(t){var i=new n({target:t}),r=new o({target:t});s.type="fast",i.hide();try{r.check(function(n){n===!1&&(s.type="input",i.show(),r.hide(),a.trigger("dys.com.user.login.vcode.show",{type:2}),a.trigger("com.vcode.fast.init.failed",{value:n,target:e(t)}))})}catch(l){s.type="input",i.show(),window.console&&console.error(l)}return{refresh:function(){"input"===s.type?i.refresh():r.refresh()},isInput:function(){return"input"===s.type},isFast:function(){return"fast"===s.type},getType:function(){return s.type},getFastResult:function(){return r.getResult()}}}};return r}),function(){$.fn.dy_dialog=function(e,t){},$.fn.dy_tips_black=function(e,t){t=$.extend(t,{trigger:$(this),mask:!1,fixed:!1}),$.dy_dialog.tips_black(e,t)},$.dy_dialog=function(t,a){if("tips_black"===a.type){var i=new e,s='<div class="shark-ui-alert-content">'+t+"</div>",n="",o="shark-ui-alert shark-ui-alert-tip";s+=n;var r=$.extend({target:s,animate:!0,show:!0,className:o,afterHide:function(e){this.dispose(),a.callback&&a.callback()}},a);i.init(r),a.timer&&setTimeout(function(){i.dispose(),a.callback&&a.callback()},1e3*a.timer),i.dbltouch(i.mask,function(){i.hide(),a.callback&&a.callback()})}else{var l=new e,s='<div class="shark-ui-dialog-content">'+t+"</div>",n="",d="";if(a.buttons){for(var c=0,u=a.buttons.length;u>c;c++){var g=a.buttons[c];d+='<a href="javascript:;" class="shark-ui-confirm-submit '+(g.className||"")+'" data-type="yes">'+g.content+"</a>"}n='<div class="shark-ui-dialog-action">'+d+"</div>"}"bottom"==a.position?s=n+s:s+=n;var m=$.extend({target:s,animate:!0,show:!0,fixed:!0,content:t,buttons:null,width:420,title:"提示",mask:!1,callback:null,zIndex:501,className:"shark-ui-confirm",afterHide:function(e){this.dispose()},beforeShow:function(e,t){l.touch($(".shark-ui-confirm-submit",t),function(e){for(var a=l.settings.buttons,i=0;i<a.length;i++)if(a[i].content==$(e.target).text()){a[i].callback&&a[i].callback.call(l,e,t);break}})}},a);l.init(m),l.dbltouch(l.mask,function(){l.hide()})}return l},$.dy_dialog.tips_black=function(e,t){var a={},i={zIndex:501,type:"tips_black"};return a="object"==typeof e?$.extend(i,e):$.extend(i,{button:null,timer:3,callback:null,minWidth:200,fixed:!0,mask:!1,height:"auto"}),$.dy_dialog(e,$.extend(a,t))};var e=function(){var e=Math.random().toString().replace(".","");this.id="dialog_"+e,this.settings={},this.settings.closeTpl=$('<span class="shark-ui-dialog-close js-dialog-close"></span>'),this.settings.titleTpl=$('<div class="shark-ui-dialog-title"></div>'),this.timer=null,this.showed=!1,this.mask=$()};e.prototype={init:function(e){var t=e.trigger||$("body");this.settings=$.extend({fixed:!1},this.settings,e),this.settings.mask&&(this.mask=$('<div class="shark-ui-dialog-mask"/>'),t.append(this.mask)),t.append('<div class="shark-ui-dialog" id="'+this.id+'"></div>'),this.dialogContainer=$("#"+this.id);var a=this.settings.zIndex||10;this.dialogContainer.css({zIndex:a}),this.settings.className&&this.dialogContainer.addClass(this.settings.className),this.mask.css({zIndex:a-1}),this.settings.closeTpl&&this.dialogContainer.append(this.settings.closeTpl),this.settings.title&&(this.dialogContainer.append(this.settings.titleTpl),this.settings.titleTpl.html(this.settings.title)),this.bindEvent(),this.settings.show&&this.show()},dbltouch:function(e,t){function a(e){return e.preventDefault(),window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),t.call(this,e)}$(e).on("dblclick",a)},touch:function(e,t){function a(e){return t.call(this,e)}$(e).on("click",a)},bindEvent:function(){var e=this;$(this.dialogContainer).on("click",".js-dialog-close",function(){return e.hide(),!1}),$(document).keydown(function(t){27===t.keyCode&&e.showed&&e.hide()}),$(this.dialogContainer).on("hide",function(){e.hide()}),$(window).on("resize",function(){e.setPosition()})},dispose:function(){this.dialogContainer.remove(),this.mask.remove(),this.timer&&clearInterval(this.timer)},hide:function(){var e=this;e.settings.beforeHide&&e.settings.beforeHide.call(e,e.dialogContainer),this.showed=!1,this.mask.hide(),this.timer&&clearInterval(this.timer),this.settings.animate?(this.dialogContainer.removeClass("zoomIn").addClass("zoomOut"),setTimeout(function(){e.dialogContainer.hide(),"object"==typeof e.settings.target&&$("body").append(e.dialogContainer.hide()),e.settings.afterHide&&e.settings.afterHide.call(e,e.dialogContainer),e.settings.onHide&&e.settings.onHide.call(e)},500)):(this.dialogContainer.hide(),"object"==typeof this.settings.target&&$("body").append(this.dialogContainer),this.settings.afterHide&&this.settings.afterHide.call(this,this.dialogContainer),e.settings.onHide&&e.settings.onHide.call(e))},show:function(){"string"==typeof this.settings.target?/^(\.|\#\w+)/gi.test(this.settings.target)?this.dailogContent=$(this.settings.target):this.dailogContent=$("<div>"+this.settings.target+"</div>"):this.dailogContent=this.settings.target,this.mask.show(),this.dailogContent.show(),this.height=this.settings.height||"auto",this.width=this.settings.width||"auto",this.dialogContainer.append(this.dailogContent).show().css({height:this.height,width:this.width}),this.settings.minWidth&&this.dialogContainer.css({"min-width":this.settings.minWidth}),this.settings.beforeShow&&this.settings.beforeShow.call(this,this.dialogContainer),this.showed=!0,$(this.settings.trigger).blur(),this.setPosition(),$(this.dialogContainer).attr({tabindex:1}).focus();this.timer&&clearInterval(this.timer),this.settings.animate&&this.dialogContainer.removeClass("zoomOut").addClass("animated").addClass("zoomIn"),this.settings.onInit&&this.settings.onInit.call(this)},setPosition:function(){if(this.showed){var e=this,t=e.settings.trigger||$(window);this.dialogContainer.show(),this.height=this.settings.height,this.width=this.settings.width,isNaN(this.height)&&(this.height=this.dialogContainer.outerHeight&&this.dialogContainer.outerHeight()||this.dialogContainer.height()),isNaN(this.width)&&(this.width=this.dialogContainer.outerWidth&&this.dialogContainer.outerWidth()||this.dialogContainer.width());var a=t.height(),i=t.width(),s=this.width/2,n=this.height/2,o=(i/2-s)/i*100,r=(a/2-n)/a*100,l="absolute";e.settings.fixed?l="fixed":r+=t.scrollTop();var d="auto";"bottom"==e.settings.position&&(r="auto",d=0),e.dialogContainer.css({position:l,top:r+"%",left:o+"%",bottom:d})}}}}(),function(){window.define&&define.fmd&&define("douyu/com/dialog",function(){return $.dy_dialog})}(),define("douyu/com/msgq",function(){var e=20,t=200;navigator.appVersion.indexOf("MSIE")>0&&(t=350);var a=function(e){return"function"==typeof e},i=function(e,t,a){var i=e.length,s=t(i),n=e.splice(0,s);return a(n),e},s=function(e,a,n,o){var r=e.length;i(e,a,n),r=e.length,0>=r?o():setTimeout(function(){s(e,a,n,o)},t)},n=function(){return 1},o=function(){window.console&&console.log&&console.log(list.join(""))},r=function(){this.init.apply(this,arguments)};return r.prototype.init=function(e){e=e||{},this.STATE=0,this.CACHE=[],this._hotplan=a(e.hotplan)?e.hotplan:n,this._render=a(e.render)?e.render:o,this._releaseRight=!!e.releaseRight},r.prototype.push=function(e){return this.CACHE.push(e),this._releaseIf(),this},r.prototype._release=function(){var e=this.CACHE,t=this._hotplan,a=this._render,i=this;s(e,t,a,function(){i.STATE=0})},r.prototype._releaseIf=function(){var t=this.STATE,a=this;0===t&&(this.STATE=1,setTimeout(function(){a._release()},e))},{create:function(e,t){return new r(e,t)}}}),define("douyu/page/room/normal/mod/check-verify",["jquery","shark/class","shark/observer","shark/util/lang/1.0","shark/util/template/1.0","shark/util/cookie/1.0","douyu/context","douyu/com/vcode-user","douyu/com/dialog"],function(e,t,a,i,s,n,o,r){var l={init:function(){var e=i.string.join('<div class="checkplace">',"<% if(hasPhone && phoneNumber) { %>",'<div class="warningphonetext">','为了保护您的账号安全，请输入账号所绑定的完整手机号：<span class="orange"><%=phoneNumber%></span>',"</div>",'<div class="checkphonenumber"><input placeholder="请输入完整手机号" type="text" data-type="phonenumber" maxlength="11"></div>',"<% }else{ %>",'<div class="warningphonetext">','亲爱的<span class="orange"><%=nickName%></span>用户，<span data-type="codechecktype">检测到您不是在常用环境登录账号请在下方输入验证码验证</span>',"</div>","<% } %>",'<div class="captcha">','<input data-type="imgcapchainput" class="ipt ipt-capcha" type="text" maxlength="4" placeholder="请输入右侧验证码" autocomplete="off">','<img title="点击切换验证码" data-type="imgcapchaimg" src="about:blank" data-vcodesrc="/api/remote_verify/get_captcha">',"</div>",'<div class="captcha-gt">',"</div>",'<div class="checkplacebtnwrap">','<div class="checkplacebtn" data-type="confirmcheck">确定</div>',"</div>","</div>");this.render=s.compile(e),this.dialogWrap={},this.tipParam={className:"tips_blackerror",zIndex:503,timer:2},this.bindEvents(),this.ajaxing=null},bindEvents:function(){var e=this;a.on("com.vcode.fast.init",function(t){t.target[0]==e.dialogWrap[0]&&e.dialogWrap.find('[data-type="codechecktype"]').text("检测到您不是在常用环境登录账号请拖动下方滑块进行验证")})},getPhone:function(t){var a=this;t.type;this.ajaxing||(a.ajaxing=e.get("/api/remote_verify/get_MobilePhone",function(i){var s=i.data||{},l="",d={device_id:n.get("did"),client_type:0};a.ver_type=t.isDanmu?1:2,s.phonestatus?a.hasPhone=!0:a.hasPhone=!1,200==i.result?(l=a.render({nickName:o.get("sys.nickname"),hasPhone:s.phonestatus,phoneNumber:s.mobile_phone,isDanmu:s.mobile_phone&&t.isDanmu}),a.checkDialog=e.dy_dialog(l,{title:"异常登录验证",width:388,mask:1,zIndex:502,className:"dialogcheckplace",onInit:function(){var i=this,n=this.dailogContent,o=n.find(".checkplace"),l=r.init(o);a.dialogWrap=e(i),n.on("click",'[data-type="confirmcheck"]',function(){var o,r,c=e(this);if(s&&s.phonestatus&&s.mobile_phone){if(r=n.find('[data-type="phonenumber"]').val(),""===e.trim(r))return e.dy_dialog.tips_black("请输入手机号！",a.tipParam),void DYS.sub({action_code:"show_testphone_fail",ext:{ver_type:a.ver_type}});if(!/^\d{1,11}$/.test(r))return e.dy_dialog.tips_black("手机号格式有误！",a.tipParam),void DYS.sub({action_code:"show_testphone_fail",ext:{ver_type:a.ver_type}});d.mobile_phone=r}if(l&&l.isFast()&&!(o=l.getFastResult()))return void e.dy_dialog.tips_black("请拖动滑块通过验证！",a.tipParam);if(l&&l.isInput()){if(o=n.find('[data-type="imgcapchainput"]').val(),!/^\d{4}$/.test(o))return void e.dy_dialog.tips_black("验证码格式不正确！",a.tipParam);d.code=e.trim(o)}if(l&&l.isFast()){var u=l.getFastResult();u&&e.extend(d,u)}a.getCSRFCookie(function(e,n){d[e]=n,a.submitCheck({context:c,data:d,type:t.type,success:t.success,failure:t.failure,dialog:i},s.phonestatus)})}).on("click",'[data-type="phonenumber"]',function(){DYS.sub({action_code:"click_testphone_inphone",ext:{ver_type:a.ver_type}})}).on("change",'[data-type="phonenumber"]',function(){if(s&&s.phonestatus&&s.mobile_phone){if(phoneVal=n.find('[data-type="phonenumber"]').val(),""===e.trim(phoneVal))return e.dy_dialog.tips_black("请输入手机号！",a.tipParam),void DYS.sub({action_code:"show_testphone_fail",ext:{ver_type:a.ver_type}});if(!/^\d{1,11}$/.test(phoneVal))return e.dy_dialog.tips_black("手机号格式有误！",a.tipParam),void DYS.sub({action_code:"show_testphone_fail",ext:{ver_type:a.ver_type}});d.mobile_phone=phoneVal}}),s.phonestatus&&s.mobile_phone&&DYS.sub({action_code:"show_testphone",ext:{ver_type:a.ver_type}})},onHide:function(){this.dailogContent.off()}})):402==i.result&&(e.dy_dialog('<p>亲爱<span class="orange">'+o.get("sys.nickname")+'</span>用户，您的账号今天有多次异常操作，为了您的账号安全，已限制您<span class="orange">今天不能在非常用环境上</span>发弹幕及消费鱼丸鱼翅，请改天再来吧！</p><p>如给您带来不便，请您谅解==！</p>',{title:"账号安全风险",className:"checklimit",mask:1,zIndex:503,buttons:[{content:"关闭",callback:function(){this.hide()}}]}),t.failure(i))},"json").then(function(){a.ajaxing=null}))},submitCheck:function(t){var a=this,i="disabled",s=(t.dialog,a.hasPhone),n=DYS.sub.getPublicExt();t.data.ver_type=a.ver_type,t.data.dzh_type=n.ext.dzh_type,t.data.page_code=n.page_code,t.data.roomid=o.get("room.room_id");var r={type:"post",dataType:"json",context:t.context,url:"/api/remote_verify/verify_Info",data:t.data,beforeSend:function(){this.addClass(i)},complete:function(){this.removeClass(i)},error:function(){e.dy_dialog.tips_black("验证失败！",a.tipParam),t.failure(),s&&DYS.sub({action_code:"show_testphone_fail",ext:{ver_type:a.ver_type}})},success:function(i){200==i.result?(e.dy_dialog.tips_black("验证成功！",{mask:1,className:"tips_blacksuccess",zIndex:503}),t.success(i),s&&DYS.sub({action_code:"show_testphone_succ",ext:{ver_type:a.ver_type}}),a.checkDialog.hide()):402==i.result?(e.dy_dialog.tips_black("验证次数达到上限，明天再来吧！",a.tipParam),t.failure(i),s&&DYS.sub({action_code:"show_testphone_succ",ext:{ver_type:a.ver_type}}),a.checkDialog.hide()):(e.dy_dialog.tips_black(i.msg,a.tipParam),s&&i.phone_fail&&DYS.sub({action_code:"show_testphone_fail",ext:{ver_type:a.ver_type}}),t.failure(i))}};t.context.hasClass(i)||e.ajax(r)},getCSRFCookie:function(t){var a=this,i=n.get(o.get("sys.tvk")),s=o.get("sys.tn");return i?void(t&&t(s,i)):void e.ajax({url:"/curl/csrfApi/getCsrfCookie",type:"GET",dataType:"json",success:function(e){0===e.error&&a.getCSRFCookie(t)}})}},d={init:function(){l.init()},checkPhone:function(e){e.success=e.success||function(){},e.failure=e.failure||function(){},l.getPhone(e)}};return d}),define("douyu/com/polyfill",function(){for(var e=0,t=["ms","moz","webkit","o"],a=t.length,i=0;a>i;++i)window.requestAnimationFrame=window.requestAnimationFrame||window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window.cancelAnimationFrame||window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,a){var i=(new Date).getTime(),s=Math.max(0,16-(i-e)),n=window.setTimeout(function(){t(i+s)},s);return e=i+s,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){window.clearTimeout(e)})}),define("douyu/com/fps",["shark/class","douyu/com/polyfill"],function(e){var t,a=e({init:function(){this.fps=0,this.history=[],this.historyLength=10,this.frames=0,this.startTime=(new Date).getTime()},getFPS:function(){return this.fps},getHistory:function(e){return this.history.slice(0,e||this.historyLength)},start:function(){this.animationFrameId||this.loop()},stop:function(){this.animationFrameId&&(window.cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)},loop:function(){var e=this;e.step(),e.animationFrameId=window.requestAnimationFrame(function(){e.loop()})},step:function(){var e,t=(new Date).getTime(),a=t-this.startTime;this.frames++,a>=1e3&&(e=Math.round(1e3*this.frames/a),this.fps=e>60?60:e,this.frames=0,this.startTime=t,this.updateHistory())},updateHistory:function(){this.history.length>this.historyLength&&this.history.splice(0,1),this.history.push({fps:this.fps,time:(new Date).getTime()})}});return t||(t=new a),{start:function(){return t.start()},stop:function(){return t.stop()},getFPS:function(){return t.getFPS()},getHistory:function(){return t.getHistory(arguments)}}}),define("douyu/page/room/normal/mod/fans-medal-config",["jquery","shark/observer","douyu/context","douyu/com/exjsonp"],function(e,t,a,i){var s={config:{resourceUrl:a.get("sys.webconfUrl")+"resource/common/fans_medal_web.json"},init:function(){var a=this;a.deferred=e.Deferred(),i.load(a.config.resourceUrl,"fansMedalConfig",function(i){var s,n,o,r={},l={},d=0;if(i){for(s=i.length;s>d;d++){n=i[d],o=n.room_id||0,l=r[o],e.isPlainObject(l)||(l={}),l[d]={};for(var c=0;30>=c;c++)1>c?l[c]={bg:n.resource.lv0.bg,md:n.resource.lv0.md}:5>=c?l[c]={bg:n.resource.lv1_lv5.bg,md:n.resource.lv1_lv5.md}:10>=c?l[c]={bg:n.resource.lv6_lv10.bg,md:n.resource.lv6_lv10.md}:15>=c?l[c]={bg:n.resource.lv11_lv15.bg,md:n.resource.lv11_lv15.md}:20>=c?l[c]={bg:n.resource.lv16_lv20.bg,md:n.resource.lv16_lv20.md}:25>=c?l[c]={bg:n.resource.lv21_lv25.bg,md:n.resource.lv21_lv25.md}:29>=c?l[c]={bg:n.resource.lv26_lv29.bg,md:n.resource.lv26_lv29.md}:l[c]={bg:n.resource.lv30.bg,md:n.resource.lv30.md};r[o]=l,l=null}t.trigger("crazy.fans.config.data",r),a.deferred.resolve(r),r&&t.trigger("crazy.fans.config.data.back")}})}};return{init:function(){s.init()},getData:function(){return s.deferred}}}),define("douyu/page/room/normal/mod/chat-noble",["jquery","shark/observer","shark/util/lang/1.0","shark/util/template/2.0","shark/util/flash/data/1.0","douyu/context","douyu/page/room/base/api"],function(e,t,a,i,s,n,o){var r={avatarDomain:n.get("sys.avatar_url"),defaultAvatar:a.string.format("{0}/app/douyu/res/com/defaultAvatar.png?20161229",n.get("sys.web_url")),className:{scroll:"status--scroll",scrollMax:"status--scroll-max"},webUrl:n.get("sys.web_url"),resourceUrl:n.get("sys.resource_url"),nobleConfig:n.get("room.nobleConfig"),nobleTotalInfo:null},l={init:function(t){this.config=e.extend(!0,{isNoble:!1,isInProtected:!1,trial:0,maxUserLevel:120,maxListLength:20,minListLength:3,target:'[data-fans="target"]',total:'[data-noble="number"]',callback:function(){}},t),this.renderNobleToatlTpl=this.renderNobleToatlList(),e.isFunction(this.config.callback)&&this.config.callback.call(this),this.$total=e(this.config.total),this.$target=e(this.config.target),this.$target.length&&(this.$target.find('[data-fans="noble"]').html(this.render()),this.$noble=this.$target.find('[ selector="noble-main"]'),this.$list=this.$noble.find('[selector="list"]'),this.initInterface(),this.initScrollbar())},initScrollbar:function(){var e=this;e.$list.mCustomScrollbar({alwaysShowScrollbar:2,mouseWheel:{scrollAmount:200,normalizeDelta:!0},callbacks:{whileScrolling:function(){e.$noble[this.mcs.top===e.config.scrollTop?"addClass":"removeClass"](r.className.scrollMax)},onScrollStart:function(){e.$list.addClass(r.className.scroll)},onScroll:function(){e.$list.removeClass(r.className.scroll)},onTotalScroll:function(){e.config.scrollTop=this.mcs.top,e.$noble[e.config.isShowInfo?"addClass":"removeClass"](r.className.scrollMax)}}})},render:function(){var e,t,s;return e=a.string.join('<div class="noble-box--main" selector="noble-main">','<div class="main--tips">',"{{if (isNoble || isInProtected) && trial != 1}}",'<div class="tips--main">续费贵族，尊享荣耀特权</div>\n','<a class="btn--normal" href="javascript:;" selector="noble-buy">续费贵族</a>',"{{else}}",'<div class="tips--main">支持<strong title="{{anchorName}}">{{anchorName}}</strong>，成为斗鱼贵族</div>\n','<a class="btn--normal" href="javascript:;" selector="noble-buy">开通贵族</a>',"{{/if}}","</div>",'<div class="main--rank-list" selector="list">','<ul class="r-list clearfix" data-type="list">','<li class="contribution--noresult">主播很可怜，暂无贵族用户</li>',"</ul>",'<div class="s-noble-count" data-flag="noble-total-wrap" style="display:none;">','<div class="noble-count-title">本房间莅临<span class="special">贵族人数</span></div>','<ul class="noble-rank-items" data-flag="noble-total-list">',"</ul>","</div>","</div>","</div>","</div>"),s=i.compile(e),t=s({isNoble:this.config.isNoble,isInProtected:this.config.isInProtected,trial:this.config.trial,anchorName:n.get("room.owner_name"),maxListLength:this.config.maxListLength})},renderList:function(e){var t,s,n;return t=a.string.join("{{if list.length}}","{{each list as item}}","{{if $index < 3}}",'<li class="contribution-item contribution-item-top contribution-item-{{$index + 1}}">',"{{if item.isReality}}",'<a href="javascript:;" class="js-nick" is-show-super-icon="{{item.sahf}}" data-rel="user-info" avatar="{{item.icon}}" rel="{{item.uid}}" gid="{{item.pg}}" data-level="{{item.lv}}" data-noble="{{item.nobleLevel}}">','<span class="contribution-item-avatar">','<img src="{{item.avatar}}" alt="{{item.nickname}}">','<i class="contribution-item-icon"></i>',"</span>",'<span class="r-nick" title="{{item.nickname}}">{{item.nickname}}</span>',"{{if item.nobleIcon}}",'<span class="noble-level"><img src="{{item.nobleIcon}}" alt="{{item.nobleName}}"></span>',"{{/if}}","</a>","{{else}}",'<span class="contribution-item-avatar">','<img src="{{item.avatar}}" alt="{{item.nickname}}">','<i class="contribution-item-icon"></i>',"</span>",'<span class="r-nick" title="{{item.nickname}}">{{item.nickname}}</span>',"{{/if}}","</li>","{{else}}","{{if $index == 3}}",'<li class="contribution-item contribution-item-{{$index + 1}}">',"{{else}}",'<li class="contribution-item">',"{{/if}}",'<a href="javascript:;" class="js-nick" is-show-super-icon="{{item.sahf}}" data-rel="user-info" avatar="{{item.icon}}" rel="{{item.uid}}" gid="{{item.pg}}" data-level="{{item.lv}}" data-noble="{{item.nobleLevel}}">',"{{if item.nobleIcon}}",'<span class="noble-level"><img src="{{item.nobleIcon}}" alt="{{item.nobleName}}"></span>',"{{/if}}",'<span class="r-nick" title="{{item.nickname}}">{{item.nickname}}</span>',"</a>","</li>","{{/if}}","{{/each}}","{{else}}",'<li class="contribution--noresult">主播很可怜，暂无贵族用户</li>',"{{/if}}"),n=i.compile(t),s=n({list:this.dataHandler(e)})},renderNobleToatlList:function(){var e=["{{ each nobleTotalList as item index }}","{{ if (item.num > 0) }}",'<li class="noble-rank-item noble-rank-item0{{ item.lev }}">','<img src="{{ item.icon }}" class="noble-rank-img">',"{{ if (item.num > 9999) }}",'<span class="noble-rank-nums">9999+</span>',"{{ else }}",'<span class="noble-rank-nums">{{ item.num }}</span>',"{{ /if }}","</li>","{{ /if }}","{{ /each }}"].join(""),t=i.compile(e);return t},dataHandler:function(i){var o=this,l=o.config.maxUserLevel,d=o.config.maxListLength,c=o.config.minListLength,u=e.isArray(i)?i:[],g=0,m=0,p=null,f={},h=[];for(u=u.slice(0,d),g=u.length,g>0&&c>g&&(g=c),g>=d?o.config.isShowInfo=!0:o.config.isShowInfo=!1;g>m;m++)p=u[m],p||h.push({isReality:!1,nickname:"虚位以待",avatar:r.defaultAvatar}),p&&p.value&&(p=s.decode(p.value).too(),p.isReality=!0,
p.nn&&(p.nickname=p.nn),p.nobleLevel=parseInt(p.ne,10)||0,f=r.nobleConfig[p.nobleLevel],f&&f.symbol&&(p.nobleIcon=n.get("sys.resource_url")+f.symbol.web_symbol_pic1||"",p.nobleName=f.symbol.name||"贵族用户"),p.icon?p.avatar=a.string.format("{0}upload/{1}_middle.jpg",r.avatarDomain,p.icon):p.avatar=r.defaultAvatar,p.lv>0?p.lv=p.lv>l?l:p.lv:p.lv=1,t.trigger("mod.center.usergroup.set",p.uid,{pg:p.pg,rg:p.rg}),h.push(p));return h},updateNobleTotal:function(e){var t=parseInt(e,10)||0;t>9999&&(t="9999+"),this.$total.html(t)},handleNobleTotalList:function(){for(var e,t,a=r.nobleTotalInfo||{},i=r.nobleConfig||{},n=[],o=s.isArray(a.list)?s.decode(a.list):[{value:a.list}],l=0;l<o.length;l++)t=o[l],t&&t.value&&(t=s.decode(t.value).too(),e=i[t.lev]||{},t.icon=e.symbol&&e.symbol.web_symbol_pic2?r.resourceUrl+e.symbol.web_symbol_pic2:r.webUrl+"/app/douyu/res/page/room-normal/noble-count/icon-0"+t.lev+".png",n.push(t));return a.nList=n,n},appendNobleTotalList:function(e){var t=r.nobleTotalInfo||{},a=this.$target.find('[data-flag="noble-total-list"]'),i=this.renderNobleToatlTpl({nobleTotalList:t.nList||[]});a.html(i),t.nList&&t.nList.length>=7?a.addClass("noble-rank-full"):a.removeClass("noble-rank-full"),this.$target.find('[data-flag="noble-total-wrap"]').show()},updateNobleTotalList:function(){var e=r.nobleTotalInfo||{};e.sum>20&&e.list?(this.handleNobleTotalList(),this.appendNobleTotalList()):this.$target.find('[data-flag="noble-total-wrap"]').hide()},initInterface:function(){var e=this;o.exe("js_getnoble",s.encode([{name:"type",value:"get_online_noble_list"},{name:"rid",value:n.get("room.room_id")}])),o.reg("room_data_handler",function(a){var i=s.decode(a).too();"online_noble_list"===i.type&&(i.num&&e.updateNobleTotal(i.num),e.config.prevData!==i.nl&&(e.config.prevData=i.nl,i.nl?e.$target.find('[data-fans="noble"] [data-type="list"]').html(e.renderList(s.isArray(i.nl)?s.decode(i.nl):[{value:i.nl}])):e.$target.find('[data-fans="noble"] [data-type="list"]').html(e.renderList()),e.$list.mCustomScrollbar("update")),t.trigger("chat.fans.change.tab.show",{noble:i.nl})),"noble_num_info"===i.type&&(r.nobleTotalInfo=i,i.sum>=0&&e.updateNobleTotal(i.sum),e.updateNobleTotalList())})}};return l}),define("douyu/page/room/normal/mod/chat-rank",["jquery","shark/observer","shark/util/lang/1.0","shark/util/template/2.0","shark/util/flash/data/1.0","douyu/context","douyu/page/room/base/api"],function(e,t,a,i,s,n,o){var r={avatarDomain:n.get("sys.avatar_url"),defaultAvatar:a.string.format("{0}/app/douyu/res/com/defaultAvatar.png?20161229",n.get("sys.web_url")),nobleConfig:n.get("room.nobleConfig")},l={formatNumber:function(e){var t=0,a=e.unit||"";switch(a){case"千万":t=7;break;case"百万":case"t":case"T":t=6;break;case"万":t=4;break;case"千":case"k":case"K":t=3;break;case"百":t=2}return parseFloat(Number(e.number)||0/Math.pow(10,t)).toFixed(e.precision||0)+(e.isUnit?a:"")}},d={init:function(t){this.config=e.extend(!0,{hasInvisible:!1,isFaceScore:!1,maxUserLevel:120,maxListLength:10,target:'[data-fans="target"]',callback:function(){}},t),e.isFunction(this.config.callback)&&this.config.callback.call(this),this.$target=e(this.config.target),this.$rankAllPop||(this.$rankAllPop=e(a.string.join('<div class="rank-all-pop hide">','<div class="rank-all-container">','<div class="rank-all-header">','<a data-rank="hideallrank" href="javascript:;" class="rank-all-close"></a>',"</div>",'<div class="rank-all-content f-cn" data-fans="all"></div>',"</div>","</div>")),e("#js-fans-rank").before(this.$rankAllPop),this.$target=this.$target.add(this.$rankAllPop)),this.$target.length&&(this.$weekRank=this.$target.find('[data-fans="week"]').html(this.render(1)),this.$target.find('[data-fans="all"]').html(this.render()),this.initUserRole(),this.initInterface(),this.bindEvents())},initUserRole:function(){this.isAnchor=String(n.get("sys.uid"))===String(n.get("room.owner_uid")),this.isSuper=5===parseInt(n.get("sys.groupid"),10)},render:function(e){var t,s,n;return t=a.string.join("{{if isWeek }}",'<div class="rank-all-trigger">',"<span>点击右侧查看详情</span>",'<a data-rank="showallrank" href="javascript:;">贡献总榜 ></a>',"</div>","{{/if}}",'<ul class="r-list clearfix" data-type="list">','<li class="contribution--noresult"></li>',"</ul>","{{if isWeek && hasInvisible }}",'<div class="noble-invisible">','<div class="noble-invisible-container main--tips">','<div class="noble-invisible-tips tips--main">贵族用户可以设置榜单匿名啦~</div> ','<div class="noble-invisble-enter">','<span class="noble-invisble-enter-tips">贡献榜隐身</span>','<label class="noble-invisible-trigger btn--toggle status--checked" selector="toggle">',"<em>",'<input type="checkbox">','<span class="icon--btn-toggle"></span>',"</em>","</label>","</div>","</div>","</div>","{{/if}}"),n=i.compile(t),s=n({hasInvisible:this.config.hasInvisible,isWeek:e})},renderList:function(e,t){var s,n,o;return s=a.string.join("{{if list.length}}","{{each list as item}}","{{if $index < 3}}","{{if item.isOwn}}",'<li class="contribution-item contribution-item-top contribution-item-{{$index + 1}}" selector="self">',"{{else}}",'<li class="contribution-item contribution-item-top contribution-item-{{$index + 1}}">',"{{/if}}",'<a href="javascript:;" class="js-nick" is-show-super-icon="{{item.sahf}}" data-ranktype="{{type}}" data-rel="user-info" avatar="{{item.icon}}" rel="{{item.uid}}" gid="{{item.pg}}" data-level="{{item.level}}" data-noble="{{item.nobleLevel}}" data-invisible="{{item.isInvisible}}" data-invisiblenick="{{item.nick}}">','<span class="contribution-item-avatar">','<img src="{{item.avatar}}">',"{{if item.isShowInvisible}}",'<span class="invisible--holder"><span class="invisible--holder-text">已隐身</span></span>',"{{/if}}",'<i class="contribution-item-icon"></i>',"</span>","{{if item.isInvisible}}",'<span class="r-nick status--invisible" title="{{item.nickname}}">{{item.nickname}}</span>',"{{else}}",'<span class="r-nick" title="{{item.nickname}}">{{item.nickname}}</span>',"{{/if}}","</a>","{{if item.isShowMedal}}","{{if item.nobleIcon}}",'<span class="noble-level"><img src="{{item.nobleIcon}}" alt="{{item.nobleName}}"></span>',"{{/if}}",'<span class="l-icon cuserlevel level-{{item.level}} {{item.imgType}} {{item.imgSize}}" data-uid="{{item.uid}}" title="用户等级：{{item.level}}" selector="user-level"></span>',"{{/if}}","{{if isFaceScore}}",'<span class="r-contribution" title="{{item.gold}}贡献">{{item.fgold}}贡献</span>',"{{/if}}","</li>","{{else}}","{{if $index == 3}}","{{if item.isOwn}}",'<li class="contribution-item contribution-item-{{$index + 1}}" selector="self">',"{{else}}",'<li class="contribution-item contribution-item-{{$index + 1}}">',"{{/if}}","{{else}}","{{if item.isOwn}}",'<li class="contribution-item" selector="self">',"{{else}}",'<li class="contribution-item">',"{{/if}}","{{/if}}","{{if isFaceScore}}",'<span class="r-contribution" title="{{item.gold}}贡献">{{item.fgold}}贡献</span>',"{{/if}}",'<i class="n-icon">{{$index + 1}}</i>',"{{if item.isShowMedal}}","{{if item.nobleIcon}}",'<span class="noble-level"><img src="{{item.nobleIcon}}" alt="{{item.nobleName}}"></span>',"{{/if}}",'<span class="l-icon cuserlevel level-{{item.level}} {{item.imgType}} {{item.imgSize}}" data-uid="{{item.uid}}" title="用户等级：{{item.level}}" selector="user-level"></span>',"{{/if}}",'<a href="javascript:;" class="js-nick" is-show-super-icon="{{item.sahf}}" data-ranktype="{{type}}" data-rel="user-info" avatar="{{item.icon}}" rel="{{item.uid}}" gid="{{item.pg}}" data-level="{{item.level}}" data-noble="{{item.nobleLevel}}" data-invisible="{{item.isInvisible}}" data-invisiblenick="{{item.nick}}">',"{{if item.isInvisible}}",'<span class="r-nick status--invisible" title="{{item.nickname}}">',"{{if item.isShowInvisible}}",'<span class="r-nickname">{{item.nickname}}</span>(已隐身)',"{{else}}","{{item.nickname}}","{{/if}}","</span>","{{else}}",'<span class="r-nick" title="{{item.nickname}}">{{item.nickname}}</span>',"{{/if}}","</a>","{{if item.trendTitle}}",'<span class="r-img {{item.trend}}" title="{{item.trendTitle}}"></span>',"{{else}}",'<span class="r-img {{item.trend}}"></span>',"{{/if}}","</li>","{{/if}}","{{/each}}","{{else}}",'<li class="contribution--noresult"></li>',"{{/if}}"),o=i.compile(s),n=o({list:this.dataHandler(e),isFaceScore:this.config.isFaceScore,type:t})},bindEvents:function(){var e=this;this.$weekRank.on("click",'[data-rank="showallrank"]',function(){e.$rankAllPop.removeClass("hide"),t.trigger("dys",{key:"dys.room.rank.week.all.click",is_anch:e.isAnchor?1:0})}),this.$rankAllPop.on("click",'[data-rank="hideallrank"]',function(){e.$rankAllPop.addClass("hide")})},dataHandler:function(i){var o=this,d=o.config.maxUserLevel,c=o.config.maxListLength,u=e.isArray(i)?i:[],g=0,m=0,p=null,f={},h=[];for(u=u.slice(0,c),g=u.length;g>m;m++)if(p=u[m],p&&p.value){switch(p=s.decode(p.value).too(),p.isShowMedal=!0,String(n.get("sys.uid"))===String(p.uid)&&(p.isOwn=!0),p.isInvisible=parseInt(p.ih,10)||0,p.isInvisible&&(p.isOwn||o.isAnchor||o.isSuper?(p.nick=p.nickname+"(已隐身)",p.isShowInvisible=!0,p.isShowMedal=!0):p.isShowMedal=!1),p.nobleLevel=parseInt(p.ne,10)||0,f=r.nobleConfig[p.nobleLevel],f&&f.symbol&&(p.nobleIcon=n.get("sys.resource_url")+f.symbol.web_symbol_pic2||"",p.nobleName=f.symbol.name||"贵族用户"),p.gold=p.gold?p.gold/100:0,p.gold>=Math.pow(10,6)?p.fgold=l.formatNumber({number:p.gold,unit:"万"}):p.fgold=p.gold,p.level>0?p.level=p.level>d?d:p.level:p.level=1,p.imgType=p.level>=70?"":"level-bgpng",p.imgSize=p.level>=100?"level-size2":" level-size1",p.icon?p.avatar=a.string.format("{0}upload/{1}_middle.jpg",r.avatarDomain,p.icon):p.avatar=r.defaultAvatar,parseInt(p.rs,10)){case 1:p.trend="rank-up";break;case-1:p.trend="rank-down";break;case 0:p.trend="rank-normal"}p.lrk>=1&&p.lrk<=c?p.trendTitle="之前排名第"+p.lrk+"位":p.trendTitle="之前未上榜",t.trigger("mod.center.usergroup.set",p.uid,{pg:p.pg,rg:p.rg}),h.push(p)}return h},updateCurrentUserLevel:function(t){var i=this.config.maxUserLevel,s=parseInt(t,10),n="level-next-1";s&&i>=s&&(n=a.string.format("level-{0}",s)),this.$target.find('[selector="self"]').each(function(){e(this).find('[selector="user-level"]').removeClass(function(){return this.className.match(/level-\d*/g).join(" ")}).addClass(n).attr({title:"用户等级："+s}),e(this).find('[data-rel="user-info"]').data("level",s)})},initInterface:function(){var e=this;o.exe("js_rewardList"),o.reg("room_data_cqrank",function(a){var i=s.decode(a).too(),n=i.list,o=i.list_all;"ranklist"===i.type&&(e.config.prevWeek!==n&&(e.config.prevWeek=n,e.$target.find('[data-fans="week"] [data-type="list"]').html(e.renderList(s.isArray(n)?s.decode(n):[{value:n}],"week"))),e.config.prevAll!==o&&(e.config.prevAll=o,e.$target.find('[data-fans="all"] [data-type="list"]').html(e.renderList(s.isArray(o)?s.decode(o):[{value:o}],"all"))),t.trigger("chat.fans.change.tab.show",{week:n,all:o}))}),o.reg("room_data_cqrankupdate",function(e){t.trigger("mod.chat.msg.res.rankupdate",e)}),o.reg("room_data_rankgap",function(e){t.trigger("mod.chat.msg.res.rankgap",e)}),t.on("mod.chatrank.cqrankupdate",function(t){e.updateCurrentUserLevel(t)}),o.reg("room_data_handler",function(e){var a=s.decode(e).too();"hide_status_change"===a.type&&2===parseInt(a.hide_type,10)&&t.trigger("mod.fans.rank.invisible.change",{isInvisible:parseInt(a.is_hide,10)||0})})}};return d}),define("douyu/page/room/normal/mod/fans-medal-rank",["jquery","douyu/context","shark/observer","shark/util/cookie/1.0","shark/util/lang/1.0","shark/util/template/1.0","shark/util/flash/data/1.0","douyu/page/room/base/api","douyu/page/room/normal/mod/fans-medal-config"],function(e,t,a,i,s,n,o,r,l){var d={},c={avatarDomain:t.get("sys.avatar_url"),defaultAvatar:s.string.format("{0}/app/douyu/res/com/defaultAvatar.png?20110329",t.get("sys.web_url")),isOpenfans:t.get("room.is_set_fans_badge"),currentRoomId:parseInt(t.get("room.room_id"),10),fansSpecialUrl:"http://www.douyu.com/t/fans"},u={selfSource:{is_cbdg:"",is_bdg:"",bdg_id:"",cbdg_id:""},init:function(t){this.config=e.extend(!0,{maxListLength:10,minListLength:3,maxLvel:30,hasInvisible:!1,target:'[data-fans="target"]',callback:function(){}},t),e.isFunction(this.config.callback)&&this.config.callback.call(this),this.$target=e(this.config.target),this.$target.length&&(this.$fans=this.$target.find('[data-fans="fans"]'),this.$fansTab=e('[data-fans="trigger"]').find('[data-fans="fans"]'),this.render(),this.bindEvent())},render:function(){var e,a,i;e=s.string.join('<div class="fans-myself-rank unopened clearfix" data-self="info">',"<span>您还未获得该主播的粉丝徽章</span>",'<a target="_blank" data-fans="get" href="<%= fansSpecialUrl %>">如何获得粉丝徽章?</a>',"</div>",'<ul class="r-list clearfix" data-type="list">',"<% if (isOpenfans) {%>",'<li class="no-fans-rank"></li>',"<%} else {%>",'<li class="no-open-fans"></li>',"<% } %>","</ul>",'<div class="contribution-item-last" data-list="last">','<div class="fans-total-num">粉丝总人数：<span data-fans="allnum">0</span></div>',"<% if (hasInvisible) { %>",'<div class="main--tips">','<div class="tips--main">粉丝榜单隐身</div>','<label class="btn--toggle" selector="toggle">','<em><input type="checkbox"><span class="icon--btn-toggle"></span></em>',"</label>","</div>","<% } %>",'<div class="fans-rank-num">本周亲密度排行第<span data-fans="rank-num">--</span>位</div>',"</div>"),i=n.compile(e),a=i({isOpenfans:c.isOpenfans,hasInvisible:this.config.hasInvisible,fansSpecialUrl:c.fansSpecialUrl}),this.$fans.html(a),this.$selfInfo=this.$fans.find('[data-self="info"]'),this.$fansList=this.$fans.find('[data-type="list"]'),this.$listLast=this.$fans.find('[data-list="last"]'),this.$fansNumber=this.$fans.find('[data-fans="allnum"]'),this.$fansRankNum=this.$fans.find('[data-fans="rank-num"]'),t.get("room.owner_uid")==t.get("sys.uid")&&this.$selfInfo.hide(),this.initInterface()},updateData:function(e){parseInt(e,10)>=1&&this.$listLast.show(),this.$fansNumber.html(e)},updateRank:function(e){e&&this.$fansRankNum.text(e)},renderSelfInfo:function(e){var a,i,o,r=this;e&&0===parseInt(u.isOpenfans,10)&&(u.isOpenfans=1),a=s.string.join("<span>",'<i class="my-rank-num" data-rank="bl">',"<% if (pos) { %>","<% if (pos <= 500) { %>","<%= pos %>","<% } else { %>","500+","<% } %>","<% } %>","</i>","<% if (fansMedal["+c.currentRoomId+"]) { %>",'<span class="fans-badge-icon" data-ui="lv" data-ui-level="<%= bl %>">','<span class="fans-icon-name" data-rank="bg" style="background-image:url(',"<%= fansMedal["+c.currentRoomId+"][bl].bg %>",')"><i data-rank="bnn"><%= bnn %></i></span>','<span class="fans-badge-level" data-rank="md" style="background-image:url(',"<%= fansMedal["+c.currentRoomId+"][bl].md %>",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'<% } else if (fansMedal["all"]) { %>','<span class="fans-badge-icon" data-ui="lv" data-ui-level="<%= bl %>">','<span class="fans-icon-name" data-rank="bg" style="background-image:url(<%= fansMedal["all"][bl].bg %> ',')"><i data-rank="bnn"><%= bnn %></i></span>','<span class="fans-badge-level" data-rank="md" style="background-image:url(<%= fansMedal["all"][bl].md %>',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","<% } else { %>",'<span class="fans-badge-icon" data-ui="lv" data-ui-level="<%= bl %>">','<span class="fans-icon-name"><i data-rank="bnn"><%= bnn %></i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","<% } %>",'<em class="my-name"><%= username %></em>',"</span>",'<a target="_blank" data-fans="get" href="<%= fansSpecialUrl %>">快速提升粉丝等级</a>'),o=n.compile(a),i=o({username:t.get("sys.nickname"),pos:e.pos||r.selfPos,bnn:e.bnn,bl:e.bl||r.selfBl,fansMedal:d||{},fansSpecialUrl:c.fansSpecialUrl}),this.$selfInfo.html(i),this.$selfInfo.removeClass("unopened"),this.$selfRanking=this.$selfInfo.find('[data-rank="bl"]'),this.$selfMedalLevel=this.$selfInfo.find('[data-ui="lv"]'),this.$selfMedalBg=this.$selfInfo.find('[data-rank="bg"]'),this.$selfMedalMd=this.$selfInfo.find('[data-rank="md"]')},renderFansList:function(e,t){var a,i,o,r;return r=this.handleRankListData(e,t),a=s.string.join("<% for (var i = 0;i < data.length; i++) {%>","<% if (i < 3) {%>","<% if (data[i].isRealUser) { %>",'<li class="contribution-item contribution-item-top contribution-item-<%= i + 1 %>" data-rel="user-info" data-fansMedal-lev="<%= data[i].lv %>" data-fansMedal-nick="<%= data[i].fansId %>" data-level="<%= data[i].lev %>">','<a class="js-nick" href="javascript:;" is-show-super-icon="<%= data[i].sahf%>" avatar="<%= data[i].ic%>" gid="<%= data[i].pg %>" rel="<%= data[i].uid %>" data-invisiblenick="<%= data[i].nickname %>" data-invisible="<%= data[i].hd %>"  data-noble="<%= data[i].nl %>">','<span class="contribution-item-avatar">','<img src="<%= data[i].avatar%>">',"<% if (data[i].isShowInvisible) { %>",'<span class="invisible--holder">','<span class="invisible--holder-text">已隐身</span>',"</span>","<% } %>",'<i class="contribution-item-icon"></i></span>',"<% if (data[i].isVisibility == 1) { %>",'<span class="r-nick status--invisible" title="<%= data[i].nickname %>" data-invisiblenick="<%= data[i].nickname %>">',"<%= data[i].nickname %>","</span>","<% } else { %>",'<span class="r-nick" title="<%= data[i].nickname %>" data-invisiblenick="<%= data[i].nickname %>">',"<%= data[i].nickname %>","</span>","<% } %>","<% if (data[i].isShowMedal){%>","<% if (fansMedal["+c.currentRoomId+"]) { %>",'<span class="fans-badge-icon" data-ui-level="<%= data[i].lv %>">','<span class="fans-icon-name" style="background-image:url(',"<%= fansMedal["+c.currentRoomId+"][data[i].lv].bg %>",')"><i><%= data[i].fansId %></i></span>','<span class="fans-badge-level" style="background-image:url(',"<%= fansMedal["+c.currentRoomId+"][data[i].lv].md %>",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'<% } else if (fansMedal["all"]) { %>','<span class="fans-badge-icon" data-ui-level="<%= data[i].lv %>">','<span class="fans-icon-name" style="background-image:url(','<%= fansMedal["all"][data[i].lv].bg %>',')"><i><%= data[i].fansId %></i></span>','<span class="fans-badge-level" style="background-image:url(','<%= fansMedal["all"][data[i].lv].md %>',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","<% } else { %>",'<span class="fans-badge-icon" data-ui-level="<%= data[i].lv %>">','<span class="fans-icon-name"><i><%= data[i].fansId %></i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","<% } %>","<%}%>","</a>","</li>","<% }else{%>",'<li class="contribution-item contribution-item-top contribution-item-<%= i + 1 %>" data-rel="user-info" data-fansMedal-lev="<%= data[i].lv %>" data-fansMedal-nick="<%= data[i].fansId %>" data-level="<%= data[i].lev %>">','<a class="js-nick" href="javascript:;" is-show-super-icon="<%= data[i].sahf%>" avatar="<%= data[i].ic%>" gid="<%= data[i].pg %>" rel="<%= data[i].uid %>" data-invisiblenick="<%= data[i].nickname %>" data-invisible="<%= data[i].hd %>"  data-noble="<%= data[i].nl %>">','<span class="contribution-item-avatar">','<img src="<%= data[i].avatar %>">','<i class="contribution-item-icon"></i>',"</span>",'<span class="r-nick" title="<%= data[i].nickname %>">',"<%= data[i].nickname %>","</span>","</a>","</li>","<%}%>","<% }else {%>","<%if (i == 3){%>",'<li class="contribution-item contribution-item-<%= i + 1 %>" data-rel="user-info" data-fansMedal-lev="<%= data[i].lv %>" data-fansMedal-nick="<%= data[i].fansId %>" data-level="<%= data[i].lev %>">',"<%} else {%>",'<li class="contribution-item" data-rel="user-info" data-fansMedal-lev="<%= data[i].lv %>" data-fansMedal-nick="<%= data[i].fansId %>" data-level="<%= data[i].lev %>">',"<% } %>",'<i class="n-icon"><%= i+1 %></i>',"<% if (data[i].isShowMedal) { %>","<% if (fansMedal["+c.currentRoomId+"]) { %>",'<span class="fans-badge-icon" data-ui-level="<%= data[i].lv %>">','<span class="fans-icon-name" style="background-image:url(',"<%= fansMedal["+c.currentRoomId+"][data[i].lv].bg %>",')"><i><%= data[i].fansId %></i></span>','<span class="fans-badge-level" style="background-image:url(',"<%= fansMedal["+c.currentRoomId+"][data[i].lv].md %>",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'<% } else if (fansMedal["all"]) { %>','<span class="fans-badge-icon" data-ui-level="<%= data[i].lv %>">','<span class="fans-icon-name" style="background-image:url(','<%= fansMedal["all"][data[i].lv].bg %>',')"><i><%= data[i].fansId %></i></span>','<span class="fans-badge-level" style="background-image:url(','<%= fansMedal["all"][data[i].lv].md %>',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","<% } else { %>",'<span class="fans-badge-icon" data-ui-level="<%= data[i].lv %>">','<span class="fans-icon-name"><i><%= data[i].fansId %></i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","<% } %>","<% } %>","<% if (data[i].isShowInvisible) { %>",'<span class="js-nick r-nick status--invisible" style="cursor: pointer;" title="<%= data[i].nickname %>" is-show-super-icon="<%= data[i].sahf%>" avatar="<%= data[i].ic%>" gid="<%= data[i].pg %>" rel="<%= data[i].uid %>" data-invisiblenick="<%= data[i].nickname %>" data-invisible="<%= data[i].hd %>"  data-noble="<%= data[i].nl %>">',"<%= data[i].nickname %>（已隐身）","</span>","<% } else { %>","<% if (data[i].isVisibility == 1) { %>",'<span class="js-nick r-nick status--invisible" style="cursor: pointer;" title="<%= data[i].nickname %>" is-show-super-icon="<%= data[i].sahf%>" avatar="<%= data[i].ic%>" gid="<%= data[i].pg %>" rel="<%= data[i].uid %>" data-invisiblenick="<%= data[i].nickname %>" data-invisible="<%= data[i].hd %>"  data-noble="<%= data[i].nl %>">',"<%= data[i].nickname %>","</span>","<% } else { %>",'<span class="js-nick r-nick" style="cursor: pointer;" title="<%= data[i].nickname %>" is-show-super-icon="<%= data[i].sahf%>" avatar="<%= data[i].ic%>" gid="<%= data[i].pg %>" rel="<%= data[i].uid %>" data-invisiblenick="<%= data[i].nickname %>" data-invisible="<%= data[i].hd %>"  data-noble="<%= data[i].nl %>">',"<%= data[i].nickname %>","</span>","<% } %>","<% } %>","</li>","<%}%>","<% } %>"),o=n.compile(a),i=o({data:r,fansMedal:d||{}})},handleRankListData:function(a,i){this.isAnchor=String(t.get("sys.uid"))===String(t.get("room.owner_uid")),this.isSuper=5===parseInt(t.get("sys.groupid"),10);var n=this,r=n.config.maxListLength,l=n.config.minListLength,d=n.config.maxLvel,u=e.isArray(a)?a:[],g=0,m=null,p=[];u=u.slice(0,r),g=u.length,g>0&&l>g&&(g=l);for(var f=0;g>f;f++)m=u[f],m||p.push({isRealUser:!1,nickname:"虚位以待",avatar:c.defaultAvatar}),m&&m.value&&(m=o.decode(m.value).too(),m.isRealUser=!0,String(t.get("sys.uid"))===String(m.uid)&&(m.isOwn=!0),i&&(m.fansId=i),m.nn&&(m.nickname=m.nn),m.ic?m.avatar=s.string.format("{0}upload/{1}_middle.jpg",c.avatarDomain,m.ic):m.avatar=c.defaultAvatar,m.bl>0?m.lv=m.bl>d?d:m.bl:m.lv=1,m.isVisibility=parseInt(m.hd,10)||0,m.isVisibility?m.isOwn||n.isAnchor||n.isSuper?(m.isShowInvisible=!0,m.isShowMedal=!0):m.isShowMedal=!1:m.isShowMedal=!0,p.push(m));return p},initInterface:function(){var t,i,s=this;r.reg("room_data_handler",function(n){var r=o.decode(n).too();l.getData().then(function(n){if(d=n,"frank"===r.type){if(r.list){if(s.$fansList.html(s.renderFansList(o.isArray(r.list)?o.decode(r.list):[{value:r.list}],r.bnn)),o.isArray(r.list)){t=o.decode(r.list);for(var l=0;l<t.length;l++)i=o.decode(t[l].value).too(),a.trigger("mod.center.usergroup.set",i.uid,{pg:i.pg,rg:i.rg})}else i=o.decode(r.list).too(),a.trigger("mod.center.usergroup.set",i.uid,{pg:i.pg,rg:i.rg});c.isOpenfans=1}else s.render();s.updateData(r.fc||0),a.trigger("chat.fans.change.tab.show",{fansMedal:r.list})}if("blst"===r.type){var u=o.isArray(r.list)?o.decode(r.list):[{value:r.list}],g=e.isArray(u)?u:[];s.handleDpData(r);for(var l=0;l<g.length;l++){var m=g[l];if(m&&m.value&&(m=o.decode(m.value).too(),parseInt(m.rid,10)===c.currentRoomId)){s.renderSelfInfo(m);break}}}if("ru"===r.type){var p="--";r.pos>0&&r.pos<=500?p=r.pos:r.pos>500&&(p="500+"),s.$selfRanking?s.$selfRanking.html(p):s.selfPos=p}if("gbi"===r.type&&(c.isOpenfans=1,s.selfSource.is_bdg=1,s.selfSource.is_cbdg=1,s.selfSource.cbdg_id=c.currentRoomId,parseInt(s.$fansNumber.html(),10)>=10&&s.$fansNumber.html(parseInt(s.$fansNumber.html(),10)+1),s.renderSelfInfo(r)),"synfim"===r.type){var f=d||{};c.isOpenfans=1,s.selfSource.is_bdg=1,s.selfSource.is_cbdg=1,s.selfSource.cbdg_id=c.currentRoomId,s.$selfMedalLevel.attr("data-ui-level",r.bl),f[c.currentRoomId]&&s.$selfMedalBg&&s.$selfMedalMd?(s.$selfMedalBg.css("background-image","url("+f[c.currentRoomId][r.bl].bg+")"),s.$selfMedalMd.css("background-image","url("+f[c.currentRoomId][r.bl].md+")")):f.all&&s.$selfMedalBg&&s.$selfMedalMd&&(s.$selfMedalBg.css("background-image","url("+f.all[r.bl].bg+")"),s.$selfMedalMd.css("background-image","url("+f.all[r.bl].md+")"))}if("wiru"===r.type){var h="--";r.pos>0&&r.pos<51?h=r.pos:r.pos>50&&(h="50+"),s.updateRank(h)}"obres"===r.type&&(0===parseInt(r.result,10)&&1===parseInt(r.ot,10)?s.selfSource.bdg_id=r.rid:0!==parseInt(r.result,10)||2!==parseInt(r.ot,10)&&3!==parseInt(r.ot,10)||(s.selfSource.bdg_id=0))})})},handleDpData:function(t){var a=t.wf?parseInt(t.wf,10):0,i=o.isArray(t.list)?o.decode(t.list):[{value:t.list}];1===parseInt(c.isOpenfans,10)&&(this.selfSource.cbdg_id=c.currentRoomId),0===a?this.selfSource.is_bdg=0:1!==a&&2!==a||(this.selfSource.is_bdg=1);for(var s=e.isArray(i)?i:[],n=0;n<s.length;n++){var r=s[n];r&&r.value&&(r=o.decode(r.value).too(),2===a&&0===n&&(this.selfSource.bdg_id=r.rid),parseInt(r.rid,10)===c.currentRoomId&&(this.selfSource.is_cbdg=1))}this.selfSource.cbdg_id||1!==parseInt(c.isOpenfans,10)||(this.selfSource.cbdg_id=c.currentRoomId),this.selfSource.is_cbdg||(this.selfSource.is_cbdg=0)},bindEvent:function(){var t=this;this.$selfInfo.on("click",'[data-fans="get"]',function(){1===parseInt(c.isOpenfans,10)&&(t.selfSource.cbdg_id=c.currentRoomId),a.trigger("dys",e.extend(!0,{key:"dys.click.fans.rank.getmoreinfo"},t.selfSource))}),this.$fansTab.on("click",function(){1===parseInt(c.isOpenfans,10)&&(t.selfSource.cbdg_id=c.currentRoomId),a.trigger("dys",e.extend(!0,{key:"dys.click.fans.rank"},t.selfSource))})}};return u}),define("douyu/page/room/normal/mod/chat-fans",["jquery","shark/observer","douyu/page/room/normal/mod/chat-noble","douyu/page/room/normal/mod/chat-rank","douyu/page/room/normal/mod/fans-medal-rank","douyu/context"],function(e,t,a,i,s,n){var o={type:{week:"week",all:"all",noble:"noble",fansMedal:"fans"},className:{isInvisible:"status--checked",isFaceScore:"status--face",isNoble:"status--noble",isHover:"status--hover"},nobleConfig:n.get("room.nobleConfig")||{}},r={status:{isInited:0},init:function(t){this.config=e.extend(!0,{target:"#js-fans-rank",currentClass:"cur",currentType:o.type.week,isAutoToggle:!1,isFaceScore:n.get("room.isVertical")||0,isNoble:!1,isInvisible:!1,hasInvisible:!1,onChange:function(){}},t),this.$fans=e(this.config.target),this.$fans.length&&(this.$trigger=this.$fans.find('[data-fans="trigger"]'),this.$target=this.$fans.find('[data-fans="target"]'),this.initInterface(),this.bindEvent())},initInterface:function(){var a=this;t.on("mod.noble.info.get.rank",function(e){"memberinfores"===e.type&&(a.config.isNoble=parseInt(e.nl,10)||0,a.config.isInProtected=parseInt(e.npts,10)||0,a.config.trial=parseInt(e["try"],10)||0,a.config.isNoble?a.config.hasInvisible=o.nobleConfig[a.config.isNoble].top_list_hide||0:a.config.hasInvisible=0,a.status.isInited||(a.initRely(),a.status.isInited=1))}),t.on("mod.fans.rank.invisible.change",function(e){a.config.isInvisible=Boolean(e.isInvisible),a.toggleInvisibleState()}),t.on("chat.fans.change.tab.show",function(t){a.config.source=e.extend(!0,{},a.config.source,t),a.toggleShow()}),t.on("chat.fans.change.tab.noble",function(e){1===parseInt(e.state,10)?(a.config.currentType=o.type.noble,a.show()):a.toggleShow()})},initRely:function(){var e=this,t=e.config;e.config.isFaceScore&&e.$fans.addClass(o.className.isFaceScore),e.config.hasInvisible&&e.$fans.addClass(o.className.isNoble),a.init({isNoble:t.isNoble,isInProtected:t.isInProtected,trial:t.trial,target:e.$target,total:e.$trigger.find('[data-noble="number"]')}),i.init({hasInvisible:t.hasInvisible,isFaceScore:t.isFaceScore,target:e.$target}),s.init({hasInvisible:t.hasInvisible,target:e.$target}),e.config.hasInvisible&&e.getInvisible()},toggleShow:function(){var e=this,t=e.config.source;e.config.isAutoToggle&&(t.week&&t.week.length?e.config.currentType=o.type.week:t.noble&&t.noble.length?e.config.currentType=o.type.noble:e.config.currentType=o.type.fansMedal),e.show()},show:function(){var e=this,a=e.config;e.$trigger.find("[data-fans]").removeClass(a.currentClass),e.$target.find("[data-fans]").removeClass(a.currentClass),e.$trigger.find('[data-fans="'+a.currentType+'"]').addClass(a.currentClass),e.$target.find('[data-fans="'+a.currentType+'"]').addClass(a.currentClass),a.onChange.call(e,a.currentType),t.trigger("mod.chat.height.change")},setInvisible:function(){var t=this;t.config.isSending||(t.config.isSending=!0,e.ajax({url:"/member/noble/setHideStatus",type:"POST",dataType:"json",async:!1,data:{type:2,rid:n.get("room.room_id"),status:t.config.isInvisible?0:1},error:function(){e.dialog.tips_black("网络错误！设置榜单隐身状态失败！")},success:function(a){0===parseInt(a.code,10)?(t.config.isInvisible=!t.config.isInvisible,t.toggleInvisibleState(),t.showToast()):e.dialog.tips_black(a.msg||"未知错误！设置榜单隐身状态失败！")},complete:function(){setTimeout(function(){t.config.isSending=!1},3e4)}}))},getInvisible:function(){var t=this;t.config.isSending=!0,e.ajax({url:"/member/noble/getHideStatus",type:"GET",dataType:"json",data:{type:2,rid:n.get("room.room_id")},error:function(){e.dialog.tips_black("网络错误！获取榜单隐身状态失败！"),t.config.isSending=!1},success:function(a){0===parseInt(a.code,10)?(t.config.isInvisible=Boolean(parseInt(a.status,10)||0),t.toggleInvisibleState()):e.dialog.tips_black(a.msg||"未知错误！获取榜单隐身状态失败！"),t.config.isSending=!1}})},toggleInvisibleState:function(){this.$target.find('[selector="toggle"]')[this.config.isInvisible?"addClass":"removeClass"](o.className.isInvisible)},showToast:function(){var t,a;"fans"===this.config.currentType?(t="粉丝榜隐身已解除",a="已在主播的粉丝榜中隐身"):(t="贡献榜隐身已解除",a="已在主播的贡献榜中隐身");var i=this.config.isInvisible?a:t,s=e('<div class="toast-box" selector="toast-box"><div class="toast-item"><span>'+i+"</span></div></div>");this.$target.find('[selector="toast-box"]').remove(),this.$target.append(s),setTimeout(function(){s.remove()},1500)},bindEvent:function(){var a=this,i=function(e){e.preventDefault(),e.stopPropagation()};a.$trigger.on("click.fans","[data-fans]",function(s){var r=e(this),l=r.data("fans");switch(a.config.isAutoToggle=!1,a.config.currentType!==l&&(a.config.currentType=l,a.show()),l){case o.type.week:t.trigger("dys",{key:"dys.room.rank.week.click",is_anch:String(n.get("sys.uid"))===String(n.get("room.owner_uid"))?1:0});break;case o.type.all:t.trigger("dys",{key:"dys.room.rank.all.click"});break;case o.type.noble:t.trigger("dys",{key:"dys.room.rank.noble.click"})}i(s)}),a.$target.on({mouseenter:function(){a.$fans.addClass(o.className.isHover)},mouseleave:function(){a.$fans.removeClass(o.className.isHover)}}).on("click.setInvisible",'[selector="toggle"]',function(e){i(e),a.setInvisible()}).on("click.buyNoble",'[selector="noble-buy"]',function(e){t.trigger("mod.normal.noble.buy"),a.config.isNoble?t.trigger("dys",{key:"dys.room.fans.noble.renewal",level:a.config.isNoble}):t.trigger("dys",{key:"dys.room.fans.noble.open"}),i(e)})}};return{init:function(e){r.init(e)}}}),define("douyu/page/room/normal/mod/chat-exp",["jquery","shark/class","shark/util/lang/1.0","shark/observer","shark/util/template/1.0","douyu/context","douyu/com/user"],function(e,t,a,i,s,n,o){var r={ratio:1366,smallScreenCol:6,bigScreenCol:7,emw:42,emh:42,emb:1,defaultThumbTop:2,state:{open:"open",close:"close"},defaultFaceListConfig:[{id:"101",type:"png",title:"666"},{id:"102",type:"png",title:"发呆"},{id:"103",type:"png",title:"拜拜"},{id:"104",type:"png",title:"晕"},{id:"105",type:"png",title:"弱"},{id:"106",type:"png",title:"傲慢"},{id:"107",type:"png",title:"开心"},{id:"108",type:"png",title:"奋斗"},{
id:"109",type:"png",title:"很酷"},{id:"110",type:"png",title:"流泪"},{id:"111",type:"png",title:"鄙视"},{id:"112",type:"png",title:"得意"},{id:"113",type:"png",title:"抠鼻"},{id:"114",type:"png",title:"亲亲"},{id:"115",type:"png",title:"偷笑"},{id:"116",type:"png",title:"口罩"},{id:"117",type:"png",title:"委屈"},{id:"118",type:"png",title:"难过"},{id:"119",type:"png",title:"吐血"},{id:"120",type:"png",title:"大怒"},{id:"121",type:"png",title:"赞"},{id:"122",type:"png",title:"睡觉"},{id:"123",type:"png",title:"骷髅"},{id:"124",type:"png",title:"调皮"},{id:"125",type:"png",title:"惊讶"},{id:"126",type:"png",title:"撇嘴"},{id:"127",type:"png",title:"拥抱"},{id:"128",type:"png",title:"背锅"},{id:"129",type:"png",title:"闭嘴"},{id:"130",type:"png",title:"吃药"},{id:"131",type:"png",title:"可怜"},{id:"132",type:"png",title:"呕吐"},{id:"133",type:"png",title:"敲打"},{id:"134",type:"png",title:"心碎"},{id:"135",type:"png",title:"嘘"},{id:"136",type:"png",title:"中箭"},{id:"137",type:"png",title:"抓狂"},{id:"001",type:"png",title:"流汗"},{id:"002",type:"png",title:"丢药"},{id:"003",type:"png",title:"白眼"},{id:"004",type:"png",title:"火箭"},{id:"005",type:"png",title:"色"},{id:"006",type:"png",title:"点蜡"},{id:"007",type:"png",title:"抽烟"},{id:"008",type:"png",title:"可爱"},{id:"009",type:"png",title:"炸弹"},{id:"010",type:"png",title:"吃丸子"},{id:"011",type:"png",title:"害怕"},{id:"012",type:"png",title:"疑问"},{id:"013",type:"png",title:"阴险"},{id:"014",type:"png",title:"害羞"},{id:"015",type:"png",title:"笑哭"},{id:"016",type:"png",title:"猪头"},{id:"017",type:"png",title:"困"}]},l=t({getDoms:function(){this.doms={$chatSpeak:e(".chat-speak"),$el:e(".face-box"),$html:e("html"),$body:e("body")}},init:function(t){this.config=e.extend(!0,{},{row:6,col:7,isExcute:!1,fullpageThumbMove:!0,thumbTop:r.defaultThumbTop,thumbH:0,currPage:1,sumPage:0,lastPage:0,state:r.state.close,rendered:!1,faceListConfig:window.faceListConfig?window.faceListConfig:r.defaultFaceListConfig},t),this.getDoms(),this.bindEvent()},initPage:function(e){e!==!0&&0!==this.doms.$el.find(".face_container").length||(this.config.rendered=!0,this.render()),this.initToggle(),this.bindMouseWheelEvent()},layout:function(t){this.config.rendered!==!1&&(this.config=e.extend(!0,{},{fullpageThumbMove:!0,thumbTop:r.defaultThumbTop,thumbH:0,currPage:1,sumPage:0,lastPage:0},t),this.initPage(!0))},render:function(){var t,a,i,s,n=this,o=[],l=r.emb,d=n.config.row,c=n.config.col,u=d*c,g=n.config.lastPage,m=n.config.thumbH,p=n.config.faceListConfig,f=0,h=0,v=p.length,b="";t=(r.emw+l)*c,a=(r.emh+l)*d,f=a,h=a-16,i=parseInt(v/u),s=v%u,s>0&&(i+=1),g=i-1,m=1*h/i;for(var y=0;i>y;y++)o.push({stoe:{sIndex:y*u,eIndex:y==i-1?v-1:y*u+(u-1)},currPage:y});b=n.makeContentHtml({faceListConfig:p,pageInfo:o,scrollbarH:h,defaultThumbTop:r.defaultThumbTop,thumbH:m,faceNum:u,row:d,col:c,fw:t,fh:a}),n.doms.$el.html(b),n.doms.$el.css({width:t+24+2+"px",height:a+2+"px",top:-(a+20)+"px"}),n.config=e.extend(!0,this.config,{sectionH:f,scrollbarH:h,sumPage:i,lastPage:g,thumbH:m})},makeContentHtml:function(e){var t,i,o;return t=a.string.join('<div class="scrollbar" style="height:<%= scrollbarH %>px">','<div class="track" style="height:<%= scrollbarH %>px">','<div class="thumb" style="top: <%= defaultThumbTop %>px; height:<%= thumbH %>px">','<div class="face_page" style="display:none">','<div class="pagenum">0/0</div>',"</div>","</div>","</div>","</div>",'<div class="facePad" id="facePad" style="width:<%=fw%>px;height:<%=fh%>px">','<div class="new_face_list clearfix viewport" id="new_face_list" style="width:<%=fw%>px;height:<%=fh%>px">','<div class="face_container overview clearfix" style="width:<%=fw%>px">',"<% for(var i=0;i<pageInfo.length;i++) { %>","<% var pageData= pageInfo[i]; %>","<% var onePageStartIndex = pageData.stoe.sIndex; %>","<% var onePageEndIndex = pageData.stoe.eIndex; %>","<% var lastIndex = (i+1)*faceNum - 1; %>",'<section class="section" style="width:<%=fw%>px;height:<%=fh%>px">',"<% for(var j = onePageStartIndex ; j <= onePageEndIndex; j++) { %>","<% if( (j + 1) % col == 0 && (j + 1)/faceNum < onePageEndIndex && j==lastIndex){ %>",'<em class="dy<%=faceListConfig[j].id%> emBRN emBBN" rel="dy<%=faceListConfig[j].id%>" name="faceimg" ftype="chat" title="<%=faceListConfig[j].title%>">','<img src="<%=web_url%>app/douyu/res/page/room-normal/face/dy<%=faceListConfig[j].id%>.','<%= !!faceListConfig[j].type ? faceListConfig[j].type : "png" %>','?v=<%=version%>"/>',"</em>","<% } else if( j >= ( (i+1) * faceNum - col ) && j < ((i+1) * faceNum ) && j!=lastIndex ){ %>",'<em class="dy<%=faceListConfig[j].id%> emBBN" rel="dy<%=faceListConfig[j].id%>" name="faceimg" ftype="chat" title="<%=faceListConfig[j].title%>">','<img src="<%=web_url%>app/douyu/res/page/room-normal/face/dy<%=faceListConfig[j].id%>.','<%= !!faceListConfig[j].type ? faceListConfig[j].type : "png" %>','?v=<%=version%>"/>',"</em>","<% } else if( (j + 1) % col == 0 && (j + 1)/faceNum < onePageEndIndex && j!=lastIndex ){ %>",'<em class="dy<%=faceListConfig[j].id%> emBRN" rel="dy<%=faceListConfig[j].id%>" name="faceimg" ftype="chat" title="<%=faceListConfig[j].title%>">','<img src="<%=web_url%>app/douyu/res/page/room-normal/face/dy<%=faceListConfig[j].id%>.','<%= !!faceListConfig[j].type ? faceListConfig[j].type : "png" %>','?v=<%=version%>"/>',"</em>","<% } else{ %>",'<em class="dy<%=faceListConfig[j].id%>" rel="dy<%=faceListConfig[j].id%>" name="faceimg" ftype="chat" title="<%=faceListConfig[j].title%>">','<img src="<%=web_url%>app/douyu/res/page/room-normal/face/dy<%=faceListConfig[j].id%>.','<%= !!faceListConfig[j].type ? faceListConfig[j].type : "png" %>','?v=<%=version%>"/>',"</em>","<% } %>","<% } %>","</section>","<% } %>","</div>","</div>","</div>",'<div class="up"></div>','<div class="down"></div>','<span class="face-arrow face-arrow1"></span>','<span class="face-arrow face-arrow2"></span>'),i=s.compile(t),o=i({faceListConfig:e.faceListConfig,pageInfo:e.pageInfo,scrollbarH:e.scrollbarH,defaultThumbTop:e.defaultThumbTop,thumbH:e.thumbH,faceNum:e.faceNum,row:e.row,col:e.col,fw:e.fw,fh:e.fh,web_url:n.get("sys.web_url"),version:20170626})},down:function(t,a){var i=this,s=a||window.event,n=e("#container");i.config=e.extend(!0,this.config,{isExcute:!0,startY:s.pageY,thumbY:t.offsetTop}),i.Move=i.processFn(i.move,i,t),i.Up=i.processFn(i.up,i,t),n.bind("mousemove",i.Move),n.bind("mouseup",i.Up),i.doms.$el.find(".thumb").bind("mouseup",i.Up),i.doms.$el.find(".track").bind("mouseup",i.Up)},move:function(t,a){var i=this,s=i.doms,n=a||window.event,o=i.config.thumbH,l=r.defaultThumbTop,d=i.config.currPage,c=0,u=l+o*i.config.lastPage,g=(d-1)*o-.5*o+l,m=(d-1)*o+.5*o+l,p=i.config.prevEndY?i.config.prevEndY:0,f=n.pageY,h=i.config.thumbY;if(c=f?h+(f-i.config.startY):h,s.$html.css({"user-select":"none"}),s.$body.css({"user-select":"none"}),l>=c?c=l:c>=u&&(c=u),e(t).css({top:c+"px"}),i.config.isExcute)if(0>f-p)g>=c&&i.pageUp();else{if(!(f-p>0))return;c>=m&&i.pageDown()}return i.config=e.extend(!0,this.config,{fullpageThumbMove:!1,endY:f,prevEndY:f}),!1},up:function(t,a){var i=this,s=e("#container"),n=a||window.event,o=i.config.thumbH,l=r.defaultThumbTop,d=i.config.endY,c=i.config.startY,u=i.config.isExcute,g=i.config.currPage,m=i.config.thumbTop,p=l+o*i.config.lastPage,f=i.config.thumbY+(d-c),h=(g-1)*o-.5*o+l,v=(g-1)*o+.5*o+l;d=n.pageY,i.config=e.extend(!0,this.config,{isExcute:!1,fullpageThumbMove:!1,endY:d}),u&&(l>=f?f=l:f>=p&&(f=p),0>d-c&&h>=f?(i.pageUp(),t.style.top=f+"px"):d-c>=0&&f>=v?(i.pageDown(),t.style.top=f+"px"):(m=l+(g-1)*o,i.doms.$el.find(".thumb").css({top:m+"px"}),i.config.thumbTop=m)),s.unbind("mousemove",i.Move),s.unbind("mouseup",i.Up),i.doms.$el.find(".thumb").unbind("mouseup",i.Up),i.doms.$el.find(".track").unbind("mouseup",i.Up)},processFn:function(e,t,a){return function(i){e.call(t,a,i)}},getPosition:function(e,t){t=t||document.body;var a=e.offsetLeft,i=e.offsetTop;for(p=e.offsetParent;(p!=t||p!=document.body)&&p;)window.navigator.userAgent.indexOf("MSIE 8.0")>-1?(a+=p.offsetLeft,i+=p.offsetTop):(a+=p.offsetLeft+p.clientLeft,i+=p.offsetTop+p.clientTop),p=p.offsetParent;var s={};return s.x=a,s.y=i,s},facePage:function(){var e=this,t=e.config.currPage,a=e.config.thumbH,i=e.config.thumbTop,s=e.doms.$el.find(".face_page"),n=e.doms.$el.find(".pagenum"),o=(a-n.height())/2;n.html(t+"/"+e.config.sumPage),s.css({display:"none"}),s.css({top:o+"px"}),s.stop().fadeIn(1500,function(){s.stop().fadeOut("fast",function(){s.css({display:"none"})})}),e.config.fullpageThumbMove===!0&&(i=r.defaultThumbTop+(t-1)*a,e.doms.$el.find(".thumb").css({top:i+"px"}),e.config.thumbTop=i)},_addWheel:function(e,t){function a(e){var a=e||event,i=a.wheelDelta?a.wheelDelta<0:a.detail>0;return t(i),a.preventDefault&&a.preventDefault(),!1}e.onmousewheel=null,e.onmousewheel=a,e.removeEventListener&&e.removeEventListener("DOMMouseScroll",a,!1),e.addEventListener&&e.addEventListener("DOMMouseScroll",a,!1)},processWheel:function(e){this.config.fullpageThumbMove=!0,this[e?"pageDown":"pageUp"]()},moveSection:function(){var e=this,t=e.doms.$el.find(".face_container"),a=-(e.config.currPage-1)*e.config.sectionH;t.stop().animate({top:a},300)},pageUp:function(){var e=this,t=e.config.currPage;t=1>=t?1:t-1,e.config.currPage=t,e.moveSection(),e.facePage()},pageDown:function(){var e=this,t=e.config.currPage,a=e.config.sumPage;t=t>=a?a:t+1,e.config.currPage=t,e.moveSection(),e.facePage()},toggle:function(){this[this.config.state===r.state.open?"close":"open"]()},initToggle:function(){this[this.config.state===r.state.close?"close":"open"]()},open:function(){this.config.state=r.state.open,this.doms.$el.show(),i.trigger("mod.chat.msg.color.hide")},close:function(){this.config.state=r.state.close,this.doms.$el.hide()},bindMouseWheelEvent:function(){var e=this;$faceContainer=this.doms.$el.find(".face_container"),e._addWheel($faceContainer[0],function(t){e.processWheel(t)})},bindEvent:function(){var t=this,a=this.doms,s=a.$el,n=e("#container");s.on("click",".face_container em",function(a){a.preventDefault(),o.check()?"chat"==e(this).attr("ftype")&&(t.toggle(),i.trigger("mod.chat.msg.exp",e(this).attr("rel"))):o.show(),i.trigger("dys",{key:"dys.room.face.click",code:e(this).attr("rel")})}),s.on("mouseover",".face_container em",function(t){e(this).addClass("hoverEm").siblings("em").removeClass("hoverEm")}).on("mouseout",".face_container em",function(t){e(this).removeClass("hoverEm")}),s.on("click",".track",function(a){var i=a||window.event,n=i.pageY,o=t.config.thumbTop,r=t.getPosition(s.get(0),e("#room_container").get(0)).y,l=o+r;t.config.fullpageThumbMove=!0,"thumb"!=a.target.className&&(l>n?t.pageUp():t.pageDown())}),n.on("click touchstart",".face-box .up",function(e){t.config.fullpageThumbMove=!0,t.pageUp()}),n.on("click touchstart",".face-box .down",function(e){t.config.fullpageThumbMove=!0,t.pageDown()}),n.delegate(".face-box .thumb","mousedown",function(e){t.down.call(t,this,e)}),a.$chatSpeak.find(".expression").on("click",".e-btn",function(a){var i=e(this);return t.initPage(!1),t.toggle(),i["open"===t.config.state?"addClass":"removeClass"]("active"),a.preventDefault(),a.stopPropagation(),!1}),i.on("mod.layout.change",function(){t.layout({row:6,col:t.doms.$body.hasClass("layout-little")?r.smallScreenCol:r.bigScreenCol,state:t.config.state})}),i.on("toggle",t.toggle),i.on("mod.chat.exp.hide",function(){t.close()})}});return{init:function(e){new l(e)}}}),define("douyu/page/room/normal/mod/chat-color",["jquery","shark/class","shark/observer","shark/util/storage/1.0","shark/util/flash/data/1.0","shark/util/storage/1.0","shark/util/lang/1.0","shark/util/template/2.0","douyu/context","douyu/com/user","douyu/page/room/base/api"],function(e,t,a,i,s,n,o,r,l,d,c){var u=e(".color-box"),g=(u.find(".c-con"),t({init:function(t){var a=e("#js-color-barrage");e("#js-fans-barrage");this.config=e.extend(!0,{},{anchorMedalSwitch:l.get("room.is_set_fans_badge"),fansSpecialUrl:"http://www.douyu.com/t/fans",defaultBarragePush:[{col:2,ul:0,ubl:6},{col:3,ul:0,ubl:9},{col:6,ul:0,ubl:12},{col:4,ul:0,ubl:15},{col:5,ul:0,ubl:18},{col:1,ul:0,ubl:21}],fansBarrageSetData:null,fansBarrageSetFlag:"fansBarrageSetData",fansBarrageSetKey:l.get("room.room_id")+"_"+l.get("sys.uid"),nobleChatBarrage:!1,$el:a,chatColorType:1,fishNotFocus:0,usesharkfinBtn:e("#J_usesharkfin"),usedmcardBtn:e("#J_usedmcard"),isColor:!1,indexColor:0,ticketroom:a.find(".data-ticketroom"),ticketTip:a.find(".color-box-tip").eq(0),leftNumTip:a.find('[data-selector="leftnum"]'),colorList:a.find(".color-list"),superMsgBtn:e("#js-super-msg"),pid:"",ifs:0,sMsg:0,dmCardNum:0,sharkfinNum:0,nobleInfo:{nl:0}},t),this.initNobleBarrage(),this.initFansBarrage().init()},setDefaultColor:function(t){var i,s=this,n=this.config,o=n.$el;i=e("#js-chat-speak").find("#js-fans-barrage"),i.find(".fans-barrage-btn").removeClass("active"),i.find(".color-default").parent().addClass("selected").siblings().removeClass("selected"),i.find('[data-type="fans-barrage-btn"]').removeAttr("style"),o=n.$el,o.find('[data-type="cbt"]').html('<i class="c-icon"></i>').removeClass("c-btn-on").removeAttr("style"),o.find(".color-default").parent().addClass("selected").siblings().removeClass("selected"),n.ticketTip.show(),n.isColor=!1,n.indexColor=0,n.pid="",n.ifs=0,"fishColor"!=t&&s.fansBarrageSetConfig(),n.fishNotFocus?a.trigger("mod.chat.msg.color.set",null):n.fishNotFocus=1},freeColor:function(t,a,i){var s=this,n=s.config.colorList.find("li");s.config.eid=i,s.config.isTicketRoom=!0,a===!0?n.each(function(e,t){s.updateColor(e,"1")}):e(t).each(function(e,t){s.updateColor(t.col,t.free)})},updateColor:function(e,t){var a='<span class="color-description">免费</span>',i=this.config.colorList.find("li").eq(e);i.find("span").remove(),"1"===t?(i.append(a),i.find("[data-type]").data("type","free")):i.find("[data-type]").data("type","cbli")},initNobleBarrage:function(){var t=['<div class="noble--barrage-toggle">','<i class="icon--barrage-toggle"></i>','<div class="dy--tips status--hover-show hide">','<div class="tips--trans-outer">','<div class="tips--trans-inner">',"</div>","</div>",'<div class="tips--main">','<div class="tips--content">',"发贵族弹幕","</div>","</div>","</div>","</div>"].join(""),i=['<div class="noble--error" style="display:none">','<a class="noble-error--close" href="javascript:;">×</a>','<div class="noble-error--tran-outer">','<div class="noble-error--tran-inner">',"</div>","</div>",'<div class="nobel-error--main">','<i class="nobel-error--icon"></i>','<div class="error-main--content">','<h3 class="content--title">',"我的弹幕，跟你的不同","</h3>","<p>","贵族弹幕-伯爵以上贵族专属特权","</p>",'<a class="btn" href="javascript:;">',"开通贵族","</a>","</div>","</div>","</div>"].join(""),s=this,n=e(".noble--barrage-box");s.nobleBox||(n.append(t),s.nobleBox=n,s.nobleError=e(i),s.nobleBox.append(s.nobleError)),s.nobleBoxHover=n.find(".status--hover-show"),n.on("click",".noble-error--close",function(){n.find(".noble--error").hide()}).on("click",".noble--barrage-toggle",function(){var e,t,i;if(s.config.nobleInfo.load){if(e=n.hasClass("status--nobel-disabled"),t=n.find(".icon--barrage-toggle"),i=t.hasClass("status--active"),0==s.config.nobleInfo.nl)return 0!==s.config.nobleInfo.npl?void s.showNobleBarrageError("续费贵族"):void s.showNobleBarrageError("开通贵族");if(1!=s.config.nobleInfo.ncp)return void s.showNobleBarrageError("升级贵族");s.toggleNobleBarrage(!i),s.setDefaultColor(),a.trigger("mod.room.chat.super.msg.switch",0)}}).on("click",".noble--error .btn",function(){n.find(".noble--error").hide();var e={};e.level=3,a.trigger("mod.normal.noble.buy",e)})},toggleNobleBarrage:function(e){var t=this.nobleBox.find(".icon--barrage-toggle");e===!0&&1!=this.config.sMsg?(this.config.nl=1,t.addClass("status--active"),this.nobleTips("贵族弹幕已启用")):(this.config.nl=0,t.removeClass("status--active"),this.nobleTips("贵族弹幕已关闭"))},nobleTips:function(e){this.nobleBoxHover.find(".tips--content").text(e)},resetNobleBarrage:function(e){var t=this.config.nobleInfo;if(t.load=!0,t.npl=e.npl||0,e.nl>0){t.nl=e.nl;var a=$ROOM.nobleConfig[e.nl]||{};t.ncp=parseInt(a.noble_barrage,10)||0}1==t.ncp?(this.config.nobleChatBarrage=!0,this.nobleBox.removeClass("status--nobel-disabled"),this.nobleBox.find(".noble--error").hide(),this.nobleBoxHover.removeClass("hide"),this.toggleNobleBarrage(!0),this.setDefaultColor(),this.showGuide()):0==e.nl?(this.toggleNobleBarrage(!1),this.nobleBox.addClass("status--nobel-disabled"),this.nobleBoxHover.addClass("hide")):(this.toggleNobleBarrage(!1),this.nobleBoxHover.addClass("hide"),this.nobleBox.removeClass("status--nobel-disabled"))},showNobleBarrageError:function(t){var a=e("#js-chat-speak").offset().left,i=this.nobleBox.offset().left;this.nobleBox.find(".noble-error--tran-outer").css({marginLeft:0,left:i-a+3}),this.nobleError.show().find(".btn").text(t||"开通贵族")},showGuide:function(){var e="noble-barrage-guide",t=n.get(e);if(1!=t){var a=this;a.nobleBoxHover.show(),setTimeout(function(){n.set(e,1),a.nobleBoxHover.removeAttr("style")},3e3)}},getFansBarrageSetData:function(){var e,t=this.config;return d.check()?(e=n.get(t.fansBarrageSetFlag),t.fansBarrageSetData=e||{}):t.fansBarrageSetData={},t.fansBarrageSetData},fansBarrageSetConfig:function(e){var t=this.config,a=t.fansBarrageSetData;if(e)a[t.fansBarrageSetKey]=e;else{if(!a.hasOwnProperty(t.fansBarrageSetKey))return;delete a[t.fansBarrageSetKey]}n.set(t.fansBarrageSetFlag,a,2592e3)},initFansBarrage:function(){var t=this,i=this.config,l={fansTipTimer:""},u={init:function(){this.doms={$fishBarrage:e("#js-color-barrage"),$chatWrapper:e("#js-chat-speak"),$nobleEnter:e("#js-chat-speak .noble--barrage-box")},this.tempHtml={fansBarrageList:this.fansBarrageListRender(),fansBarrageTip:this.fansBarrageTipRender()},t.getFansBarrageSetData(),this.fansBarrageAppend(),this.observerBind()},fansBarrageAppend:function(){var e=this,t=this.doms,a=['<div data-tag="fans-barrage-tip" style="position: relative"></div>'].join("");t.$nobleEnter&&(t.$fansEnter=t.$chatWrapper.find("#js-fans-barrage"),t.$fansEnter.find(".fans-barrage-icon").attr("data-type","fans-barrage-btn"),t.$fansEnter.append(a),t.$fansEnterTipWarp=t.$chatWrapper.find('[data-tag="fans-barrage-tip"]'),e.fansBarrageGuideTip(),e.bindEvent())},fansBarrageListRender:function(e){var t,a;return t=o.string.join('<div class="fans-barrage-box hide" data-tag="fans-barrage-list" data-type="cbl">','<div class="fans-barrage-title">','<a class="fans-barrage-right fr" target="_blank" href="{{ fansSpecialUrl }}" data-tag="medal-introduce-enter"><em class="fans-barrage-last">了解粉丝特权</em></a>',"<p>粉丝专属弹幕</p>","</div>",'<ul class="fans-barrage-list clearfix" data-tag="fans-barrage-ul">','<li class="selected">','<div data-tag="fans-color-list" class="colorwrap fanscolor-default color-default" data-type="free"><i></i></div>','<span class="color-description">默认</span>',"</li>","{{ each fansColorMap as item index }}","{{ if item.ul }}","<li>",'<div data-tag="fans-color-list" data-color-id="{{ item.col }}" class="colorwrap color0{{ item.col }}" data-type="free"><i></i></div>',"</li>","{{ else }}",'<li class="fans-barrage-lock">','<div data-tag="fans-color-list" data-color-id="{{ item.col }}" class="colorwrap color0{{ item.col }}" data-type="free"><i></i></div>','<div class="fans-barrage-tips">',"<span>粉丝等级{{ item.ubl }}级免费使用</span>",'<span class="fans-barrage-arrow"></span>',"</div>","</li>","{{ /if }}","{{ /each }}","</ul>",'<div class="fans-barrage-colordes">',"{{ if fansColorStatus }}",'<p class="fans-barrage-des">粉丝等级达到<strong>15级</strong>，弹幕可在聊天区<strong>悬浮展示</strong>噢~</p>',"{{ else }}",'<p class="fans-barrage-des">成为主播的<strong>{{ fansColorMap[0].ubl }}级</strong>粉丝即可<strong>免费</strong>发送粉丝弹幕啦！</p>',"{{ /if }}","</div>",'<span class="fans-barrage-arrow" data-tag="fans-barrage-arrow"></span>','<span class="fans-barrage-arrow fans-barrage-arrow-out" data-tag="fans-barrage-arrow"></span>',"</div>"),a=r.compile(t)},fansBarrageTipRender:function(){var e,t;return e=o.string.join('{{ if type == "fansNotOpen" }}','<div class="disfans-box clearfix" style="display: block;" data-tag="fansBarrageTip">',"<p>该主播未开通粉丝徽章，无法使用粉丝弹幕</p>",'<a class="fans-barrage-intro" target="_blank" href="{{ fansSpecialUrl }}">了解更多&rsaquo;&rsaquo;</a>','<span class="fans-barrage-arrow" style="left: 50%; margin-left: -6px;"></span>','<span class="fans-barrage-arrow fans-barrage-arrow-out" style="left: 50%; margin-left: -6px;"></span>',"</div>","{{ /if }}",'{{ if type == "fansColorOnline" }}','<div class="fans-barrage-tips " style="display: block;" data-tag="fansBarrageTip">',"<span>粉丝专属弹幕已上线噢~</span>",'<span class="fans-barrage-arrow" style="left: 50%; margin-left: -6px;"></span>',"</div>","{{ /if }}"),t=r.compile(e)},fansBarrageTipAppend:function(e){var t,a,s,n,o=this,r=this.doms,d=r.$chatWrapper.offset().left;e&&(a=r.$fansEnter.find('[data-tag="fansBarrageTip"]'),clearTimeout(l.fansTipTimer),a.remove(),t=o.tempHtml.fansBarrageTip({type:e.type,fansSpecialUrl:i.fansSpecialUrl}),r.$fansEnterTipWarp.append(t),a=r.$fansEnter.find('[data-tag="fansBarrageTip"]'),s=a.find(".fans-barrage-arrow"),a.css({left:"50%",marginLeft:-a.outerWidth()/2}),n=a.offset().left,0>n-d&&(a.css({marginLeft:-a.outerWidth()/2+(d-n)}),s.css({marginLeft:-6-(d-n)})),a.removeClass("hide"),l.fansTipTimer=setTimeout(function(){a.fadeOut(500,function(){a.remove()})},3e3))},fansBarrageGuideTip:function(){var e=this;n.get("fansBarrageGuide")||(e.fansBarrageTipAppend({type:"fansColorOnline"}),n.set("fansBarrageGuide",1,31536e3))},showFansBarrageTipInit:function(){var e,t,a=this.doms;a.$chatWrapper&&a.$fansEnter&&(e=a.$chatWrapper.offset().left,t=a.$fansEnter.offset().left,a.$fansEnter.find('[data-tag="fans-barrage-arrow"]').css({marginLeft:0,left:t-e+4}))},fansBarrageListAppend:function(e){var t,a,s,n,o=this,r=this.doms,l=this.tempHtml;if(e)if(e&&e.length>0?s=e[0].ul?1:0:(e=i.defaultBarragePush,s=0),r.$fansBarrageList)o.fansBarrageListUpdate(e);else{if(t=l.fansBarrageList({fansColorStatus:s,fansColorMap:e,fansSpecialUrl:i.fansSpecialUrl}),r.$fansEnter.append(t),r.$fansBarrageList=r.$fansEnter.find('[data-tag="fans-barrage-list"]'),r.$fansBarrageUl=r.$fansEnter.find('[data-tag="fans-barrage-ul"]'),a=r.$fansBarrageUl.find("li"),a.eq(a.length-1).addClass("last"),a.eq(a.length-2).addClass("last-second"),o.showFansBarrageTipInit(),!i.fansBarrageSetData)return;n=i.fansBarrageSetData[i.fansBarrageSetKey],d.check()&&n&&!i.nobleChatBarrage&&r.$chatWrapper.find('[data-tag="fans-color-list"][data-color-id="'+n.indexColor+'"]').trigger("click","triggerClick")}},fansBarrageListUpdate:function(t){var a=this.doms,i=0;if(t&&e.isArray(t)&&a.$fansBarrageUl){for(;i<t.length;i++)t[i].ul?a.$fansBarrageUl.find("li").eq(i+1).removeClass("fans-barrage-lock"):a.$fansBarrageUl.find("li").eq(i+1).addClass("fans-barrage-lock");t[0].ul?a.$fansEnter.find(".fans-barrage-des").html("粉丝等级达到<strong>15级</strong>，弹幕可在聊天区<strong>悬浮展示</strong>噢~"):a.$fansEnter.find(".fans-barrage-des").html("成为主播的<strong>6级</strong>粉丝即可<strong>免费</strong>发送粉丝弹幕啦！")}},bindEvent:function(){var s=this,n=this.doms;e("#container").on("click",function(o){var r,l=e(o.target);if("fans-barrage-btn"===l.data("type")){if(!d.check())return void d.show("login");if(i.chatColorType=1,!i.anchorMedalSwitch)return void s.fansBarrageTipAppend({type:"fansNotOpen"});i.isColor?t.setDefaultColor():(r=n.$fansEnter.find('[data-type="cbl"]'),r&&r.length||(s.fansBarrageListAppend([]),r=n.$fansEnter.find('[data-type="cbl"]')),r.toggleClass("hide"),r.hasClass("hide")||a.trigger("mod.chat.noble.barrage.hide"))}else l.parents("#js-fans-barrage").length||n.$fansEnter.find('[data-type="cbl"]').addClass("hide")}),n.$chatWrapper.on("click",'.fans-barrage-list [data-tag="fans-color-list"]',function(s,o){var r=e(this),l=r.parent().index()-1,d=r.css("backgroundColor"),c=e("#js-color-barrage").find('[data-type="cbt"]');return r.parent().hasClass("selected")?void 0:r.hasClass("color-default")?void t.setDefaultColor():void(0>l||r.parent().hasClass("fans-barrage-lock")||(n.$fansEnter.find('[data-type="fans-barrage-btn"]').css("color",d).attr("data-status","chat-color"),c.length&&c.removeAttr("data-status"),i.isColor=!0,i.indexColor=r.data("color-id"),i.ifs=1,i.pid="",t.fansBarrageSetConfig({indexColor:i.indexColor}),a.trigger("mod.chat.noble.barrage.hide"),a.trigger("mod.room.chat.super.msg.switch",0),a.trigger("mod.chat.msg.color.set",d,o),r.parent().addClass("selected").siblings().removeClass("selected"),n.$fansEnter.find(".fans-barrage-btn").css({backgroundColor:d})))})},observerBind:function(){var e=this;this.doms;c.reg("room_data_handler",function(t){var a,n=s.decode(t).too(),o=[],r=[];if("fdm"==n.type){if(!n.list)return;o=s.isArray(n.list)?s.decode(n.list):[{value:n.list}];for(var l=0;l<o.length;l++)a=o[l],a&&a.value&&(a=s.decode(a.value).too(),a.col=parseInt(a.col,10),a.ul=parseInt(a.ul,10),a.ubl=parseInt(a.ubl,10),r[l]=a);i.defaultBarragePush=r,e.fansBarrageListAppend(r)}}),c.reg("room_data_handler",function(t){var a=s.decode(t).too();"cdcp"==a.type&&e.showFansBarrageTipInit()}),c.reg("room_data_ShieldDan",function(e){var t;s.decode(e).too();a.trigger("mod.chat.blackList.set",e),t=a.fire("mod.chat.blackList.get",e),c.exe("js_myblacklist",t.list.join("|"))}),a.on("fans.medal.switch.set",function(){i.anchorMedalSwitch=1}),a.on("fans.barrage.list.append",function(){e.fansBarrageListAppend([])})}};return u}}));return a.on("mod.chat.msg.color.get",function(){return{color:colorBarrage.config.indexColor,pid:colorBarrage.config.pid,eid:colorBarrage.config.eid,nl:colorBarrage.config.nl,ifs:colorBarrage.config.ifs,sMsg:colorBarrage.config.sMsg}}),a.on("mod.chat.msg.color.hide",function(){colorBarrage.config.$el.find('[data-type="cbl"]').addClass("hide")}),a.on("mod.chat.msg.color.free",function(e){colorBarrage.freeColor(e.corlorArr,e.freeAll,e.eid)}),a.on("mod.chat.noble.barrage.show",function(){colorBarrage.toggleNobleBarrage(!0)}),a.on("mod.chat.noble.barrage.hide",function(){colorBarrage.toggleNobleBarrage(!1)}),a.on("mod.room.chat.gift.noble.info",function(e){colorBarrage.resetNobleBarrage(e)}),a.on("mod.room.chat.super.msg.switch",function(t){var i,s=e("#js-chat-speak").find(".cs-textarea");t?(colorBarrage.setDefaultColor(),a.trigger("mod.chat.noble.barrage.hide"),colorBarrage.config.sMsg=1,i="守护天神专属巨大弹幕，快来试试吧！",colorBarrage.config.superMsgBtn&&colorBarrage.config.superMsgBtn.find('[data-type="super-msg-btn"]').addClass("cur")):(colorBarrage.config.sMsg=0,i="守护天神专属巨大弹幕，快来试试吧！",colorBarrage.config.superMsgBtn&&colorBarrage.config.superMsgBtn.find('[data-type="super-msg-btn"]').removeClass("cur"),i="试着输入“#关注”吧，可以关注主播噢"),s&&s.attr("placeholder",i)}),{init:function(e){colorBarrage=new g(e)},val:function(){return colorBarrage.config.indexColor}}}),define("douyu/page/room/normal/mod/chat-shield",["jquery","shark/observer","shark/class","douyu/com/fps","shark/util/flash/data/1.0","douyu/page/room/base/api","shark/util/storage/1.0","douyu-liveH5/live/js/player"],function(e,t,a,i,s,n,o,r){var l={checkedMap:{allGift:!1,message:!1,videoBroadcast:!1,smallgift:!1,isGetFpsMsg:!1,tipsFlag:!1,isActiveStatus:!0},checkedNum:0,className:{liActive:"shie-checked",wrapActive:"shie-switch-open"},flag:!0,maxStatus:4,storageName:"chat-shield-config",fpsMonitorSwitch:1,fpsLoopTimer:null},d=a({fpsStart:function(){i.start(),this.loopMonitorFPS()},loopMonitorFPS:function(){var e,t=this,a=function(){return r.useH5?l.fpsMonitorSwitch?l.checkedMap.smallgift?!1:(e=i.getFPS(),void(15>e&&t.showLowFpsTips())):(clearInterval(l.fpsLoopTimer),!1):!1};setInterval(a,500)},init:function(a){var i=this;i.config=e.extend(!0,{},{target:"#js-shie-gift"},a),t.on("mod.center.userrole.ready",function(e){i.config.isCurrentAnchor=e.isAnchor()}),i.getDoms(),i.fpsStart(),i.bindEvent()},getDoms:function(){var t=this,a=e("#js-shie-gift");t.doms={shieGiftWrap:a,shieSwitch:e("#shie-switch"),allShieType:a.find("[data-shield-type]"),allGift:a.find('[data-shield-type="allGift"]'),videoBroadcast:a.find('[data-shield-type="videoBroadcast"]'),shieTip:a.find('[data-shield-tip="tip"]')}},getShieldArr:function(t){var a=this,i={},s="";e(a.config.target).find("[data-shield-type]").each(function(t){parseInt(e(this).attr("data-shield-status"),10)?i[e(this).attr("data-shield-type")]=1:i[e(this).attr("data-shield-type")]=0}),s=JSON.stringify(i),a.videoBroadcast(),a.GiftEffect(),t||n.exe("js_shieldEffects",s),o.set(l.storageName,s)},initShieType:function(){var t=o.get(l.storageName)||"",a=this;if(t)try{var i=JSON.parse(t);e.each(i,function(e,t){a.singalCheacd(e,t)}),a.getShieldArr()}catch(s){}},GiftEffect:function(){var e=parseInt(this.doms.allGift.attr("data-shield-status"),10);n.exe("js_shieGiftEffect",e?1:0)},videoBroadcast:function(){var e=parseInt(this.doms.videoBroadcast.attr("data-shield-status"),10);n.exe("js_effectVisible",e?1:0)},bindEvent:function(){var a=this,i=a.doms;i.shieSwitch.on("click.shieldGift",function(){var e="",i=0;l.flag?(l.checkedNum=l.maxStatus,e="屏蔽",i=1):(l.checkedNum=0,e="开启",i=0),a.dpFunction(l.flag,a.dpAllTypeHandle(l.flag)),a.checkedNumStyle(a.config.isCurrentAnchor),t.trigger("mod.chat.msg.msg",'<li class="jschartli" data-type="list"><p class="text-cont"><span class="hy-org">已'+e+"礼物特效</span></p></li>"),a.getShieldArr(),n.exe("js_data_server_shield","type@=dmfbdreq/"+a.getShieldStatusSTT("all",i))}),i.allShieType.on("click.shieldType",function(t,i){var s=e(this),o=0;s.toggleClass(l.className.liActive),a.changeStatus(s,s.index()-1),a.getShieldArr(),o=s.hasClass(l.className.liActive)?1:0,n.exe("js_data_server_shield","type@=dmfbdreq/"+a.getShieldStatusSTT(s.attr("data-shield-type"),o))}),n.reg("room_data_shield_effects",function(t){var i,s=JSON.parse(t),o={};if(e.isPlainObject(s)){for(i in s)a.singalCheacd(i,s[i])&&(o[i]=parseInt(s[i],10)||0);n.exe("js_shieldEffects",t),a.getShieldArr(1),n.exe("js_data_server_shield","type@=dmfbdreq/"+a.getShieldStatusSTT(o))}}),n.reg("room_bus_shild",function(){r.useH5||n.exe("js_data_isAction",l.checkedMap.isActiveStatus),a.initShieType()}),n.reg("room_data_FPS",function(e){parseInt(e,10)<15&&a.showLowFpsTips()}),n.reg("room_data_handler",function(t){var i=s.decode(t).too(),n={},o={};"dmfbdres"===i.type&&(s.isArray(i.dfl)?(n=s.decode(i.dfl),e.each(n,function(e){var t=s.decode(this.value).too();o[t.sn]=t.ss})):(n=s.decode(i.dfl).too(),o[n.sn]=n.ss),a.setShieldView(o))}),a.getActiveStatus()},getShieldStatusSTT:function(t,a){var i=[],n={smallgift:105,allGift:106,message:107,videoBroadcast:108},o="";return"object"==typeof t?e.each(t,function(e){i.push("sn@A="+n[e]+"@Sss@A="+(t[e]||0))}):"all"===t?e.each(n,function(e){i.push("sn@A="+n[e]+"@Sss@A="+a)}):t&&i.push("sn@A="+n[t]+"@Sss@A="+a),i.length&&(o=s.encode([{name:"dfl",value:i.join("/")}])),o},setShieldView:function(t){var a={smallgift:105,allGift:106,message:107,videoBroadcast:108},i={};e.each(a,function(e){i[e]=""+t[this]=="1"?1:0}),o.set(l.storageName,JSON.stringify(i)),this.initShieType()},getActiveStatus:function(){e(window).on({"blur.fps":function(){l.checkedMap.isActiveStatus=!1,r.useH5||n.exe("js_data_isAction",l.checkedMap.isActiveStatus)},"focus.fps":function(){l.checkedMap.isActiveStatus=!0,r.useH5||n.exe("js_data_isAction",l.checkedMap.isActiveStatus)}})},showLowFpsTips:function(){var t=e(".shie-gift"),a=t.find(".shie-tips-label"),i=t.find('[data-shield-type="smallgift"]'),s=t.find('[data-shie="tips"]'),d=t.find('[data-shie="cls"]'),c=null,u=this,g=(new Date).setSeconds((new Date).getSeconds()+43200),m=(new Date).getTime(),p=null,f=e("#js-chat-cont .giftbatter-box").children();p=setTimeout(function(){1!==parseInt(i.attr("data-shield-status"),10)&&!l.checkedMap.isGetFpsMsg&&l.checkedMap.isActiveStatus&&f.length>0&&(l.checkedMap.isGetFpsMsg=!0,i.click(),r.useH5||n.exe("js_data_FPSBack"),c=setTimeout(function(){l.checkedMap.tipsFlag=!0,clearTimeout(c)},5e3),o.get("shiePropTips")||(o.get("halfDayShow")?1===parseInt(o.get("halfDayShow").split("|")[0],10)&&(o.set("halfDayShow","2|"+!1,parseInt((o.get("halfDayShow").split("|")[1]-m)/1e3,10)),s.show()):(o.set("halfDayShow","1|"+g,43200),s.show()))),clearTimeout(p)},200),o.get("shiePropTips")||(d.on("click.tipsCls",function(){o.set("halfDayShow","2|"+!1,parseInt((o.get("halfDayShow").split("|")[1]-m)/1e3,10)),
s.hide(),u.getTipsStatus()}),e("#container").on("click.tipsCls",function(t){var a=e(t.target);a.parents(".shie-tips").length||l.checkedMap.tipsFlag&&(s.hide(),u.getTipsStatus())}),a.on("click",function(){var t=e(".shie-gift").find('[data-input="tips"]'),a=new Date,i=604800-(3600*a.getHours()+60*a.getMinutes()+a.getSeconds());t.is(":checked")?o.set("shiePropTips",!0,i):o.set("shiePropTips",!1)}))},getTipsStatus:function(){var t=e(".shie-gift").find('[data-input="tips"]'),a=new Date,i=604800-(3600*a.getHours()+60*a.getMinutes()+a.getSeconds());t.is(":checked")&&o.set("shiePropTips",!0,i)},changeStatus:function(t){var a=this,i=e(t);i.hasClass(l.className.liActive)?a.singalCheacd(i.attr("data-shield-type"),1):a.singalCheacd(i.attr("data-shield-type"),0)},checkedNumStyle:function(e){var t=this,a=t.doms;l.checkedNum<=0?t.allRemoveStyle():l.checkedNum>=l.maxStatus?t.allAddStyle(e):(a.shieGiftWrap.addClass(l.className.wrapActive),t.addActive(a.shieSwitch))},allAddStyle:function(e){var t=this,a=t.doms;l.flag=!1,a.shieGiftWrap.addClass(l.className.wrapActive),t.addActive(a.shieSwitch),t.addActive(a.allShieType),e&&(t.removeActive(a.allGift),a.shieSwitch.removeClass(l.className.liActive),a.shieSwitch.addClass("shie-checked-notall"),l.checkedNum--),t.extremeStatus(1,e)},allRemoveStyle:function(){var e=this,t=e.doms;l.flag=!0,t.shieGiftWrap.removeClass(l.className.wrapActive),t.shieSwitch.removeClass(l.className.liActive),t.shieSwitch.removeClass("shie-checked-notall"),e.removeActive(t.shieSwitch),e.removeActive(t.allShieType),e.extremeStatus(0)},singalCheacd:function(e,t){var a=this,i=a.doms,s=i.shieGiftWrap.find('[data-shield-type="'+e+'"]'),n=parseInt(s.attr("data-shield-status"),10),o=a.dpType(e),r=0;return l.flag=!1,parseInt(t,10)?n||(l.checkedNum++,i.shieGiftWrap.addClass(l.className.wrapActive),l.checkedNum>0&&l.checkedNum<4?i.shieSwitch.addClass("shie-checked-notall"):4===l.checkedNum&&a.addActive(i.shieSwitch),a.addActive(s),a.dpFunction(1,o),r=1):(n&&(l.checkedNum--,a.removeActive(s),a.dpFunction(0,o),r=1),l.checkedNum>0&&l.checkedNum<4?(i.shieSwitch.addClass("shie-checked-notall"),i.shieSwitch.removeClass(l.className.liActive)):0===l.checkedNum&&(l.flag=!0,a.allRemoveStyle())),l.checkedMap[s.attr("data-shield-type")]=parseInt(s.attr("data-shield-status"),10),r},extremeStatus:function(e,t){var a=0;e&&(a=1);for(var i in l.checkedMap)l.checkedMap[i]=a;t&&(l.checkedMap.allGift=0)},addActive:function(t){var a=e(t);a.attr("data-shield-status",1).addClass(l.className.liActive)},removeActive:function(t){var a=e(t);a.attr("data-shield-status",0).removeClass(l.className.liActive)},dpAllTypeHandle:function(t){var a=this,i=a.doms.allShieType,s=[];return i.each(function(i,n){var o=parseInt(e(n).attr("data-shield-status"),10);t!=o&&s.push(a.dpType(e(n).attr("data-shield-type")))}),s.join(",")},dpFunction:function(e,a){e?t.trigger("dys",{key:"dys.room.gift..shield_gift_select",shield_sel:a}):t.trigger("dys",{key:"dys.room.gift..shield_gift_cancel",shield_can:a})},dpType:function(e){var t;switch(!0){case"allGift"===e:t=1;break;case"message"===e:t=2;break;case"videoBroadcast"===e:t=3;break;case"smallgift"===e:t=4}return t}});return t.on("mod.chat.msg.shield",function(){return l.checkedMap}),{init:function(e){return new d(e)},val:function(){return l.checkedMap}}}),define("douyu/page/room/normal/mod/chat-msg",["jquery","shark/observer","shark/util/lang/1.0","shark/util/flash/data/1.0","shark/util/storage/1.0","shark/util/template/1.0","douyu/context","douyu/com/user","douyu/com/vcode-user","douyu/com/msgq","douyu/com/exjsonp","douyu/page/room/base/api","douyu/page/room/normal/mod/chat-msg-tmp","douyu/page/room/normal/mod/check-verify","douyu/com/vcode-v3","douyu/page/room/normal/mod/account-security"],function(e,t,a,i,s,n,o,r,l,d,c,u,g,m,p,f){var h=!1,v={limitConfig:{low:30,vistor:200,normal:200,anchor:1e3,roomAdmin:1e3,superAdmin:1e3},defaultLenConf:{low:30,vistor:200,normal:200,anchor:1e3,roomAdmin:1e3,superAdmin:1e3},bufferLenConf:{low:5,vistor:100,normal:100,anchor:200,roomAdmin:200,superAdmin:200},comboConfig:o.get("room.comboConfig")||{},nobleBarrageSuspendTime:3e3,nobleBarrageSuspendTimer:0,msgBarrageQueue:[],msgBarrageScroll:0,avatarDomain:o.get("sys.avatar_url"),defaultAvatar:a.string.format("{0}/app/douyu/res/com/defaultAvatar.png?20161229",o.get("sys.web_url")),V3Instance:null},b={},y={},k={},w={},_=window.$COLLIGATE?window.$COLLIGATE.NobleSuspend||0:0;y.checkBrowser=function(){(window.navigator.userAgent.indexOf("MSIE 8")>-1||window.navigator.userAgent.indexOf("MSIE 9")>-1)&&(h=!0)},y.init=function(){y.checkBrowser(),y.$chatCont=e("#js-chat-cont"),y.$chatContWrap=y.$chatCont.find('[data-type="chat-cont"]'),y.$chatList=y.$chatContWrap.find('ul[data-type="chat-list"]'),y.$roll=y.$chatCont.find('[data-type="roll"]'),y.chatCls=y.$chatCont.find(".chat-cls"),y.$chatSpeak=e("#js-chat-speak"),y.initMoreMessage(),y.initNobleBarrage(),m.init(),h&&y.listenBarrageScroll()},y.listenBarrageScroll=function(){a.interval(function(){b.scrollToBottom(),b.listenNobleBarrage()},1e3,!0)},y.initNobleBarrage=function(){if(1===_){var t=y.$chatContWrap.length?y.$chatContWrap[0].clientWidth:"";y.nobleLayerWrap=e('<div class="noble-barrage-suspend"><ul class="c-list"></ul></div>'),y.nobleLayerWrap.append(y.chatCls),y.nobleLayerWrap.css({width:t}),y.nobleBarrageLayer=y.nobleLayerWrap.find(".c-list"),y.chatCls.css("top","auto"),y.$chatCont.prepend(y.nobleLayerWrap)}var a=o.get("sys.webconfUrl")+"/resource/noble/global/web.json";c.load(a,"nobleGlobalConfig",function(e){e.barrage_bgcolor&&y.changeNobleBarrageStyle({color:e.barrage_bgcolor})})},y.changeNobleBarrageStyle=function(t){var a=e("#nobleBarrageStyle"),i="<style>.chat-cont li.noble-chart{background-color:"+t.color+"}</style>";0===a.length&&(e('<div id="nobleBarrageStyle"></div>').appendTo("body"),a=e("#nobleBarrageStyle")),a.html(i)},y.initMoreMessage=function(){var t=e(['<div class="chat-more-message">','<div class="chat-more-message-bg"></div>','<span class="js-chat-more-message chat-more-message-txt">有0条新消息</span>','<span class="chat-more-message-downarrow"></span>',"</div>"].join(""));y.$moreMessageWrap=t,y.$moreMessage=t.find(".js-chat-more-message"),y.$chatContWrap.after(t),t.on("click",function(){b.release()})},k.init=function(){y.$chatCont.on("click","span.js-distribute-barrage",function(){var a=e(this).data(),i=+a.jump_type;if(4!==i){var s=a.reverse?"dys.room.normal.click.athena.reverse":"dys.room.normal.click.athena.supermsg",n=e.extend({key:s,ctid:$ROOM.cate_id},a);t.trigger("dys",n),e.get("/lapi/athena/room/catch",{t:(new Date).getTime(),bizid:a.bid,bthid:a.booth_id,conId:a.con_id,roomId:o.get("room.room_id")||0}),window.open(a.jurl)}}).on("click","span.js-normal-barrage",function(){var t,a=e(this),s=o.get("room.room_id"),n=o.get("sys.uid"),r=a.data("trid"),l=a.data("sdid"),d=a.data("type"),c=a.data("url"),g=a.html();s!=r&&(0===d?window.open(c):(t=[{name:"sdid",value:l},{name:"trid",value:r},{name:"content",value:g},{name:"rid",value:s},{name:"uid",value:n}],u.exe("js_superDanmuClick",i.encode(t)),window.open("/"+r)))}).on("click",'[data-buy="defensemute"]',function(){t.trigger("mod.normal.noble.buy"),t.trigger("dys",{key:"dys.noble.buy.defensemute"})}).on({"click.fans":function(a){a.stopPropagation(),t.trigger("dys",{key:"dys.click.msg.fans.medal",bdg_id:e(this).data("fans")})},"mouseenter.fans":function(t){var a=e(this);return s.get("fans_"+a.data("fans"))?void a.attr({title:s.get("fans_"+a.data("fans"))}):void e.ajax({url:"/fansbadge/fansbadge/getAnchorInfo",type:"GET",dataType:"json",data:{rid:a.data("fans")||0,auth:a.data("hc")||""},error:function(){e.dialog.tips_black("网络错误")},success:function(t){var i;0===parseInt(t.result,10)?(i=t.is_live?"(正在直播)":"(不在直播)",a.attr({title:t.nn+i||""}),s.set("fans_"+a.data("fans"),t.nn+i,10)):e.dialog.tips_black(t.msg||"")}})}},'[data-msg="fans"]'),t.on("mod.chat.msg.setroll.chat",function(e){2==e?v.limitMaxl=v.defaultMaxl:v.limitMaxl=v.defaultMaxl+v.limitMaxBufferl}),y.$chatContWrap.on("scroll",function(e){b.whatchMore()})},b.init=function(){var e=function(e){var t=1;return e>=1&&5>=e?t=1:e>=6&&25>=e?t=2:e>=26&&100>=e?t=4:e>=101&&200>=e?t=8:e>=201&&400>=e?t=16:e>=401&&600>=e?t=32:e>=601&&(t=64),navigator.appVersion.indexOf("MSIE")>0&&(t+=2),t};b.bufferLength=0,b.Queue=d.create({hotplan:e,render:function(e){b.addView(e.join(""),e.length)}}),t.on("mod.center.userrole.ready",function(e){return h?(v.limitMaxl=v.limitConfig.low,v.defaultMaxl=v.defaultLenConf.low,void(v.limitMaxBufferl=v.bufferLenConf.low)):void(e.isVistor()?(v.limitMaxl=v.limitConfig.vistor,v.defaultMaxl=v.defaultLenConf.vistor,v.limitMaxBufferl=v.bufferLenConf.vistor):e.isSuperAdmin()?(v.limitMaxl=v.limitConfig.superAdmin,v.defaultMaxl=v.defaultLenConf.superAdmin,v.limitMaxBufferl=v.bufferLenConf.superAdmin):e.isRoomAdmin()?(v.limitMaxl=v.limitConfig.roomAdmin,v.defaultMaxl=v.defaultLenConf.roomAdmin,v.limitMaxBufferl=v.bufferLenConf.roomAdmin):e.isAnchor()?(v.limitMaxl=v.limitConfig.anchor,v.defaultMaxl=v.defaultLenConf.anchor,v.limitMaxBufferl=v.bufferLenConf.anchor):(v.limitMaxl=v.limitConfig.normal,v.defaultMaxl=v.defaultLenConf.normal,v.limitMaxBufferl=v.bufferLenConf.normal))}),t.on("mod.chat.msg.msg",function(e){void 0!==e&&""!==e&&b.addQueue(e)}),t.on("mod.chat.msg.clear.chat",function(){b.clearChat()}),t.on("mod.chat.locker.release",function(){b.release()})},b.whatchMore=function(){var e=y.$chatContWrap[0],t=e.scrollHeight,a=e.scrollTop;parseInt(t-y.$chatContWrap.height()-a,10)<=0?(b.release(),y.$moreMessageWrap.hide()):(y.$roll.addClass("c-scr"),y.$chatCont.find('[data-type="roll"]').find("span").text("解锁"),v.limitMaxl=v.defaultMaxl+v.limitMaxBufferl,b.bufferLength>0&&y.$moreMessageWrap.show())},b.listenNobleBarrage=function(){if(0!==_){var t=y.$chatCont.find(".js-noble-barrage-tag"),a=y.$chatCont.offset().top;e(t).each(function(t,i){var s=e(i).offset().top;return a>s?void b.addNobleBarrageLayer(i):!1})}},b.addNobleBarrageLayer=function(t){var a,i=e(".noble-barrage-suspend");clearTimeout(v.nobleBarrageSuspendTimer),e(t).removeClass("js-noble-barrage-tag"),a=e(t)[0].outerHTML,y.nobleBarrageLayer.empty().show().append(a),i.find(".c-list .js-fans-chart span[chatid]").css("color","#3c3c3c"),i.find(".c-list .js-fans-chart").addClass("fans-chart"),y.nobleLayerWrap.stop(!0).animate({top:0},300,function(){v.nobleBarrageSuspendTimer=setTimeout(function(){var a=e(t).outerHeight(!0);y.nobleLayerWrap.animate({top:"-="+a},300,function(){y.nobleBarrageLayer.hide().html(""),y.nobleLayerWrap.css({top:0})})},v.nobleBarrageSuspendTime)})},b.addQueue=function(t){e(t).find(".nick").attr("rel")===$SYS.uid?b.addView(t,1,!0):b.Queue.push(t)},b.addView=function(e,t,a){var i="99+";y.$chatList.append(e),b.limit(),y.$roll.hasClass("c-scr")?(b.bufferLength+=t||1,i=b.bufferLength<=99?b.bufferLength:i,y.$moreMessage.text("有"+i+"条新消息"),y.$moreMessageWrap.show(),(b.bufferLength>=v.limitMaxBufferl||a)&&(b.release(),b.listenNobleBarrage())):(b.release(),b.listenNobleBarrage())},b.clearChat=function(){y.$chatList.html(""),t.trigger("mod.chat.msg.msg",'<li class="jschartli"><p class="my-cont"><span class="hy-org">已清空所有弹幕内容</span></p></li>'),b.release()},b.release=function(){v.limitMaxl=v.defaultMaxl,b.bufferLength=0,y.$moreMessage.text("有0条新消息"),y.$moreMessageWrap.hide(),y.$roll.removeClass("c-scr"),y.$chatCont.find('[data-type="roll"]').find("span").text("锁定"),b.scrollToBottom()},b.limit=function(){var e=y.$chatList.children(),t=e.length-v.limitMaxl;t>0&&(e.slice(0,t).remove(),b.release())},b.scrollToBottom=function(){if(!y.$roll.hasClass("c-scr")){var e=y.$chatContWrap.prop("scrollHeight");y.$chatContWrap.scrollTop(e)}},b.sendVerify=function(t){m.checkPhone({isDanmu:1,success:function(){e.isFunction(t)&&t()}})},b.muteNoSession={tpl:function(){var e=['<div class="super-global-mute-wrap" id="super-global-mute-wrap">','<div class="super-global-mute-close js-close">×</div>','<span class="super-global-mute-icon"></span>','<div class="super-global-mute-header">请通过安全校验</div>','<div class="super-global-mute-area"></div>','<div class="super-global-mute-captcha js-captcha js-captcha-error"></div>',"</div>"].join("");return e},show:function(t){var a=this;a.dstUid=t,e("#super-global-mute-wrap").length||(e("body").append(a.tpl()),a.v3Init(),a.bindEvt())},hide:function(){e("#super-global-mute-wrap").length&&e("#super-global-mute-wrap").remove()},v3Init:function(){if(!v.V3Instance){var t=this,a=e("#super-global-mute-wrap").find(".js-captcha");v.V3Instance=p.init(a,{op_type:30,idpre:"super-global-mute",success:t.muteAjax||function(){},error:t.v3Error||function(){}},{area:".super-global-mute-area"})}},refresh:function(){v.V3Instance&&v.V3Instance.refresh()},getResult:function(){var e={};return v.V3Instance&&(e=v.V3Instance.getFastResult()),e},v3Error:function(){e("#super-global-mute-wrap").find("js-captcha-error").text("验证码加载失败，请稍后重试。")},muteAjax:function(){var t=b.muteNoSession,a=e.extend(!0,{dst_uid:t.dstUid||"",room_id:o.get("room.room_id")},t.getResult());e.ajax({url:"/member/forwardmute/index",type:"post",data:a,dataType:"json",success:function(a){0===+a.code?(t.hide(),v.V3Instance=null):(a.msg&&e.dialog.tips_black(a.msg),t.refresh())},error:function(){e.dialog.tips_black("请求失败")}})},bindEvt:function(){var t=this;e("#super-global-mute-wrap").on("click",".js-close",function(){t.hide(),v.V3Instance=null})}};var x=function(a){var s=t.fire("mod.center.userrole.get"),n={len:200},r={};"full"===t.fire("mod.video.state.get")?2:1;if("chatres"===a.type||"chatmsg"===a.type){var l="";switch(isNaN(a.egtt)&&(a.egtt=0),parseInt(a.egtt,10)){case 1:l="6鱼翅礼物666连击即可获得";break;case 2:l="66鱼翅礼物666连击即可获得";break;case 4:l="666鱼翅礼物666连击即可获得";break;default:l=""}r=e.extend(!0,{},{isSender:parseInt(a.uid,10)===parseInt(o.get("sys.uid"),10),uid:a.uid,nn:a.nn,txt:a.txt,cid:a.cid,cbid:a.cbid,level:parseInt(a.level,10)||0,gt:parseInt(a.gt,10)||0,col:parseInt(a.col,10)||0,ct:parseInt(a.ct,10)||0,rg:parseInt(a.rg,10)||1,pg:parseInt(a.pg,10)||1,dlv:a.dlv||0,dc:a.dc||0,bdlv:a.bdlv||0,ut:a.ut||"",at:a.at||"",el:a.el||"",shark:a.shark||"",egtt:parseInt(a.egtt,10),txtitle:l,ic:a.ic||"",nl:parseInt(a.nl)||0,nc:parseInt(a.nc)||0,bnn:a.bnn,hc:a.hc,bl:parseInt(a.bl,10)||0,hl:parseInt(a.hl,10)||0,brid:a.brid,ol:parseInt(a.ol,10)||0,sahf:parseInt(isNaN(a.sahf)?1:a.sahf,10),lk:a.lk||""},r),"chatres"===a.type&&(r.isSender=!0,r.len=parseInt(a.len,10),e.extend(!0,n,{isSender:!0,res:a.res,cd:parseInt(a.cd,10),len:parseInt(a.len,10)}),t.trigger("mod.chat.msg.send.cd",n.cd),y.$chatSpeak.find('[data-type="cont"]').prop({maxlength:n.len}))}if("chatmessage"===a.type&&(r=e.extend(!0,{},{isSender:parseInt(a.sender,10)===parseInt(o.get("sys.uid"),10),uid:a.sender,nn:a.sender_nickname,txt:a.content,cid:a.chatmsgid,level:parseInt(a.level,10)||0,gt:parseInt(a.gt,10)||0,col:parseInt(a.col,10)||0,ct:parseInt(a.ct,10)||0,rg:parseInt(a.sender_rg,10)||1,pg:parseInt(a.sender_pg,10)||1,dlv:a.m_deserve_lev||0,dc:a.cq_cnt||0,bdlv:a.best_dlev||0,len:parseInt(a.maxl,10),ut:a.ut||"",at:a.at||"",shark:a.shark||""},r),e.extend(!0,n,{isSender:parseInt(a.sender,10)===parseInt(o.get("sys.uid"),10),res:a.rescode,cd:parseInt(a.cd,10),len:parseInt(a.len,10)}),t.trigger("mod.chat.msg.send.cd",n.cd),y.$chatSpeak.find('[data-type="cont"]').prop({maxlength:n.len})),n.res>0){if(n.isSender){var d="";switch(n.res){case"2":d="您已被禁言";break;case"5":d="全站禁言";break;case"6":d="主播设置仅粉丝可发言";break;case"206":d="非法操作";break;case"208":d="目标用户未找到";break;case"289":d="请不要重复发言。";break;case"290":d="您的发言速度过快....";break;case"294":e.dialog({content:"鱼翅余额不足，点击获取！",icon:"warning",okVal:"确定",ok:function(){window.location.href="/web_game/welcome/18",t.trigger("dys",{key:"dys.room.barrage.send.charge.action"})},cancelVal:"取消",cancel:function(){}}),t.trigger("dys",{key:"dys.room.barrage.send.charge.show"});break;case"363":b.sendVerify(function(){u.exe("js_sendmsg",i.encode([{name:"content",value:a.txt.replace(/\\/g,"\\\\")},{name:"col",value:a.col},{name:"sender",value:o.get("sys.uid")}]))});break;case"391":f.init({dys_type:1})}d.length&&t.trigger("mod.chat.msg.msg",g.sysMsg({msg:d}))}return void("288"!=n.res&&"356"!=n.res||(t.trigger("mod.chat.msg.msg",g.barrage(r,v.comboConfig)),t.trigger("mod.center.usergroup.set",r.uid,{pg:r.pg,rg:r.rg})))}if(s.isSuperAdmin()||s.isAnchor()||(n.len=r.len),t.trigger("mod.chat.msg.msg",g.barrage(r,v.comboConfig)),t.trigger("mod.center.usergroup.set",r.uid,{pg:r.pg,rg:r.rg}),o.get("sys.uid")==r.uid&&r.col>0){if(1===r.col&&"hjs"===r.shark)return;t.trigger("mod.userinfo.change",{change:{exp:10}})}},T=function(e){var a;if("uenter"===e.type){var s="";switch(isNaN(e.egtt)&&(e.egtt=0),parseInt(e.egtt,10)){case 1:s="6鱼翅礼物666连击即可获得";break;case 2:s="66鱼翅礼物666连击即可获得";break;case 4:s="666鱼翅礼物666连击即可获得";break;default:s=""}a={level:parseInt(e.level,10),lev:parseInt(e.level/10,10),dlv:parseInt(e.dlv,10)||0,dc:parseInt(e.dc,10)||0,bdlv:parseInt(e.bdlv,10)||0,gt:parseInt(e.gt,10)||0,rg:parseInt(e.rg,10)||1,pg:parseInt(e.pg,10)||1,uid:parseInt(e.uid,10),nn:e.nn||"",ut:e.ut||"",at:e.at||"",el:e.el||"",egtt:parseInt(e.egtt,10),txtitle:s,ic:e.ic||"",crw:e.crw,nl:parseInt(e.nl)||0,ceid:parseInt(e.ceid,10)||0,cbid:e.cbid,ol:parseInt(e.ol,10)||0,sahf:parseInt(isNaN(e.sahf)?1:e.sahf,10)};var n=!1;if(t.trigger("douyu.halloween.isUenterHalloween",a,function(e){n=e}),n)return}if("userenter"===e.type){var o=i.decode(e.userinfo).too();a={level:parseInt(o.level,10),lev:parseInt(o.level/10,10),dlv:parseInt(o.m_deserve_lev,10)||0,dc:parseInt(o.cq_cnt,10)||0,bdlv:parseInt(o.best_dlev,10)||0,gt:parseInt(o.gt,10)||0,rg:parseInt(o.rg,10)||1,pg:parseInt(o.pg,10)||1,uid:parseInt(o.id,10),nn:o.nick||"",ut:e.ut||"",at:e.at||""}}t.trigger("mod.chat.msg.msg",g.userEnter(a,v.comboConfig)),t.trigger("mod.center.usergroup.set",a.uid,{pg:a.pg,rg:a.rg})},C=function(e){var a,i="",s=o.get("sys.uid"),n="newblackres"===e.type;if("newblackres"===e.type){parseInt(e.otype,10);switch(a=parseInt(e.ret,10),n=n&&264===a,a){case 0:i=e.sid==s?e.dnic+"已被成功禁言":e.dnic+"已被禁言",s&&e.sid&&e.did&&o.get("sys.owner_uid")&&s==e.sid&&o.get("sys.owner_uid")==e.did&&t.trigger("mod.anchorwhitelist.sendEmail",{uid:e.did,operate_type:"mute"});break;case 4807:case 4808:i="该用户已被禁言。";break;case 264:i="贵族用户 "+(e.dnic||e.did),i+=" 防御了房管 "+(e.snic||e.sid)+" 的禁言 ",i+='<a class="noble--gagbtn" data-buy="defensemute" href="javascript:;">购买贵族防御禁言</a>';break;case 268:return void b.muteNoSession.show(e.did)}}"ntmet"!==e.type&&"muteinfo"!==e.type||t.trigger("mod.chat.msg.mute",e),t.trigger("mod.chat.msg.msg",g[n?"sysHtmlMsg":"sysMsg"]({msg:i}))};return w.init=function(){u.reg("room_data_chat",function(e){x(i.decode(e).too())}),u.reg("room_data_chat2",function(e){x(i.decode(e).too())}),u.reg("room_data_nstip",function(e){T(i.decode(e).too())}),u.reg("room_data_nstip2",function(e){T(i.decode(e).too())}),u.reg("room_data_luckdrawcd",function(e){t.trigger("mod.chat.msg.msg",g.lottery(e))}),u.reg("room_data_chatrep",function(t){var a=i.decode(t).too(),s="";s=1==a.state?"<p>您已成功举报！<p><br><p>超管在后台确认违规后，会对该用户<br />进行相应的处理，并对首位举报的用户赠<br />送100鱼丸。 鱼丸会直接发放到帐号上，无需通<br />过任务大厅领取。</p>":"<p>举报失败</p>",e.dialog.alert(s)}),u.reg("room_data_setadm",function(e){var a=i.decode(e).too();0!=a.rescode&&206!=a.rescode&&208!=a.rescode&&214!=a.rescode||(t.trigger("mod.chat.msg.msg",g.setAdmin(a)),0===parseInt(a.rescode,10)&&t.trigger("mod.center.usergroup.set",a.userid,{rg:a.group})),t.trigger("mod.room.userrole.get",a||{})}),u.reg("room_data_onekeyacc",function(a){var s=i.decode(a).too();"gbmres"===s.type&&(t.trigger("mod.chat.msg.msg",g.oneKey(s)),o.get("sys.uid")==s.uid&&(t.trigger("mod.center.onekey.closure",{code:57}),e.dialog.tips_black("当前用户已被封号不能发送弹幕！",3)),o.get("sys.uid")==s.ouid&&t.trigger("mod.anchorwhitelist.sendEmail",{uid:s.uid,operate_type:"ban"}))}),u.reg("room_data_sys",function(e){C(i.decode(e).too())}),u.reg("room_data_schat",function(e){t.fire("mod.chat.msg.shield").message||t.trigger("mod.chat.msg.msg",g.superBarrage(e))}),u.reg("room_data_athena_supermsg",function(e){t.fire("mod.chat.msg.shield").message||t.trigger("mod.chat.msg.msg",g.athenaSuperBarrage(e))}),t.on("mod.chat.msg.res.cq",function(e){var a=i.decode(e).too(),s=i.decode(a.sui).too();return s.id!=o.get("sys.uid")&&t.fire("mod.chat.msg.shield").allGift?!1:void t.trigger("mod.chat.msg.msg",g.chouqin(e))}),t.on("mod.chat.msg.gift",function(e,a){var s,n=i.decode(e).too();if("dgb"===n.type||"bgd"===n.type){if(s=g.gift(e,a),n.uid!=o.get("sys.uid")&&t.fire("mod.chat.msg.shield").allGift)return!1;t.trigger("mod.center.usergroup.set",n.uid,{pg:n.pg||1,rg:n.rg||1})}if("ggbb"===n.type&&(s=g.peck(e),n.did!=o.get("sys.uid")&&t.fire("mod.chat.msg.shield").message))return!1;if("donateres"===n.type){var r=i.decode(n.sui).too();if(s=g.balls(e),r.id!=o.get("sys.uid")&&t.fire("mod.chat.msg.shield").allGift)return!1;t.trigger("mod.center.usergroup.set",r.id,{pg:r.pg||1,rg:r.rg||1})}t.trigger("mod.chat.msg.msg",s)}),t.on("mod.chat.msg.peckprop",function(e){var a=i.decode(e).too();if(a.did==o.get("sys.uid")||!t.fire("mod.chat.msg.shield").message){var s=g.peckprop(a);t.trigger("mod.chat.msg.msg",s)}}),t.on("mod.chat.msg.res.rankupdate",function(e){var a=i.decode(e).too();return a.uid!=o.get("sys.uid")&&t.fire("mod.chat.msg.shield").message?!1:void t.trigger("mod.chat.msg.msg",g.rankupdate(e))}),t.on("mod.chat.msg.res.rankgap",function(e){t.trigger("mod.chat.msg.msg",g.rankgap(e))}),t.on("mod.chat.msg.res.olyw.luckburst",function(e){var a=i.decode(e).too();return a.uid!=o.get("sys.uid")&&t.fire("mod.chat.msg.shield").message?!1:void t.trigger("mod.chat.msg.msg",g.luckburst(e))}),u.reg("room_data_ulgrow",function(e){var a=i.decode(e).too();return a.uid!=o.get("sys.uid")&&t.fire("mod.chat.msg.shield").message?!1:void t.trigger("mod.chat.msg.msg",g.uplevel(e))}),u.reg("room_data_handler",function(e){var a=i.decode(e).too();return a.uid!=o.get("sys.uid")&&t.fire("mod.chat.msg.shield").message?!1:void("blab"!==a.type||1!==parseInt(a.ba,10)&&3!==parseInt(a.ba,10)||t.trigger("mod.chat.msg.msg",g.fansLevelUp(e)))}),u.reg("room_yz_data",function(e){var a=i.decode(e).too();return a.uid!=o.get("sys.uid")&&t.fire("mod.chat.msg.shield").message?!1:void("apkb"===a.type&&4===parseInt(a.cmd,10)&&t.trigger("mod.chat.msg.msg",g.winAnchorFans(e)))}),u.reg("room_data_wbsharesuc",function(e){var a=i.decode(e).too();return a.uid!=o.get("sys.uid")&&t.fire("mod.chat.msg.shield").message?!1:void t.trigger("mod.chat.msg.msg",g.wbsharesuc(e))}),u.reg("room_data_handler",function(e){var a=i.decode(e).too();"redirect"===a.type&&"wdf_video"===a.msgtype&&t.trigger("mod.chat.msg.msg",g.videoMomentRecord(a))}),u.reg("room_data_handler",function(e){var a=i.decode(e).too();if("gbroadcast"===a.type){var s=o.get("sys.webconfUrl").replace(/^http(s?):/,"").replace(/\/$/g,"")+"/resource/common/privilege_broadcast/broadcast.json";c.load(s,"privilegeBroadcasConfig",function(e){var s;1===parseInt(a.ft,10)?s=JSON.parse(a.gbcc):2===parseInt(a.ft,10)&&(s=i.decode(a.gbcc).too());var n=e[s.param].title;t.trigger("mod.chat.msg.msg",g.broadcastRecord(s,n))})}}),t.on("mod.center.onekey.closure",function(){t.trigger("mod.gift.auto.send.set",!1),t.trigger("mod.chouqin.auto.send.set",!1),t.trigger("mod.task.destroy",!1),t.trigger("mod.olyw.destroy",!1),t.trigger("mod.guess.destroy",!1),y.$chatSpeak.find('[data-type="send"]').addClass("b-btn-gray")}),u.reg("room_GCBroadCast_data",function(e){function s(e){var t=new String(Math.round(e/1e3)/10);return t.indexOf(".")>-1?t:t+".0"}function n(e,t){return a.string.format("{0}upload/{1}_middle.jpg",e,t)}var o=i.decode(e).too();if("qzembls"===o.type){var r=o.qzels,l=!1;if(""===r&&(l=!0),!l){r=i.isArray(r)?i.decode(r):[{value:r}];for(var d=0,c=r.length;c>d;d++){var u=r[d].value,m=u&&i.decode(u).too(),p=v.defaultAvatar;if(m){var f={ec:m.ec>=1e4?s(m.ec)+"万":m.ec,uname:m.uname,icon:m.icon?n(v.avatarDomain,m.icon):p};t.trigger("mod.chat.msg.msg",g.guessGame(f))}}}}})},{init:function(){y.init(),k.init(),b.init(),w.init()}}}),define("douyu/page/room/normal/mod/chat-cmd",["jquery","shark/observer","shark/util/flash/data/1.0","douyu/page/room/base/api"],function(e,t,a,i){var s,n,o,r,l,d,c;return s={broadcastResultUrl:"/api/bcmd/dealBroadResult",gatewayResultUrl:"/api/bcmd/dealResult",cdTime:1},n={interval:function(){var e=c.doms.sender,t=e.html(),a=s.cdTime,i=null,n=null;n=function(){0>=a?(e.removeClass("b-btn-gray").html(t),clearInterval(i)):(e.addClass("b-btn-gray").html(a),a--)},n(),i=setInterval(function(){n()},1e3)}},l={isCurrentAnchor:function(){return Number($SYS.uid)===$ROOM.owner_uid}},c={init:function(){var t,a=e("#anchor-info");this.timer=null,this.doms={chatBox:e("#js-live-room-normal-right"),speakBox:e("#js-chat-speak"),followBtn:a.find('[data-anchor-info="follow"]'),followedBtn:a.find('[data-anchor-info="followed"]'),fansNum:a.find('[data-anchor-info="nic"]')},t=this.doms,t.speakCont=t.speakBox.find('[data-type="cont"]'),t.sender=t.speakBox.find('[data-type="send"]'),t.speakBox.before('<div class="chat-cmdbox"><div class="chat-cmdboxresult"><div class="chat-cmdboxresult-content"></div></div></div>'),t.cmdBox=t.speakBox.prev().find(".chat-cmdboxresult-content"),t.cmdBoxWrap=t.cmdBox.parent()},clearInput:function(){this.doms.speakCont.val("")},setCont:function(e,t,a){var i=t||{common:"#f03",keyword:"#46abff"};this.doms.cmdBox.html(this.translate(e,i.keyword)).css("color",i.common),this.showCont(1e3*(a||60))},showCont:function(e){var t=this,a=this.doms.cmdBoxWrap.stop(!0,!0),i=a.height("auto").height();clearTimeout(t.timer),a.height(0).animate({height:i},function(){t.timer=setTimeout(function(){a.animate({height:0})},e)})},tpls:{cmdFailed:"指令操作失败！",followAnchorOwn:"不可以关注自己的直播间噢！<br />如需帮助，请输入“#帮助”或“#help”",willJump:"空降部队准备完毕，3秒后即将空降",unsafeScript:"抱歉，暂时无法支持您输入的内容|br|如需帮助，请输入“#帮助”或“#help”"},cachedResult:{},translate:function(e,t){return e.replace(/\|br\|/g,"<br>").replace(/“([^”]+)”/g,'“<span style="color:'+t+'">$1</span>”')}},o={"帮助|help":function(t,i){var n={type:"cmdres",cmd:e.trim(t+" "+i)},o=a.encode(n),r=o,l=c.cachedResult[r];return l?(c.setCont(l.str_msg,l.colors,l.str_msg_showtime),DYS.sub({action_code:"click_msginstr_send",ext:{instr:n.cmd,is_right:1}})):d.getResult(s.gatewayResultUrl,r,1),c.clearInput(),!1}},r={"空降":function(t,a){var i=window.location;return e.trim(a)?(c.setCont(c.tpls.willJump),setTimeout(function(){i.href=i.protocol+"//"+i.host+"/"+a},3e3),DYS.sub({action_code:"click_msginstr_send",ext:{instr:t,is_right:1}}),c.clearInput(),!0):void 0},"关注":function(t){var a=c.doms,i=$ROOM.room_id,s=c.tpls;return l.isCurrentAnchor()?(c.setCont(c.tpls.followAnchorOwn),DYS.sub({action_code:"click_msginstr_send",ext:{instr:t,is_right:0}})):e.ajax("/room/follow/add_cmd/"+i,{type:"post",dataType:"json",data:{room_id:i},error:function(){c.setCont(s.cmdFailed)},success:function(e){var i,s=0;e&&0===e.error?(s=1,i=a.fansNum.length?parseInt(a.fansNum.html().replace(/,/g,""),10):0,a.fansNum.html(i+1),a.followBtn.addClass("hide"),a.followedBtn.removeClass("hide")):s=0,c.setCont(e.msg),DYS.sub({action_code:"click_msginstr_send",ext:{instr:t,is_right:s}})}}),c.clearInput(),!1},"取关":function(t){var a=c.doms,i=$ROOM.room_id,s=c.tpls;return l.isCurrentAnchor()?void 0:(e.ajax("/room/follow/cancel_cmd/"+i,{type:"post",dataType:"json",data:{room_id:i},error:function(){c.setCont(s.cmdFailed),DYS.sub({action_code:"click_msginstr_send",ext:{instr:t,is_right:0}})},success:function(e){var i,s=0;e&&0===e.error?(s=e.error?0:1,a.followBtn.removeClass("hide"),a.followedBtn.addClass("hide"),i=a.fansNum.length?parseInt(a.fansNum.html().replace(/,/g,""),10):0,i--,i=i>-1?i:0,a.fansNum.html(i)):s=0,c.setCont(e.msg),DYS.sub({action_code:"click_msginstr_send",ext:{instr:t,is_right:s}})}}),c.clearInput(),!0)},"开始投票|结束投票|查看投票结果|开始猜词|放弃猜词":function(e,t){var i=a.encode([{value:t}]),s=[{name:"type",value:"cmd"},{name:"cmd",value:e},{name:"params",value:i}];return d.exeCmd(s),!0}},d={init:function(){this.whiteList=!1,this.bindEvents()},bindEvents:function(){var e=this;t.on("mod.chat.cmd.check",function(t){var a,i=!1,s=e.getCmd(t),n=s.action,l=s.param;if(!n)return!1;if(/<script[^>]*?>/.test(l))return c.setCont(c.tpls.unsafeScript),DYS.sub({action_code:"click_msginstr_send",ext:{instr:n,is_right:0}}),!0;for(a in o)if(new RegExp("^("+a+")$").test(n)){i=o[a](n,l);break}for(a in r)if(new RegExp("^("+a+")$").test(n)){i=r[a](n,l);break}return i}),i.reg("room_data_commandresult",function(t){e.getResult(s.broadcastResultUrl,t,0,1)}),i.reg("room_data_handler",function(t){var i=a.decode(t).too();"cmdres"===i.type&&(i.cd=i.cd?i.cd:0,i.len=i.len?i.len:200,s.cdTime=i.cd/1e3,n.interval(),e.getResult(s.gatewayResultUrl,t))})},getCmd:function(t){var a=/^#([^#| ]+)\s?(.*)/i,i=e.trim(t),s=i.match(a)||[];return s&&s[0]?{input:i,action:s[1].replace(/\\/g,"\\\\"),param:s[2].replace(/\\/g,"\\\\")}:{}},exeCmd:function(e){i.exe("js_barrage_command",a.encode(e)),c.clearInput()},getResult:function(t,s,n,o){var r=a.decode(s).too();e.ajax({url:t,type:"post",data:"str="+encodeURIComponent(s),dataType:"json",error:function(){c.setCont(c.tpls.cmdFailed),DYS.sub({action_code:"click_msginstr_send",ext:{instr:r.cmd,is_right:0}})},success:function(e){var t=e.data,a=0;0===e.error&&t&&t.str_msg&&(n&&(c.cachedResult[s]=t),o&&i.exe("js_barrage_command_showresult",t.str_msg,t.str_msg_showtime),c.setCont(t.str_msg,t.colors,t.str_msg_showtime),a=t.is_right||0,DYS.sub({action_code:"click_msginstr_send",ext:{instr:r.cmd,is_right:a}}))}})}},{init:function(){c.init(),d.init()}}}),define("douyu/page/room/normal/mod/chat-link-barrage",["jquery","shark/observer","shark/util/flash/data/1.0","douyu/context","douyu/com/user","douyu/page/room/base/api"],function(e,t,a,i,s,n){var o={init:function(){this.initConfigs(),this.initDoms(),this.checkSwitch(),this.bindListen()},initConfigs:function(){this.configs={urls:{handleLink:"/lapi/member/barrageLink/filter"},isSending:0,isBindPhone:1,linkBarrageSwitch:i.get("colligate.barrage_link.switch"),linkBarrageConfig:i.get("colligate.barrage_link.link_pre"),isRenderPanel:0,linkCheckRegMap:null,typeMap:{1:1,2:2,3:3,4:4}},this.linkRes={canUse:1,linkSwitch:0,lastValue:"",linkValue:""}},initDoms:function(){this.doms={$chatSpeak:e("#js-chat-speak"),$linkBarrageBtn:e("#js-chat-speak").find("#js-link-barrage")}},startApp:function(){this.doms.$linkBarrageBtn.removeClass("hide"),this.bindEvent()},checkSwitch:function(){return this.configs.linkBarrageSwitch&&this.configs.linkBarrageConfig?void this.startApp():!1},appendLinkBarragePanel:function(){var e=this.doms,t=['<div class="hyperlink-chat-box" style="display: none;">','<div class="hyperlink-chat-title">',"<h3>超链弹幕</h3>","<p>想去哪？我的弹幕引导你~</p>","</div>",'<div class="hyperlink-chat-close"></div>','<a href="https://www.douyu.com/cms/gong/201801/05/7017.shtml" target="_blank" class="hyperlink-chat-introduce">介绍</a>','<div class="hyperlink-chat-content">','<div class="hyperlink-chat-info">设置以下跳转链接，其他人点击你的弹幕可直接过去哟~</div>','<div class="hyperlink-chat-link">','<textarea class="js-linkBarrage-area" type="text" placeholder="房间号/鱼吧贴子链接/视频链接"></textarea>',"</div>","</div>",'<div class="hyperlink-chat-attention" style="display:none;">请勿重复发送弹幕！</div>',"</div>"].join("");e.$chatSpeak.append(t),e.$linkBarragePanel=e.$chatSpeak.find(".hyperlink-chat-box"),e.$linkBarrageArea=e.$chatSpeak.find(".js-linkBarrage-area"),e.$remainTip=e.$chatSpeak.find(".hyperlink-chat-attention")},reqHandleLink:function(t){var a=this,i=a.configs.urls,s=e.Deferred(),n=encodeURI(t);return e.ajax({url:i.handleLink,dataType:"json",data:{link:n}}).done(function(e){e&&0==e.error&&e.data?s.resolve(e.data):s.reject(0,e.data)}).fail(function(e){s.reject(0)}),s},handleLinkBarrageData:function(){var t=this,a=this.doms,i=(new RegExp(/^\d{1,12}$/),e.Deferred()),s=this.linkRes,n=a.$linkBarrageArea.val().toString();return s.linkValue=n.trim(),s.canUse=1,s.linkSwitch?""!=s.linkValue?this.reqHandleLink(s.linkValue).done(function(e){s.lastValue=s.linkValue,s.linkValue=e,i.resolve(s)}).fail(function(e,a){s.canUse=0,i.resolve(s),t.showRemainTips(a||"请填写正确的链接信息")}):(t.showRemainTips("请输入跳转链接"),
s.canUse=0,i.resolve(s)):(s.linkSwitch=0,i.resolve(s)),i},showRemainTips:function(e){var t=this.doms;t.$remainTip.text(e).show()},checkCanUse:function(){return s.check()?this.configs.isBindPhone?!0:(e.dialog.tips_black("绑定手机号才能发超链弹幕哟"),!1):(s.show("login"),!1)},openLinkBarrage:function(){var e=this.configs,t=this.doms;this.checkCanUse()&&(e.isRenderPanel||(e.isRenderPanel=1,this.appendLinkBarragePanel(),this.bindAreaEvent()),t.$linkBarragePanel.show(),this.linkRes.linkSwitch=1)},closeLinkBarrage:function(){var e=this.doms;e.$linkBarragePanel.hide(),e.$remainTip.hide(),e.$linkBarrageArea.val(""),this.linkRes.linkSwitch=0},bindEvent:function(){var a=this,i=a.doms;i.$chatSpeak.on("click","#js-link-barrage",function(){return a.openLinkBarrage(),t.trigger("dys",{key:"dys.room.linkBarrage.enterbtn"}),!1}).on("click",".hyperlink-chat-close",function(){return a.closeLinkBarrage(),!1}).on("click",".hyperlink-chat-introduce",function(){t.trigger("dys",{key:"dys.room.linkBarrage.intro"})}),e("#js-chat-cont").on("click",".hyperlink-chat-msg",function(){var i=e(this),s=a.configs.typeMap;t.trigger("dys",{key:"dys.room.linkBarrage.lmsg",type:s[i.attr("data-msg-type")]||-1})})},bindAreaEvent:function(){var e=this,t=e.doms;t.$linkBarrageArea.on("focus",function(){t.$remainTip.hide()})},bindListen:function(){var a=this,i=this.configs,s=a.linkRes;t.on("room.get.isBindPhone.status",function(e){a.configs.isBindPhone=+e?1:0}),t.on("room.get.linkBarrage.status",function(){var t=e.Deferred();return s.linkSwitch?i.isSending?t.reject():(i.isSending=1,a.handleLinkBarrageData().done(function(e){i.isSending=0,t.resolve(e)}),t):t.resolve(s)})}};return{init:function(){o.init()}}}),define("douyu/page/room/normal/mod/chat-send",["jquery","shark/observer","shark/util/flash/data/1.0","shark/util/date/1.0/date","douyu/context","douyu/com/user","douyu/page/room/base/api","douyu/page/room/normal/mod/chat-msg-tmp","shark/util/storage/1.0"],function(e,t,a,i,s,n,o,r,l){var d={currentVal:"",lastText:"",cdTime:1,defval:"#A9A9A9",cursurPosition:0,placeholder:{deft:"这里输入聊天内容",help:"试着输入“#帮助”，看看会发生什么吧",follow:"试着输入“#关注”吧，可以关注主播噢"},normalLimitStr:"",userRole:{},isSetFansSpeak:!1,hasFansMedal:!1,isMsgMute:!1,isNormalStatus:!1},c={},u={},g={},m={};return c.render=function(){var t,a="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;t=a?'<a class="shie-pc-link" href="/client?platform=4" target="_blank" data-link="mac-client"><div class="shie-pc-client-icon"></div><span>MAC客户端</span></a>':'<a class="shie-pc-link" href="/client?platform=3" target="_blank" data-link="pc-client"><div class="shie-pc-client-icon"></div><span>PC客户端</span></a>';var i=['<div class="face-box" style="display:none;"></div>','<div class="speak-up clearfix">','<div class="expression fl">','<a class="e-btn" href="javascript:;" title="表情"></a>',"</div>",'<div id="js-msg-barrage" class="unread-msgs fl">','<a class="m-btn" href="javascript:;" title="发站内信"><i class="m-icon"></i></a>','<i class="m-left-num hide"></i>',"</div>",'<div id="js-noble-speaker-btn" class="fl noble--broadcast-box hide"></div>','<div class="fl noble--barrage-box status--nobel-disabled"></div>','<div id="js-fans-barrage" class="fans-barrage fl">','<a class="fans-barrage-btn" data-type="fans-barrage-btn" href="javascript:;" title="粉丝弹幕"><i class="fans-barrage-icon"></i></a>',"</div>",'<div id="js-super-msg" class="big-chat fl hide">','<a class="big-chat-btn" data-type="super-msg-btn" href="javascript:;" title="超大弹幕"></a>',"</div>",'<div id="js-filter-keywords" class="filter-keywords fl ">','<a class="filter-keywords-btn" data-type="filter-keywords-btn" href="javascript:;" title="过滤关键词"><i class="filter-keywords-icon"></i></a>',"</div>",'<div id="js-link-barrage" class="hyperlink-chat fl hide">','<a class="hyperlink-chat-btn" href="javascript:;" title="超链弹幕">','<i class="hyperlink-chat-icon"></i>',"</a>","</div>",'<div class="shie-gift fr">','<div class="shie-tips" data-shie="tips">','<a class="shie-tips-close" href="javascript:;" data-shie="cls"></a>','<span class="shie-tips-txt1">鲨鱼娘检测到您屏幕卡顿！</span>','<span class="shie-tips-txt2">已为您屏蔽小礼物特效</span>','<label class="shie-tips-label">','<input class="shie-tips-label-input" type="checkbox" name="" data-input="tips">','<span class="shie-tips-label-span">本周不再提示</span>',"</label>",'<span class="shie-tips-arrow shie-tips-arrow1"></span>','<span class="shie-tips-arrow shie-tips-arrow2"></span>',"</div>",'<div id="js-shie-gift" class="shie shie-switch-open">','<dl class="shie-site-list" id="shie-site-list">','<dd class="shie-pc-client">'+t+"</dd>",'<dd class="shie-input" data-shield-type="allGift" data-shield-status="0">','<div class="shie-checkbox-icon" data-shidld-style="cheacked"></div>',"<span>屏蔽全部礼物</span>","</dd>",'<dd class="shie-input" data-shield-type="message" data-shield-status="0">','<div class="shie-checkbox-icon" data-shidld-style="cheacked"></div>',"<span>屏蔽消息通知</span>","</dd>",'<dd class="shie-input" data-shield-type="videoBroadcast" data-shield-status="0">','<div class="shie-checkbox-icon" data-shidld-style="cheacked"></div>',"<span>屏蔽视频广播</span>","</dd>",'<dd class="shie-input" data-shield-type="smallgift" data-shield-status="0">','<div class="shie-checkbox-icon" data-shidld-style="cheacked"></div>',"<span>屏蔽小礼物</span>","</dd>",'<dd class="shie-site-list-arrow shie-site-list-arrow1"></dd>','<dd class="shie-site-list-arrow shie-site-list-arrow2"></dd>',"</dl>",'<div class="shie-switch">','<span class="shie-input" id="shie-switch">','<div class="shie-checkbox-icon"></div>',"<span>屏蔽全部特效</span>","</span>","</div>","</div>","</div>","</div>",'<div id="js-send-msg" class="chat-feat clearfix">','<textarea class="cs-textarea" name="" maxlength="50" placeholder="这里输入聊天内容" tabindex="1" data-type="cont"></textarea>','<p class="login-inside" data-type="log"><a class="is-log" href="javascript:;" data-type="login">登录</a>发弹幕，参与主播互动</p>','<div class="b-btn b-btn-gray" data-type="send">发送</div>',"</div>",'<div id="js-noble-speaker" class="chat--broadcast-box hide"></div>','<div class="chat-bottom-ad hide" data-dysign="30011" ></div>'];e("#js-chat-speak").html(i.join(""))},c.render(),c.init=function(){c.$target=e("#js-send-msg"),c.$content=c.$target.find('[data-type="cont"]'),c.$send=c.$target.find('[data-type="send"]'),c.$log=c.$target.find('[data-type="log"]'),c.changePlaceholder(),d.isLogin=n.check(),d.isLogin?u.logStatus.normal():u.logStatus.notLogin(),t.on("mod.chat.send",function(e){var a=parseInt(e.npv,10);d.isLogin&&!a&&(d.isNormalStatus=!0,u.logStatus.normal()),1===a&&(u.logStatus.bindPhone(),t.trigger("room.get.isBindPhone.status",0),c.$log.find(".is-log").on("mousedown",function(){t.trigger("dys",{key:"dys.room.barrage.bindphone"})}))}),t.on("mod.chat.msg.mute",function(e){var t=c.$log.data("show");if(0===t||3===t||4===t){var a=1e3*e.met||0,s=parseInt(e.mtype,10)||1;s>0&&a>0?(d.normalLimitStr="您已被"+["房间","房间","全站","全站"][s-1]+'禁言。<span class="is-mute-type">禁言类型：0'+s+"</span><br />解禁时间:"+i.format(new Date(a),"yyyy-MM-dd hh:mm:ss")+'<a class="is-mute" data-type="mute" href="/cms/gong/201601/06/2924.shtml" target="_blank">用户发言须知</a>',d.isMsgMute=!0,u.logStatus.normalLimit()):d.isMsgMute=!1}}),t.on("mod.chat.msg.exp",function(e){var t=c.$content[0],a=c.$content.attr("placeholder");t.value===a&&(t.value=""),t.value.length<t.maxLength&&(t.value=t.value.substring(0,d.cursurPosition)+"[emot:"+e+"]"+t.value.substring(d.cursurPosition),t.focus())}),t.on("mod.chat.msg.color.set",function(e,t){null===e?"triggerClick"!=t?c.$content.removeAttr("style").focus():c.$content.removeAttr("style"):"triggerClick"!=t?c.$content.css({color:e}).focus():c.$content.css({color:e})}),t.on("mod.chat.msg.send.cd",function(e){d.cdTime=e})},c.changePlaceholder=function(){var e=d.placeholder.deft,t=Math.random();t>.5&&.75>=t?e=d.placeholder.help:t>.75&&1>=t&&(e=d.placeholder.follow),c.$content.attr({placeholder:e})},u.roomLinkCheck=function(t){var a=/\[room\=([^\]]+)\]/gi,i=/\[room\=([a-z\d]+)\]/gi,s=t.match(a),n=1;return s&&e.each(s,function(e,t){return i.test(t)?void 0:(n=0,!1)}),n},u.sendMsg=function(){var i,g=e.trim(c.$content.val())||e.trim(d.currentVal),m=t.fire("mod.chat.msg.color.get"),p=m.color,f=m.pid,h=m.ifs,v=m.sMsg,b=m.nl>0?1:0;"full"===t.fire("mod.video.state.get")?2:1;if(!c.$send.hasClass("b-btn-gray"))return""===g?void c.$content.val("").focus():n.check()?void(t.fire("mod.chat.cmd.check",g)||t.fire("room.get.linkBarrage.status").done(function(n){var m,y=n||{},k={1:1,2:2,3:3,4:4};if(5!=s.get("sys.groupid")&&s.get("sys.uid")!=s.get("room.owner_uid")&&d.lastText===g)return void t.trigger("mod.chat.msg.msg",r.sysMsg({msg:"请不要重复发言。"}));if(!u.roomLinkCheck(g))return void t.trigger("mod.chat.msg.msg",r.sysMsg({msg:"您输入的代码中含有非法字符，请重新输入。"}));if(""===g.replace(/\[emot:[A-Za-z0-9_]+\]/g,"")&&(p=0),i=[{name:"content",value:g.replace(/\\/g,"\\\\")},{name:"col",value:p},{name:"type",value:"chatmessage"},{name:"dy",value:s.get("room.device_id")},{name:"sender",value:s.get("sys.uid")},{name:"pid",value:f},{name:"ifs",value:h},{name:"hg",value:v},{name:"nc",value:b},{name:"rev",value:+l.get("fansCrazyBarrage")?1:0}],y.linkSwitch){if(!y.canUse)return;m=y.linkValue.split("_"),t.trigger("dys",{key:"dys.room.linkBarrage.send",type:k[m[0]]||-1}),i.push({name:"lk",value:y.linkValue})}o.exe("js_sendmsg",a.encode(i)),d.lastText=g,c.$content.val("").focus(),d.currentVal="",d.cdTime>0&&u.interval(),t.trigger("activity.danmuh5.firstmsg");var w=e('#js-color-barrage [data-type="cbt"]'),_=w.hasClass("c-btn-on")?1:2;t.trigger("dys",{key:"dys.room.barrage.send",type:_,code:1===_?w.data("code"):void 0})})):void n.show("login")},u.interval=function(e){var t=c.$send.html(),a=e||d.cdTime,i=null,s=null;s=function(){0>=a?(c.$send.removeClass("b-btn-gray").html(t),clearInterval(i)):(c.$send.addClass("b-btn-gray").html(a),a--)},s(),i=setInterval(function(){s()},1e3)},u.logStatus={normal:function(){c.$log.removeClass("login-inside-nologbor login-inside-mute").hide().data("show",0),c.$send.removeClass("b-btn-gray")},notLogin:function(){c.$log.removeClass("login-inside-mute").addClass("login-inside-nologbor").show().data("show",1),c.$send.addClass("b-btn-gray")},bindPhone:function(){c.$log.removeClass("login-inside-mute").addClass("login-inside-nologbor").show().html('<a class="is-log" data-type="phobi" href="/member/cp#phone" target="_blank">验证手机号</a>即可发送弹幕！').data("show",2),c.$send.addClass("b-btn-gray")},normalLimit:function(){d.normalLimitStr&&(c.$log.addClass("login-inside-nologbor login-inside-mute").show().html(d.normalLimitStr).data("show",3),c.$send.addClass("b-btn-gray"))},fansLimit:function(){c.$log.removeClass("login-inside-mute").addClass("login-inside-nologbor").html("想和主播聊天，先办卡吧！").show().data("show",4),c.$send.addClass("b-btn-gray")}},u.fansSpeakCheck=function(){var e=String(s.get("sys.uid"))===String(s.get("room.owner_uid")),t=5===parseInt(s.get("sys.groupid"),10),a=4===parseInt(d.userRole.group,10);return!d.isNormalStatus||e||t?void 0:d.isMsgMute?void u.logStatus.normalLimit():d.userRole.userid===String(s.get("sys.uid"))&&a?void(c.$send.hasClass("b-btn-gray")&&u.logStatus.normal()):void(d.isSetFansSpeak&&!d.hasFansMedal?u.logStatus.fansLimit():u.logStatus.normal())},g.init=function(){c.$log.on("click",'[data-type="login"]',function(e){e.preventDefault(),n.show("login"),t.trigger("dys",{key:"dys.room.chat.login.click"})}),e("#js-chat-speak").on("click",'[data-link="mac-client"]',function(){t.trigger("dys",{key:"dys.room.clientDownload.click",d_type:1})}).on("click",'[data-link="pc-client"]',function(){t.trigger("dys",{key:"dys.room.clientDownload.click",d_type:2})}),c.$send.on("click",function(e){e.preventDefault(),d.currentVal=c.$content.val(),u.sendMsg()}),c.$content.on("keydown click focus keyup",function(t){var a=e("#js-fans-barrage>a.fans-barrage-btn");if("chat-color"==a.attr("data-status")||(a=e("#js-color-barrage>a.c-btn")),e(this).css("color",a.css("color")),document.selection){var i=document.selection.createRange(),s=document.body.createTextRange(),n=0;for(s.moveToElementText(this);s.compareEndPoints("StartToStart",i)<0;n++)s.moveStart("character",1);d.cursurPosition=n}else d.cursurPosition=this.selectionStart}).on("keypress",function(e){return 13===e.which?(d.currentVal=this.value,u.sendMsg(),!1):void 0}).on("input propertychange",function(){this.value.length>=this.maxLength&&(this.value=this.value.substr(0,this.maxLength))}).on("blur",function(){""===e(this).val()&&e(this).css("color",d.defval)}),""===c.$content.val()&&c.$content.css("color",d.defval)},m.init=function(){o.reg("room_data_chatinit",function(e){var i=a.decode(e).too(),n=t.fire("mod.center.userrole.get"),o=parseInt(i.maxl,10);n.isAnchor()||n.isSuperAdmin()?c.$content.prop({maxLength:200}):s.get("sys.uid")==i.uid&&c.$content.prop({maxLength:o}),i.fcd&&i.fcd>0&&u.interval(parseInt(i.fcd/1e3,10)),d.cdTime=i.cd/1e3}),o.reg("room_data_reg",function(e){if(!t.fire("mod.chat.cmd.check",e)){if(!n.check())return n.show("reg"),void o.exe("js_sendhandler",[2,""]);var i=[{name:"content",value:e.replace(/\\/g,"\\\\")},{name:"sender",value:s.get("sys.uid")}];o.exe("js_sendmsg",a.encode(i)),c.$content.val(""),d.cdTime>0&&u.interval(),t.trigger("activity.danmuh5.firstmsg"),o.exe("js_sendhandler",[0,d.cdTime])}}),t.on("mod.room.userrole.get",function(e){d.userRole=e,u.fansSpeakCheck()}),t.on("mod.room.user.fansMedal.info",function(e){d.hasFansMedal=parseInt(e.is_cbdg,10)||0,u.fansSpeakCheck()}),t.on("mod.anthor.setFansSpeak.get",function(e){d.isSetFansSpeak=parseInt(e.soff,10)||0,u.fansSpeakCheck()}),o.reg("room_data_handler",function(e){var t=a.decode(e).too();"speakOnlyFans"===t.type&&(d.isSetFansSpeak=parseInt(t.soff,10)||0,u.fansSpeakCheck())})},{init:function(){c.init(),g.init(),m.init()}}}),define("douyu/page/room/normal/mod/chat-user-card",["jquery","shark/observer","shark/util/lang/1.0","shark/util/flash/data/1.0","douyu/context","douyu/com/user","douyu/com/avatar","douyu/page/room/base/api","shark/util/template/1.0","douyu/page/room/normal/mod/chat-user-manager"],function(e,t,a,i,s,n,o,r,l,d){var c={},u=s.get("sys.yubaDomain")||"",g=null,m=null,p=!1,f=!1,h=null,v=null,b={girlReqstu:!1},y=0,k=!0,w=120,_={init:function(){t.on("crazy.fans.config.data",function(e){c=e});var a=s.get("sys.uid"),i=s.get("sys.groupid"),n=this;p=a==s.get("room.owner_uid"),f=5==i,g=e("#js-live-room-normal-right .chat"),n.bindEvent(),r.reg("room_data_setadm",function(){h&&h.trigger("click")})},subPoint:function(e,t){try{DYS.sub({action_code:e,ext:t||{}})}catch(a){}},bindEvent:function(){var a=this,i=s.get("sys.uid"),n={maxLevel:w};e(document).on("click",".js-nick",function(o){o.stopPropagation();var r=h=e(this),l=r.closest('.jschartli, [data-rel="user-info"]'),d=r.attr("rel")||0,u=r.attr("clt")||0,m=r.attr("gid")||0,p=parseInt(r.attr("is-show-super-icon"),10),f=l.data("level"),v=l.attr("data-anchor-level"),y=r.parent().next(),k=y.attr("chatid"),w=r.data("invisiblenick")||r.text(),_=r.data("noble")||0,x=r.data("invisible")||0,T=i==d,C=r.data("ranktype"),S=l.attr("data-fansMedal-lev")||0,$=l.attr("data-fansMedal-nick")||0,I=t.fire("mod.center.usergroup.get",d),j=9==u||12==u||15==u?"":r.attr("avatar"),D="";if(t.trigger("douyu.avatar.url",j,"middle",function(e){D=e}),a.destroy(),!i||""==i||!I||10==u||16==u)return!1;if(w=w.replace(/[\:\：]$/,""),n=e.extend(n,{nickname:w,encodeNickname:encodeURI(w),isMobileUser:1==u||2==u,isAnchor:s.get("room.owner_uid")==d,isThirdParty:9==u||12==u||15==u,isRoomAdmin:4==I.rg,isSuperAdmin:5==m,levelClass:a.returnUlevelClass(f)+" "+a.imgSize(f)+" "+a.imgType(f)||"",level:parseInt(f,10),ol:parseInt(v,10),chatid:k,isShowSuperIcon:p,rel:d,clt:u,gid:m,avatar:D,girlPrivilege:0,noble:parseInt(_,10),invisible:x,isSelf:T,ranktype:C,nobleConfig:s.get("room.nobleConfig"),resourceUrl:s.get("sys.resource_url"),fansMedalLev:S,fansMedalNick:$,fansMedal:c||{},roomId:s.get("room.room_id")}),a.renderReport({chatid:k,rel:d,clt:u,gid:m,data:n,nickname:w,avatar:j}),0===+_){if(b.girlReqstu)return;return b.girlReqstu=!0,void e.ajax({url:"/member/female_privilege/get_privilege_status",dataType:"json",type:"GET",data:{uid:d}}).done(function(s){b.girlReqstu=!1;var o=s.data;o&&+o.is_receive&&(e.extend(!0,n,{girlPrivilege:1}),t.trigger("dys",{key:"dys.room.girl.show.card"})),a.render(g,n),i!=d&&i&&""!=i||e(".user-card-action").remove(),a.countActionItem()})}a.render(g,n),i!=d&&i&&""!=i||e(".user-card-action").remove(),a.countActionItem()}).on("click",".chat-user-card-holder",function(e){e.stopPropagation()}).on("click","[data-type='closecard']",function(){a.destroy()}).on("click",function(){a.destroy()}).on("click",'[data-type="toreport"]',function(e){e.stopPropagation(),a.showReport(),a.destroy()}).on("click",".user-report-close",function(){a.destroyReport()}).on("click",'[data-type="sendletter"]',function(a){var i=e(this),s=i.attr("rel");a.preventDefault(),a.stopPropagation(),t.trigger("mod.room.privateLetter.open",s);var n=i.closest("[data-noblelvl]").data("noblelvl")||0;t.trigger("dys",{key:"dys.room.username.click",type:3,r_type:3,level:n})}).on("click",'[data-type="opennoble"]',function(i){t.trigger("mod.normal.noble.buy"),a.destroy(),h=null;var s=e(this),n=s.closest("[data-noblelvl]").data("noblelvl")||0;if(t.trigger("dys",{key:"dys.room.username.click",type:4,r_type:4,level:n}),1===s.data("mistery")){var o=s.data("uid"),r=s.data("ranktype"),l="";l="all"===r?"click_msg_sendlist_all_buynoble":"click_msg_sendlist_wk_buynoble",a.subPoint(l,{sid:o})}else a.subPoint("click_usercard_open")})},countActionItem:function(){var t=e(".girl--privilege .user-card-action .action-item"),a=0;t.length&&(t.each(function(t,i){e(i).is(":visible")&&a++}),a>4?e(".chat-user-card-wrap.girl--privilege").css("background-size","310px 213px"):e(".chat-user-card-wrap.girl--privilege").css("background-size","310px 187px"))},showMassageTip:function(){e(".cuch-massage-tip").css("display","block"),setTimeout(function(){e(".cuch-massage-tip").hide(),k=!0},2e3)},render:function(a,i){var s,n,o=this,r=t.fire("mod.center.userrole.get");i.isNormalCard=r.isAnchor()||r.isSuperAdmin()||i.isSelf||!i.invisible,s=i.isNormalCard?o.getCardTmpl():o.getMysteryCardTmpl(),n=l.compile(s),m&&m.remove(),m=e(n(i)),a.append(m),d.init(),m.on("click","[data-yuba-jump]",this.jumpToYuba)},jumpToYuba:function(){var t=e(this).data("uid");u&&_.jsJumpPage(u+"fe/uriredirect?page=userpage&id="+t)},jsJumpPage:function(t,a){var i=a||"_blank",s=document.createElement("a");s.setAttribute("href",t),s.setAttribute("target",i),document.body.appendChild(s),s.click(),e(s).remove()},getMysteryCardTmpl:function(){return['<div class="chat-user-card-holder">','<div class="status--mistery">','<div class="noble--error">','<a class="noble-error--close" href="javascript:;" data-type="closecard">×</a>','<div class="nobel-error--main">','<i class="nobel-error--icon"></i>','<div class="error-main--content">','<h3 class="content--title">我是神秘人，猜猜我是谁？</h3>',"<p>贡献榜隐身—国王以上贵族专属特权</p>",'<a class="btn" href="javascript:;" data-ranktype="<%= ranktype %>" data-mistery="1" data-type="opennoble" data-uid="<%= rel %>">开通贵族</a>',"</div>","</div>","</div>","</div>","</div>"].join("")},getCardTmpl:function(){return['<% if (noble) {var nobleClass="status--noble";} %>','<% if (invisible) {var invisibleClass="status--invisible";} %>','<% if (girlPrivilege) {var girlClass = "girl--privilege";} %>','<div class="chat-user-card-holder">',"<% if (nobleClass) { %>",'<div class="chat-user-card-wrap <%= nobleClass %> <%= invisibleClass %> lv--<%= noble %>">',"<% } else { %>",'<div class="chat-user-card-wrap <%= invisibleClass %> <%= girlClass %>">',"<% } %>",'<a class="card-close" href="javascript:;" data-type="closecard">×</a>','<div class="chat-user-card">','<div class="user-card-main clearfix">','<div class="user-card-widget-tl"></div>','<div class="user-card-widget-br"></div>','<div class="user-card-avatar" data-card="avatar" data-yuba-jump="<%= isNormalCard ? 1 : 0 %>" data-uid="<%=rel%>">','<img src="<%=avatar%>"/>',"<%if (!isNormalCard){%>",'<div class="invisible-mask">','<div class="icon--invisible"></div>隐身',"</div>","<%}%>",'<div class="user-card-avatar-cover" ></div>',"</div>",'<div class="user-card-title">',"<h1 ","<%if (isSuperAdmin){%>",'class="sa"',"<%}%>",'><span class="user-card-name" data-yuba-jump="<%= isNormalCard ? 1 : 0 %>" data-uid="<%=rel%>"><%=nickname%></span></h1>','<strong class="user-card-badge">',"<span>","<%if (isSuperAdmin && isShowSuperIcon){%>",'<img class="user-role" src="'+s.get("sys.web_url")+'/app/douyu/res/page/room-normal/super_admin.png?v=20170627">',"<%}else if(isAnchor){%>",'<img class="user-role" src="'+s.get("sys.web_url")+'/app/douyu/res/page/room-normal/anchor.png?v=20170627">',"<%}else if(isRoomAdmin){%>",'<img class="user-role" src="'+s.get("sys.web_url")+'/app/douyu/res/page/room-normal/roomadmin.png?v=20170627">',"<%}%>","<% if ( noble && nobleConfig[noble] ) { %>",'<img class="user-noble" src="<%= resourceUrl %><%= nobleConfig[noble].symbol.web_symbol_pic2 %>" title="<%= nobleConfig[noble].symbol.name %>" />',,"<% } %>","<% if (fansMedalLev && fansMedalNick && !isSuperAdmin) { %>","<% if (fansMedal[roomId]) { %>",'<span class="fans-badge-icon" data-ui-level="<%= fansMedalLev %>">','<span class="fans-icon-name" style="background-image:url(',"<%= fansMedal[roomId][fansMedalLev].bg %>",')"><i><%= fansMedalNick %></i></span>','<span class="fans-badge-level" style="background-image:url(',"<%= fansMedal[roomId][fansMedalLev].md %>",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'<% } else if (fansMedal["all"]) { %>','<span class="fans-badge-icon" data-ui-level="<%= fansMedalLev %>">','<span class="fans-icon-name" style="background-image:url(','<%= fansMedal["all"][fansMedalLev].bg %>',')"><i><%= fansMedalNick %></i></span>','<span class="fans-badge-level" style="background-image:url(','<%= fansMedal["all"][fansMedalLev].md %>',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","<% } else { %>",'<span class="fans-badge-icon" data-ui-level="<%= fansMedalLev %>">','<span class="fans-icon-name"><i><%= fansMedalNick %></i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","<% } %>","<% } %>",,"<%if (!isSuperAdmin&&clt!=9&&clt!=12&&clt!=15&&level){%>","<% if(ol > 0){%>",'<span class="anchor-level-icon" data-anchor-levelimg="<%= ol %>">',"<%} else {%>",'<span class="user-level <%= levelClass %>  <%if(level<10){%> lve-icon-1to9 <%}%> ">',"</span>","<%}%>","<%}%>","</span>","<%if(isSuperAdmin && isShowSuperIcon){%>","<strong>斗鱼官方管理员</strong>","<%}%>","</strong>","</div>","</div>",'<div class="user-card-action">','<div class="user-card-action-inr" data-noblelvl="<%= noble %>">',"<%if(isSuperAdmin){%>",'<a class="action-item" target="_blank" href="https://kefu.douyu.com">联系客服</a>','<a class="action-item" target="_blank" href="/member/message/release">意见反馈</a>','<a class="action-item" target="_blank" href="http://weibo.com/u/3982726153">官方微博</a>','<a class="action-item" target="_blank" href="http://qm.qq.com/cgi-bin/qm/qr?k=1RlH3lAF3a1ietQ3Luxd1DMOEouVyvJx">官方Q群</a>',"<%}else{%>",'<a class="action-item" data-type="toreport"','clt="<%=clt%>" rel="<%=rel%>" ','gid="<%=gid%>" chatid="<%=chatid%>" nickname="<%=nickname%>"',">举报用户</a>",'<a class="action-item" data-type="shield" href="javascript:;">屏蔽用户</a>','<a class="action-item" data-type="appoint" href="javascript:;">任命房管</a>','<a class="action-item" data-type="mute" href="javascript:;">禁止发言</a>','<a class="action-item" data-type="onekeyblack" href="javascript:;">一键封号</a>',"<%if(!isThirdParty){%>",'<a class="action-item" data-type="sendletter" href="/member/pm" rel="<%=rel%>" target="_blank"><span>发站内信</span></a>',"<%}%>","<% if (girlPrivilege) { %>",'<a class="action-item font5 js-girl-right" data-type="girlPrivilege" href="javascript:;">小姐姐特权</a>',"<% } %>","<%}%>","<%if(noble){%>",'<a class="action-item" data-type="opennoble" href="javascript:;">成为贵族</a>',"<%}%>","</div>","</div>","</div>","</div>",'<span class="cuch-massage-tip">10级以上才可以发站内信噢</span>',"</div>"].join("")},returnUlevelClass:function(e){var t=120,i="";return i=e?a.string.format("{0}{1}","level-",t+1>e?e:t):"level-next-1"},imgType:function(e,t){var a="";return a=e>=70?"":"level-bgpng",t&&(a="level-bgpng"),a},imgSize:function(e){var t="";return t=e>=100?"level-size2":" level-size1"},getReportTmpl:function(){return['<div class="chat-user-card-holder">','<div class="user-report-dialog"  data-type="user-manager-group"','clt="<%=clt%>" rel="<%=rel%>" avatar="<%=avatar%>"','gid="<%=gid%>" chatid="<%=chatid%>" nickname="<%=nickname%>" data-noblelvl="<%= data.noble %>"',">",'<div class="user-report-dialog-title">',"举报用户",'<a class="user-report-close" href="javascript:;">×</a>',"</div>",'<div class="user-report-dialog-content">','<span class="user-report-menu" >','<a data-rept="2" data-type="report" href="javascript:;">举报头像</a>','<a data-rept="0" data-type="report" href="javascript:;">举报弹幕</a>','<a data-rept="1" data-type="report" href="javascript:;">举报昵称</a>',"</span>","</div>","</div>","</div>"].join("")},renderReport:function(t){var a=this;a.destroyReport();var i=a.getReportTmpl(),s=l.compile(i);v&&v.remove(),v=e(s(t)),g.append(v)},destroyReport:function(){v&&v.remove()},showReport:function(){v&&v.addClass("active")},destroy:function(){m&&(m.remove(),m.off("click","[data-yuba-jump]",this.jumpToYuba))}};return t.on("mod.userinfo.currentLevel",function(e){y=e}),{init:function(){_.init()}}}),define("douyu/page/room/normal/mod/chat-msg-roll",["jquery","shark/observer"],function(e,t){var a={},i={};return a.init=function(){a.$chatCont=e("#js-chat-cont"),a.$chatCls=a.$chatCont.find('[data-type="chat-cls"]'),a.$chatCont.find('[data-type="roll"]').find("span").text("解锁")},i.init=function(){a.$chatCont.on({mouseenter:function(){a.$chatCls.removeClass("hide")},mouseleave:function(){a.$chatCls.addClass("hide")}}).on("click",'[data-type="roll"]',function(){var a=e(this),i=0;a.hasClass("c-scr")?(a.removeClass("c-scr").find("span").text("锁屏"),i=2,t.trigger("mod.chat.locker.release")):(a.addClass("c-scr").find("span").text("解锁"),i=1),t.trigger("mod.chat.msg.setroll.chat",i),t.trigger("dys",{key:"dys.room.barrage.setting.scroll",stat:i})}).on("click",'[data-type="clear"]',function(){t.trigger("mod.chat.msg.clear.chat"),t.trigger("mod.chat.locker.release"),t.trigger("dys",{key:"dys.room.barrage.setting.clear"})})},{init:function(){a.init(),i.init()}}}),define("douyu/page/room/normal/mod/chat-gift",["jquery","shark/observer","shark/util/flash/data/1.0","douyu/context","douyu/com/get-gift-configs","douyu/page/room/base/api","douyu/page/room/normal/mod/gift/constants","douyu/page/room/normal/mod/gift/app"],function(e,t,a,i,s,n,o,r){var l={status:{isFirstEnter:1},init:function(){var e=i.get("sys.web_url")+"app/douyu/res/page/room-normal/gift/";this.config={webUrl:e,userId:""+i.get("sys.uid"),anchorId:""+i.get("room.owner_uid"),giftHeights:[52,56,60,78,96,106,0,52,54,56],nobleHeights:{7:78,1:96,2:106,3:106,4:106,5:106,6:106},chouqinConfig:{}},this.bindEvents()},extendGiftConfig:function(t){var a=this,i=a.config;i.giftConfigs={},e.extend(!0,i.giftConfigs,t,{"cq-1":{ef:0,devote:150,bimg:i.webUrl+"chouqin_1.gif?v=20160322",himg:"",name:"初级酬勤",stay_time:1e4},"cq-2":{ef:0,devote:300,bimg:i.webUrl+"chouqin_2.gif?v=20160322",himg:"",name:"中级酬勤",stay_time:2e4},"cq-3":{ef:0,devote:500,bimg:i.webUrl+"chouqin_3.gif?v=20160322",himg:"",name:"高级酬勤",stay_time:3e4},older100Balls:{ef:0,devote:1,bimg:i.webUrl+"mobile-bg-100.png?v=20160322",himg:i.webUrl+"mobile-head-100.png?v=20160322",name:"鱼丸",stay_time:1e3}})},bindEvents:function(){var e=this;n.reg("room_data_buycq",function(t){s.load().done(function(a){e.extendGiftConfig(a),e.handleChouqin(t)})}),n.reg("room_data_gift",function(t){s.load().done(function(a){e.extendGiftConfig(a),e.handleOldBall(t)})}),n.reg("room_data_handler",function(e){var i=a.decode(e).too();"msrpn"===i.type&&t.trigger(o.NOBLE_TREASURE_BOX,i)}),t.on("mod.chat.gift.call",function(t){s.load().done(function(a){e.extendGiftConfig(a),e.handleEnterRoom(t)})}),n.reg("room_data_giftbat1",function(t){s.load().done(function(a){e.extendGiftConfig(a),e.handleNormalGift(t)})}),n.reg("room_data_login",function(e){var s={},n=0;(i.get("sys.uid")||i.get("sys.username"))&&(s=a.decode(e).too(),"0"===s.ps&&(n=1),t.trigger(o.IS_LOGIN_CONTROLLER,n))})},handleChouqin:function(e){var i=this.config.giftConfigs,s=a.decode(e).too(),n=a.decode(s.sui).too(),r=i["cq-"+s.lev],l={uid:n.id,nn:n.nick,gfid:"cq-"+s.lev,gs:[8,9,10][s.lev-1],hits:s.hits};t.trigger("mod.chat.msg.res.cq",e),t.fire("mod.chat.msg.shield").allGift&&s.sid!=this.config.userId||r&&t.trigger(o.GET_GIFT_DATA,{giftData:l,giftConfig:r,giftType:"giftCQ"})},handleOldBall:function(e){var i,s=this.config.giftConfigs,n=this,r=a.decode(e).too(),l=a.decode(r.sui).too(),d=s.older100Balls,c={uid:l.id,nn:l.nick,gfid:"older100Balls",gs:1,hits:r.hc};t.fire("mod.chat.msg.shield").allGift&&l.id!=n.config.userId||"donateres"===r.type&&"0"===r.r&&d&&(t.trigger(o.GET_GIFT_DATA,{giftData:c,giftConfig:d}),i=n.giftBatterMsgShow({pushResult:r}),i||t.trigger("mod.chat.msg.gift",e))},handleEnterRoom:function(e){var a,i,s=this;if("memberinfores"===e.type){if(t.trigger("mod.room.chat.gift.noble.info",{nl:parseInt(e.nl,10)||0,npl:parseInt(e.npl,10)||0,npts:parseInt(e.npts,10)||0,ncp:parseInt(e.ncp,10)||0,ih:parseInt(e.ih,10)||0,iha:parseInt(e.iha,10)||0,nhp:parseInt(e.nhp,10)||0,nets:parseInt(e.nets,10)||0}),!s.status.isFirstEnter)return;e.glist&&(a=s.getGiftBannerDatas(e.glist),t.trigger(o.GiFT_BANNER_LIST,a)),e.nblist&&s.handleNobleBannerDatas(e.nblist),""===e.list&&""===e.listn&&""===e.listt||(i=s.getTreasureDatas(e),t.trigger(o.GiFT_USENTER_LIST,i)),s.status.isFirstEnter=0}},handleNobleBannerDatas:function(e){var s=this,n=[],r=0,l=i.get("room.nobleConfig");n=e.split("/|/"),r=n.length,l&&t.fire("room.get.noble.effect.config").done(function(e){var i=0,d=null,c=[],u=null,g=null,m=0;if(e){for(;r>i;i++)""!==n[i]&&(d=a.decode(n[i]).too(),m=d.nl,m&&(u=e[m],g=l[m],u&&g&&c.push({effectType:"noble",senderId:d.uid||"",giftId:d.nl,senderName:d.unk,giftName:g.noble_name,bannerStayTime:1e3*d.ltc||0,styleNumber:d.nl,bannerBgImg:u.pc_bg,bannerGiftImg:u.pc_pic,bannerSenderNameColor:u.text_color1,bannerGiftNameColor:u.text_color2,contribution:u.display_rank||0,bannerHeight:s.config.nobleHeights[m]})));t.trigger(o.GiFT_BANNER_LIST,c)}})},getGiftBannerDatas:function(e){var t,i=this,s=[],n=0,o=0,r=null,l=[],d=this.config.giftConfigs;for(s=e.split("/|/"),n=s.length;n>o;o++)""!==s[o]&&(r=a.decode(s[o]).too(),r.gid&&(t=d[r.gid],t&&l.push({senderId:r.sid||"",giftId:r.gid,senderName:r.snk,giftName:t.name,hitTimes:r.hs||1,bannerStayTime:1e3*r.ctc||0,styleNumber:r.gs||0,bannerBgImg:t.bimg,bannerGiftImg:t.himg,bannerGiftBorderColor:t.brgb,bannerSenderNameColor:t.urgb,bannerWordColor:t.drgb,bannerGiftNameColor:t.grgb,contribution:t.devote||0,bannerHeight:i.config.giftHeights[r.gs-1||1]})));return l},getTreasureDatas:function(e){var t,i=[],s=0,n=[],o=0;for(i=i.concat(e.list.split("/|/")),i=i.concat(e.listn.split("/|/")),i=i.concat(e.listt.split("/|/")),s=i.length;s>o;o++)""!==i[o]&&(t=a.decode(i[o]).too(),"6"!==t.rpt&&"9"!==t.rpt&&n.push(t));return n},handleNormalGift:function(i){var s,n,r=this,l=this.config,d=l.userId,c=l.giftConfigs,u=a.decode(i).too(),g=u.type,m=-1,p=l.anchorId;if(g){if(d===p){if("dgb"===g)return}else if("bgd"===g)return;if(u.gfid&&(u.sid!==d&&u.uid!==d||t.trigger("mod.gift.exp.up",{gid:u.gfid,silver:u.sb})),!u.dw||"dgn"!==g&&"dgb"!==g&&"bgd"!==g||t.trigger("mod.titleinfo.change",{weight:u.dw}),"dsgr"===g){if("0"===u.r)t.trigger("mod.userinfo.change",{current:{silver:u.sb}}),t.trigger("room.giftprop.send.success.land",u.gfid),t.trigger("room.gift.send.success.finalyear",{val:u.gfid,isProp:!1});else{if("283"===u.r)return void t.trigger("mod.gift.yw.res",i);if(u.errstr&&u.errstr.length>0)return void e.dialog.tips_black(u.errstr,1.5)}t.trigger("mod.gift.yw.res",i)}if("ggbb"===g&&(t.trigger(o.GIFT_GET_LUCYKING,{
giftData:u}),t.trigger("mod.chat.msg.gift",i,c)),u.gfid&&(s=c[u.gfid])){switch(m=s.ef,g){case"dgb":case"bgd":case"donateres":u.uid===d&&t.trigger("mod.gift.send.batter.update",{giftId:u.gfid,giftBatterTime:s.hit_interval}),3===m||4===m||5===m?1===+u.imd&&t.trigger(o.GET_GIFT_DATA,{giftData:u,giftConfig:s}):t.trigger(o.GET_GIFT_DATA,{giftData:u,giftConfig:s})}if(3===m||4===m||5===m){if(1===+u.imd){if(n=r.giftBatterMsgShow({pushResult:u}))return;t.trigger("mod.chat.msg.gift",i,c)}}else{if(n=r.giftBatterMsgShow({pushResult:u}))return;t.trigger("mod.chat.msg.gift",i,c)}}}},giftBatterMsgShow:function(e){var t,a=this.config,i=a.giftConfigs,s=e.pushResult,n=i[s.gfid];return n?(t=n.devote/10,1>=t?!s.hits||s.hits<=1?!1:!(s.hits>1&&s.hits%10===0):!1):!1}};return{init:function(){l.init()}}}),define("douyu/page/room/normal/mod/chat",["jquery","shark/observer","douyu/page/room/base/api","douyu/page/room/normal/mod/chat-fans","douyu/page/room/normal/mod/chat-exp","douyu/page/room/normal/mod/chat-color","douyu/page/room/normal/mod/chat-shield","douyu/page/room/normal/mod/chat-msg","douyu/page/room/normal/mod/chat-cmd","douyu/page/room/normal/mod/chat-link-barrage","douyu/page/room/normal/mod/chat-send","douyu/page/room/normal/mod/chat-user-card","douyu/page/room/normal/mod/chat-msg-roll","douyu/page/room/normal/mod/chat-gift"],function(e,t,a,i,s,n,o,r,l,d,c,u,g,m){var p={blackList:[]};return t.on("mod.chat.blackList.set",function(e){void 0!==e&&p.blackList.push(String(e))}),t.on("mod.chat.blackList.get",function(t){return{list:p.blackList,index:void 0===t?0:e.inArray(String(t),p.blackList),length:p.blackList.length}}),t.on("mod.chat.blackList.del",function(t){void 0!==t&&p.blackList.splice(e.inArray(t,p.blackList),1)}),{init:function(){i.init(),s.init(),n.init(),o.init(),r.init(),l.init(),d.init(),c.init(),u.init(),g.init(),m.init()}}}),define("douyu/page/room/normal/mod/fans-medal-set2",["jquery","shark/class","shark/observer","shark/util/lang/1.0","shark/util/cookie/1.0","shark/util/storage/1.0","shark/util/flash/data/1.0","shark/util/template/2.0","douyu/context","douyu/com/user","douyu/page/room/base/api","douyu/com/room-gift-tmp"],function(e,t,a,i,s,n,o,r,l,d,c,u){var g={},m={isNobleOneYearOpen:l.get("colligate.activitySwitch.noble_one_year.activity_switch"),dropingDialogFlag:"dropingDialogShow",dropingListFlag:"dropingMedalList",medalListPushState:0,dropingDialogSwitch:0,newDropingMedal:[],filterDropingMedal:[],dropingFansMedal:[],fansRequestState:0,fansListDataState:0,fansFirstPayTask:71,searchProgress:0,storageExpired:2592e3,defaultAvatar:{left:l.get("sys.web_url")+"/app/douyu/res/page/room-normal/fans/dialog_img_2.png",center:l.get("sys.web_url")+"/app/douyu/res/page/room-normal/fans/dialog_img_1.png",right:l.get("sys.web_url")+"/app/douyu/res/page/room-normal/fans/dialog_img_3.png"},fansSpecialUrl:"http://www.douyu.com/t/fans",personMedalUrl:"/member/cp/getFansBadgeList",firstRechargeUrl:"/task/firstpaytask/"+l.get("room.room_id"),medalLevel:[1,6,11,16,21,26,30],fansNick:"粉丝",removeMedalID:"",ruPos:"",opearMedalType:"",levelMap:{packName:"弱鸡",key:["粉丝等级","粉丝礼包","每日亲密上限","每日亲密度衰减"],list:[[1,10,500,25],[2,10,500,25],[3,10,500,25],[4,15,500,25],[5,15,500,25],[6,15,1e3,50],[7,20,1e3,50],[8,25,1e3,50],[9,30,1e3,50],[10,35,1500,75],[11,40,1500,75],[12,45,1500,75],[13,50,1500,75],[14,50,1500,75],[15,50,2e3,100],[16,60,2e3,100],[17,60,2e3,100],[18,60,2e3,100],[19,70,2e3,100],[20,70,2500,125],[21,70,2500,125],[22,80,2500,125],[23,80,2500,125],[24,80,2500,125],[25,90,2700,135],[26,90,3e3,240],[27,90,3500,280],[28,100,4e3,320],[29,100,4500,360],[30,100,5e3,400]]},medalNumLimit:20,anchorMedalSwitch:l.get("room.is_set_fans_badge"),userMsgStatus:"",tipsTimer:"",tipsAutoTimer:"",medalListData:"",fansRankData:"",curMedalInfo:{},medalInfoStatus:1,medalListStatus:1,medalIntroductionStatus:1,hoverEnterStatus:0,fansRechargeStorage:"fansRechargeRemain",dpType:{medalEnter:"medalEnter",fansIntroduction:"fansIntroduction",medalListEnter:"medalListEnter",medalListSel:"medalListSel",myMedalEnter:"myMedalEnter"},roomId:l.get("room.room_id"),medalEnterStatus:{close:"medal-disable-btn",none:"medal-none-btn",notWear:"medal-not-btn",yesWear:"medal-yes-btn"},types:{fansRank:"frank",medalList:"blst",medalOpera:"obreq",medalGet:"gbi",medalUpdate:"synfim",medalUpdateCur:"synfimd",medalUpgrade:"blab",medalRankPos:"ru",medalOperaError:"obres",fansGift:"gg",firstFansGift:"frs",firstFansMsg:"frb"},urls:{searchAnchorInfo:"/fansbadge/fansbadge/getAnchorInfo"}},p={eventDefault:function(e){return e.stopPropagation(),e.preventDefault(),!1},returnType:function(e){for(var t=[null,void 0],a=0;a<t.length;a++)if(e==t[a])return e;return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},medalLevel:function(e){for(var t=0,a=m.medalLevel.length,i=0;a>t;t++)if(e<m.medalLevel[t]){i=m.medalLevel[t-1];break}return i?i:m.medalLevel[m.medalLevel.length-1]},getRestTime:function(e){var t,a;return e=e?parseInt(e,10):0,t=new Date,t.setDate(t.getDate()+e),t.setHours(24),t.setMinutes(0),t.setSeconds(0),a=t.getTime()-(new Date).getTime()}},f={init:function(){var t=this;a.on("crazy.fans.config.data",function(e){g=e}),this.doms={$container:e("#container"),$chatContent:e("#js-chat-cont"),$giftContent:e("#gift-content"),$sendMsgWarp:e("#js-send-msg"),$roomVideoWarp:e("#js-room-video")},this.renderHtml={medalContainerTemp:t.medalContainerRender(),medalEnterTemp:t.medalEnterRender(),medalContentWarpTemp:t.medalContentWarpRender(),medalContentTemp:t.medalContentRender(),medalTipTemp:t.medalTipRender(),medalMsgTemp:t.medalMsgRender(),medalListTemp:t.medalListRender(),fansGiftPackTemp:t.fansGiftPackRender(),firstRechargeMsgTemp:t.firstRechargeMsgRender(),firstRechargeTemp:t.firstRechargeRender(),firstRechargeFulfillTemp:t.firstRechargeFulfillRender(),fansRechargeEnterTemp:t.fansRechargeEnterRender(),dropingMedalsTemp:t.dropingMedalsRender()},this.userInfo={uid:l.get("sys.uid")},m.dropingDialogFlag=m.dropingDialogFlag+"_"+this.userInfo.uid,m.dropingListFlag=m.dropingListFlag+"_"+this.userInfo.uid,this.fansRechargeLoginCheck(),this.medalLevMap(),this.medalSwitchCheck(),this.pushBind(),this.eventBind()},medalContainerRender:function(){var e,t;return e=i.string.join("{{ if !userCheck}}",'<div class="fans-entrance status-fansnologin" data-flag="medal-entrance-warp">',"{{ /if }}","{{ if userCheck }}",'<div class="fans-entrance" data-flag="medal-entrance-warp">',"{{ /if }}","</div>"),t=r.compile(e)},medalEnterRender:function(){var e,t;return e=i.string.join('{{ if status == "medal-yes-btn" }}','<a class="entrance-btn" data-medal-id="{{ medalData.rid }}" data-action="medal-enter-btn" data-flag="{{ status }}" data-ui-level="{{ medalData.bl }}">','<i class="entrance-btn-icon"></i>',"{{ if (fansMedal[medalData.rid]) }}",'<span class="fans-badge-icon" data-ui-level="{{ medalData.bl }}">','<span class="fans-icon-name" style="background-image:url(',"{{ fansMedal[medalData.rid][medalData.bl].bg }}",')"><i>{{ medalData.bnn }}</i></span>',"</span>",'{{ else if (fansMedal["all"]) }}','<span class="fans-badge-icon" data-ui-level="{{ medalData.bl }}">','<span class="fans-icon-name" style="background-image:url(','{{ fansMedal["all"][medalData.bl].bg }}',')"><i>{{ medalData.bnn }}</i></span>',"</span>","{{ else }}",'<span class="fans-badge-icon" data-ui-level="{{ medalData.bl }}">','<span class="fans-icon-name"><i>{{ medalData.bnn }}</i></span>',"</span>","{{ /if }}","</a>","{{ /if }}",'{{ if status == "medal-disable-btn" || status == "medal-none-btn" || status == "medal-not-btn" }}','<a class="entrance-btn status-nowear" data-action="medal-enter-btn" data-flag="{{ status }}">','<i class="entrance-btn-icon"></i>','{{ if status == "medal-disable-btn" || status == "medal-none-btn" }}','<span class="fans-badge-icon fans-badge-unavailable">','<span class="fans-icon-name"><i>未拥有</i></span>',"</span>","{{ /if }}",'{{ if status == "medal-not-btn" }}','<span class="fans-badge-icon fans-badge-unavailable">','<span class="fans-icon-name"><i>未佩戴</i></span>',"</span>","{{ /if }}","</a>","{{ /if }}"),t=r.compile(e)},medalContentWarpRender:function(){var e,t;return e=i.string.join("{{ if data.wf == 1 }}",'<div class="entrance-content status-nomedal fans-badge-second" style="display: none;" data-flag="medal-info-warp">',"{{ /if }}","{{ if data.wf == 2 }}",'<div class="entrance-content fans-badge-second" style="display: none;" data-flag="medal-info-warp">',"{{ /if }}",'<div class="entrance-title"><span></span></div>','<i class="arrow-icon"><i></i></i>',"</div>"),t=r.compile(e)},medalContentRender:function(){var e,t;return e=i.string.join('<div class="entrance-current" data-flag="medal-info-content">','<div class="current-box">','<div class="entrance-current-title"><a data-flag="fans-info-more" target="_blank" href="{{ fansSpecialUrl }}">了解粉丝体系</a><span>当前房间徽章</span></div>',"{{ if fansSwitch }}","<!-- 主播已开通-已拥有 当前房间徽章 begin -->","{{ if curMedalStatus }}",'<div class="fans-has-badge" data-tag="fans-medal-item" data-medal-index="{{ curMedalIndex }}" data-flag="medal-take-on" data-medal-id="{{ medalInfo.rid }}" style="display: block;">',"{{ if data.wf == 2 && roomId == data.list[0].rid }}",'<label class="radiobox is-checked">','<input data-check="1" type="radio" name="fans-badge" checked />',"{{ /if }}","{{ if data.wf == 1 || roomId != data.list[0].rid }}",'<label class="radiobox">','<input data-check="0" type="radio" name="fans-badge" />',"{{ /if }}",'<i class="radio-icon"></i>',"{{ if (fansMedal[medalInfo.rid]) }}",'<span class="fans-badge-icon" data-ui-level="{{ medalInfo.bl }}">','<span class="fans-icon-name" style="background-image:url(',"{{ fansMedal[medalInfo.rid][medalInfo.bl].bg }}",')"><i>{{ medalInfo.bnn }}</i></span>','<span class="fans-badge-level" style="background-image:url(',"{{ fansMedal[medalInfo.rid][medalInfo.bl].md }}",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'{{ else if (fansMedal["all"]) }}','<span class="fans-badge-icon" data-ui-level="{{ medalInfo.bl }}">','<span class="fans-icon-name" style="background-image:url(','{{ fansMedal["all"][medalInfo.bl].bg }}',')"><i>{{ medalInfo.bnn }}</i></span>','<span class="fans-badge-level" style="background-image:url(','{{ fansMedal["all"][medalInfo.bl].md }}',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","{{ else }}",'<span class="fans-badge-icon" data-ui-level="{{ medalInfo.bl }}">','<span class="fans-icon-name"><i>{{ medalInfo.bnn }}</i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","{{ /if }}",'<span class="name" title="{{ medalInfo.anchorNick }}">{{ medalInfo.anchorNick }}</span>',"</label>","</div>","<!-- 主播已开通-已拥有-用户未佩戴 begin -->","{{ if medalInfo.afim <= 0 }}",'<div class="medal-desc" style="display: block;">',"<ul>","<li>Lv{{ medalInfo.bl }}:",'<div class="progress-barbox">','<span class="progress-bar">',"{{ if medalInfo.bl < maxLev }}",'<em style="width:{{ (medalInfo.fim)/(medalInfo.nfim) * 100 }}%;"></em>',"{{ /if }}","{{ if medalInfo.bl >= maxLev }}",'<em style="width:100%;"></em>',"{{ /if }}","</span>",'<span data-flag="medal-lev-number" class="progress-num">',"{{ if medalInfo.bl < maxLev }}","{{ medalInfo.fim }}/{{ medalInfo.nfim }}","{{ /if  }}","{{ if medalInfo.bl >= maxLev }}","Max","{{ /if }}","</span>","</div>","</li>",'<li class="today-intimate">今日亲密度: {{ medalInfo.afim }}</li>',"</ul>","<p>连续7天不送礼物，亲密度会下降，下降到0时您将失去该徽章</p>","</div>","{{ /if }}","<!-- 主播已开通-已拥有-用户未佩戴 end -->","<!-- 主播已开通-已拥有-用户已佩戴 begin -->","{{ if medalInfo.afim > 0 }}",'<div class="medal-desc" style="display: block;">',"<ul>","<li> Lv{{ medalInfo.bl }}:",'<div class="progress-barbox">','<span class="progress-bar">',"{{ if medalInfo.bl < maxLev }}",'<em style="width:{{ (medalInfo.fim)/(medalInfo.nfim) * 100 }}%;"></em>',"{{ /if }}","{{ if medalInfo.bl >= maxLev }}",'<em style="width:100%;"></em>',"{{ /if }}","</span>",'<span data-flag="medal-lev-number" class="progress-num">',"{{ if medalInfo.bl < maxLev }}","{{ medalInfo.fim }}/{{ medalInfo.nfim }}","{{ /if  }}","{{ if medalInfo.bl >= maxLev }}","Max","{{ /if  }}","</span>","</div>","</li>",'<li class="intimate">','<i class="intimate-icon">',"</i>","<em>+{{ medalInfo.afim }}</em>","</li>",'<li>我的粉丝排名: <span data-flag="medal-rank">',"{{ if medalInfo.pos <= 500 }}","{{ if medalInfo.pos > 0 }}","{{ medalInfo.pos }}","{{ else }}","--","{{ /if }}","{{ /if }}","{{ if medalInfo.pos > 500 }}","500+","{{ /if }}","</span></li>",'<li data-flag="medal-inti-limit">今日亲密度上限: {{ medalInfo.mafim }}</li>',"</ul>","</div>","{{ /if }}","<!-- 主播已开通-已拥有-用户已佩戴 end -->","{{ /if }}","<!-- 主播已开通-已拥有 当前房间徽章 end -->","<!-- 主播已开通-未拥有 当前房间徽章 begin -->","{{ if !curMedalStatus }}",'<div class="fans-has-badge clearfix" style="display: block;">','<span class="fans-badge-icon fans-badge-unavailable" data-ui-level="1">','<span class="fans-icon-name"><i>{{ fansNick }}</i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>",'<span class="anchor-nobadge-tips">未拥有该主播的徽章</span>',"{{ if firstRecharge == 1 }}",'<a href="{{ firstRechargeUrl }}" target="_blank" class="fans-firstpay-entrance"></a>',"{{ /if }}",'<p class="fans-nobadge-tips">给主播送礼物达6鱼翅，就可获得专属徽章噢~</p>',"</div>","{{ /if }}","<!-- 主播已开通-未拥有 当前房间徽章--更新    end -->","{{ /if }}","{{ if !fansSwitch }}","<!-- 主播未开通粉丝勋章 begin -->",'<div class="fans-has-badge" style="display: block;">','<span class="fans-badge-icon fans-badge-unavailable" data-ui-level="1">','<span class="fans-icon-name"><i>粉丝</i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>",'<span class="anchor-nobadge-tips">主播未开通粉丝徽章</span>',"</div>","<!-- 主播未开通粉丝勋章 end -->","{{ /if }}","</div>","</div>"),t=r.compile(e)},medalTipRender:function(){var e,t;return e=i.string.join('<div class="entrance-tipswrap" data-action="medal-tip-warp" data-tip-type="{{ type }}">','{{ if type == "medalDisable" }}','<i class="arrow-icon"></i>',"<p>主播还未开通粉丝徽章",'<a data-flag="fans-info-more" target="_blank" href="{{ fansSpecialUrl }}"> 了解更多&gt;&gt;</a>',"</p>","{{ /if }}",'{{ if type == "medalUpper" }}','<i class="arrow-icon"></i>','<p>您的徽章已达到上限20个。　<a target="_blank" href="/member/cp/getFansBadgeList">点击设置&gt;&gt;</a></p>',"{{ /if }}",'{{ if type == "medalRemain" }}','<i class="arrow-icon"></i>',"<p>当天累计送主播价值6个鱼翅的礼物即可获得Ta的粉丝徽章，并获取粉丝专属礼包。　",'<a data-flag="fans-info-more" target="_blank" href="{{ fansSpecialUrl }}">了解更多&gt;&gt;</a>',"</p>","{{ /if }}",'{{ if type == "ownerRoomMedalRemain" }}','<i class="arrow-icon"></i>',"<p>",'<a href="javascript:;" data-flag="medal-get-use" data-medal-rid="{{ curMedalInfo.rid }}" class="adornbtn">立即佩戴</a>','<span class="adorn-msg">您已拥有该主播徽章</span>',"{{ if (fansMedal[curMedalInfo.rid]) }}",'<span class="fans-badge-icon" data-ui-level="{{ curMedalInfo.bl }}">','<span class="fans-icon-name" style="background-image:url(',"{{ fansMedal[curMedalInfo.rid][curMedalInfo.bl].bg }}",')"><i>{{ curMedalInfo.bnn }}</i></span>','<span class="fans-badge-level" style="background-image:url(',"{{ fansMedal[curMedalInfo.rid][curMedalInfo.bl].md }}",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'{{ else if (fansMedal["all"]) }}','<span class="fans-badge-icon" data-ui-level="{{ curMedalInfo.bl }}">','<span class="fans-icon-name" style="background-image:url(','{{ fansMedal["all"][curMedalInfo.bl].bg }}',')"><i>{{ curMedalInfo.bnn }}</i></span>','<span class="fans-badge-level" style="background-image:url(','{{ fansMedal["all"][curMedalInfo.bl].md }}',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","{{ else }}",'<span class="fans-badge-icon" data-ui-level="{{ curMedalInfo.bl }}">','<span class="fans-icon-name"><i>{{ curMedalInfo.bnn }}</i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","{{ /if }}","</p>","{{ /if }}",'{{ if type == "getOtherMedal" }}','<i class="arrow-icon"></i>',"<p>恭喜您获得粉丝徽章！</p>","{{ /if }}","</div>"),t=r.compile(e)},medalMsgRender:function(){var e,t;return e=i.string.join('<div class="entrance-noticewrap" data-msg-type="{{ type }}">','<i class="arrow-icon"></i>','<a class="notice-closebtn" href="javascript:;" data-flag="medal-close-msg"></a>','{{ if type == "expUpper" }}','<div class="notice-content full-value">','<span class="notice-icon"></span>','<div class="notice-box">',"<p>亲，真给力，已刷满本日亲密度!</p>","</div>","</div>","{{ /if }}",'{{ if type == "medalUpgrade" }}','<div class="notice-content upgrade">','<span class="notice-icon"></span>','<div class="notice-box">',"<p>恭喜你又升一级，离主播铁粉更近一步!</p>","</div>","</div>","{{ /if }}",'{{ if type == "medalUpgradeFull" }}','<div class="notice-content upgrade">','<span class="notice-icon"></span>','<div class="notice-box">',"<p>恭喜你升级且刷满了今天的亲密度!</p>","</div>","</div>","{{ /if }}",'{{ if type == "getFirstMedal" }}','<div class="notice-content get-medal">','<span class="notice-icon"></span>','<div class="notice-box">',"<dl>","<dt>恭喜您获得：","{{ if (fansMedal[getMedalData.rid]) }}",'<span class="fans-badge-icon" data-ui-level="{{ getMedalData.bl }}">','<span class="fans-icon-name" style="background-image:url(',"{{ fansMedal[getMedalData.rid][getMedalData.bl].bg }}",')"><i>{{ getMedalData.bnn }}</i></span>','<span class="fans-badge-level" style="background-image:url(',"{{ fansMedal[getMedalData.rid][getMedalData.bl].md }}",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'{{ else if (fansMedal["all"]) }}','<span class="fans-badge-icon" data-ui-level="{{ getMedalData.bl }}">','<span class="fans-icon-name" style="background-image:url(','{{ fansMedal["all"][getMedalData.bl].bg }}',')"><i>{{ getMedalData.bnn }}</i></span>','<span class="fans-badge-level" style="background-image:url(','{{ fansMedal["all"][getMedalData.bl].md }}',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","{{ else }}",'<span class="fans-badge-icon" data-ui-level="{{ getMedalData.bl }}">','<span class="fans-icon-name"><i>{{ getMedalData.bnn }}</i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","{{ /if }}","</dt>","<dd>每天送礼物会提升等级和获得丰厚的礼包！</dd>",'<dd class="wear"><a data-tag="msg-tip-btn" data-flag="medal-get-use" data-medal-rid="{{ getMedalData.rid }}" href="javascript:;" class="fans-btn">立即佩戴</a></dd>',"</dl>","</div>","</div>","{{ /if }}","</div>"),t=r.compile(e)},medalListRender:function(){var e,t;return e=i.string.join('<div class="entrance-select" data-flag="medal-list-warp">','<div class="entrance-select-title"><a data-flag="look-my-medal" target="_blank" href="{{ personMedalUrl }}">查看全部徽章</a><span>其他徽章</span></div>',"{{ each medalList.list as item index }}","{{ if index <= medalNumMax }}","{{ if item.rid != roomId}}",'<div class="fans-has-badge fans-hover-badge" data-tag="fans-medal-item" data-medal-index="{{ index }}" data-flag="medal-take-on" data-medal-id="{{ item.rid }}">',"{{ if medalList.wf == 2 }}","{{ if index == 0 }}",'<label class="radiobox is-checked">','<input type="radio" data-check="1" name="fans-badge" checked />',"{{ /if }}","{{ if index != 0 }}",'<label class="radiobox">','<input type="radio" data-check="0" name="fans-badge" />',"{{ /if }}","{{ /if }}","{{ if medalList.wf == 1 }}",'<label class="radiobox">','<input type="radio" data-check="0" name="fans-badge" />',"{{ /if }}",'<i class="radio-icon"></i>','<a target="_blank" href="javascript:;" class="fans-online-icon" style="display: none;"><i></i><em>查询中</em></a>',"{{ if (fansMedal[item.rid]) }}",'<span class="fans-badge-icon" data-ui-level="{{ item.bl }}">','<span class="fans-icon-name" style="background-image:url(',"{{ fansMedal[item.rid][item.bl].bg }}",')"><i>{{ item.bnn }}</i></span>','<span class="fans-badge-level" style="background-image:url(',"{{ fansMedal[item.rid][item.bl].md }}",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'{{ else if (fansMedal["all"]) }}','<span class="fans-badge-icon" data-ui-level="{{ item.bl }}">','<span class="fans-icon-name" style="background-image:url(','{{ fansMedal["all"][item.bl].bg }}',')"><i>{{ item.bnn }}</i></span>','<span class="fans-badge-level" style="background-image:url(','{{ fansMedal["all"][item.bl].md }}',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","{{ else }}",'<span class="fans-badge-icon" data-ui-level="{{ item.bl }}">','<span class="fans-icon-name"><i>{{ item.bnn }}</i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","{{ /if }}",'<span class="name" title="{{ item.anchorNick }}">{{ item.anchorNick }}</span>',"{{ if medalList.wf == 2 && index == 0 }}","{{ if item.afim >= 0 }}",'<span class="intimate" style="display:inline-block;"><i class="intimate-icon"></i><em>+{{ item.afim }}</em></span>',"{{ /if }}","{{ if item.afim < 0 }}",'<span class="intimate is-down" style="display:inline-block;"><i class="intimate-icon"></i><em>{{ item.afim }}</em></span>',"{{ /if }}","{{ /if }}","{{ if medalList.wf != 2 || index != 0 }}","{{ if item.afim >= 0 }}",'<span class="intimate"><i class="intimate-icon"></i><em>+{{ item.afim }}</em></span>',"{{ /if }}","{{ if item.afim < 0 }}",'<span class="intimate is-down"><i class="intimate-icon"></i><em>{{ item.afim }}</em></span>',"{{ /if }}","{{ /if }}","</label>","</div>","{{ /if }}","{{ /if }}","{{ /each }}",'<div class="fans-has-badge nowear-badge" data-tag="fans-medal-item" data-flag="medal-take-off">',"{{ if medalList.wf == 2 }}",'<label class="radiobox">','<input type="radio" data-check="0" name="fans-badge" />',"{{ /if }}","{{ if medalList.wf != 2 }}",'<label class="radiobox is-checked">','<input type="radio" data-check="1" name="fans-badge" checked />',"{{ /if }}",'<i class="radio-icon"></i>','<span class="name">不佩戴徽章</span>',"</label>","</div>"),t=r.compile(e)},fansGiftPackRender:function(){var e,t;return e=i.string.join('<div class="fans-barrage-gift">','<span class="barrage-offline-close" data-tag="fans-gift-close">×</span>','<div class="fans-barrage-gift-wrap">','<div class="fans-barrage-gift-title">','<div class="fans-barrage-gift-level">','<span class="fans-barrage-gift-leveltxt">根据您的最高粉丝等级</span>',"{{ if (fansMedal[fansGiftData.gbr]) }}",'<span class="fans-badge-icon" data-ui-level="{{ fansGiftData.gbl }}">','<span class="fans-icon-name" style="background-image:url(',"{{ fansMedal[fansGiftData.gbr][fansGiftData.gbl].bg }}",')"><i>{{ fansGiftData.gbnn }}</i></span>','<span class="fans-badge-level" style="background-image:url(',"{{ fansMedal[fansGiftData.gbr][fansGiftData.gbl].md }}",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'{{ else if (fansMedal["all"]) }}','<span class="fans-badge-icon" data-ui-level="{{ fansGiftData.gbl }}">','<span class="fans-icon-name" style="background-image:url(','{{ fansMedal["all"][fansGiftData.gbl].bg }}',')"><i>{{ fansGiftData.gbnn }}</i></span>','<span class="fans-badge-level" style="background-image:url(','{{ fansMedal["all"][fansGiftData.gbl].md }}',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","{{ else }}",'<span class="fans-badge-icon" data-ui-level="{{ fansGiftData.gbl }}">','<span class="fans-icon-name"><i>{{ fansGiftData.gbnn }}</i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","{{ /if }}","</div>",'<span class="fans-barrage-gift-txt">恭喜您！您将获得：</span>',"</div>",'<div class="fans-lightstick">','<div class="fans-lightstick-pic">','<img src="{{ fansGiftData.gicon }}">','<span class="fans-lightstick-icon">今日</span>',"</div>",'<span class="fans-lightstick-num">{{ fansGiftData.gname }}*{{ fansGiftData.gn }}</span>',"</div>",'<div class="fans-barrage-gift-warning clearfix">','<a class="fans-barrage-get fr" data-tag="fans-backpack-open" href="javascript:;">知道了</a>','<span class="fl">粉丝专属礼物仅限当日使用哟~</span>',"</div>","</div>",'<span class="fans-barrage-arrow"></span>','<span class="fans-barrage-arrow fans-barrage-arrow-out"></span>',"</div>"),t=r.compile(e)},firstRechargeMsgRender:function(){var e,t;return e=i.string.join('<li class="jschartli chartli firstpay-chat normal-notice">','<i class="icon-heart"></i>','<p class="text-cont">',"恭喜",'<span class="firstpay-user">{{ nn }}</span>',"将第一次充值献给了本房间主播，并获得了",'<span class="firstpay-badge-desc">首充奖励</span>',"</p>","</li>"),t=r.compile(e)},firstRechargeRender:function(){var e,t;return e=i.string.join('<div class="firstpay-entrance">','<a class="firstpay-btn" target="_blank" href="{{ firstRechargeUrl }}"></a>','<div class="firstpay-tipswrap">','<i class="arrow-icon"></i>','<div class="firstpay-tips">','<p class="firstpay-tip1">',"在本直播间<em>首次充值6元</em>即可免费获得两大徽章","</p>",'<span class="firstpay-tip2">',"<em>粉丝徽章</em>+<em>首充徽章</em>","</span>","</div>","</div>","</div>"),t=r.compile(e)},firstRechargeFulfillRender:function(){var e,t;return e=i.string.join('<div class="firstpay-success">','<a href="javascript:;" class="fisrtpay-close"></a>','<div class="firstpay-desc">',"<p>恭喜你！成功将第一次充值献给了主播</p>",'<p class="firstpay-anchor">"{{ fansGiftData.onn }}"</p>',"</div>",'<div class="firstpay-award">','<div class="firstpay-award-title">',"<span>获得奖励</span>","</div>",'<div class="firstpay-award-content">','<div class="clearfix">','<div class="firstpay-award-fans">',"<span>专属粉丝徽章：</span>","{{ if (fansMedal[fansGiftData.gbr]) }}",'<span class="fans-badge-icon" data-ui-level="{{ fansGiftData.gbl }}">','<span class="fans-icon-name" style="background-image:url(',"{{ fansMedal[fansGiftData.gbr][fansGiftData.gbl].bg }}",')"><i>{{ fansGiftData.gbnn }}</i></span>','<span class="fans-badge-level" style="background-image:url(',"{{ fansMedal[fansGiftData.gbr][fansGiftData.gbl].md }}",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'{{ else if (fansMedal["all"]) }}','<span class="fans-badge-icon" data-ui-level="{{ fansGiftData.gbl }}">','<span class="fans-icon-name" style="background-image:url(','{{ fansMedal["all"][fansGiftData.gbl].bg }}',')"><i>{{ fansGiftData.gbnn }}</i></span>','<span class="fans-badge-level" style="background-image:url(','{{ fansMedal["all"][fansGiftData.gbl].md }}',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","{{ else }}",'<span class="fans-badge-icon" data-ui-level="{{ fansGiftData.gbl }}">','<span class="fans-icon-name"><i>{{ fansGiftData.gbnn }}</i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","{{ /if }}","</div>",'<div class="firstpay-award-pay">',"<span>专享首充徽章：</span>",'<span class="firstpay-award-icon"></span>',"</div>","</div>",'<a href="javascript:;" data-medal-rid="{{ fansGiftData.gbr }}" class="firstpay-award-btn">立即佩戴</a>',"</div>","</div>","</div>"),t=r.compile(e)},fansRechargeEnterRender:function(){var e,t;return e=i.string.join('<div class="firstpay-warp">','<div class="firstpay-enter">  ',"</div>",'<div class="firstpay-modal hide">','<a class="firstpay-modal-close" href="javascript:;"></a>','<div class="firstpay-txt">','<span class="firstpay-txt1">献出你的“第一次”充值给主播</span>','<span class="firstpay-txt2">立即获得：</span>',"</div>",'<div class="firstpay-rewards clearfix">','<div class="firstpay-rewards-sub fl">','<span class="firstpay-rewards-icon"></span>','<span class="firstpay-rewards-name">首充专属徽章</span>','<span class="firstpay-rewards-intro">（有效期7天）</span>',"</div>",'<div class="firstpay-rewards-sub fr">','<span class="firstpay-rewards-fansicon">',"{{ if (fansMedal[roomId]) }}",'<span class="fans-badge-icon" data-ui-level="1">','<span class="fans-icon-name" style="background-image:url(',"{{ fansMedal[roomId][1].bg }}",')"><i>{{ fansNick }}</i></span>','<span class="fans-badge-level" style="background-image:url(',"{{ fansMedal[roomId][1].md }}",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'{{ else if (fansMedal["all"]) }}','<span class="fans-badge-icon" data-ui-level="1">','<span class="fans-icon-name" style="background-image:url(','{{ fansMedal["all"][1].bg }}',')"><i>{{ fansNick }}</i></span>','<span class="fans-badge-level" style="background-image:url(','{{ fansMedal["all"][1].md }}',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","{{ else }}",'<span class="fans-badge-icon" data-ui-level="1">','<span class="fans-icon-name"><i>{{ fansNick }}</i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","{{ /if }}","</span>",'<span class="firstpay-rewards-name">本房间粉丝徽章</span>',"</div>","</div>",'<div class="firstpay-submit-wrap">','<a class="firstpay-submit" target="_blank" href="{{ fansRechargeUrl }}">立即充值</a>',"</div>",'<i class="firstpay-modal-arrow"></i>',"</div>","</div>"),t=r.compile(e)},dropingMedalsRender:function(){var e,t;return e=i.string.join("{{ if newMedalState }}",'<div class="fans-medal-droping-warp new-fans-medal-remain">',"{{ else }}",'<div class="fans-medal-droping-warp">',"{{ /if }}",'<i class="fans-droping-close"></i>','<div class="fans-droping-top">','<div class="fans-droping-switch">','<i class="fans-droping-switch-icon"></i>',"<span>不再提示</span>","</div>",'<div class="fans-droping-info">',"{{ if newMedalState }}",'<div class="fans-droping-desc">',"<h3>好心疼~您今天<span>又有{{ newMedalList.length }}枚徽章亲密度下降了</span>哟~</h3>","</div>","{{ else }}",'<p class="fans-droping-pic"></p>','<div class="fans-droping-desc">',"<h3>好心疼~</h3>","<h3>你与<span><em>{{ oldMedalList.length }}</em>位主播</span>的亲密度<span>正在下降~</span></h3>","<h5>亲密度下降到0时，将会失去主播粉丝徽章</h5>","</div>","{{ /if }}","</div>","</div>",'<div class="fans-droping-content">',"{{ if newMedalState }}",'<ul class="fans-droping-list">',"{{ each newMedalList as item index }}","{{ if ((index == newMedalList.length-1) && (oldMedalList.length <= 0)) }}",'<li class="fans-droping-list-item no-border" data-bid="{{ item.rid }}">',"{{ else }}",'<li class="fans-droping-list-item" data-bid="{{ item.rid }}">',"{{ /if }}",'<div class="fans-medal-info">','<div class="fans-medal-icon-warp">','<p class="fans-medal">',"{{ if (fansMedal[item.rid]) }}",'<span class="fans-badge-icon" data-ui-level="{{ item.bl }}">','<span class="fans-icon-name" style="background-image:url(',"{{ fansMedal[item.rid][item.bl].bg }}",')"><i>{{ item.bnn }}</i></span>','<span class="fans-badge-level" style="background-image:url(',"{{ fansMedal[item.rid][item.bl].md }}",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'{{ else if (fansMedal["all"]) }}','<span class="fans-badge-icon" data-ui-level="{{ item.bl }}">','<span class="fans-icon-name" style="background-image:url(','{{ fansMedal["all"][item.bl].bg }}',')"><i>{{ item.bnn }}</i></span>','<span class="fans-badge-level" style="background-image:url(','{{ fansMedal["all"][item.bl].md }}',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","{{ else }}",'<span class="fans-badge-icon" data-ui-level="{{ item.bl }}">','<span class="fans-icon-name"><i>{{ item.bnn }}</i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","{{ /if }}","</p>",'<p class="fans-intimate">',"<i></i>","<span>{{ item.afim }}</span>","</p>","</div>",'<p class="fans-medal-score">',"亲密度剩余：<span>{{ item.fim }}</span>","</p>","</div>",'<a href="/{{ item.rid }}" target="_blank" class="fans-droping-go-room">去直播间</a>',"</li>","{{ /each }}","</ul>","{{ if oldMedalList.length > 0 }}",'<h3 class="fans-new-droping-title">以下徽章的亲密度正在下降，赶紧送礼物吧~</h3>',"{{ /if }}","{{ /if }}",'<ul class="fans-droping-list">',"{{ each oldMedalList as item index }}","{{ if (index == (oldMedalList.length - 1)) }}",'<li class="fans-droping-list-item no-border" data-bid="{{ item.rid }}">',"{{ else }}",'<li class="fans-droping-list-item" data-bid="{{ item.rid }}">',"{{ /if }}",'<div class="fans-medal-info">','<div class="fans-medal-icon-warp">','<p class="fans-medal">',"{{ if (fansMedal[item.rid]) }}",'<span class="fans-badge-icon" data-ui-level="{{ item.bl }}">','<span class="fans-icon-name" style="background-image:url(',"{{ fansMedal[item.rid][item.bl].bg }}",')"><i>{{ item.bnn }}</i></span>','<span class="fans-badge-level" style="background-image:url(',"{{ fansMedal[item.rid][item.bl].md }}",')">',"</span>",'<span class="fans-icon-level"></span>',"</span>",'{{ else if (fansMedal["all"]) }}','<span class="fans-badge-icon" data-ui-level="{{ item.bl }}">','<span class="fans-icon-name" style="background-image:url(','{{ fansMedal["all"][item.bl].bg }}',')"><i>{{ item.bnn }}</i></span>','<span class="fans-badge-level" style="background-image:url(','{{ fansMedal["all"][item.bl].md }}',')">',"</span>",'<span class="fans-icon-level"></span>',"</span>","{{ else }}",'<span class="fans-badge-icon" data-ui-level="{{ item.bl }}">','<span class="fans-icon-name"><i>{{ item.bnn }}</i></span>','<span class="fans-badge-level"></span>','<span class="fans-icon-level"></span>',"</span>","{{ /if }}","</p>",'<p class="fans-intimate">',"<i></i>","<span>{{ item.afim }}</span>","</p>","</div>",'<p class="fans-medal-score">',"亲密度剩余：<span>{{ item.fim }}</span>","</p>","</div>",'<a href="/{{ item.rid }}" target="_blank" class="fans-droping-go-room">去直播间</a>',"</li>","{{ /each }}","</ul>","</div>","</div>"),
t=r.compile(e)},medalSwitchCheck:function(){var e,t=this;if(m.anchorMedalSwitch){if(!d.check())return;e=m.medalEnterStatus.none}else e=m.medalEnterStatus.close;t.medalEnterAppend({status:e,userCheck:"notLogin"})},medalTipMsgConfig:function(e){var t,a,i,s=this.doms,n=this.renderHtml,o=s.$medalContentWarp;if("hide"===e.status)return clearTimeout(m.tipsTimer),void(m.tipsTimer=setTimeout(function(){o.find("[data-"+e.remainType+"-type="+e.type+"]").remove()},150));switch(e.remainType){case"tip":if(t=o.find("[data-tip-type="+e.type+"]"),t&&t.length>0)return;i=e.medalInfo,o.append(n.medalTipTemp({type:e.type,curMedalInfo:i,fansMedal:g||{},fansSpecialUrl:m.fansSpecialUrl})),o.find("[data-tip-type="+e.type+"]").show();break;case"msg":if(a=o.find("[data-msg-type="+e.type+"]"),a&&a.length>0)return;o.append(n.medalMsgTemp({type:e.type,getMedalData:"getFirstMedal"===e.type?e.getMedalData:"",fansMedal:g||{},fansSpecialUrl:m.fansSpecialUrl})),o.find("[data-msg-type="+e.type+"]").show()}e.timer&&setTimeout(function(){o.find("[data-"+e.remainType+"-type="+e.type+"]").remove()},4e3)},medalLevMap:function(){for(var e=0,t=m.levelMap.list;e<t.length;e++)t[e].push(p.medalLevel(t[e][0]))},firstRechargeMsgHtml:function(e){var t=this.renderHtml;return t.firstRechargeMsgTemp(e)},firstRechargeEnterAppend:function(){var t,a=this.doms,i=this.renderHtml;a.$firstRechargeBtn&&a.$firstRechargeBtn.length||(t=i.firstRechargeTemp({firstRechargeUrl:m.firstRechargeUrl}),a.$sendMsgWarp.addClass("chat-fans").append(t),a.$firstRechargeBtn=e(".firstpay-entrance"))},medalEnterAppend:function(t){var a,i,s=this.doms,n=this.renderHtml;s.$medalEnterBtn&&s.$medalEnterBtn.length>0&&s.$medalEnterBtn.remove(),t.status==m.medalEnterStatus.yesWear&&(a=m.medalListData.list[0],i=p.medalLevel(a.bl)),s.$medalContentWarp&&s.$medalContentWarp.length>0||(s.$sendMsgWarp.addClass("chat-fans").append(n.medalContainerTemp({userCheck:d.check()})),s.$medalContentWarp=e('[data-flag="medal-entrance-warp"]')),s.$medalContentWarp.append(n.medalEnterTemp({status:t.status,medalData:a,madelLev:i,fansMedal:g||{}})),s.$medalEnterBtn=e('[data-action="medal-enter-btn"]')},medalContentWarpAppend:function(t){var a=this.doms,i=this.renderHtml;a.$medalInfoWarp&&a.$medalInfoWarp.length>0||(a.$medalContentWarp.append(i.medalContentWarpTemp({data:m.medalListData})),a.$medalInfoWarp=e('[data-flag="medal-info-warp"]'))},medalContentAppend:function(t){var a,i,s=this,n=this.doms,o=this.renderHtml,t=t||{};if(t&&"hide"===t.status){if(clearTimeout(m.tipsTimer),!n.$medalInfoWarp)return;return void(m.tipsTimer=setTimeout(function(){n.$medalInfoWarp.hide()},150))}if(t&&"update"===t.status){if(!n.$medalInfoWarp)return;n.$medalInfoWarp.is(":hidden")?m.medalInfoStatus=0:m.medalInfoStatus=1,n.$medalInfoWarp.remove(),n.$medalInfoWarp=e('[data-flag="medal-info-warp"]')}n.$medalInfoWarp&&n.$medalInfoWarp.length>0?n.$medalInfoWarp.show():(s.medalContentWarpAppend(),a=s.searchMedalIndex(),i="number"===p.returnType(a)?1:0,n.$medalInfoWarp.append(o.medalContentTemp({fansSwitch:m.anchorMedalSwitch,fansNick:m.fansNick,data:m.medalListData,roomId:m.roomId,maxLev:m.medalLevel[m.medalLevel.length-1],curMedalStatus:i,curMedalIndex:a,medalInfo:m.medalListData.list[a],fansMedal:g||{},fansSpecialUrl:m.fansSpecialUrl,firstRecharge:m.medalListData.frq,firstRechargeUrl:m.firstRechargeUrl})),n.$medalInfoContent=e('[data-flag="medal-info-content"]'),s.medalListAppend(t))},medalListAppend:function(t){var a,i,s=this,n=this.doms,o=this.renderHtml;t&&"hide"===t.status||(a=s.searchMedalIndex(),i="number"===p.returnType(a)&&5>a?5:4,n.$medalInfoContent.after(o.medalListTemp({personMedalUrl:m.personMedalUrl,medalList:m.medalListData,roomId:m.roomId,medalNumMax:i,fansMedal:g||{}})),n.$medalListWarp=e('[data-flag="medal-list-warp"]'),2==m.medalListData.wf&&s.anchorRoomStatus(),1===m.medalInfoStatus&&s.hoverEnterStatus&&n.$medalInfoWarp.show())},fansGiftPackAppend:function(t){var a,i=this;a=i.renderHtml.fansGiftPackTemp({fansMedal:g||{},fansGiftData:t}),e("#js-stats-and-actions .uinfo-ywyc").append(a),e("#js-stats-and-actions .uinfo-ywyc").find(".fans-barrage-gift").show()},firstRechargeFulFillAppend:function(e){var t,a=this.doms,i=this.renderHtml,s=e||{};a.$firstRechargeTip&&a.$firstRechargeTip.length&&a.$firstRechargeTip.remove(),t=i.firstRechargeFulfillTemp({fansGiftData:{oid:s.oid,onn:s.onn,gbnn:s.bnn,gbl:s.bl,gbr:m.roomId},fansMedal:g||{}}),a.$roomVideoWarp.append(t),a.$firstRechargeTip=a.$roomVideoWarp.find(".firstpay-success")},fansRechargeEnterAppend:function(e){var t,a=this,i=this.doms;+m.isNobleOneYearOpen||u.render().done(function(){i.$fansRechatEnter&&i.$fansRechatEnter.length||(t=a.renderHtml.fansRechargeEnterTemp({fansRechargeUrl:m.firstRechargeUrl,fansNick:m.fansNick,roomId:m.roomId,fansMedal:g||{}}),i.$giftContent.find(".g-list"),i.$giftContent.prepend(t),i.$fansRechatEnter=i.$giftContent.find(".firstpay-warp"),i.$fansRechatRemain=i.$giftContent.find(".firstpay-modal"),n.get(m.fansRechargeStorage)||(i.$fansRechatRemain.removeClass("hide"),n.set(m.fansRechargeStorage,1,m.storageExpired)))})},fansRechargeLoginCheck:function(){var e=this,t=m.medalListData||{},a=d.check();a?m.anchorMedalSwitch&&1==t.frq&&e.fansRechargeEnterAppend():e.fansRechargeEnterAppend()},fansNickUpdate:function(e){var t=this.doms;t.$fansRechatEnter&&t.$fansRechatEnter.length&&t.$fansRechatEnter.find(".fans-icon-name i").text(e)},anchorRoomStatusView:function(e){var t=this.doms,a=t.$medalListWarp.find('.fans-has-badge[data-medal-index="0"] .fans-online-icon');e.is_live?a.removeClass("status-disable").prop("href","/"+m.medalListData.list[0].rid).find("em").text("直播中"):a.addClass("status-disable").prop("href","/"+m.medalListData.list[0].rid).find("em").text("未开播"),a.fadeIn()},anchorRoomStatus:function(){var t=this,a=m.medalListData,i=m.medalListData.list[0];i&&i.anchorUid&&i.anchorNick?t.anchorRoomStatusView(i):e.ajax({url:m.urls.searchAnchorInfo,dataType:"json",data:{rid:a.list[0].rid,auth:a.list[0].hc}}).done(function(e){t.anchorRoomStatusView(e)}).then(function(){})},searchMedalIndex:function(t){var a,i,s=0,n=m.medalListData.list;if(e.isArray(n)){for(i=t?t:m.roomId;s<n.length;s++)if(i==n[s].rid){a=s;break}return a}},medalLevDeal:function(t){var a=0,i=t.list;if(e.isArray(i))for(;a<i.length;a++)i[a].medalLev=p.medalLevel(i[a].bl)},medalAnchorInfoSearch:function(){var t,a=this,i=m.medalListData;t=i.list.length>=8?8:i.list.length,e.ajax({url:m.urls.searchAnchorInfo,dataType:"json",data:{rid:i.list[m.searchProgress].rid,auth:i.list[m.searchProgress].hc}}).done(function(e){var s=i.list[m.searchProgress];m.searchProgress++,s.anchorUid=e.owner_uid,s.anchorNick=e.nn,s.anchorPic=e.avatar,s.is_live=e.is_live,m.searchProgress>=t?(m.fansListDataState=1,m.searchProgress=0,a.medalListPushCall()):a.medalAnchorInfoSearch()}).fail(function(){m.searchProgress++})},dropingMdealAppend:function(){var t,a=this,i=a.doms,s=a.renderHtml,o=m.dropingFansMedal,r=n.get(m.dropingDialogFlag),l=0;!r&&o&&o.length>0&&(m.newDropingMedal&&m.newDropingMedal.length&&(l=1),t=s.dropingMedalsTemp({fansMedal:g||{},newMedalState:l,oldMedalList:l?m.filterDropingMedal:o,newMedalList:m.newDropingMedal}),i.$dropingMedalsWarp&&i.$dropingMedalsWarp.length&&i.$dropingMedalsWarp.remove(),i.$chatContent.append(t),i.$dropingMedalsWarp=e(".fans-medal-droping-warp"),e(".fans-droping-content").mCustomScrollbar("destroy").mCustomScrollbar())},dropingMdealCheck:function(t){var a,i=m.dropingFansMedal,s=t,o=0;if(i&&i.length>0)for(a=e(".fans-droping-content");o<i.length;o++)i[o].rid==s&&(i.splice(o,1),o--,a&&a.length&&(i.length<=0?e(".fans-medal-droping-warp").remove():(e('.fans-droping-list-item[data-bid="'+s+'"]').remove(),e(".fans-droping-desc").find("em").text(i.length),e(".fans-droping-content").mCustomScrollbar("destroy").mCustomScrollbar())),i.length>0?n.set(m.dropingListFlag,i,m.storageExpired):n.remove(m.dropingListFlag))},dropingMedalPush:function(e){var t=e;t&&(t.rid==l.get("room.room_id")&&c.exe("js_fans_change",1),t.afim<0&&m.dropingFansMedal.push(t))},newDropingMedalCheck:function(){var t,a,i=this,s=m.dropingFansMedal,o=n.get(m.dropingListFlag),r=n.get(m.dropingDialogFlag),l=[],d=0;if(!r){if(s.length)if("array"===p.returnType(o)){for(l=e.extend(!0,[],s);d<s.length;d++)if(t=s[d]){a=!1;for(var c=0;c<o.length;c++)t.rid==o[c].rid&&(a=!0);if(!a){for(var u=0;u<l.length;u++)l[u].rid==t.rid&&l.splice(u,1);m.newDropingMedal.push(t)}}m.filterDropingMedal=l,m.newDropingMedal&&m.newDropingMedal.length&&i.dropingMdealAppend()}else i.dropingMdealAppend();n.set(m.dropingListFlag,s,m.storageExpired)}},dropingMedalSort:function(){var e,t,a=this,i=m.dropingFansMedal,s=0,o=0;if(i&&i.length>0){for(;s<i.length;s++){for(e=i[s],t=s,o=s+1;o<i.length;o++)e.fim>i[o].fim&&(e=i[o],t=o);i.splice(s,0,e),i.splice(t+1,1)}a.newDropingMedalCheck()}else n.remove(m.dropingListFlag)},medalListPush:function(t){var a,i=this,s=(this.doms,t);if(m.medalListData=s,"object"===p.returnType(m.medalListData)){a=m.medalListData.wf,m.fansRequestState=0,m.fansListDataState=0,m.dropingFansMedal=[],m.newDropingMedal=[],m.isHandleList||(m.medalListData.list=o.isArray(m.medalListData.list)?o.decode(m.medalListData.list):[{value:t.list}],m.isHandleList=1),0!=a&&e.isArray(m.medalListData.list)||(m.medalListData.list=[]);for(var n=0;n<m.medalListData.list.length;n++){var r=m.medalListData.list[n];r&&r.value&&(r=o.decode(r.value).too(),r.fim=Math.round(r.fim/10)/10,r.nfim=Math.round(r.nfim/10)/10,r.afim=Math.round(r.afim/10)/10,r.mafim=Math.round(r.mafim/10)/10,m.medalListData.list[n]=r),i.dropingMedalPush(r)}m.medalListPushState=1,i.dropingMedalSort(),i.medalListPushCall()}},medalFirstListAppend:function(){var e,t=this;"object"===p.returnType(m.medalListData)&&(m.fansRequestState||(m.fansRequestState=1,e=m.medalListData.wf,m.fansListDataState||(1!=e&&2!=e||m.fansListDataState?t.medalListPushCall():t.medalAnchorInfoSearch())))},ownerRoomMedalStauts:function(){var e=this,t=e.searchMedalIndex(),a=m.medalListData;"number"!==p.returnType(t)||0===t&&1!=a.wf||e.medalTipMsgConfig({medalInfo:a.list[t],remainType:"tip",type:"ownerRoomMedalRemain",status:"show",timer:!0})},medalListPushCall:function(){var e,t=this,a=this.doms,i=m.medalListData.wf;0==i?m.anchorMedalSwitch?(e=m.medalEnterStatus.none,n.get("medalRemainTip")||(t.medalTipMsgConfig({remainType:"tip",type:"medalRemain",status:"show",timer:!0}),n.set("medalRemainTip",1,31536e3))):(e=m.medalEnterStatus.close,n.get("medalNotOpenTip")||(t.medalTipMsgConfig({remainType:"tip",type:"medalDisable",status:"show",timer:!0}),n.set("medalNotOpenTip",1,31536e3))):1==i?(e=m.medalEnterStatus.notWear,t.medalLevDeal(m.medalListData)):2==i&&(e=m.medalEnterStatus.yesWear,t.medalLevDeal(m.medalListData)),t.medalViewUpdateAgent({type:"firstRender",enterStatus:e}),1!=i&&2!=i||m.fansListDataState||(a.$sendMsgWarp.find('[data-action="medal-tip-warp"]').remove(),t.ownerRoomMedalStauts())},medalUpdatePush:function(e,t){var i,s,o,r,l,d,c=this,u=e;m.medalListData&&("fansDay"==t&&u&&u.brid?(d=u.brid,i=c.searchMedalIndex(u.brid)):(d=m.roomId,i=c.searchMedalIndex()),s=m.medalListData.list[i],"object"===p.returnType(s)&&(o=s.bl,s.bl=u.bl,s.fim=Math.round(u.fim/10)/10,s.nfim=Math.round(u.nfim/10)/10,s.afim=Math.round(u.afim/10)/10,s.mafim=Math.round(u.mafim/10)/10,c.medalLevDeal(m.medalListData),s.afim>=0&&c.dropingMdealCheck(d),l="fansDay"==t&&u&&u.brid?c.medalStatusSearch(u.brid)||{}:c.medalStatusSearch()||{},s.afim>=s.mafim?u.bl>o?(r="medalUpgradeFull",n.get("medalExpUpper_"+m.roomId)||(n.set("medalExpUpper_"+m.roomId,1,p.getRestTime()/1e3),c.medalTipMsgConfig({getMedalData:s,remainType:"msg",type:r,status:"show",timer:!0}),a.trigger("dys",{key:"dys.room.fansbadge.medalUpgrade.show",bdg_id:l.bdg_id,cbdg_id:l.cbdg_id,level:s.bl,qinmi:s.fim,rank:s.pos}),a.trigger("dys",{key:"dys.room.fansbadge.coreLimit.show",bdg_id:l.bdg_id,cbdg_id:l.cbdg_id,level:s.bl,qinmi:s.fim,rank:s.pos}))):(r="expUpper",n.get("medalExpUpper_"+m.roomId)||(n.set("medalExpUpper_"+m.roomId,1,p.getRestTime()/1e3),c.medalTipMsgConfig({getMedalData:s,remainType:"msg",type:r,status:"show",timer:!0}),a.trigger("dys",{key:"dys.room.fansbadge.coreLimit.show",bdg_id:l.bdg_id,cbdg_id:l.cbdg_id,level:s.bl,qinmi:s.fim,rank:s.pos}))):u.bl>o&&(c.medalTipMsgConfig({remainType:"msg",type:"medalUpgrade",status:"show",timer:!0}),a.trigger("dys",{key:"dys.room.fansbadge.medalUpgrade.show",bdg_id:l.bdg_id,cbdg_id:l.cbdg_id,level:s.bl,qinmi:s.fim,rank:s.pos})),(m.anchorMedalSwitch||"fansDay"==t)&&(2==m.medalListData.wf?c.medalViewUpdateAgent({enterStatus:m.medalEnterStatus.yesWear}):c.medalViewUpdateAgent({enterStatus:m.medalEnterStatus.notWear}))))},medalGetPush:function(t){var i,s,n=this,o=this.doms,r=m.medalListData;m.anchorMedalSwitch=1,m.medalListData.frq=0,a.trigger("fans.medal.switch.set"),o.$fansRechatEnter&&o.$fansRechatEnter.length&&o.$fansRechatEnter.addClass("hide"),"object"!==p.returnType(r)&&(r={type:m.types.medalList,wf:1,list:[]},n.medalViewUpdateAgent({enterStatus:m.medalEnterStatus.notWear})),s=n.searchMedalIndex(),0==r.wf&&(r.wf=1,n.medalEnterAppend({status:m.medalEnterStatus.notWear})),"number"===p.returnType(s)&&0!==s&&r.list.splice(s,1),i=t,i.rid=m.roomId,i.fim=Math.round(i.fim/10)/10,i.nfim=Math.round(i.nfim/10)/10,i.afim=Math.round(i.afim/10)/10,i.mafim=Math.round(i.mafim/10)/10,i.medalLev=p.medalLevel(i.bl),e.ajax({url:m.urls.searchAnchorInfo,dataType:"json",data:{rid:m.roomId,auth:i.hc}}).done(function(e){var s;i.pos=m.ruPos?m.ruPos:"-",i.anchorUid=e.owner_uid,i.anchorNick=e.nn,i.anchorPic=e.avatar,2==r.wf?r.list.splice(1,0,i):r.list.unshift(i),n.medalContentAppend({status:"update"}),s=n.medalStatusSearch(),a.trigger("mod.room.user.fansMedal.info",s),a.trigger("mod.room.user.fansMedal.setcurrroom",s),m.medalListData.list.length<m.medalNumLimit?m.medalListData.list.length>1?n.medalTipMsgConfig({remainType:"tip",type:"getOtherMedal",status:"show",timer:!0}):n.medalTipMsgConfig({getMedalData:t,remainType:"msg",type:"getFirstMedal",status:"show"}):(o.$sendMsgWarp.find('[data-flag="medal-entrance-warp"]').addClass("status-full"),n.medalTipMsgConfig({remainType:"tip",type:"medalUpper",status:"show",timer:!0}))}).then(function(){})},fansFirstPayStatus:function(){var e=m.medalListData.frq;m.anchorMedalSwitch&&l.get("sys.uid")!=l.get("room.owner_uid")&&1==e||a.trigger("mod.task.config.hide",m.fansFirstPayTask)},medalViewUpdateAgent:function(e){var t,a=this,i=m.medalListData.frq;l.get("sys.uid")==l.get("room.owner_uid")&&(m.medalListData.frq=0,i=0),a.fansFirstPayStatus(),a.medalEnterAppend({status:e.enterStatus,firstRecharge:i}),a.fansRechargeLoginCheck(),m.fansListDataState&&e.enterStatus!=m.medalEnterStatus.none&&e.enterStatus!=m.medalEnterStatus.close&&(t="firstRender"==e.type?"":"update",a.medalContentAppend({status:t,firstRecharge:i}))},medalListDataUpdate:function(e){var t,a,i=this,s=e,n=m.medalListData;switch(parseInt(s.ot,10)){case 1:t=i.searchMedalIndex(e.rid),n.wf=2,a=n.list.splice(t,1),n.list.unshift(a[0]),i.medalViewUpdateAgent({enterStatus:m.medalEnterStatus.yesWear});break;case 2:n.wf=1,i.medalViewUpdateAgent({enterStatus:m.medalEnterStatus.notWear});break;case 3:t=i.searchMedalIndex(e.rid)}},medalStatusSearch:function(){var e,t=this,a={},i=m.medalListData;return m.medalListPushState?1==i.wf||2==i.wf?(e=t.searchMedalIndex(),a.is_bdg=1,"number"===p.returnType(e)?(a.is_cbdg=1,a.cbdg_id=m.roomId):(a.is_cbdg=0,a.cbdg_id=""),2==i.wf?a.bdg_id=i.list[0].rid:a.bdg_id=""):(a.is_bdg=0,a.is_cbdg=0,a.bdg_id="",a.cbdg_id=""):a={is_bdg:"",is_cbdg:"",bdg_id:"",cbdg_id:""},a},dpDealAgent:function(e){var t,i,s=this,n=s.medalStatusSearch();switch(e.type){case m.dpType.medalEnter:t="dys.room.fansbadge.medalEnter.click";break;case m.dpType.fansIntroduction:t="dys.room.fansbadge.introduction.click";break;case m.dpType.medalListEnter:t="dys.room.fansbadge.medalListEnter.click";break;case m.dpType.medalListSel:t="dys.room.fansbadge.medalListSel.click";break;case m.dpType.myMedalEnter:t="dys.room.fansbadge.myMedal.click"}e.type===m.dpType.medalListSel&&(i=e.selMedalRid),a.trigger("dys",{key:t,is_bdg:n.is_bdg,is_cbdg:n.is_cbdg,bdg_id:n.bdg_id,cbdg_id:n.cbdg_id,nbdg_id:i})},pushBind:function(){var t,i,s=this,r=m.types;c.reg("room_data_handler",function(u){var g,f=o.decode(u).too();switch(f.type){case r.fansRank:m.fansNick=f.bnn||"粉丝",s.fansNickUpdate(m.fansNick);break;case r.medalList:if(!d.check())return;m.isHandleList=0,s.medalListPush(f),s.initMedalData=f,g=s.medalStatusSearch(),a.trigger("mod.room.user.fansMedal.info",g),a.trigger("mod.room.user.fansMedal.setcurrroom",g);break;case r.medalGet:if(!d.check())return;c.exe("js_fans_change",1),s.medalGetPush(f);break;case r.medalOpera:if(!d.check())return;s.medalListDataUpdate(f);break;case r.medalUpdate:if(!d.check())return;s.updateMedalData=f,s.medalUpdatePush(f);break;case r.medalUpdateCur:if(!d.check())return;s.medalUpdatePush(f,"fansDay");break;case r.medalRankPos:if(!d.check())return;m.ruPos=f.pos,i=s.searchMedalIndex(),"number"===p.returnType(i)&&(m.medalListData.list[i].pos=f.pos,s.medalContentAppend({status:"update"}));break;case r.medalOperaError:if(!d.check())return;if("503101"==f.result){if(m.removeMedalID=f.rid,t=s.searchMedalIndex(f.rid),"number"!==p.returnType(t))return;m.medalListData.list.splice(t,1),m.medalListData.list.length<=0?m.medalListData.wf=0:m.medalListData.wf=1,s.medalViewUpdateAgent({enterStatus:m.medalListData.wf?m.medalEnterStatus.notWear:m.medalEnterStatus.none}),2!=f.ot&&e.dialog.tips_black("您没有此徽章")}else 0==f.result&&s.medalListDataUpdate({rid:f.rid,ot:m.opearMedalType});break;case r.fansGift:n.set("fansGiftPush_"+l.get("sys.uid"),f,p.getRestTime()/1e3);break;case r.firstFansGift:m.medalListData.frq=0,s.firstRechargeFulFillAppend(f)}}),c.reg("room_frbInfo",function(e){var t=o.decode(e).too();t.type==m.types.firstFansMsg&&a.trigger("mod.chat.msg.msg",s.firstRechargeMsgHtml(t))}),a.on("crazy.fans.config.data.back",function(){s.medalConfigUpdate()}),a.on("room.activity.get.fans.id",function(){return s.medalStatusSearch().bdg_id})},medalConfigUpdate:function(){this.initMedalData?this.medalListPush(this.initMedalData):this.updateMedalData&&this.medalUpdatePush(this.updateMedalData)},eventBind:function(){var t=this,i=this.doms;a.on("fans.gift.backpack.show",function(e){var a=e;a&&(t.fansGiftPackAppend(a),n.remove("fansGiftPush_"+l.get("sys.uid")))}),i.$sendMsgWarp.on("mouseenter",'[data-action="medal-enter-btn"]',function(a){var i=e(this).attr("data-flag");switch(p.eventDefault(a),t.hoverEnterStatus=1,clearTimeout(m.tipsTimer),i){case m.medalEnterStatus.close:t.medalTipMsgConfig({remainType:"tip",type:"medalDisable",status:"show"});break;case m.medalEnterStatus.none:t.medalTipMsgConfig({remainType:"tip",type:"medalRemain",status:"show"});break;case m.medalEnterStatus.notWear:m.fansListDataState?t.medalContentAppend():t.medalFirstListAppend();break;case m.medalEnterStatus.yesWear:m.fansListDataState?t.medalContentAppend():t.medalFirstListAppend()}}).on("click",'[data-action="medal-enter-btn"]',function(e){p.eventDefault(e),i.$sendMsgWarp.find('[data-flag="medal-entrance-warp"]').removeClass("status-full"),t.dpDealAgent({type:m.dpType.medalEnter})}).on("mouseleave",'[data-action="medal-enter-btn"]',function(a){var i=e(this).attr("data-flag");switch(p.eventDefault(a),t.hoverEnterStatus=0,i){case m.medalEnterStatus.close:t.medalTipMsgConfig({remainType:"tip",type:"medalDisable",status:"hide"});break;case m.medalEnterStatus.none:t.medalTipMsgConfig({remainType:"tip",type:"medalRemain",status:"hide"});break;case m.medalEnterStatus.notWear:t.medalContentAppend({status:"hide"});break;case m.medalEnterStatus.yesWear:t.medalContentAppend({status:"hide"})}}).on("mouseenter",'[data-action="medal-tip-warp"]',function(e){p.eventDefault(e),clearTimeout(m.tipsTimer)}).on("mouseleave",'[data-action="medal-tip-warp"]',function(a){var i=e(this).attr("data-tip-type");p.eventDefault(a),t.medalTipMsgConfig({remainType:"tip",type:i,status:"hide"})}).on("mouseenter",'[data-flag="medal-info-warp"]',function(e){p.eventDefault(e),t.hoverEnterStatus=1,clearTimeout(m.tipsTimer)}).on("mouseleave",'[data-flag="medal-info-warp"]',function(e){p.eventDefault(e),t.hoverEnterStatus=0,t.medalContentAppend({status:"hide"})}).on("click",'[data-tag="fans-medal-item"] .radiobox',function(i){var s=e(this),n=s.closest('[data-tag="fans-medal-item"]'),r=n.attr("data-flag"),l=parseInt(n.attr("data-medal-index"),10),d={};s.find("input").is(":checked")||(s.find("input").prop("checked",!0),"medal-take-on"==r&&(m.opearMedalType=1,d={ot:1,rid:m.medalListData.list[l].rid}),"medal-take-off"==r&&(m.opearMedalType=2,d={ot:2,rid:""}),a.trigger("mod.room.user.fansMedal.setcurrroom",{bdg_id:d.rid}),c.exe("js_medal_opera",o.encode([{name:"type",value:m.types.medalOpera},{name:"ot",value:d.ot},{name:"rid",value:d.rid}])),t.dpDealAgent({type:m.dpType.medalListSel,selMedalRid:n.attr("data-medal-id")}))}).on("click",'[data-flag="medal-close-msg"]',function(a){var i;p.eventDefault(a),i=e(this).parent().attr("data-msg-type"),t.medalTipMsgConfig({remainType:"msg",type:i,status:"hide"})}).on("click",'[data-flag="medal-get-use"]',function(t){p.eventDefault(t);var a=e(this);m.opearMedalType=1,c.exe("js_medal_opera",o.encode([{name:"type",value:m.types.medalOpera},{name:"ot",value:1},{name:"rid",value:a.attr("data-medal-rid")}])),"msg-tip-btn"==a.attr("data-tag")&&a.closest(".entrance-noticewrap").remove()}).on("click",'[data-flag="look-my-medal"]',function(){t.dpDealAgent({type:m.dpType.myMedalEnter})}).on("click",'[data-flag="fans-info-more"]',function(){t.dpDealAgent({type:m.dpType.fansIntroduction})}).on("click",".fans-firstpay-entrance",function(){DYS.sub({action_code:"click_msg_firstpay",ext:{is_bdg:1}})}).on("click",".firstpay-entrance",function(){DYS.sub({action_code:"click_msg_firstpay",ext:{is_bdg:0}})}),e('#container [data-flag="fans-badge-close"]').on("click",function(t){p.eventDefault(t),e('[data-flag="fans-badge-lead"]').remove()}),e("#js-stats-and-actions").on("click",'[data-tag="fans-gift-close"]',function(){var t=e("#js-stats-and-actions").find(".fans-barrage-gift");return t.fadeOut(100,function(){t.remove()}),!1}).on("click",'[data-tag="fans-backpack-open"]',function(){e("#js-stats-and-actions .backpack-btn").trigger("click")}),i.$roomVideoWarp.on("click",".fisrtpay-close",function(){return i.$roomVideoWarp.find(".firstpay-success").remove(),!1}).on("click",".firstpay-award-btn",function(){var a=i.$roomVideoWarp.find(".firstpay-success"),s=e(this).attr("data-medal-rid"),n=i.$sendMsgWarp.find(".entrance-noticewrap").attr("data-msg-type");return a.fadeOut(500,function(){a.remove()}),m.opearMedalType=1,c.exe("js_medal_opera",o.encode([{name:"type",value:m.types.medalOpera},{name:"ot",value:1},{name:"rid",value:s}])),n&&n.length&&t.medalTipMsgConfig({remainType:"msg",type:n,status:"hide"}),DYS.sub({action_code:"click_msg_firstpay_sel",ext:{bdg_id:s}}),!1}),i.$giftContent.on("click",".firstpay-enter",function(){return i.$fansRechatRemain.hasClass("hide")?i.$fansRechatRemain.removeClass("hide"):i.$fansRechatRemain.addClass("hide"),!1}).on("click",".firstpay-modal-close",function(){return i.$fansRechatRemain.addClass("hide"),!1}).on("click",".firstpay-submit",function(){return d.check()?void 0:(d.show("login"),!1)}),i.$container.on("click",".fans-guide-close,.fans-guide-button",function(){return i.$container.find(".fans-remain-modal-wrap").remove(),!1}),i.$chatContent.on("click",".fans-droping-close",function(){return i.$chatContent.find(".fans-medal-droping-warp").remove(),t.dropingDialogSwitch&&e.dialog.tips_black("可在个人中心-我的头衔-粉丝徽章开启提醒"),!1}).on("click",".fans-droping-switch",function(){var a=n.get(m.dropingDialogFlag);a?(e(this).removeClass("close-remain"),t.dropingDialogSwitch=0,n.set(m.dropingDialogFlag,0,m.storageExpired)):(e(this).addClass("close-remain"),t.dropingDialogSwitch=1,n.set(m.dropingDialogFlag,1,m.storageExpired))})},dialogEventBind:function(){var t=this.doms;e('[data-flag="fans-dialog-closebtn"]').on("click",function(e){p.eventDefault(e),t.$fansIntroductionWarp.hide()}),t.$fansIntroductionWarp.on("click",'[data-flag="fans-tab-item"]',function(a){switch(p.eventDefault(a),e(this).index()){case 0:t.$fansIntroductionWarp.find('[data-flag="fans-tab-warp"]').addClass("what-is-fans");break;case 2:t.$fansIntroductionWarp.find('[data-flag="fans-tab-warp"]').addClass("how-tobe-fans");break;default:t.$fansIntroductionWarp.find('[data-flag="fans-tab-warp"]').removeClass("what-is-fans how-tobe-fans")}t.$fansIntroductionWarp.find('[data-flag="fans-tab-item"] a, [data-flag="tans-tab-content"]').removeClass("status-cur"),e(this).find("a").addClass("status-cur"),t.$fansIntroductionWarp.find('[data-flag="tans-tab-content"]').eq(e(this).index()).addClass("status-cur")})}};return f}),define("douyu/com/kill-ie",["jquery","shark/util/template/1.0","shark/util/storage/1.0","douyu/context"],function(e,t,a,i){var s="dialogIe7",n=navigator.appVersion,o={isIe6:-1!=n.search(/MSIE 6/i),isIe7:-1!=n.search(/MSIE 7/i),isIe8:-1!=n.search(/MSIE 8/i)},r={init:function(){(o.isIe8||o.isIe7||o.isIe6)&&(this.render(),this.show())},render:function(){var t=i.get("sys.web_url")+"app/douyu/res/com/kill-ie/chrome_pic.png?20160824",a=i.get("sys.web_url")+"app/douyu/res/com/kill-ie/firefox_pic.png?20160824",s=i.get("sys.web_url")+"app/douyu/res/com/kill-ie/downApp_sq.png?20160824",n=i.get("sys.web_url")+"app/douyu/res/com/kill-ie/down_btn.png?20160819",o=['<div id="diaIe7" class="dia-ie7-wp">','<span class="dia-ie7-mask"></span>','<div class="dia-ie7-container">','<a class="dia-ie7-cls" href="javascript:;" title="关闭"></a>','<div class="dia-ie7-hd">','<p class="dih-tit">温馨提示</p>','<p class="dih-p">您当前浏览器版本过低，存在安全风险，建议您升级浏览器</p>',"</div>",'<div class="dia-ie7-browser">','<a class="dib-lk chrome-lk" href="https://www.google.cn/intl/zh-CN/chrome/browser/desktop/" target="_blank" title="下载谷歌浏览器">','<img src="'+t+'">',"</a>",'<a class="dib-lk firefox-lk" href="https://www.mozilla.org/zh-CN/firefox/new/" target="_blank" title="下载火狐浏览器">','<img src="'+a+'">',"</a>","</div>",'<div class="dia-ie7-down">','<img class="did-sq" src="'+s+'">','<p class="did-p">下载斗鱼APP，随时随地看直播</p>','<a class="did-lk" href="http://www.douyu.com/client" target="_blank">','<img src="'+n+'">',"</a>","</div>","</div>","</div>"].join("");e("body").append(o),this.bindEvt()},show:function(){e(".dia-ie7-wp").show()},hide:function(){e(".dia-ie7-wp").hide()},bindEvt:function(){var t=this;e(".dia-ie7-cls").on("click",function(){t.hide()})}},l=function(){var e=new Date,t=new Date;return t.setHours(24),t.setMinutes(0),t.setSeconds(0),(t-e)/1e3},d=function(e){if(e)r.init();else{var t;if(t=a.get(s),t&&1===t.flag)return;a.set(s,{flag:1},l()),r.init()}};return{init:d}}),define("douyu/page/room/normal/mod/baidu-hm",["jquery","douyu/page/room/base/api"],function(e,t){function a(){i||(setTimeout(function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?e99aee90ec1b2106afe7ec3b199020a7";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)},0),i=1)}var i=0;return{init:function(){t.reg("room_data_info",function(){a()})}}}),define("douyu/com/zoom-dp",["jquery","shark/observer"],function(e,t){function a(e){DYS.sub(e)}var i={"dys.com.zoom.pop.show":function(e){a({action_code:"show_live_pagescal"})},"dys.com.zoom.pop.close":function(e){a({action_code:"click_live_pagescal_close"})},"dys.com.zoom.pop.zoomtip":function(e){a({action_code:"click_live_pagescal_no"})}};for(var s in i)!function(e){var a=i[e];t.on(e,function(e){a.call(this,e)})}(s);return{init:function(e){DYS.sub.setPageCode(e)}}}),define("douyu/com/zoom",["jquery","shark/observer","shark/util/cookie/1.0","shark/util/storage/1.0","douyu/context","douyu/com/zoom-dp"],function(e,t,a,i,s,n){var o={storageName:"zoomtip",storageVal:"1",storageTime:604800,isPop:!1,init:function(){this.handleCookie(),this.pop(),t.on("mod.layout.screen.change",function(e){o.detect()&&o.pop()})},handleCookie:function(){a.get(this.storageName)&&(a.remove(this.storageName),i.set(this.storageName,this.storageVal,this.storageTime))},detect:function(){return this.ua=navigator.userAgent.toLowerCase(),-1==this.ua.indexOf("windows")?!1:!i.get(this.storageName)},cal:function(){var e=0,t=window.screen;return void 0!==window.devicePixelRatio?e=window.devicePixelRatio:~this.ua.indexOf("msie")?t.deviceXDPI&&t.logicalXDPI&&(e=t.deviceXDPI/t.logicalXDPI):void 0!==window.outerWidth&&void 0!==window.innerWidth&&(e=window.outerWidth/window.innerWidth),e&&(e=Math.round(100*e)),99!==e&&101!==e||(e=100),e},resize:function(){var t=this.cal();if(this.isPop&&t&&100==t)return void this.close();var a=540,i=432,s=100*a/t,n=100*i/t;e(".pop-zoom-container").css({width:s+"px",height:n+"px",marginLeft:-s/2+"px",marginTop:-n/2+"px"})},pop:function(){var a=this.cal();if(!i.get(this.storageName)&&!this.isPop&&100!==a){var n=s.get("sys.web_url")+"app/douyu/res/com/sg-zoom-error.png?20160823",o=['<div class="pop-zoom-container">','<div class="pop-zoom">','<img class="pop-zoom-bg" src="',n,'">','<div class="pop-zoom-close">close</div>','<div class="pop-zoom-hide"></div>',"</div>","</div>"].join("");e("body").append(o),this.bindEvt(),this.isPop=!this.isPop,t.trigger("dys.com.zoom.pop.show")}this.resize()},close:function(){e(".pop-zoom-container").remove(),this.isPop=!this.isPop,t.trigger("dys.com.zoom.pop.close")},bindEvt:function(){var a=this;e(".pop-zoom-close").on("click",function(){a.close()}),e(".pop-zoom-hide").on("click",function(){i.set(a.storageName,a.storageVal,a.storageTime),t.trigger("dys.com.zoom.pop.zoomtip"),a.close()})}},r=function(){o.detect()&&o.init()};e(r)}),define("douyu/page/room/normal/mod/page-full",["jquery","shark/class","shark/observer","shark/util/lang/1.0","shark/util/storage/1.0","shark/util/template/1.0","douyu/context","douyu/page/room/base/api"],function(e,t,a,i,s,n,o,r){var l={localstorage:"pageFullSibarState",localstorageGuide:"pageFullIsGuideLayerShowed",expireTime:31536e4,siberShowTime:2e3,guideLayerTime:5100,guideLayerIETime:6200,state:{open:"open",close:"close"}},d=t({init:function(t){this.config=e.extend(!0,{},{hideChatGiftClassName:"hide-chatgift-area",sideBarTimer:null,uid:o.get("sys.uid")?o.get("sys.uid"):""},t),this.getDoms(),this.render(),this.addEvent()},getDoms:function(){var t=e("body");this.doms={$body:t,$fullpageOperate:e(".fullpage-operate")}},render:function(){var e=this.doms;navigator.userAgent.indexOf("MSIE")>0&&e.$fullpageOperate.find(".toggle-chatgift-area").addClass("ie-bg"),"undefined"==typeof $ROOM.isActive&&e.$body.addClass("layout-newfullpage")},setVideoSidebarState:function(){var e=this,t=(e.doms,e.config),i=e.getState(t.uid);"full"===a.fire("mod.video.state.get")&&e[i===l.state.close?"close":"open"]()},toggle:function(){var e=this,t=e.doms,i=e.config,s=(t.$body,"full"===a.fire("mod.video.state.get"));s&&i.state===l.state.open?e.close():e.open(),a.trigger("mod.video.state.change",s),e.processSideBar()},open:function(){var t=this,a=t.doms,n=t.config,o=a.$body,d=e(".toggle-chatgift-area"),c=d.find(".toggle-chatgift-btn"),u=i.string.format("点击{0}右侧和底部菜单",c.data("closetitle")),g={};n.state=l.state.open,n.uid&&(g=t.getState(),g[n.uid]=n.state,s.set(l.localstorage,JSON.stringify(g),l.expireTime)),o.removeClass(n.hideChatGiftClassName),c.attr({title:u}),r.exe("js_page_fullscreen_state",0),t.point(2)},close:function(){var t=this,a=t.doms,n=t.config,o=a.$body,d=e(".toggle-chatgift-area"),c=d.find(".toggle-chatgift-btn"),u=i.string.format("点击{0}右侧和底部菜单",c.data("opentitle")),g={};n.state=l.state.close,n.uid&&(g=t.getState(),g[n.uid]=n.state,s.set(l.localstorage,JSON.stringify(g),l.expireTime)),o.addClass(n.hideChatGiftClassName),c.attr({title:u}),r.exe("js_page_fullscreen_state",1),t.point(1)},point:function(e){try{DYS.sub({action_code:"click_wfmsg_hide",ext:{stat:e}})}catch(t){}},getGuideLayerState:function(){var e=this,t=(e.config,e.doms,l.localstorageGuide),a=s.get(t)?s.get(t):!1,i=Boolean(a);return i},guideLayerShow:function(){var t,a,s,r=this;t=i.string.join('<div class="guide-layer">','<img src="<%= url %>"/>',"</div>"),a=n.compile(t),
s=a({url:i.string.format("{0}app/douyu/res/page/room-normal/fullpage-guide-layer.gif?v={1}",o.get("sys.web_url"),(new Date).getTime())}),r.$guideLayerview=e(s),r.doms.$fullpageOperate.find(".toggle-chatgift-area").append(r.$guideLayerview),r.$guideLayerview.show()},guideLayerHide:function(){var t=e(".guide-layer");0!=t.length&&(t.hide(),t.remove())},guideLayerDestory:function(){clearTimeout(this.config.sideBarTimer),this.config.sideBarTimer=null,this.guideLayerHide()},getState:function(t){var a=this,i=a.config,n=(a.doms,l.localstorage),o=s.get(n)?s.get(n):"{ }",r=JSON.parse(o);return"undefined"==typeof t?r:""===t?i.state:e.isEmptyObject(r)?i.state:r[t]},processSideBar:function(){var e=this,t=this.doms,i=t.$body,n=i.find(".toggle-chatgift-slider"),o=i.find(".toggle-chatgift-area"),r=o.find(".toggle-chatgift-btn"),d=!1,c=l.siberShowTime;"full"===a.fire("mod.video.state.get")?(e.sideBarShow(r,n),d=e.getGuideLayerState(),d||(e.guideLayerShow(),s.set(l.localstorageGuide,!0,l.expireTime),c=navigator.userAgent.indexOf("MSIE")>0||navigator.userAgent.indexOf("Trident")>0||navigator.userAgent.indexOf("Edge")>0?l.guideLayerIETime:l.guideLayerTime),e.config.sideBarTimer=window.setTimeout(function(){e.sideBarHide(r,n),e.guideLayerDestory()},c)):(e.sideBarHide(r,n),e.guideLayerDestory())},sideBarShow:function(e,t){e.addClass("show active"),t.show().addClass("active")},sideBarHide:function(e,t){e.removeClass("show active"),t.hide().removeClass("active")},addEvent:function(){var t=this,i=this.doms,s=i.$body,n=s.find(".toggle-chatgift-slider"),o=s.find(".toggle-chatgift-area"),r=o.find(".toggle-chatgift-btn");o.on("mouseenter",function(t){var a=e(this),i=a.data("timer");i&&clearTimeout(i),i=setTimeout(function(){r.addClass("show"),n.show()},0),a.data("timer",i)}).on("mouseleave",function(a){if(!t.config.sideBarTimer){var i=e(this),s=i.data("timer");s=window.setTimeout(function(){r.removeClass("show"),n.hide()},500),i.data("timer",s)}}),r.on("mouseenter",function(){r.addClass("active"),n.show().addClass("active")}).on("mouseleave",function(){t.config.sideBarTimer||(r.removeClass("active"),n.removeClass("active"))}).on("click",function(){r.addClass("active"),n.show().addClass("active"),t.toggle()}),a.on("mod.normal.pagefull.videoSidebarStateInit",function(e){t.setVideoSidebarState()}),a.on("mod.normal.pagefull.videoSidebar.toggle",function(e){t.processSideBar()})}}),c={init:function(e){return new d(e)}};return c}),define("douyu/page/room/normal/mod/freetime",["jquery","douyu/page/room/base/api","shark/util/flash/data/1.0"],function(e,t,a){var i,s={interval:2400,screenState:0,rushHour:[{start:18,end:24,interval:900},{start:0,end:6,interval:900}],listenInterval:3e4},n=0,o=!1,r=!1,l=+new Date,d=function(e){-1!==window.location.href.indexOf("freetime_debug")&&(window.FreeTime=i,window.console&&console.log&&console.log(e," FreeTime ",new Date))};return i={init:function(e){t.reg("room_data_idle",function(e){i.startListening()}),t.reg("room_data_idle_dp",function(e){var t=a.decode(e).too(),s=i.dpData(t.stage,t);i.dp(s),d("flash打点"),3===parseInt(t.stage)&&(d("点击继续观看"),i.startListening()),4===parseInt(t.stage)&&(d("倒计时结束,停止监听"),i.stopListening())}),t.reg("room_screenChange",function(e){var t=a.decode(e).too();s.screenState=parseInt(t.state,10)||0,0===s.screenState?i.startListening():i.stopListening()})},startListening:function(){r=!1,o=!0,l=+new Date,i.startMoveInterval(),e(document).on("mousemove.freetime",function(e){i.moveMouse(e)}),d("监听开始")},stopListening:function(){r=!1,o=!1,l=+new Date,i.stopMoveInterval(),e(document).off("mousemove.freetime"),d("监听关闭")},startMoveInterval:function(){clearTimeout(n),n=setTimeout(function(){var e=new Date,t=i.getIdleInterval(e.getHours());e.getTime()-l>1e3*t&&r===!1&&i.handleTimeUp(),i.startMoveInterval(),d("用户长时间无操作监听")},s.listenInterval)},stopMoveInterval:function(){clearTimeout(n)},moveMouse:function(e){l=+new Date,r===!0&&i.hideHandle()},handleTimeUp:function(){i.showHandle(),i.dpOverTime()},getIdleInterval:function(t){var a=t||(new Date).getHours(),i=s.interval;return e.each(s.rushHour,function(e,t){return a>=t.start&&a<t.end?(i=t.interval,!1):void 0}),i},addIdleInterval:function(e){s.rushHour.push(e)},__setDebug:function(e,t){var a=(new Date).getHours();s.rushHour.push({start:a,end:a+2,interval:+e||10}),s.listenInterval=1e3*(+t||12)},showHandle:function(){r=!0,t.exe("js_UserNoHandle"),d("计时结束,显示遮罩,关闭直播流!")},showFlowHandle:function(){r=!0,t.exe("js_UserNoFlowHandle"),d("遮罩不关流!")},hideHandle:function(){r=!1,t.exe("js_UserHaveHandle"),d("移除遮罩!")},dp:function(e){try{DYS.sub(e)}catch(t){}},dpOverTime:function(){var e=i.dpData(1);e.ot=i.getNowUnixTime(),i.dp(e)},dpData:function(e,t){var a={},i="";try{switch(parseInt(e,10)){case 1:i="show_idlelive_adjust_remind";break;case 2:i="show_idlelive_adjust_recover";break;case 3:i="click_idlelive_adjust_continue";break;case 4:i="show_idlelive_adjust_close"}a={action_code:i},t&&t.pt&&(a.pt=t.pt),t&&t.ot&&(a.ot=t.ot),t&&t.e&&(a.ext=t.e)}catch(s){}return a},getNowUnixTime:function(){return Math.round((new Date).getTime()/1e3)}}}),define("douyu/page/room/normal/mod/cover-title-remind",["jquery","shark/util/flash/data/1.0","douyu/context","douyu/page/room/base/api"],function(e,t,a,i){var s={showMark:0,init:function(){var s=this,n=a.get("room.owner_uid"),o=a.get("sys.uid");s.box=e("#js-room-video"),n==o&&i.reg("room_data_handler",function(e){var i=t.decode(e).too();"tcremind"==i.type&&i.rid==a.get("room.room_id")&&s.showRemind(i.tc,i.msg)})},showRemind:function(t,a){var i=this;i.remindBox?(i.remindBox.empty(),clearTimeout(i.timeTicket)):(i.remindBox=e('<div class="background-control-box"></div>'),i.box.append(i.remindBox));var s=+t,n=s?i.titleTpl(a):i.coverTpl(a);i.remindBox.append(n),i.remindBox.show(),s?i.setTimeClose(5):i.setTimeClose(15),i.bindEvent()},bindEvent:function(){var e=this;e.remindBox.on("click","[data-close]",function(){e.hideRemind()})},setTimeClose:function(e){var t=this;t.timeTicket=setTimeout(function(){t.hideRemind()},1e3*e)},hideRemind:function(){clearTimeout(this.timeTicket),this.remindBox.hide()},coverTpl:function(e){return['<a href="javascript:void(0);" data-close class="background-control-close"></a>',"<h2>上传封面</h2>","<p>",e||"为了更好提升您的热度已为您更换封面，<br>下次请记得上传优质封面～","</p>"].join("")},titleTpl:function(e){return['<a href="javascript:void(0);" data-close class="background-control-close"></a>',"<h2>修改标题</h2>","<p>",e||"为了规范您的标题已为您修改标题，<br>下次请记得编辑优质合格标题帮您提升热度哦～","</p>"].join("")}};return{init:function(){s.init()}}}),define("douyu/page/room/normal/mod/charge",["jquery","shark/class","shark/observer","douyu/context","douyu/com/user","douyu/page/room/base/api","shark/util/cookie/1.0","shark/util/storage/1.0","shark/util/flash/data/1.0","shark/util/template/1.0"],function(e,t,a,i,s,n,o,r,l,d){function c(e,t){var a="",i=e.getFullYear(),s=e.getMonth()+1,n=e.getDate(),o=e.getHours(),r=e.getMinutes(),l=e.getSeconds();return s=s>9?s:"0"+s,n=n>9?n:"0"+n,o=o>9?o:"0"+o,r=r>9?r:"0"+r,l=l>9?l:"0"+l,!e||isNaN(e)?a:(t=t.replace("YYYY",i),t=t.replace("MM",s),t=t.replace("DD",n),t=t.replace("hh",o),t=t.replace("mm",r),t=t.replace("ss",l),a=t)}var u=window.$ROOM,g=window.$SYS,m=g.groupid,p=m>=5,f=u.owner_uid==g.uid,h="liveNotify",v=0,b=Number.prototype.toFixed,y=i.get("room.eticket"),k={},w={};w.processArrData=function(t){var a,i,s=[];if(!t)return s;a=t.split("/");for(var n=0,o=a.length;o>n;n++)i=l.decode(a[n]).too(),e.isPlainObject(i)&&!e.isEmptyObject(i)&&s.push(i);return s};var _={init:function(e){var t=this;this.reset(),T.init(),n.reg("room_data_buytickets",function(e){t.buyTickets(e)}),n.reg("room_data_chargelive",function(e){return e?void t.chargeLive(e):!1}),n.reg("room_data_endchargelive",function(e){t.endChargeLive(e)}),n.reg("room_data_endtrysee",function(e){t.changeTxt(e.flash_is_yuanhua),x.endtrysee(e)}),n.reg("room_data_cden",function(e){var t=l.decode(e).too();!!t.enter;t.coll=w.processArrData(t.coll),T.freeChatColor(t)}),n.reg("room_data_nstip",function(e){T.findTicktUserEnter(e)}),n.reg("room_data_nstip2",function(e){T.findTicktUserEnter(e)})},reset:function(){u=window.$ROOM,g=window.$SYS,m=g.groupid,p=m>=5,f=u.owner_uid==g.uid,h="liveNotify",v=0,b=Number.prototype.toFixed,y=i.get("room.eticket")},changeTxt:function(e){k=e?{0:{txt:"",btntxt:"直播"},1:{txt:"原画",btntxt:"原画"},2:{txt:"原画",btntxt:"原画"}}:{0:{txt:"",btntxt:"直播"},1:{txt:"超清",btntxt:"超清"},2:{txt:"超清",btntxt:"超清"}}},chargeLive:function(t){y=t.data.payment_mode,this.changeTxt(t.flash_is_yuanhua);if(110017==t.error)return e.dialog.tips_black(t.msg),!1;if(0!=t.error&&110006!=t.error)return!1;if(!s.check())return"0"==y?!1:"1"!=y&&"2"!=y||"0"!=t.error?!1:(x.showTimeUserTipForCryptonym(t),!1);g=window.$SYS,m=g.groupid,p=m>=5,f=u.owner_uid==g.uid;var a=t.data;n.exe("js_exitFullScreen");var o=parseInt(1e3*a.start_time),l=parseInt(1e3*a.end_time),d=parseInt(a.expire_time),c=parseInt(a.trail_seconds),k=c/60,w=a.is_pay,_=0,T=parseInt(a.price)/100;if(T!=parseInt(T)&&(T=b.call(T,1)),f){var C=new Date(o);if(C.setHours(24),C.setMinutes(0),C.setSeconds(0),_=C.getTime()-(new Date).getTime(),0>_&&(r.set(h,i.get("sys.uid"),_/1e3),r.set("eticket",y,_/1e3)),i.get("sys.uid")==r.get(h)&&r.get("eticket")==y)return!1;r.set(h,i.get("sys.uid"),_/1e3),r.set("eticket",y,_/1e3),x.showTimeAnchorTip(k)}else if(!p){new Date(o),new Date(l);v=1===i.get("room.show_status"),d>0&&v&&!w&&x.showTimeUserTip(t,k)}},endChargeLive:function(t){y=t,f?(n.exe("js_exitFullScreen"),x.endShowTimeAnchorTip()):p||"1"!=y&&"2"!=y||(e(".room-charge-loginTitle-panel").size()>0&&e(".room-charge-loginTitle-panel").hide(),e(".room-charge-userTip-panel").size()>0&&e(".room-charge-userTip-panel").hide(),e(".room-charge-buyTip-panel").size()&&e(".room-charge-buyTip-panel").hide()),r.remove(h)},buyTickets:function(t){if(!t)return!1;y=t.data.payment_mode,this.changeTxt(t.flash_is_yuanhua),n.exe("js_exitFullScreen");var a=null,i=0,o=0;if(a=t.data,!s.check())return s.show("login"),!1;if(!a.need_pay)return!1;if(o=parseFloat(e('[data-login-user="gold"]').eq(0).text()),isNaN(o))return e.dialog.tips_black("正在获取余额，请稍后再试！"),!1;i=parseInt(a.price)/100,i!=parseInt(i)&&(i=b.call(i,1));var r=c(new Date(parseInt(1e3*a.show_start)),"YYYY/MM/DD/ hh:mm"),l=c(new Date(parseInt(1e3*a.show_end)),"YYYY/MM/DD/ hh:mm");f||p||(o>=i?x.buyTicket(a,i,o,r,l):x.ticketRecharge(a,i,o,r,l))}},x={userLogin:function(){if("1"==y||"2"==y){var t=k[y].txt,a=e([' <div class="room-charge-loginTitle-panel">','<a data-role="confirm" class="room-charge-login-close" href="javascript:;"></a>','<div class="room-charge-login-info">','<div>本场<span class="color-org">'+t+"</span>画质需购买门票哦</div>",'<div><span class="color-org">请登录购买</span></div></div>','<div class="room-charge-loginTitle-btnGroup"><a class="login-btn" href="javascript:;"></a>','<a class="register-btn" href="javascript:;"></a></div></div>'].join(""));e(".room-charge-loginTitle-panel").remove(),e("body").append(a),a.on("click",'[data-role="confirm"]',function(){a.hide()}),a.on("click",".login-btn",function(){a.hide(),s.show("login")}),a.on("click",".register-btn",function(){a.hide(),s.show("register")})}},showTimeAnchorTip:function(t){var a="0"==y?"":"清晰度",i=e(["<div class='room-charge-anchorTip-panel'>",'<a data-role="confirm" class="room-charge-anchorTip-close" href="javascript:;"></a>','<div class="room-charge-anchorTip-info">',"<div>"+a+'<span class="color-pink">付费</span>时间<span class="color-pink">已开始</span></div>','<div><span class="small-font">用户可试看'+t+"分钟，试看结束后将需要付费</span></div></div>",'<div class="room-charge-anchorTip-btnGroup"><a class="ok-btn" href="javascript:;"></a></div>',"</div>"].join(""));e(".room-charge-anchorTip-panel").remove();try{DYS.submit({point_id:"5.16.1.0"})}catch(s){}e("body").append(i),i.on("click",".room-charge-anchorTip-close,.ok-btn",function(){i.hide()})},endShowTimeAnchorTip:function(){var t="0"==y?"":"清晰度",a=e(["<div class='room-charge-anchorTip-panel'>",'<a data-role="confirm" class="room-charge-anchorTip-close" href="javascript:;"></a>','<div class="room-charge-anchorTip-info">',"<div>"+t+'<span class="color-pink">付费</span>时间<span class="color-pink">已结束</span>','，请<span class="color-pink">关闭直播</span>！</div>',"<div>否则付费时长将一直持续。</div></div>",'<div class="room-charge-anchorTip-btnGroup"><a class="ok-btn" href="javascript:;"></a></div>',"</div>"].join(""));e(".room-charge-anchorTip-panel").remove();try{DYS.submit({point_id:"5.16.6.0"})}catch(i){}e("body").append(a),a.on("click",".room-charge-anchorTip-close,.ok-btn",function(){a.hide()})},privilegeHtml:function(e){for(var t="",a=e?e.split("|"):[],i=0;i<a.length;i++)t+=0==i?'<div class="ticket-privilege-title">'+a[i]+"</div>":'<div class="ticket-privilege-des privilege-'+i+'"><i class="ticket-point"></i><span>'+a[i]+"</span></div>";return t},showTimeUserTip:function(t,a){var i="0"==y?"":k[y].txt,s=["<div class='room-charge-userTip-panel '>",'<a data-role="confirm" class="room-charge-userTip-close" href="javascript:;"></a>','<div class="room-charge-userTip-info">',"试看"+a+'分钟<span class="note-big">'+i+"</span>","</div>",'<div class="ticket-privilege"></div>','<div class="room-charge-userTip-btnGroup"><a class="buy-btn" href="javascript:;">朕要看'+k[y].btntxt+"</a></div>","</div>"].join("");try{DYS.submit({point_id:"5.16.4.0"})}catch(n){}var o=e(s);o.find(".ticket-privilege").append(this.privilegeHtml(t.data.ticket_note)),"0"==y&&o.find(".room-charge-userTip-info").html("本场直播需要购买门票"),e(".room-charge-userTip-panel").remove(),e("#js-room-video").append(o),o.on("click",".room-charge-userTip-close",function(){o.hide()}).on("click",".buy-btn",function(){try{DYS.submit({point_id:"5.16.12.0"})}catch(e){}o.hide(),_.buyTickets(t)})},showTimeUserTipForCryptonym:function(t){var a=k[y].txt,i=["<div class='room-charge-userTip-panel'>",'<a data-role="confirm" class="room-charge-userTip-close" href="javascript:;"></a>','<div class="room-charge-userTip-info">','购买门票尊享<span class="note-big">'+a+"</span>","</div>",'<div class="ticket-privilege"></div>','<div class="room-charge-userTip-btnGroup"><a class="buy-btn" href="javascript:;">朕要看'+k[y].btntxt+"</a></div>","</div>"].join(""),s=e(i);s.find(".ticket-privilege").append(this.privilegeHtml(t.data.ticket_note)),e(".room-charge-userTip-panel").remove();try{DYS.submit({point_id:"5.16.4.0"})}catch(n){}e("#js-room-video").append(s),s.on("click",".room-charge-userTip-close",function(){s.hide()}).on("click",".buy-btn",function(){try{DYS.submit({point_id:"5.16.12.0"})}catch(e){}s.hide(),_.buyTickets(t)})},endtrysee:function(t){if(!t)return!1;if(f||p)return!1;if(y=t.data.payment_mode,n.exe("js_exitFullScreen"),"1"==y||"2"==y){var a=["<div class='room-charge-userTip-panel room-charge-userTip-ets-panel'>",'<a data-role="confirm" class="room-charge-userTip-close" href="javascript:;"></a>','<div class="room-charge-userTip-info">','&nbsp;&nbsp;&nbsp;&nbsp;试看<span class="note-big">已结束</span>',"</div>",'<div class="ticket-privilege"></div>','<div class="room-charge-userTip-btnGroup"><a class="buy-btn" href="javascript:;">朕要看'+k[y].btntxt+"</a></div>","</div>"].join(""),i=e(a);i.find(".ticket-privilege").append(this.privilegeHtml(t.data.ticket_note)),e(".room-charge-userTip-panel").remove();try{DYS.submit({point_id:"5.16.7.0"})}catch(s){}e("#js-room-video").append(i),i.on("click",".room-charge-userTip-close",function(){i.hide()}).on("click",".buy-btn",function(){try{DYS.submit({point_id:"5.16.13.0"})}catch(e){}i.hide(),_.buyTickets(t)})}else"0"==y&&e(".room-charge-userTip-panel").remove()},buyTicket:function(t,s,o,r,l){var d=this,c=t.ticket_name?t.ticket_name:"门票名称",g=t.ticket_privilege?'<img src="'+$SYS.resource_url+t.ticket_privilege+'"/>':"",m=[' <div class="room-charge-buyTip-panel">','<div class="room-charge-buyTip-headbg">','<a href="javascript:;" class="room-charge-buyTip-close"></a>','<div class="room-charge-buyTip-des">','<div class="etickt-name">'+c+"</div>",'<div class="etickt-price"><span class="color-org">'+s+"</span>鱼翅</div>",'<div class="etickt-time">'+r+"-"+l+"</div>","<div></div>","</div>","</div>",'<div class="room-charge-buyTip-weal">'+g+"</div>",'<div class="room-charge-buyTip-footer">','<div class="room-charge-buyTip-check">鱼翅余额为'+o+"，将扣除您"+s+"鱼翅，确认购买吗？</div>",'<a class="buy-btn js-buy-btn" herf="javasript:;">购买</a>',"</div>","</div>"].join(""),p=e(m);p.find("room-charge-buyTip-weal"),e(".room-charge-buyTip-panel").remove(),e("body").append(p),p.on("click",".room-charge-buyTip-close",function(){p.hide()});try{DYS.submit({point_id:"5.16.14.0"})}catch(f){}p.on("click",".js-buy-btn",function(){try{DYS.submit({point_id:"5.16.8.0"})}catch(o){}e.ajax({url:"/room/eticket/deal_eticket",dataType:"json",type:"post",data:{ticket_id:t.ticket_id,room_id:u.room_id,dy:i.get("room.device_id")}}).then(function(t){var i=t.msg;switch(parseInt(t.code,10)){case 0:try{DYS.submit({point_id:"5.16.18.0"})}catch(o){}e.dialog.tips_black("购买成功"),p.hide(),e(".room-charge-userTip-panel").size()>0&&e(".room-charge-userTip-panel").hide(),a.trigger("mod.userinfo.change",{current:{gold:i.balance/100}}),n.exe("js_buytickets_success");break;case 12:var r=parseInt(i.balance,10),l=parseInt(i.noble_balance,10),c=(r-l)/100,u=parseInt(i.noble_ingf,10);l&&!u&&d.ticketRecharge2(s,0>c?0:c),u&&e('[data-login-content="yes"] .y3').hide();break;default:e.dialog.tips_black(i)}})})},ticketRecharge:function(t,a,i,s,n){var o=t.ticket_name?t.ticket_name:"门票名称",r=t.ticket_privilege?'<img src="'+$SYS.resource_url+t.ticket_privilege+'"/>':"",l=[' <div class="room-charge-buyTip-panel">','<div class="room-charge-buyTip-headbg">','<a href="javascript:;" class="room-charge-buyTip-close"></a>','<div class="room-charge-buyTip-des">','<div class="etickt-name">'+o+"</div>",'<div class="etickt-price"><span class="color-org">'+a+"</span>鱼翅</div>",'<div class="etickt-time">'+s.replace(" ","")+"-"+n.replace(" ","")+"</div>","<div></div>","</div>","</div>",'<div class="room-charge-buyTip-weal">'+r+"</div>",'<div class="room-charge-buyTip-footer">','<div class="room-charge-buyTip-check">鱼翅余额为'+i+"，您的鱼翅不足，请先充值</div>",'<a class="buy-btn js-recharge-btn" herf="javasript:;">充值</a>',"</div>","</div>"].join(""),d=e(l);e(".room-charge-buyTip-panel").remove(),e("body").append(d);try{DYS.submit({point_id:"5.16.15.0"})}catch(c){}d.on("click",".room-charge-buyTip-close",function(){d.hide()}),d.on("click",".js-recharge-btn",function(){d.hide();try{DYS.storage.save("_dypay_fp",5)}catch(e){}try{DYS.submit({point_id:"5.16.9.0"})}catch(e){}window.open("/web_game/welcome/18")})},ticketRecharge2:function(t,a){var i=['<div class="room-charge-buyTip-panel spend--artdialog--fail">','<div class="room-charge-buyTip-headbg">','<a href="javascript:;" data-buyTip="cancel" class="room-charge-buyTip-close"></a>','<h2 class="spend--fail--title">购买失败</h2>',"</div>",'<div class="room-charge-buyTip-weal">',"<h4>门票价格: <%= price %>元</h4>",'<p><a href="javascript:;">贵族鱼翅不能用于购买门票！</a>除去贵族鱼翅后，您的账户剩余<%= balance %>鱼翅，不足以支付门票！</p>',"</div>",'<div class="room-charge-buyTip-footer">','<p class="spend--fail--btnbox">','<a href="javascript:;" data-buyTip="recharge" class="myvipbtn orangebtn">获取鱼翅</a>','<a href="javascript:;" data-buyTip="cancel" class="myvipbtn graybtn">取消</a> ',"</p>","</div>","</div>"].join(""),s=d.compile(i),n=s({price:t,balance:a}),o=e(n);e(".room-charge-buyTip-panel").remove(),e("body").append(o),o.on("click",'[data-buyTip="recharge"]',function(){window.open("/web_game/welcome/18"),o.remove()}),o.on("click",'[data-buyTip="cancel"]',function(){o.remove()})}},T={$view:e("#js-chat-cont"),init:function(){this.$view.append("<div class='liveTicket'></div>")},freeChatColor:function(e){for(var t=!0,i=0;i<e.coll.length;i++)0==e.coll[i].free&&(t=!1);e.coll.length||(t=!1),a.trigger("mod.chat.msg.color.free",{corlorArr:e.coll,freeAll:t,eid:e.eid})},findTicktUserEnter:function(e){var t=l.decode(e).too();if(t.el=w.processArrData(t.el),$ROOM.effectInfo){for(var a=0;a<t.el.length;a++)if("1500000092"===t.el[a].eid||"1500000094"===t.el[a].eid)return;for(var i=0;i<t.el.length;i++)2==t.el[i].etp&&1==t.el[i].ef&&this.showUEnterTip(t,t.el[i].eid)}},showUEnterTip:function(e,t){if("uenter"===e.type){var a=$SYS.res_url+"douyu/images/defaultAvatar.png?v=20160525";void 0!==e.ic&&""!==e.ic&&(a=$SYS.avatar_url+"upload/"+e.ic+"_middle.jpg");var i={uid:void 0!==e.uid?parseInt(e.uid,10):0,uname:void 0!==e.nn?e.nn:"",icon:$ROOM.effectInfo[t]?$ROOM.effectInfo[t].icon:"",ic:a,txt:$ROOM.effectInfo[t]?$ROOM.effectInfo[t].txt:""};this.makeTip(i)}},makeTip:function(t){var a,i;t=e.extend(!0,{Character:t.txt.replace("{uname}",'<span class="username" title="'+t.uname+'">'+t.uname+"</span>").replace("|","<br/>")},t),a=['<div class="ticket-uEnterTip-item">','<img class="ticket-uEnter-tx" src="'+t.ic+'" />','<div class="ticket-uEnter-tx-shade"></div>','<div class="ticket-uEnterTip-info">','<span class="place"></span><p class="describe" ></p>',"</div>",'<img class="ticket-uEnter-ticket-icon" src="'+$SYS.resource_url+t.icon+'" />',"</div>"].join(""),i=e(a),i.find(".describe").append(t.Character),this.$view.find(".liveTicket").append(i),i.animate({bottom:0},1e3),setTimeout(function(){i.fadeOut(1e3,function(){i.remove()})},3e3)}};return _}),define("douyu/page/room/normal/mod/anchor-white-list",["jquery","shark/class","shark/observer","shark/util/lang/1.0","shark/util/cookie/1.0","shark/util/template/1.0","douyu/context"],function(e,t,a,i,s,n,o){var r=t({init:function(t){this.$body=e("body"),this.$anchorInfo=e("#anchor-info"),this.$headline=this.$anchorInfo.find(".relate-text .headline"),this.config=e.extend(!0,{},{diyNum:parseInt(this.$body.data("diy"),10)||0,isRender:!1,whListDialogData:{}},t),this.interFace()},interFace:function(){var t=this;a.on("mod.anchorwhitelist.getAnchorWhList",function(e){t.config.isRender||(t.requestWhiteListInfo({room_id:o.get("room.room_id")},t.renderWhListIdentify),t.config.isRender=!0)}),a.on("mod.anchorwhitelist.dialogshow",function(i){if(e.isPlainObject(i)&&e.isPlainObject(i.anchorwhitelistData)||(i={anchorwhitelistData:{isShowDialog:!1,flag:""}}),t.config.isLocked=t.config.isLocked&&i.anchorwhitelistData.config.isLocked,!t.config.isLocked){var s=e.extend(!0,{},{is_loose:"no_loose"},{uid:i.anchorwhitelistData.userid,room_id:i.anchorwhitelistData.roomid});t.config.whListDialogData=i,t.config.isLocked=!0,t.requestWhiteListInfo(s,t.renderWhListDialog),a.on("mod.anchorwhitelist.lock.change",function(e){i.anchorwhitelistData.config.isLocked=e})}}),a.on("mod.anchorwhitelist.sendEmail",function(a){var i=a.uid?a.uid:"",n=a.operate_type?a.operate_type:"";a&&""!==i&&""!==n&&t.getCSRFCookie(s,function(t){a[t.name]=t.val,e.ajax({url:"/room/anchor_whitelist/notifyanchor",type:"POST",dataType:"json",data:a,error:function(){},success:function(e){}})})})},requestWhiteListInfo:function(t,a){var i=this;a=e.isFunction(a)?a:function(){},i.config.isLocked=!0,5===parseInt(o.get("sys.groupid"),10)?this.getCSRFCookie(s,function(s){var n=e.extend(!0,{},t);n[s.name]=s.val,e.ajax({url:"/room/anchor_whitelist/getwhitelistinfo",type:"POST",data:n,error:function(e){a.call(i,e)},success:function(e){e&&(e="string"==typeof e?JSON.parse(e):e,a.call(i,e))}})}):a.call(i)},renderWhListIdentify:function(e){if(e&&e.isWhitelist&&e.show_whitelist_mark){var t,a,s,o=e.showMsg?e.showMsg:"";1===this.config.diyNum&&this.$body.addClass("diy-room"),t=i.string.join('<div class="anchor-white-list fl"  >','<a data-anchor-whlist="btn" class="whl-btn"></a>','<div data-anchor-whlist="tips" class="whl-tip">','<i class="arrow-icon"></i>','<div class="whl-text" >',o,"</div>","</div>","</div>"),a=n.compile(t),s=a({showMsg:o}),this.$headline.append(s),this.bindEvent()}},renderWhListDialog:function(t){var i=this,s=i.config.whListDialogData,n=s.anchorwhitelistData;t&&t.isWhitelist&&n.isShowDialog?e.dialog({title:"白名单主播提醒",content:i.achorWhListDialogTpl(t),okVal:"确定",ok:function(){i.config.isLocked=!0,a.trigger(n.flag,s)},cancelVal:"取消",lock:!0,cancel:function(){i.config.isLocked=!1,a.trigger("mod.anchorwhitelist.lock.change",!1)}}):a.trigger(n.flag,s)},achorWhListDialogTpl:function(e){var t,a,s,o=e.showMsg?e.showMsg:"";return t=i.string.join('<form id="anchorWhiteListForm" name="" method="post"  target="submit-frame" enctype="multipart/form-data">','<div class="anchor-whlist-operation-content">','<div class="wrap clearfix">','<div class="roomid">主播房间号</div>','<div class="anchor-white-list">','<a data-anchor-whlist="btn" class="whl-btn"></a>',"</div>","</div>",'<div class="wrap clearfix">','<div class="con2" style="">',o,"</div>","</div>",'<div class="wrap clearfix">','<div class="con3">请确认是否继续处理！</div>',"</div>","</div>","</form>"),a=n.compile(t),s=a({showMsg:o}),this.$body.append('<iframe width="0" height="0" id="r_mana_iframe" name="submit-frame" style="position: absolute;top:-9999px;left:-9999px;"></iframe>'),s},bindEvent:function(){var t=this,a=!1,i=null;this.$anchorInfo.on("mouseenter mouseleave",".anchor-white-list",function(s){switch(String(s.type)){case"mouseenter":a=!0,e(s.currentTarget).addClass("on");break;case"mouseleave":a=!1,e(s.currentTarget).removeClass("on")}i&&clearTimeout(i),i=setTimeout(function(){t.$body[a?"addClass":"removeClass"]("body-show-white-list"),clearTimeout(i)},100)})},getCSRFCookie:function(t,a){var i=this,s=t.get(o.get("sys.tvk")),n=o.get("sys.tn");return a=e.isFunction(a)?a:function(){},s?void a({name:n,val:s}):void e.ajax({url:"/curl/csrfApi/getCsrfCookie",type:"GET",dataType:"json",success:function(e){0===e.error&&i.getCSRFCookie(t,a)}})},curStrByLen:function(e,t){for(var a,i=0,s=e.length,n="",o=0;s>o;o++)if(a=e.charAt(o),i++,escape(a).length>4&&i++,n=n.concat(a),i>=t)return n.concat("...");return t>i?e:void 0}});return{init:function(e){new r(e)}}}),define("douyu/com/ajax",["jquery"],function(e){var t={},a=function(a){var i=e.extend({},a),s=null,n=null,o=null,r=e.Deferred(),l=null,d=i.url;return d?(i.type=i.type||"get","GET"===i.type.toUpperCase()&&i.data&&(d=-1===d.indexOf("?")?d+"?"+e.param(i.data):d+"&"+e.param(i.data)),s=t[d]||{},n=s.promise,o=s.expires,l=(new Date).getTime(),n&&(!o||o>l)?n:(i.expires&&(o=l+1e3*i.expires),i=e.extend(a,{success:function(e){r.resolve(e)},error:function(e){r.reject(e)}}),n=e.ajax(i),s.promise=n,s.expires=o,t[d]=s,r.promise(n))):!1};return a}),define("douyu/page/room/normal/mod/weibo",["jquery","shark/observer","douyu/page/room/base/api","douyu/com/user","shark/util/storage/1.0","shark/util/flash/data/1.0","douyu/context","shark/util/template/2.0","douyu/com/ajax","douyu/com/get-gift-configs"],function(e,t,a,i,s,n,o,r,l,d){var c={},u={};c.templateSettings={evaluate:/%([\s\S]+?)%/g,interpolate:/%=([\s\S]+?)%/g,escape:/%-([\s\S]+?)%/g},c.template=function(t,a,i){var s=/\\|'|\r|\n|\u2028|\u2029/g,n=function(e){return"\\"+escapes[e]};!a&&i&&(a=i),a=e.extend({},a,c.templateSettings);var o=RegExp([(a.escape||noMatch).source,(a.interpolate||noMatch).source,(a.evaluate||noMatch).source].join("|")+"|$","g"),r=0,l="__p+='";t.replace(o,function(e,a,i,o,d){return l+=t.slice(r,d).replace(s,n),r=d+e.length,a?l+="'+\n((__t=("+a+"))==null?'':_.escape(__t))+\n'":i?l+="'+\n((__t=("+i+"))==null?'':__t)+\n'":o&&(l+="';\n"+o+"\n__p+='"),e}),l+="';\n",a.variable||(l="with(obj||{}){\n"+l+"}\n"),l="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+l+"return __p;\n";try{var d=new Function(a.variable||"obj","_",l)}catch(u){throw u}var g=function(e){return d.call(this,e)},m=a.variable||"obj";return g.source="function("+m+"){\n"+l+"}",g};var g=(e(document),0),m=0,p=(new Date).getTime(),f=(String.prototype.toString,!1),h=null,v={1:{name:"观看时长",storagename:"plogin",val:0,tmpl:"<div class='room-wbshare wbshare-login'></div>",btnid:"wb-sh-login-btn"},2:{name:"鱼丸暴击",storagename:"pcritical",val:0,style:0,tmpl:"<div class='room-wbshare wbshare-critical'></div>",btnid:"wb-sh-crit-btn"},3:{name:"高级酬勤",lev:3,storagename:"padvcq",val:0,tmpl:"<div class='room-wbshare wbshare-advcq'></div>",btnid:"wb-sh-advcq-btn"},4:{name:"中级酬勤",lev:2,storagename:"pmidcq",val:0,tmpl:"<div class='room-wbshare wbshare-midcq'></div>",btnid:"wb-sh-midcq-btn"},5:{name:"初级酬勤",lev:1,storagename:"pjuncq",val:0,tmpl:"<div class='room-wbshare wbshare-juncq'></div>",btnid:"wb-sh-juncq-btn"},6:{name:"火箭",storagename:"procket",val:0,style:6,effect:"1",tmpl:"<div class='room-wbshare wbshare-rocket'></div>",btnid:"wb-sh-rock-btn"},7:{name:"飞机",storagename:"pplane",val:0,style:5,effect:"2",tmpl:"<div class='room-wbshare wbshare-plane'></div>",btnid:"wb-sh-plan-btn"},8:{name:"666",storagename:"pliu",val:0,style:4,effect:"0",tmpl:"<div class='room-wbshare wbshare-liu'></div>",btnid:"wb-sh-liu-btn"},9:{name:"赞",storagename:"pzan",val:0,style:3,effect:"0",tmpl:"<div class='room-wbshare wbshare-zan'></div>",btnid:"wb-sh-zan-btn"},10:{name:"520",storagename:"pwel",val:0,style:2,effect:"0",tmpl:"<div class='room-wbshare wbshare-wel'></div>",btnid:"wb-sh-wel-btn"},11:{name:"100鱼丸",storagename:"phyw",val:0,style:1,effect:"0",tmpl:"<div class='room-wbshare wbshare-hyw'></div>",btnid:"wb-sh-hyw-btn"},12:{name:"游艇",storagename:"ship",val:0,style:6,effect:"5",tmpl:"<div class='room-wbshare wbshare-ship'></div>",btnid:"wb-sh-ship-btn"},13:{name:"跑车",storagename:"car",val:0,style:6,effect:"4",tmpl:"<div class='room-wbshare wbshare-car'></div>",btnid:"wb-sh-car-btn"},14:{name:"香吻",storagename:"kiss",val:0,style:5,effect:"3",tmpl:"<div class='room-wbshare wbshare-kiss'></div>",btnid:"wb-sh-kiss-btn"}},b=null,y="share",k=null,w={init:function(){var a=this;k=e("#js-stats-and-actions"),t.on("mod.center.userrole.ready",function(e){if(!f){f=1;var t=i.check();t&&a.getServerInfo()}})},getServerInfo:function(){var e=this;l({url:"/wb_share/config",type:"get",cache:!0,dataType:"json"}).then(function(t){if(t&&0==t.error){var a=t.data;e.setData(a);var i=parseInt(a.switch_on);if(!a.events)return!1;i&&(p=1e3*a.system_time,g=parseInt(a.probability),m=a.experience,e.ready())}})},getStorage:function(e){return s.get(y+e)},setStorage:function(e,t,a){s.set(y+e,t,a)},triggered:function(e){var t=this,a=v[e];return o.get("sys.uid")==t.getStorage(a.storagename)},loginAction:function(e){var t=this,a=null,i=0,s=(v[e],t.getEvent(e));t.getRestTime(p);a=setInterval(function(){i=i?i:0,i++;var n=parseInt(s.count);if(isNaN(n)||!n)return!1;if(i/60%s.count==0){var o=100*Math.random();g>o&&(clearInterval(a),a=null,t.render(e))}},1e3)},giftAction:function(e,t){var a=this,i=(v[e],a.getEvent(e)),s=parseInt(i.count),n=parseInt(t.hits),o=100*Math.random(),r=i.probability||g;if(n=n?n:1,t.ur&&""!=t.ur);else if(s>n)return!1;r>o&&a.render(e,t)},render:function(a,i){var s=this;d.getGift().done(function(n){u=n||{};var o=s.getModule(a,i),l=r.compile(s.getContainer(a),{openTag:"{{",closeTag:"}}"}),d=l(o),c=e(o.wrap);c.html(d),k.append(c),s.bindEvent(a,c,o),t.trigger("dys",{key:"dys.room.wbshare.show"})})},bindEvent:function(a,i,s){var n=this,r=v[a],l=!1,d=0;i.on("click.wbshare",".wbshare-close",function(){n.closeTip(i),t.trigger("dys",{key:"dys.room.wbshare.close"})}).on("change.wbshare","[type='checkbox']",function(){var a=e(this);a.is(":checked")?r.val=a.val():r.val=0,d=n.getRestTime((new Date).getTime(),r.val),n.setStorage(r.storagename,o.get("sys.uid"),d/1e3),t.trigger("dys",{key:"dys.room.wbshare.nomore"})}).on("mousedown","button",function(){return l?!1:(l=!0,window.open(n.getShareLink(s)),e(this).closest(".room-wbshare").hide(),void t.trigger("dys",{key:"dys.room.wbshare.btn.click"}))}),d=n.getRestTime((new Date).getTime(),6),n.setStorage(r.storagename,o.get("sys.uid"),d/1e3),e.extend(s,{callback:function(){i.fadeOut(1e3),n.getReward()}})},getModule:function(t,a){var i=this,s=v[t],n=i.getEvent(t),r=null,l=[],d=0,c=s.style,g=s.effect,p=u,f="",b=1,y="",b=0,k="";if(c)for(var w in p){var _=p[w]||{};if(g){if(_.style==c&&_.ef==g){f=_.name;break}}else if(_.style==c){f=_.name;break}}else f=s.name;if(a)if(a.ur&&""!=a.ur)b=a.sil,y=n.git_content;else{var x=a.hits?a.hits:1;y=1==x?n.tip_content:n.git_content,b=x}else y=n.git_content,b=n.count;return r={giftName:f,giftCount:b,roomName:o.get("room.room_name"),anchorName:o.get("room.owner_name"),roomId:o.get("room.room_id"),url:window.location.href},h=e.extend(null,r),
l=n.article,d=l.length?parseInt(Math.random()*l.length):0,k=i.helperTmpl(l[d],r),e.extend(r,{cq:s.lev,btnid:s.btnid,tips:i.helperTmpl(y,r),wrap:s.tmpl,template:k,exp:n.experience||m}),r},getContainer:function(){var e=["<a class='wbshare-close' href='javascript:;'></a>","<div class='wbshare-title'><i></i></div>","<div class='wbshare-body'>","<h2 class='wbshare-content'>","{{if cq}}","<i></i>","{{/if}}","{{tips}}","</h2>","<p><!--分享即可获得<em>{{exp}}</em>经验值（每天一次）-->&nbsp;</p>","<div class='wbshare-btn-grp'>","<button id='{{btnid}}' type='button' class='wbshare-btn'><i></i><span>微博分享</span></button>","<label><input value='6' type='checkbox'><span>不再提醒</span></label>","</div>","</div>"];return e.join("")},clone:function(e,t){e=e?e:{},t||(t=e);for(var a in t)e[a]=t[a];return e},helperTmpl:function(e,t){var a,i="";if(c){var s=this.clone(c.templateSettings);c.templateSettings={evaluate:/%([\s\S]+?)%/g,interpolate:/%([\s\S]+?)%/g,escape:/%-([\s\S]+?)%/g},a=c.template(e),i=a(t),c.templateSettings=s}return i},closeTip:function(e){e.remove()},getRestTime:function(e,t){t=parseInt(t),t=t?t:0;var a=new Date(e);a.setDate(a.getDate()+t),a.setHours(24),a.setMinutes(0),a.setSeconds(0);var i=a.getTime()-(new Date).getTime();return i},ready:function(){var e=this;e.dispatch("1"),a.reg("room_data_giftbat1",function(t){var a=n.decode(t).too();"dgb"===a.type&&a.uid==o.get("sys.uid")&&d.getGift().done(function(t){u=t||{};for(var i in v){var s=v[i],n=u[a.gfid]||{};if(s.effect){if(s.effect==n.ef&&s.style==a.gs){e.dispatch(i,a);break}}else if(s.style==a.gs){e.dispatch(i,a);break}}})}),t.on("mod.chat.msg.res.olyw.luckburst",function(t){var a=n.decode(t).too();if(a.uid==o.get("sys.uid")){if(!a.ur)return"";e.dispatch("2",a)}}),t.on("mod.chat.msg.res.cq",function(t){var a=n.decode(t).too(),i=n.decode(a.sui).too();if(i.id==o.get("sys.uid"))for(var s in v){var r=v[s];if(r.lev==a.lev){e.dispatch(s,a);break}}})},getEvent:function(e){for(var t=this.getData(),a=t.events,i={},s=0,n=a.length;n>s;s++)if(a[s].type==e){i=a[s];break}return i},dispatch:function(e,a){if(t.fire("mod.room.normal.gift.freegift.show")!==!0){var i=this;if(i.triggered(e))return!1;switch(e){case"1":i.loginAction(e);break;case"2":i.giftAction(e,a);break;case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"10":case"11":case"12":case"13":case"14":i.giftAction(e,a)}}},setData:function(e){b=e||{}},getData:function(){return b},share:function(e){var t=WB2.oauthData;if(t&&t.expires_in>0);else try{WB2.logout()}catch(a){}WB2.anyWhere(function(t){t.widget.publish({id:e.btnid,default_text:e.template,callback:function(t){e.callback&&e.callback.call(t)}})})},getShareLink:function(e){var t="http://service.weibo.com/share/share.php??url="+encodeURIComponent(location.href)+"&title="+encodeURIComponent(e.template)+"&data_track_clickback=true&pic="+encodeURIComponent($ROOM.room_pic)+"&appkey=979098171&ralateuid=3982726153";return t},getReward:function(){var a=this,i=e.extend({uid:o.get("sys.uid"),nickname:o.get("sys.nickname")},h);return a.getStorage("rewarded")?(i.exp=0,t.trigger("mod.weibo.share",i),!1):(e.ajax({url:"/member/wb_share/nc_reward",dataType:"json",success:function(e){0==e.error&&(t.trigger("mod.userinfo.change",{change:{exp:m}}),i.exp=m,t.trigger("mod.weibo.share",i),a.setStorage("rewarded",!0,a.getRestTime((new Date).getTime())/1e3))}}),void t.trigger("dys",{key:"dys.room.wbshare.success"}))}};w.init()}),define("douyu/page/room/normal/mod/private-letter",["jquery","douyu/context","shark/util/storage/1.0","shark/observer","douyu/com/user"],function(e,t,a,i,s){var n={visibile:!1,sdkLoaded:!1,frameWrapperLoaded:!1,createPrivateLetter:function(){this.frameWrapperLoaded=!0,this.$privateMsg=e(".web-message-wrapper"),this.$wrapper=e(".message-frame-wrapper"),this.$loading=this.$privateMsg.find(".loading-msg")},init:function(){var e=this;e.frameWrapperLoaded===!1&&(e.createPrivateLetter(),e.bindEvent())},bindEvent:function(){var t=this,a=e("#js-msg-barrage");window.closeMsg=t.closeMsg,window.updateUnreadMsg=t.updateUnreadMsg,a.on("click",function(e){e.stopPropagation();var a=s.check();return a?void t.openPrivateMsgBox():(s.show("login"),!1)}),e("#container").on("click",function(){t.closePrivateMsgBox()}),i.on("mod.room.privateLetter.open",function(e){var a=e||null;t.openPrivateMsgBox(a)}),i.on("com.private.letter.create",function(){t.createPrivateLetter(),window.embedMsg.init({target:n.$wrapper[0],onMessage:function(e){var t=parseInt(e,10)||0;i.trigger("com.private.letter.msg",t)},onLoad:function(){i.trigger("com.private.letter.loaded")},initShowState:!1}),n.$wrapper.removeClass("hide").show()}),i.on("com.private.letter.loaded",function(){n.$loading.remove(),n.sdkLoaded===!1&&(n.sdkLoaded=!0,n.visibile===!0&&window.embedMsg&&window.embedMsg.beforeShow())})},closeMsg:function(){n.closePrivateMsgBox()},updateUnreadMsg:function(e){a.set("userletnum"+t.get("sys.uid"),e)},closePrivateMsgBox:function(){window.embedMsg&&window.embedMsg.afterClose(),this.$privateMsg.hide(),this.visibile=!1},openPrivateMsgBox:function(e){this.sdkLoaded===!0&&window.embedMsg&&window.embedMsg.beforeShow(),e&&window.embedMsg&&window.embedMsg.showChatDetail(e),this.$privateMsg.show(),this.visibile=!0}};return{init:function(){n.init()}}}),define("douyu/page/room/normal/mod/noble-speaker",["jquery","shark/observer","shark/util/lang/1.0","shark/util/template/2.0","shark/util/storage/1.0","shark/util/flash/data/1.0","shark/util/date/1.0/date","douyu/context","douyu/com/exjsonp","douyu/com/user","douyu/page/room/base/api"],function(e,t,a,i,s,n,o,r,l,d,c){var u={},g={confPath:r.get("sys.webconfUrl")+"/resource/common/noble/setNobleHorn.json",data:{},flags:{getHorn:0,getInfo:0,isCounting:0,isUserLoged:d.check(),isShowCd:0},init:function(){var t,a=this;this.config={area:r.get("room.second_lvl_name"),maxLen:20,leadStoreName:"speakerbtnshowlead"},t=this.config,this.renders={renderSpeaker:this.renderSpeakerFn(),renderSpeakerCounter:this.renderSpeakerCounterFn()},this.nobleSpeaker=e("#js-noble-speaker"),this.speakerBtn=e("#js-noble-speaker-btn"),this.renderSpeakerBtn(),a.speakerBtn.removeClass("hide"),this.renderSpeaker(),r.get("room.cate_id")?this.bindEvents(1):(this.noAreaRender(),this.bindEvents()),l.load(a.confPath,"setNobleHorn",function(e){u.cd=e&&e.cd,a.config.cd=u.cd},function(e){u.cd=3,a.config.cd=u.cd})},renderSpeakerBtn:function(){var e=['<div data-selector="noble--broadcast-toggle" class="noble--broadcast-toggle">','<i class="icon--broadcast-toggle"></i>',"</div>"].join("");this.speakerBtn.append(e)},renderSpeakerFn:function(){var e=a.string.join('<div class="nobel--error-box">','<div class="error--mask"></div>','<div class="error--main">','<a data-btn="closespeaker" class="broadcast--close" href="javascript:;">×</a>','<div data-selector="noble-error-content" class="error--content"></div>','<div class="error--holder"></div>',"</div>","</div>",'<div class="broadcast-box--main">','<a data-btn="closespeaker" class="broadcast--close" href="javascript:;">×</a>','<div class="broadcast--title">',"<h4>",'<i class="icon--broadcast"></i> ','<span class="title--main">分区喇叭</span>',"</h4>",'<div class="title--main-sub">','<div class="main-sub--row">','<span class="main-sub--main">{{ if area }}{{ area }}区可见{{ /if }}</span>','<span data-selector="noblemsgtip" class="broadcast--status"></span>',"</div>","</div>","</div>",'<div class="broadcast--main">','<div data-selector="forbid-speaker-mask" class="broadcast--text status--forbidden">','<textarea data-selector="cate-speaker-msg" placeholder="输入喇叭内容" maxlength="{{ maxLen }}"></textarea>',"<i>",'<em data-selector="noble-words-count">{{ maxLen }}</em>字',"</i>",'<div data-selector="forbidden" class="broadcast--forbidden"></div>',"</div>",'<div class="broadcast--tool-bar">','<span data-selector="speaker-count" class="tool-bar--info">',"剩余 <em>0</em> 个，",'<a data-buy="speaker" class="btn--buy" href="javascript:;">开通贵族</a> 可获得喇叭',"</span>",' <a data-selector="send-noble-btn" class="btn--send" disabled="disabled" href="javascript:;">',"发送","</a>","</div>","</div>","</div>");return i.compile(e)},renderSpeaker:function(e){var t=this.config;this.nobleSpeaker.append(this.renders.renderSpeaker({area:t.area,maxLen:t.maxLen}))},renderSpeakerCounterFn:function(){var e=["剩余 ","<em>{{ speakerCount || 0 }}</em>"," 个",'，<a data-buy="speaker" class="btn--buy" href="javascript:;">','<div class="dy--tips status--hover-show">','<div class="tips--trans-outer">','<div class="tips--trans-inner">',"</div>","</div>",'<div class="tips--main">','<div class="tips--content">',"{{ if isNoble >= 3 || protectedLvl >= 3 }}","分区喇叭与贵族鱼翅返还时间相同","{{ else }}","分区喇叭为伯爵以上贵族专属特权","{{ /if }}","</div>","</div>","</div>","{{ if inProtected }}","{{ if protectedLvl < 3 }}","升级","{{ else }}","续费","{{ /if }}","{{ else }}","开通","{{ /if }}","贵族</a>"," 可获得喇叭"].join("");return i.compile(e)},renderSpeakerCounter:function(){var e=this.data;this.nobleSpeaker.find('[data-selector="speaker-count"]').html(this.renders.renderSpeakerCounter(e)),0===e.speakerCount&&this.setDisabled()},noAreaRender:function(){var e=this.nobleSpeaker,t=['<span class="broadcast--status status--success status--failed">',' <i class="icon--broadcast-status"></i> '," 无法获取分区喇叭不可用 ","</span>"].join("");e.find('[data-selector="noblemsgtip"]').addClass("status--failed").html(t),this.nobleSpeaker.find('[data-selector="forbid-speaker-mask"]').addClass("status--forbidden"),this.setDisabled()},hideMask:function(){this.nobleSpeaker.find('[data-selector="forbid-speaker-mask"]').removeClass("status--forbidden")},showMask:function(){this.nobleSpeaker.find('[data-selector="forbid-speaker-mask"]').addClass("status--forbidden")},setEnabled:function(){this.nobleSpeaker.find('[data-selector="send-noble-btn"]').removeAttr("disabled")},setDisabled:function(){this.nobleSpeaker.find('[data-selector="send-noble-btn"]').attr("disabled",!0)},setWordsCount:function(e){this.nobleSpeaker.find('[data-selector="noble-words-count"]').text(e)},countDown:function(){var t=this.config.cd,a=this.nobleSpeaker.find('[data-selector="send-noble-btn"]');a.attr("disabled",!0),this.config.cd--,this.flags.isCounting=1,t>0?a.text(t):(this.config.cd=u.cd,clearInterval(this.timer),this.flags.isCounting=0,a.text("发送"),this.hideMask(),""!==e.trim(this.nobleSpeaker.find('[data-selector="cate-speaker-msg"]').val())&&a.removeAttr("disabled"))},stopCounting:function(){clearInterval(this.timer),this.hideMask()},bindEvents:function(i){var l=this,u=l.config,g=e(document.body),m=l.nobleSpeaker,p=l.speakerBtn,f="",h=l.flags;p.on("click",'[data-selector="noble--broadcast-toggle"]',function(){return l.flags.isUserLoged?(m.removeClass("hide"),p.removeClass("status-new"),p.find('[data-selector="noble-btn-error"]').remove(),s.set(u.leadStoreName,1),void t.trigger("dys",{key:"dys.room.msg.hornbtn.click"})):void d.show("login")}).on("click",'[data-selector="noble-error--close"]',function(){p.find('[data-selector="noble-btn-error"]').remove()}),g.on("click",'[data-selector="not-noble-tip-btn"]',function(){e(this).text().indexOf("开通")>-1?t.trigger("mod.normal.noble.buy",{level:3}):t.trigger("mod.normal.noble.buy"),g.removeClass("has--mask"),e(this).closest('[data-selector="not-noble-tip"]').remove()}).on("click",'[data-selector="not-noble-tip-close"]',function(){g.removeClass("has--mask"),e(this).closest('[data-selector="not-noble-tip"]').remove()}),m.on("click",'[data-btn="closespeaker"]',function(){m.addClass("hide"),m.find('[data-selector="speaker-lead-tip"]').remove()}).on("click",'[data-buy="speaker"]',function(){var a=e(this).text(),i=a.indexOf("开通")>-1||a.indexOf("升级")>-1,s=a.indexOf("续费")>-1;i?t.trigger("dys",{key:"dys.room.msg.hornbtn.opennoble",level:l.data.isNoble||0}):s&&t.trigger("dys",{key:"dys.room.msg.hornbtn.renewnoble",level:l.data.isNoble||0}),i||s&&l.data.isNoble<3?t.trigger("mod.normal.noble.buy",{level:3}):t.trigger("mod.normal.noble.buy")}),i&&(m.on("keydown",'[data-selector="cate-speaker-msg"]',function(t){13===t.which&&(t.preventDefault(),e(this).blur(),m.find('[data-selector="send-noble-btn"]').trigger("click"),m.find('[data-selector="cate-speaker-msg"]').blur())}).on("input keyup paste change",'[data-selector="cate-speaker-msg"]',function(){var e=this.getAttribute("maxlength");this.value.length>=e&&(this.value=this.value.substr(0,e)),!this.value.length||l.flags.isCounting?l.setDisabled():l.setEnabled(),l.setWordsCount(e-this.value.length)}).on("click",'[data-selector="send-noble-btn"]',function(){var t={},i=l.data.speakerCount,s="开通",o="",u=l.data;return l.flags.isUserLoged?l.flags.isMute||e(this).attr("disabled")?!1:i?(o=e.trim(m.find('[data-selector="cate-speaker-msg"]').val()),""===o?!1:(t=[{name:"type",value:"cthnreq"},{name:"chatmsg",value:o},{name:"cid",value:r.get("room.cate_id")},{name:"pid",value:l.data.pid},{name:"cl",value:2}],m.find('[data-selector="cate-speaker-msg"]').blur().val(""),l.setWordsCount(l.config.maxLen),c.exe("js_send_cate_msg",n.encode(t)),l.showMask(),l.countDown(),void(l.timer=setInterval(function(){l.countDown()},1e3)))):(u.inProtected&&(s="续费",u.isNoble<3&&(s="升级")),f=a.string.join('<div data-selector="not-noble-tip" class="broadcast-auth-failed-panel">','<div class="panel-mask"></div>','<div class="noble--error">','<a data-selector="not-noble-tip-close" class="noble-error--close" href="javascript:;">×</a>','<div class="nobel-error--main">','<i class="nobel-error--icon"></i>','<div class="error-main--content">','<h3 class="content--title">承包整个区，大声说出爱</h3>',"<p>","分区喇叭--伯爵以上贵族专属特权","</p>",'<a data-selector="not-noble-tip-btn" class="btn" href="javascript:;">'+s+"贵族</a>","</div>","</div>","</div>","</div>"),g.append(f).addClass("has--mask"),l.setDisabled(),!1):(d.show("login"),!1)}),c.reg("room_data_handler",function(t){var a,i=n.decode(t).too(),s='<i class="icon--broadcast-status"></i>',o="";if("cthnres"===i.type){switch(""+i.result){case"5820":s+=" 系统维护，发送失败",o="status--failed",h.isCounting=1,h.isShowCd=0,l.showMask(),l.setDisabled(),e.dialog.tips_black("分区喇叭暂停服务，月底恢复");break;case"356":h.isShowCd=1,s+=" 发送内容包含敏感词汇",o="status--failed";break;case"0":h.isShowCd=1,s+=" 发送成功",o="status--success";break;default:h.isShowCd=1,s+=" 发送失败",o="status--failed"}a=m.find('[data-selector="noblemsgtip"]').removeClass("status--success status--failed").addClass(o).html(s),clearTimeout(l.tipTimer),h.isShowCd&&(l.tipTimer=setTimeout(function(){a.html("").removeClass("status--success status--failed")},3e3))}"cdcp"===i.type&&"hpid"in i&&(l.data.speakerCount=parseInt(i.hcnt,10),l.data.pid=parseInt(i.hpid,10),l.flags.getHorn=1,l.update())}),d.check()&&(t.on("mod.noble.info.get",function(t){var a;"memberinfores"===t.type&&(a=e.extend({nl:0,npl:0,npts:0},t),l.data.isNoble=parseInt(a.nl,10),l.data.protectedLvl=a.npl&&parseInt(a.npl,10)||0,l.data.inProtected=a.npts&&parseInt(a.npts,10)||l.data.isNoble,l.flags.getInfo=1,l.update())}),t.on("mod.chat.msg.mute",function(e){var t=1e3*e.met||0,a=parseInt(e.mtype,10)||1,i="";a>2&&t>0&&(i=["您已被"+["房间","房间","全站","全站"][a-1]+"禁言。<span>禁言类型：0"+a+"</span>","<div>","解禁时间："+o.format(new Date(t),"yyyy-MM-dd hh:mm:ss"),' <a href="/cms/gong/201601/06/2924.shtml" target="_blank">用户发言须知</a>',"</div>"].join(""),m.find('[data-selector="forbid-speaker-mask"]').addClass("status--forbidden").find('[data-selector="forbidden"]').html(i),l.setDisabled(),l.flags.isMute=1)})))},update:function(){this.updateBtn(),this.updateSpeaker()},updateSpeaker:function(){var t=this.data;""!==e.trim(this.nobleSpeaker.find('[data-selector="cate-speaker-msg"]').val());0==t.speakerCount?this.hideMask():t.speakerCount>0?(this.hideMask(),this.flags.isCounting||this.setEnabled()):(this.showMask(),this.setDisabled()),this.flags.isMute&&(this.showMask(),this.setDisabled()),this.renderSpeakerCounter()},updateBtn:function(){var e="",t=this.config;d.check()&&this.data.speakerCount>0&&!s.get(t.leadStoreName)&&(e=['<div data-selector="noble-btn-error" class="noble--error">','<a data-selector="noble-error--close" class="noble-error--close" href="javascript:;">×</a>','<div data-selector="noble-speaker-btn-arrow" class="noble-error--tran-outer">','<div class="noble-error--tran-inner">',"</div>","</div>",'<div class="nobel-error--main">','<div class="error-main--content">','<h3 class="content--title">',"您有<em>"+this.data.speakerCount+"</em>个分区喇叭，快来发送广播吧","</h3>","</div>","</div>","</div>"].join(""),this.speakerBtn.append(e),this.setLeadTipArrow(),s.set(t.leadStoreName,1))},setLeadTipArrow:function(){var t=this.speakerBtn,a=e("#js-chat-speak").offset().left,i=t.offset().left;t.find('[data-selector="noble-speaker-btn-arrow"]').css({marginLeft:0,left:i-a-10})}};return{init:function(){g.init()}}}),define("douyu/page/room/normal/mod/chat-noble-enter",["jquery","shark/observer","shark/util/lang/1.0","shark/util/flash/data/1.0","douyu/context","douyu/com/user","douyu/com/avatar","douyu/com/exjsonp","douyu/page/room/base/api","shark/util/template/1.0","shark/util/timeline/1.0","douyu/page/room/normal/mod/gift/constants"],function(e,t,a,i,s,n,o,r,l,d,c,u){var g=s.get("sys.web_url"),m=g+"/app/douyu/res/com/defaultAvatar.png",p=s.get("sys.avatar_url"),f=s.get("room.nobleConfig")||{},h=s.get("sys.resource_url"),v=s.get("room.room_id"),b=s.get("sys.webconfUrl"),y=[],k={configs:{urls:{nobleEffect:"/resource/noble/openeffect/web.json"},nobleEffectData:""},init:function(){this.bindEvt()},handleAvatar:function(e){var t=m;return e&&(t=a.string.format("{0}upload/{1}_middle.jpg",p,e)),t},OpenNobleTpl:function(){return['<div class="giftbatter-box giftbatter-noble-notify">','<ul class="c-list">','<li class="status-low-open open-level<%= nl %> normal-notice">','<i class="icon-heart"></i>','<p class="text-cont">','<span class="user-level-info">','<span class="user-noble-lv">','<img src="<%= resourceUrl %><%= nobleConfig[nl].symbol.web_symbol_pic1 %>" title="<%= nobleConfig[nl].symbol.name %>">',"</span>",'<a href="javascript:;" class="hy-name"><%= nickname %></a>','<%if(anchorName!=="") {%>','<span class="open-noble-desc">在</span><span class="hy-name"><%=anchorName%></span><span class="open-noble-desc">直播间</span>',"<%}%>","<%if(isSend===true) {%>",'<span class="open-noble-desc">给</span><span class="hy-name"><%=reciver%></span>',"<%}%>",'<span class="open-noble-desc">',"<%if(isRenew) {%>","续费了","<%} else {%>","开通了","<%}%>",'<em class="noble-name"><%= nobleConfig[nl].noble_name %></em>',"</span>","</span>","</p>","</li>","</ul>","</div>"].join("")},lianMaiTpl:function(){return['<div class="dialog-privilege-microphone dialog-nobility-center">','<a class="dialog-cls" href="javascript:;" title="关闭">&times;</a>','<h2 class="dialog-title">发弹幕很累？连麦互动一下</h2>','<span class="dialog-sp">连麦—贵族专属特权</span>','<a class="dialog-openN" href="javascript:;" title="开通贵族">开通贵族</a>',"</div>"].join("")},handleLianMai:function(){var a=this,i=(s.get("sys.uid"),e(a.lianMaiTpl()));e("body").append(i),a.$noble=e(".dialog-privilege-microphone"),a.$noble.on("click",".dialog-openN",function(e){return a.$noble.remove(),t.trigger("mod.normal.noble.buy"),!1}),a.$noble.on("click",".dialog-cls",function(e){return a.$noble.remove(),!1})},handleLowEnter:function(e){var t="",i=e.level>=70?"":"level-bgpng",s=e.level>=100?"level-size2":" level-size1";return t=a.string.join('<li class="jschartli status-low-enter enter-level<%= data.nl %>">','<p class="text-cont">','<span class="user-level-info">',"<% if(nobleConfig[data.nl]) { %>",'<span class="user-noble-lv">','<img src="<%= resourceUrl %><%= nobleConfig[data.nl].symbol.web_symbol_pic1 %>" title="<%= nobleConfig[data.nl].symbol.name %>">',"</span>","<% } %>","<% if (girlPrivilege) { %>",'<span title="小姐姐特权" class="girl-privilege-icon"></span>',"<% } %>","<% if(data.ol > 0) { %>",'<a class="chat-icon-pad anchor-level-icon" data-anchor-levelimg="<%=data.ol%>" title="主播等级：<%= data.ol %>">',"</a>","<%} else{ %>",'<a class="chat-icon-pad user-level<% if ( data.level < 10 ) { %> lve-icon-1to9 <% } %> <%= data.uli %> <%= imgType %> <%= imgSize %> " title="用户等级：<%= data.level %>">',"</a>","<%}%>",'<a href="javascript:;" data-rel="user-info" class="hy-name js-nick" is-show-super-icon="<%= data.sahf%>" avatar="<%= data.ic %>" rel="<%= data.uid %>" gid="<%= data.pg %>" data-level="<%= data.level %>" data-noble="<%= data.nl %>"><%= data.nn %></a>',"<strong>欢迎来到本直播间</strong>","</span>","</p>","</li>"),render=d.compile(t),html=render({data:e,webUrl:g,nobleConfig:f,resourceUrl:h,imgType:i,imgSize:s}),{mark:!1,html:html}},handleHightEnter:function(t){var i,n=this,o="",r=null;if(t.el)for(var l=0,c=t.el.length;c>l;l++)if(1500000123===parseInt(t.el[l].eid,10)){i=1500000123;break}o=a.string.join("<% if (sharkKingCode) {%>",'<div class="status--enter enter-level<%= data.nl %>">','<div class="sharkbaby-noble-con"></div>','<img class="noble-placeholder-img" src="<%= webUrl %>app/douyu/res/page/room-normal/vip/status-enter-vbg<%= data.nl %>.png?20170110">','<object autoplay="autoplay" data="<%= webUrl %>app/douyu/res/page/room-normal/vip/status-enter-video<%= data.nl %>.swf?20170110">','<param name="wmode" value="transparent">','<embed src="<%= webUrl %>app/douyu/res/page/room-normal/vip/status-enter-video<%= data.nl %>.swf?20170110" wmode="transparent">',"</object>",'<video autoplay="autoplay" loop="loop">','<source src="<%= webUrl %>app/douyu/res/page/room-normal/vip/status-enter-video<%= data.nl %>.mp4?20170111" type="video/mp4">',"</video>",'<div class="chat-user-card">','<div class="user-card-main clearfix">','<div class="card--invisible-main ">','<div class="enter-user-icon">','<div class="enter-user-bd"></div>','<img src="<%= handleAvatar(data.ic) %>">',"</div>","<h2><%= data.nn %></h2>","<p>欢迎<%= nobleName %>光临直播间</p>","</div>","</div>","</div>","</div>","<% } else { %>",'<div class="status--enter enter-level<%= data.nl %>">','<img class="noble-placeholder-img" src="<%= webUrl %>app/douyu/res/page/room-normal/vip/status-enter-vbg<%= data.nl %>.png?20170110">','<object autoplay="autoplay" data="<%= webUrl %>app/douyu/res/page/room-normal/vip/status-enter-video<%= data.nl %>.swf?20170110">','<param name="wmode" value="transparent">','<embed src="<%= webUrl %>app/douyu/res/page/room-normal/vip/status-enter-video<%= data.nl %>.swf?20170110" wmode="transparent">',"</object>",'<video autoplay="autoplay" loop="loop">','<source src="<%= webUrl %>app/douyu/res/page/room-normal/vip/status-enter-video<%= data.nl %>.mp4?20170111" type="video/mp4">',"</video>",'<div class="chat-user-card">','<div class="user-card-main clearfix">','<div class="card--invisible-main ">','<div class="enter-user-icon">','<div class="enter-user-bd"></div>','<img src="<%= handleAvatar(data.ic) %>">',"</div>","<h2><%= data.nn %></h2>","<p>欢迎<%= nobleName %>光临直播间</p>","</div>","</div>","</div>","</div>","<% } %>"),render=d.compile(o),$nobleEnter=e(render({data:t,sharkKingCode:i,handleAvatar:n.handleAvatar,webUrl:s.get("sys.web_url"),nobleName:f[t.nl]?f[t.nl].noble_name:""})),n.$container.append($nobleEnter),r=$nobleEnter.find(".chat-user-card"),r.css({opacity:.9});e('[data-type="chat-cont"]').height(),(new Date).getTime();$nobleEnter.animate({bottom:0},500,function(){r.css({opacity:1}),setTimeout(function(){$nobleEnter.remove(),y.splice(0,1),y.length&&n.handleHightEnter(y[0])},5e3)})},handleOpenNoble:function(t){var a=this.OpenNobleTpl(),i=d.compile(a),s=e(i({nickname:t.gvnk?t.gvnk:t.unk,anchorName:t.donk||"",webUrl:g,nl:t.nl,level:t.lv,nobleConfig:f,resourceUrl:h,isRenew:t.isRenew,isSend:!!t.gvnk,reciver:t.unk}));e("#js-chat-cont").append(s),setTimeout(function(){s.remove()},15e3)},getNobleEffectConfig:function(t,a){var i,s=this,n=s.configs,o=e.Deferred();return n.nobleEffectData?"getAll"==a?o.resolve(n.nobleEffectData):(i=n.nobleEffectData[t],i?o.resolve(i):o.reject()):(r.load(b+n.urls.nobleEffect,"nobleOpenEffect",function(e){return e?(n.nobleEffectData=e,"getAll"==a?o.resolve(n.nobleEffectData):(i=e[t],i?o.resolve(i):o.reject())):o.reject()}),o)},getNobleEffctConfig:function(e){var t,a={is_special:"is_special",bimg:"pc_bg",himg:"pc_pic",stay_time:"stay_milli_sec",nobleFlash:"spl_pc_flash",nobleBg:"spl_pc_bg",devote:"display_rank",nobleLev:"noble_lev",name:"noble_name",ef:"ef",type:"noble_type"},i={};for(t in a)i[t]=e[a[t]];return i},getNobleEffctPushData:function(e){var t,a={gfid:"noble_id",gs:"gs",hits:"hits",nn:"unk",uid:"uid",effectType:"noble_type",openNobleAvatar:"uic"},i={};for(t in a)i[t]=e[a[t]];return i},nobleEffectHandle:function(e){var a=this,i={giftConfig:a.getNobleEffctConfig(e.giftConfig),giftData:a.getNobleEffctPushData(e.giftData)};t.trigger(u.OPEN_NOBLE_PUSH,i)},openNobleEffect:function(e){var a,i=this,s=f[e.nl];s&&i.getNobleEffectConfig(e.nl).done(function(n){n&&(n.noble_name=s.noble_name,n.noble_lev=e.nl,n.ef=111111,n.noble_type="noble",e.noble_id="noble_"+e.nl,e.noble_type="noble",e.gs=e.nl,t.trigger("douyu.avatar.url",e.uic,"middle",function(t){e.uic=t,a={giftConfig:n,giftData:e},i.nobleEffectHandle(a)}))})},bindEvt:function(){var a=this;this.$container=e(".giftbatter-noble-enter"),l.reg("room_data_openNoble",function(){a.handleLianMai()}),l.reg("room_data_handler",function(e){var e=i.decode(e).too();switch(e.type){case"anbc":e.drid==v&&a.openNobleEffect(e);break;case"rnewbc":e.isRenew=!0,e.drid==v&&a.handleOpenNoble(e)}}),t.on("mod.chat.noble.enter",function(e){var t={};return e.nl<=3?t=a.handleLowEnter(e):(y.length?y.push(e):(y.push(e),a.handleHightEnter(e)),t={mark:!0,html:""}),t}),t.on("room.get.noble.effect.config",function(){var t=e.Deferred();return a.getNobleEffectConfig(0,"getAll").done(function(e){return t.resolve(e)}),t})}};return k}),define("douyu/page/room/normal/mod/girl-privilege",["jquery","shark/util/lang/1.0","shark/util/template/1.0","douyu/context","shark/observer","shark/util/storage/1.0","douyu/com/exjsonp","shark/util/cookie/1.0"],function(e,t,a,i,s,n,o,r){var l={urls:{girl:"/member/cp/cp_rpc_ajax",cap:i.get("sys.webconfUrl").replace(/^http(s?):/,"").replace(/\/$/g,"")+"/resource/common/female_privilege.json"}},d={btnAction:"jump",btnText:"立即认证",text:"实名认证为女性的用户可领取特权"},c={btnAction:"close",btnText:"朕知道了",text:"您的实名认证结果为男性，只能欣赏而不可拥有小姐姐特权~"},u={btnAction:"receive",btnText:"领取特权",text:"您已通过实名认证且认证为女性，可以领取特权~"},g={btnAction:"close",btnText:"我知道了",text:"目前只支持大陆身份证实名认证为女性的用户才能领取特权"},m={slogan:"您已享有小姐姐特权",desc:"快去直播间看看吧！"},p={slogan:"领取成功！",desc:"您已享有小姐姐特权，快去直播间看看吧！"},f={pagefrom:"",APIs:{userinfo:"/member/female_privilege/get_privilege_info",changeIdent:"/member/cp/changeIdent",hidebanner:"/member/female_privilege/hide_banner",receivePrivilege:"/member/female_privilege/receive_privilege",getCsrfCookie:"/curl/csrfApi/getCsrfCookie"},_getCsrfCookie:function(t){var a=this,i=r.get($SYS.tvk);if(!i)return void e.ajax({url:a.APIs.getCsrfCookie,type:"GET",dataType:"json",success:function(e){0===e.error&&a._getCsrfCookie(t)}});var s=$SYS.tn;t&&t({name:s,val:i})},najax:function(t){this._getCsrfCookie(function(a){t.data[a.name]=a.val,e.ajax(t)})},init:function(e){this.pagefrom=e||"",this.hasSisterDialog()?this.showPopup():this.getUserStatus(),DYS.sub({action_code:"init_page_lsis"})},hasSisterDialog:function(){return e(".widget-sisterdialog-container").length>0},getUserStatus:function(){var t=this;t.najax({type:"GET",url:t.APIs.userinfo,dataType:"json",data:{},success:function(a){if(0==a.error){var i=a.data.female_privilege,s=a.data.ident_sex;t.render(),t.renderStatus(i,s),t.bindEvent()}else e.dialog.tips_black(a.msg)}})},render:function(){var t=['<div class="widget-sisterdialog-container">','<div class="widget-content">','<div class="body">','<ul class="tequan-list">','<li><i class="tequan-icon icona"></i><span>闪亮头衔惊艳昵称</span></li>','<li><i class="tequan-icon iconb"></i><span>进房专属欢迎提示</span></li>','<li><i class="tequan-icon iconc"></i><span>萌系可爱个人名片</span></li>','<li><i class="tequan-icon icond"></i><span>小姐姐专属标识</span></li>',"</ul>",'<div class="tequan-append"></div>',"</div>",'<div class="close"></div>','<div class="nomore">不再显示此特权banner</div>',"</div>",'<div class="widget-mask"></div>',"</div>"];e("body").append(t.join(""))},renderStatus:function(t,a){var i={};if(this.pagefrom&&e(".nomore").hide(),1==t)i=m,this.appendSuccess(i);else switch(a){case 0:i=d,"identselect"==this.pagefrom&&(i.btnAction="close"),this.appendNormal(i);break;case 1:i=c,this.appendNormal(i);break;case 2:i=u,this.appendNormal(i);break;case 3:i=g,this.appendNormal(i)}},bindEvent:function(){var t=this;e(".widget-sisterdialog-container").on("click",".close",function(){t.hidePopup()}).on("click",".nomore",function(){t.hidePopup(),t.hideBanner(),DYS.sub({action_code:"click_lsis_no"})}).on("click",".button",function(){t.buttonAction(e(this))})},buttonAction:function(e){var t=e.attr("data-type");switch(t){case"jump":this.jumpToIdent();break;case"close":this.hidePopup(),DYS.sub({action_code:"click_lsis_known"});break;case"receive":this.receivePriv()}},appendNormal:function(t){var a=['<div class="normal">','<div class="line"></div>','<div class="text">'+t.text+"</div>",'<div class="button" data-type='+t.btnAction+">"+t.btnText+"</div>","</div>"];e(".tequan-append").html(a.join(""))},appendSuccess:function(t){var a=['<div class="success">','<p class="slogan">'+t.slogan+"</p>",'<p class="desc">'+t.desc+"</p>","</div>"];e(".tequan-append").html(a.join("")),e(".tequan-list li").each(function(){e(this).addClass("active")})},showPopup:function(){e(".widget-sisterdialog-container").show()},hidePopup:function(){e(".widget-sisterdialog-container").hide()},hideBanner:function(){var t=this;t.najax({type:"POST",url:t.APIs.hidebanner,data:{},dataType:"json",success:function(e){},error:function(){}}),e("#sister-right").hide()},jumpToIdent:function(){var e=this;DYS.sub({action_code:"click_lsis_realverify"}),window.location.href=e.APIs.changeIdent},receivePriv:function(){var t=this;t.najax({type:"POST",url:t.APIs.receivePrivilege,data:{},dataType:"json",success:function(a){if(0==a.error){var i=p;t.appendSuccess(i),t.pagefrom||(e(".is-dy-sister").removeClass("hide"),e(".not-dy-sister").addClass("hide"))}else e.dialog.tips_black(a.msg)},error:function(){e.dialog.tips_black("领取失败")}}),DYS.sub({action_code:"click_lsis_get"})}},h={init:function(){this.bindApi(),this.getCapMakr()},getCapMakr:function(){var e=this;n.get("hasShowGirlCap")||o.load(l.urls.cap,"female_privilege",function(t){e.girlCapMark=+t.female_privilege_guide},function(t){e.girlCapMark=!1},function(e){},!0)},capGirl:function(t){var a=this;a.girlCapMark&&!n.get("hasShowGirlCap")&&0==e(".girl-cap-notice").length&&(a.showCapGirl(t),a.timeoutRemove(),n.set("hasShowGirlCap",1))},timeoutRemove:function(){var e=this,t=setTimeout(function(){e.$capGirl.remove(),clearTimeout(t)},5e3);e.$capGirl.on("click",".girl-cap-close",function(){e.$capGirl.remove(),clearTimeout(t)})},showCapGirl:function(i){var n=this,o=i.level>=70?"":"level-bgpng",r=i.level>=100?"level-size2":" level-size1",l=t.string.join('<div class="girl-cap-notice">','<a class="girl-cap-close" href="javascript:;"></a>','<p class="girl-nick">','<span title="小姐姐特权" class="girl-privilege-icon"></span>',"<% if(data.ol > 0) { %>",'<a class="chat-icon-pad anchor-level-icon" data-anchor-levelimg="<%= data.ol %>" title="主播等级：<%= data.ol %>">',"</a>","<%} else{ %>",'<a class="chat-icon-pad level-<%= data.level %> user-level<% if ( data.level < 10 ) { %> lve-icon-1to9 <% } %> <%= data.uli %> <%= imgType %> <%= imgSize %> " title="用户等级：<%= data.level %>">',"</a>","<%}%>",'<a href="javascript:;" data-rel="user-info" class="hy-name js-nick" is-show-super-icon="<%= data.sahf%>" avatar="<%= data.ic %>" rel="<%= data.uid %>" gid="<%= data.pg %>" data-level="<%= data.level %>" data-noble="<%= data.nl %>"><%= data.nn %></a>',"</p>",'<p class="girl-right js-girl-right js-show-girl"><span>了解小姐姐特权...</span>',"</p>","</div>"),d=a.compile(l),c=d({data:i,imgType:o,imgSize:r});n.$capGirl=e(c),s.trigger("dys",{key:"dys.room.girl.right.show"}),e("#js-chat-cont").append(n.$capGirl)},bindApi:function(){var t=this;s.on("mod.userenter.get.girl",function(e){return t.enterWel(e)}),s.on("mod.msg.cap.girl",function(e){t.capGirl(e)}),e("#js-live-room-normal-right").on("click",".js-girl-right",function(){
f.init("liveroom"),e(this).hasClass("js-show-girl")?s.trigger("dys",{key:"dys.room.girl.right.click"}):s.trigger("dys",{key:"dys.room.girl.show.detail"})})},enterWel:function(e){var i,s=e.level>=70?"":"level-bgpng",n=e.level>=100?"level-size2":" level-size1";if(h.girlEnterRender)i=h.girlEnterRender;else{var o=t.string.join('<li class="jschartli chart-li-girl">','<p class="text-cont girl-cont">','<span title="小姐姐特权" class="girl-privilege-icon"></span>',"<% if(data.ol > 0) { %>",'<a class="chat-icon-pad anchor-level-icon" data-anchor-levelimg="<%= data.ol %>" title="主播等级：<%= data.ol %>">',"</a>","<%} else{ %>",'<a class="chat-icon-pad user-level<% if ( data.level < 10 ) { %> lve-icon-1to9 <% } %> <%= data.uli %> <%= imgType %> <%= imgSize %> " title="用户等级：<%= data.level %>">',"</a>","<%}%>",'<a href="javascript:;" data-rel="user-info" class="hy-name js-nick" is-show-super-icon="<%= data.sahf%>" avatar="<%= data.ic %>" rel="<%= data.uid %>" gid="<%= data.pg %>" data-level="<%= data.level %>" data-noble="<%= data.nl %>"><%= data.nn %></a>',"<strong>欢迎来到本直播间</strong>","</p>","</li>");i=a.compile(o),h.girlEnterRender=i}var r=i({data:e,imgType:s,imgSize:n});return{mark:!1,html:r}}};return{init:function(){h.init()}}}),define("douyu/page/room/normal/mod/level120-enter",["jquery","shark/observer","shark/util/lang/1.0","shark/util/template/2.0","douyu/context","douyu/com/exjsonp"],function(e,t,a,i,s,n){var o=s.get("sys.webconfUrl"),r=s.get("sys.avatar_url"),l=s.get("sys.ceph_url"),d=window.location.protocol+"//"+window.location.host+"/",c={width:336,config:[],configUrl:o+"resource/common/privilege/custom_effect2.json",callbackName:"customEffectConfig",defaultAvatar:o+"/app/douyu/res/com/defaultAvatar.png",direc:"",tempArr:[],timer:null,flag:!0},u={init:function(){var t=this;t.$view=e("#js-chat-cont"),t.target=null,n.load(c.configUrl,c.callbackName,function(e){c.config=e.concat()},function(e){c.config=[]})},render:function(e){var t,s,n,o=this;t=a.string.join('<div class="giftbatter-normal-config-enter" data-type-welcome="level120Box" style="height:{{ data.bg_height }}px;">','<div class="normal-config-enter-status--enter" data-type-welcome="level120">','<img class="normal-config-enter-flashbg" src="{{ url + data.web_img }}">','<object autoplay="autoplay">','<embed type="application/x-shockwave-flash" src="{{ mainUrl + data.web_img_swf }}" wmode="transparent">',"</object>",'<div class="normal-config-enter-user-icon" style="top:{{ data.img_height }}px">','<img class="normal-config-enter-user-avatar" src="{{ handleAvatar(data.ic) }}">',"</div>",'<div class="normal-config-enter-user-intro" style="color:{{ data.font_color }};top: {{ data.font_height }}px">','<span class="normal-config-enter-user-intro-con"><span class="normal-config-enter-user-intro-text1">{{ data.text1 }}</span>','<span class="normal-config-enter-user-name" style="color:{{ data.name_color }}";>{{ data.nn }}</span>','<span class="normal-config-enter-user-intro-text2">{{ data.text2 }}</span></span>',"</div>","</div>","</div>"),s=i.compile(t),n=s({data:e,url:l,handleAvatar:o.handleAvatar,mainUrl:d}),o.$view.append(n),o.target=o.$view.find('[data-type-welcome="level120"]'),o.layout(o.target,e)},layout:function(e,t){var a=["bottom","top","left","right"],i=a[t.occurrence_mode-1];3==t.occurrence_mode&&4==t.occurrence_mode?e.css(i,-c.width+"px"):e.css(i,-t.bg_height+"px"),c.direc=i},show:function(){var t=this,a={},i={};c.tempArr.length&&c.flag&&(a=c.tempArr[0],c.flag=!1,t.render(a),i[c.direc]=0,t.target.show().animate(i,1e3),c.timer=setTimeout(function(){t.target.fadeOut(1e3,function(){c.flag=!0,e(this).closest('[data-type-welcome="level120Box"]').remove(),c.tempArr.shift(),t.show()})},4e3))},handleAvatar:function(e){var t=c.defaultAvatar;return e&&(t=a.string.format("{0}upload/{1}_middle.jpg",r,e)),t},handleData:function(t){var a=this,i={};return c.config.length&&(i=a.matchEid(t.ceid,c.config),i.ic=t.ic,i.nn=t.nn),e.isEmptyObject(i)?!1:(c.tempArr.push(i),i)},matchEid:function(e,t){for(var a=[],i=t.length-1;i>=0;i--)if(e==t[i].ceid)return a=t[i].welcome_content.split("%username%"),t[i].text1=a[0],2===a.length?t[i].text2=a[1]:t[i].text2="",t[i];return!1},imgLoad:function(e,t){var a=!0,i=null,s=new Image,n=new Image;return n.complete?void t():(i=setTimeout(function(){a&&(a=!1,t())},500),n.onload=function(){a&&(clearTimeout(i),n.onload=null,a=!1,t())},s.src=e.web_img,void(n.src=e.web_img_swf))}};return t.on("mod.chat.level120.enter",function(e){var t=u.handleData(e);return t?(u.imgLoad(t,function(){u.show(t)}),{mark:!0}):{mark:!1,html:""}}),{init:function(){u.init()}}}),define("douyu/page/room/normal/mod/yz-anchor-pk",["jquery","douyu/context","shark/observer","shark/util/lang/1.0","shark/util/template/1.0","shark/util/flash/data/1.0","douyu/page/room/base/api"],function(e,t,a,i,s,n,o){var r={wrapDoms:e("#js-chat-cont"),webUrl:t.get("sys.web_url"),curAnchorName:t.get("room.owner_name"),curAnchorRid:parseInt(t.get("room.room_id"),10),isPkStart:!1},l={tipsTitle:{start:"PK开始，赶快刷礼物支持主场主播“"+r.curAnchorName+"”吧~",willEnd:"PK即将结束，抓紧时间赶紧走一波礼物吧~",endNoWin:"PK结束，双方战成平局，快鼓励主播再来一波吧~"},renderTips:function(){var e,t,a;a=i.string.join('<div class="lianmai-tips clearfix" data-value="pkWrap">','<img class="lianmai-tips-icon" src="'+r.webUrl+'app/douyu/res/page/room-normal/lianmai-tips-icon.png"/>','<p class="lianmai-tips-text" data-value="pkTitle"></p>','<span class="lianmai-tips-close"></span>',"</div>"),t=s.compile(a),e=t({}),r.wrapDoms.append(e),this.doms.pkWrap=r.wrapDoms.find('[data-value="pkWrap"]'),this.doms.pkTitle=r.wrapDoms.find('[data-value="pkTitle"]')},htmlTitle:function(e){var t=this.doms;t.pkTitle.html(e)},regData:function(){var e,t,i,s,l=this,d=l.doms;l.backTimer=null,l.tipsTimer=null,l.checkStatusTimer=null,o.reg("room_yz_data",function(o){var c=n.decode(o).too(),u=c.type;if(a.trigger("room.monitor.room_yz_data",c),"apkb"===u)switch(e=parseInt(c.cmd,10)){case 3:r.isPkStart=!0,l.backTimer=setTimeout(function(){d.pkWrap||l.renderTips(),l.htmlTitle(l.tipsTitle.start),clearTimeout(l.backTimer)},3e3),clearTimeout(l.tipsTimer),l.tipsTimer=setTimeout(function(){d.pkWrap&&(d.pkWrap.remove(),d.pkWrap=null),clearTimeout(l.tipsTimer)},11e3);break;case 4:d.pkWrap||l.renderTips(),i=parseInt(c.ac,10)>parseInt(c.bc,10)?"PK已结束，“"+n.decode(c.ai).too().nn+"”在本场PK中获胜":parseInt(c.ac,10)===parseInt(c.bc,10)?l.tipsTitle.endNoWin:"PK已结束，“"+n.decode(c.bi).too().nn+"”在本场PK中获胜",l.htmlTitle(i),clearTimeout(l.tipsTimer),l.tipsTimer=setTimeout(function(){d.pkWrap&&(d.pkWrap.remove(),d.pkWrap=null),clearTimeout(l.tipsTimer)},8e3);break;case 5:d.pkWrap&&(d.pkWrap.remove(),d.pkWrap=null);break;case 6:d.pkWrap&&(d.pkWrap.remove(),d.pkWrap=null),r.isPkStart&&(l.checkStatusTimer=setTimeout(function(){d.pkWrap&&(d.pkWrap.remove(),d.pkWrap=null),r.isPkStart=!1,clearTimeout(l.checkStatusTimer)},3200));break;case 9:d.pkWrap&&(d.pkWrap.remove(),d.pkWrap=null)}if("apkt"===u)switch(t=parseInt(c.st,10)){case 2:d.pkWrap||l.renderTips(),l.htmlTitle(l.tipsTitle.start),clearTimeout(l.tipsTimer),l.tipsTimer=setTimeout(function(){d.pkWrap&&(d.pkWrap.remove(),d.pkWrap=null),clearTimeout(l.tipsTimer)},8e3);break;case 3:r.isPkStart=!0,l.backTimer=setTimeout(function(){d.pkWrap||l.renderTips(),l.htmlTitle(l.tipsTitle.start),clearTimeout(l.backTimer)},3e3),clearTimeout(l.tipsTimer),l.tipsTimer=setTimeout(function(){d.pkWrap&&(d.pkWrap.remove(),d.pkWrap=null),clearTimeout(l.tipsTimer)},11e3);break;case 4:d.pkWrap||l.renderTips(),s=parseInt(c.ac,10)>parseInt(c.bc,10)?"PK已结束，“"+n.decode(c.ai).too().nn+"”在本场PK中获胜":parseInt(c.ac,10)===parseInt(c.bc,10)?l.tipsTitle.endNoWin:"PK已结束，“"+n.decode(c.bi).too().nn+"”在本场PK中获胜",l.htmlTitle(s),clearTimeout(l.tipsTimer),l.tipsTimer=setTimeout(function(){d.pkWrap&&(d.pkWrap.remove(),d.pkWrap=null),clearTimeout(l.tipsTimer)},8e3)}}),o.reg("room_yz_backtime",function(){d.pkWrap||l.renderTips(),l.htmlTitle(l.tipsTitle.willEnd),clearTimeout(l.tipsTimer),l.tipsTimer=setTimeout(function(){d.pkWrap&&(d.pkWrap.remove(),d.pkWrap=null),clearTimeout(l.tipsTimer)},8e3)})},bindEvt:function(){var e=this,t=e.doms;r.wrapDoms.on("click",".lianmai-tips-close",function(){t.pkWrap&&(t.pkWrap.remove(),t.pkWrap=null,clearTimeout(e.tipsTimer))})},init:function(){this.doms={},this.regData(),this.bindEvt()}};return{init:function(){l.init()}}}),define("douyu/page/room/normal/mod/noble-overtime-tips",["jquery","shark/observer","shark/util/storage/1.0","shark/util/lang/1.0","shark/util/template/1.0","douyu/page/room/base/api","douyu/com/exjsonp"],function(e,t,a,i,s,n,o){var r={},l={init:function(t){return this.svgEnable=!(!window.navigator.msPointerEnabled&&!window.navigator.pointerEnabled),this.isIE=navigator.userAgent.indexOf("MSIE")>-1,this.id="grayscale"+(Math.random()+"").slice(2,8),this.svg=['<svg version="1.1" xmlns="http://www.w3.org/2000/svg" style="position:absolute;left:-1000px;top:-1000px;">','<filter id="'+this.id+'">','<feColorMatrix type="matrix" values="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"/>',"</filter>","</svg>"].join(""),e("body").append(this.svg),this.render(t)},render:function(t){var a;this.svgEnable?(a=e(t),a.length>0&&"img"!==a[0].nodeName.toLowerCase()&&(a=e(t).find("img")),e(a).each(function(t,a){var i=a.width||0,s=a.height||0,n='<svg width="'+i+'" height="'+s+'"><image xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+a.src+'" x="0" y="0" width="'+i+'" height="'+s+'" filter="url(#'+this.id+')"></image></svg>';e(a).replaceWith(n)})):(e(t).css({"-webkit-filter":"grayscale(100%)","-moz-filter":"grayscale(100%)","-ms-filter":"grayscale(100%)","-o-filter":"grayscale(100%)",filter:"grayscale(100%)"}),this.isIE&&e(t).css("filter","gray"))}};return r={init:function(){this.config={nobleInfoUrl:"/noble/confignw",containsDom:".chat",showTipsTimes:0},this.regNobleInfo(),this.bindEvt()},bindEvt:function(){e(this.config.containsDom).on("click",'[noble-overtime="close"]',function(){var t=e(".noble-renewal-fee");t.remove()}).on("click",'[noble-overtime="renew"]',function(){var a=e(".noble-renewal-fee");return a.remove(),t.trigger("mod.normal.noble.buy"),!1})},renderChatTips:function(t){var n,o,r,d,c=a.get("nobleOverTips")||"",u=parseInt(c.split("-")[0],10)||0,g=(new Date).getTime();n=i.string.join('<div class="noble-renewal-fee">','<div class="close" noble-overtime="close"></div>','<div class="noble-fee-id">','<div class="noble-id-icon">','<img src="<%= nobleInfo.icon %>">',"</div>",'<h3 class="noble-fee-txt">您的<%= nobleInfo.nobleName %>身份已过期</h3>',"<% if (nobleInfo.nobleGold > 0) { %>",'<span class="noble-account"><em class="noble-account-em"><%= nobleInfo.nobleGold %>贵族鱼翅</em>已被冻结</span>',"<% } %>","</div>",'<div class="noble-expired-desc">','<span><%= nobleInfo.endTime %>日0点前续费贵族可解冻贵族鱼翅，</span><span>享续费价格<em class="noble-expired-strong">节省<%= nobleInfo.savePrices %>元</em> </span>',"</div>",'<a class="noble-renewal-btn" href="javascript:;" noble-overtime="renew">续费贵族</a>',"</div>"),r=s.compile(n),o=r({nobleInfo:t}),e(this.config.containsDom).append(o),l.init(".noble-renewal-fee .noble-fee-id img"),0===u?a.set("nobleOverTips",g+6048e5+"-1",1296e3):a.set("nobleOverTips",g+6048e5+"-2",1296e3),d=setTimeout(function(){e(".noble-renewal-fee").remove(),clearTimeout(d)},2e4)},delTime:function(e){var t,a,i,s;return e?(s=new Date(1e3*e),t=s.getFullYear(),a=s.getMonth()+1<10?"0"+(s.getMonth()+1):s.getMonth()+1,i=s.getDate()+"",t+"-"+a+"-"+i):0},handleData:function(e,t){var a={};a.nobleGold=t.ngb/100,a.endTime=this.delTime(t.npts),a.nobleName=e.noble_name,a.icon=$SYS.resource_url+e.symbol.web_symbol_pic3||$SYS.web_url+"app/douyu/res/page/room-normal/noble/noble-icon.png?20170914",a.savePrices=parseInt((e.first_open_price-e.first_remand_gold)/100,10),this.renderChatTips(a)},getCurNobleInfo:function(e,t){var a=null,i=0;for(i;i<e.length;i++)parseInt(e[i].level,10)===+t&&(a=e[i]);return a},getNobleConfig:function(t,a){var i=this,s={};0>=t||e.ajax({url:i.config.nobleInfoUrl,type:"GET",dataType:"json",success:function(e){0===parseInt(e.error,10)&&(s=i.getCurNobleInfo(e.data,t)||{},i.handleData(s,a))}})},regMsg:function(e){var t=parseInt((new Date).getTime()/1e3,10),i=e.nets||0,s=parseInt(e.nl,10)||parseInt(e.npl,10)||0,n=a.get("nobleOverTips")||"",o=parseInt(n.split("-")[1],10)||0,r=parseInt(n.split("-")[0],10)||0;i>0&&a.remove("nobleOverTips"),o>=2||r>1e3*t||!e.nl&&e.npl&&this.getNobleConfig(s,e)},regNobleInfo:function(){var e=this;t.on("mod.noble.info.get",function(t){"memberinfores"===t.type&&e.regMsg(t)})}},{init:function(){r.init()}}}),define("douyu/page/room/normal/mod/broadcast",["jquery","shark/observer","shark/util/lang/1.0","shark/util/storage/1.0","shark/util/flash/data/1.0","shark/util/template/2.0","douyu/context","douyu/com/sign","douyu/com/exjsonp","douyu/page/room/base/api","shark/lib/json2"],function(e,t,a,i,s,n,o,r,l,d){var c={urls:{config:o.get("sys.webconfUrl")+"resource/common/broadcast/broadcastJsonp.json"},adQueue:[],flags:{configLoaded:0,detailLoaded:0,signLoaded:0,isShow:0,pageLoaded:1},storeNames:{configData:"broadcastconfig",broadcasts:"broadcasts",broadcastlimit:"broadcastlimit"},timers:{delayTime:null,displayTime:null},data:{currentData:null,roomId:o.get("room.room_id")},config:{},init:function(){var a=this;this.doms={sysBroadcast:e("#js-chat-notice")},this.renders={renderAd:this.renderAdFn(),renderNotify:this.renderNotifyFn(),renderImg:this.renderImgFn()},l.load(a.urls.config,"setSysBroadcastConf",function(e){a.config=e,i.set(a.storeNames.configData,e),t.trigger("mod.broadcast.config.loaded")},function(){a.config=i.get(a.storeNames.configData),a.config&&t.trigger("mod.broadcast.config.loaded")}),a.bindEvents()},renderAdFn:function(){var e=a.string.join('<div class="chat-sysbroadcast-ad {{ if !data.link }} chat-sysbroadcast-ad-nolink{{ /if }}" {{if data.posid }} data-dysign={{data.posid}} {{/if}}>','<div class="chat-sysbroadcast-header clearfix">','<a data-sysbroadcast="btn-close" class="chat-sysbroadcast-close" href="javascript:;" title="关闭">关闭</a>',"</div>",'<div class="chat-sysbroadcast-body clearfix  {{if data.posid }} dysign-text-dot {{/if}}">',"{{ if data.link }}",'<a href="{{ data.link }}" data-sysbroadcast="cont" class="chat-sysbroadcast-cont" target="_blank" title="{{ data.c }}">',"{{ data.c }}","</a>",'<a href="{{ data.link }}" data-sysbroadcast="godetail" class="chat-sysbroadcast-godetail fr" target="_blank" title="查看详情">查看详情</a>',"{{ else }}",'<div data-sysbroadcast="cont" class="chat-sysbroadcast-cont" target="_blank" title="{{ data.c }}">',"{{ data.c }}","</div>","{{ /if }}","</div>","</div>"),t=n.compile(e);return t},renderNotifyFn:function(){var e=a.string.join('<div class="chat-sysbroadcast">','<div class="chat-sysbroadcast-header clearfix">','<a data-sysbroadcast="btn-close" class="chat-sysbroadcast-close" href="javascript:;" title="关闭">关闭</a>',"</div>",'<div class="chat-sysbroadcast-body clearfix">',"{{ if data.link }}",'<a href="{{ data.link }}" data-sysbroadcast="cont" class="chat-sysbroadcast-cont" target="_blank" title="{{ data.c }}">',"{{ data.c }}","</a>","{{ else }}",'<div data-sysbroadcast="cont" class="chat-sysbroadcast-cont" title="{{ data.c }}">',"{{ data.c }}","</div>","{{ /if }}","</div>","</div>"),t=n.compile(e);return t},renderImgFn:function(){var e=a.string.join('<div class="chat-sysbroadcast-imgad" {{if data.posid }} data-dysign={{data.posid}} {{/if}}>',"{{ if data.link }}",'<a href="{{ data.link }}" data-sysbroadcast="cont" class="chat-sysbroadcast-cont" target="_blank">','<img style="width: 335px; height: 116px;" src="{{ data.wis }}" title="{{ data.c }}" />',"</a>","{{ else }}",'<div data-sysbroadcast="cont" class="chat-sysbroadcast-cont">','<img style="width: 335px; height: 116px;" src="{{ data.wis }}" title="{{ data.c }}" />',"</div>","{{ /if }}","{{ if data.mtype == 1 }}",'<div class="chat-sysbroadcast-ad-flag">广告</div>',"{{ /if }}",'<a data-sysbroadcast="btn-close" class="chat-sysbroadcast-close" href="javascript:;" title="关闭">关闭</a>',"</div>"),t=n.compile(e);return t},bindEvents:function(){var e=this,a=e.doms.sysBroadcast;t.on("mod.broadcast.config.loaded",function(){e.flags.configLoaded=1,e.check()&&(e.flags.signLoaded?e.adQueue.push(1):e.setBroadcast())}),d.reg("room_data_brocast",function(t){var a=s.decode(t).too();window.removeSign||"rsm"==a.type&&(e.data.currentData=a,e.flags.detailLoaded=1,e.check()&&(e.flags.signLoaded?e.adQueue.push(1):e.setBroadcast()))}),a.on("click",'[data-sysbroadcast="btn-close"]',function(){var a=e.data.currentData;e.hideBroadcast(),a&&t.trigger("dys",{key:"dys.room.sysbroadcast.close",radio_type:parseInt(a.mtype,10)+1,radio_id:a.id})}),a.on("click",'a[data-sysbroadcast="cont"], [data-sysbroadcast="godetail"]',function(){var a=e.data.currentData;a&&t.trigger("dys",{key:"dys.room.sysbroadcast.click",radio_type:parseInt(a.mtype,10)+1,radio_id:a.id,jurl:1==a.jmptp?"":a.weburl,rid:1==a.jmptp?a.weburl:0})})},check:function(){return this.flags.configLoaded&&this.flags.detailLoaded},setBroadcast:function(){var e,t,a,s=this,n=s.data.roomId,o=s.storeNames.broadcasts,r=s.storeNames.broadcastlimit,l=s.config,d=s.timers,c=s.renders,u=s.data.currentData,g=u&&u.id,m=u&&u.t,p=(new Date).getTime();if(g&&u.clitp%2==1&&(2==m||3==m||4==m||5==m)){if(g&&(g=parseInt(u.id,10)),0!=l.frequency.time&&0!=l.frequency.count||i.remove(r),a=i.get(r),a||(a={}),a.showedTimes||(a.showedTimes=0,a.firstTime=(new Date).getTime()),0!=l.frequency.time&&0!=l.frequency.count)if(a.firstTime+6e4*l.frequency.time>p){if(a.showedTimes>=l.frequency.count)return}else a={showedTimes:0,firstTime:(new Date).getTime()};e=i.get(o),e||(e={}),s.flags.pageLoaded&&(s.flags.pageLoaded=0,e[n]=null,delete e[n]),t=e&&e[n],t&&l.sort[u.t]<l.sort[t.t]||(s.currentRender=function(){return""},1==u.jmptp?u.link="/"+u.weburl:u.link=u.weburl,u.wis?(u.wis=l.broadcast_img_prefix+u.wis,s.currentRender=c.renderImg):1==u.mtype?s.currentRender=c.renderAd:s.currentRender=c.renderNotify,clearTimeout(d.displayTime),s.flags.isShow&&s.hideBroadcast(),0!=l.delay?d.delayTime=setTimeout(function(){s.render(),clearTimeout(d.delayTime)},1e3*parseInt(l.delay,10)):s.render(),a.showedTimes++,e[n]=u,i.set(r,a),i.set(o,e,31536e3))}},render:function(){var t=this.data.currentData,a="";a=e.trim(this.currentRender({data:t})),a&&(this.doms.sysBroadcast.html(a),this.showBroadcast())},showBroadcast:function(){var e=this,a=e.timers,i=e.data.currentData,s=e.doms.sysBroadcast;t.trigger("dys",{key:"dys.room.sysbroadcast.show",radio_type:parseInt(i.mtype,10)+1,radio_id:i.id}),s.removeClass("hide").animate({bottom:90,opacity:1}),s.find('[data-sysbroadcast="cont"]').animate({height:"auto"},function(){e.flags.isShow=1,"0"!=i.distm&&(a.displayTime=setTimeout(function(){e.hideBroadcast()},1e3*i.distm||1500))})},hideBroadcast:function(){var e=this,t=e.doms.sysBroadcast,a=e.timers;clearTimeout(a.displayTime),t.animate({bottom:3,opacity:0}).find('[data-sysbroadcast="cont"]').animate({height:0},function(){e.flags.isShow=0,u.canShowBroadcast()})}},u={flag:!1,id:10014,init:function(){var e=this;t.on("direction.sign."+e.id,function(t){parseInt(t.posid,10)===e.id&&(c.flags.signLoaded=1,u.render(t))}),this.addEvent()},render:function(t){var a=this.buildComData(t),i="",s=t.srcid?c.renders.renderImg:c.renders.renderAd,n=t.ec||{},o=n.cd;if(n.text&&(a.c=n.text),this.isSignGapExpired(o)){if(i=e.trim(s({data:a})),!i)return void this.canShowBroadcast();c.doms.sysBroadcast.html(i),this.showSign(t),r.exposure()}},showSign:function(e){var t=this,a=c.doms.sysBroadcast;a.removeClass("hide").animate({bottom:90,opacity:1}),a.find('[data-sysbroadcast="cont"]').animate({height:"auto"},function(){t.displayTime=setTimeout(function(){t.hideSign()},1e3*e.ec.showtime||15e3)})},hideSign:function(){var e=this,t=c.doms.sysBroadcast;clearTimeout(e.displayTime),t.animate({bottom:3,opacity:0}).find('[data-sysbroadcast="cont"]').animate({height:0},function(){e.canShowBroadcast()})},canShowBroadcast:function(){c.flags.signLoaded=0,c.adQueue.length>0&&(c.adQueue.pop(),c.setBroadcast())},isSignGapExpired:function(e){var t=Number(e),a="sign_last_show",s=i.get(a);if(isNaN(t)||void 0===e||null===s)return i.set(a,+new Date),!0;var n=+new Date-s,o=1e3*t;return n>o?(i.set(a,+new Date),!0):!1},buildComData:function(e){var t={};return t.link=r.helper.innerLink(e),t.wis=e.srcid,t.c=e.adtitle,t.mtype=e.priority,t.posid=e.posid,t},addEvent:function(){e("#mainbody").on("click",".dysign-text-dot a",function(e){t.trigger("mod.sign.dot",10014)})}};return u.init(),{init:function(){c.init()}}}),define("douyu/page/room/normal/mod/super-recommended",["jquery","shark/observer","shark/util/lang/1.0","shark/util/cookie/1.0","shark/util/storage/1.0","shark/util/template/2.0","douyu/context","douyu/com/imgp","douyu/com/sign"],function(e,t,a,i,s,n,o,r,l){var d={getDayDiff:function(){var e=new Date,t=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate(),a=new Date(t);a.setDate(a.getDate()+1);var i=((a.getTime()-e.getTime())/1e3).toFixed(0);return parseInt(i)},getRandomNum:function(e,t){var a=t-e,i=Math.random();return e+Math.round(i*a)}},c={locstorage:{locname:"showsuperrmd"+(i.get("uid")||"no"),showsuper:1,storagetime:86400},tipstorage:{locname:"showtiprmd"+(i.get("uid")||"no"),showtip:1,storagetime:259200,storagetime2:d.getDayDiff()},listdata:[],ywlistdata:[],showtime:0,tiptime:18e4,showflag:0,togglefirst:1,dataflag:{rightPop:0,ywPop:1}},u={$win:e(window)},g={},m={},p={};return c.getdata=function(t){var a=$ROOM.room_id,i=$ROOM.cate_id,s="/roomrecomm/getrecommand";e.ajax(s,{data:{roomid:a,cateid:i},type:"get",dataType:"json",timeout:3e3,success:function(e){0==e.error&&(c.ywlistdata=e.data.fish)}})},c.getAdData=function(t){var a="30041,30042,30043,30044",i="/lapi/sign/signapi/getinfo",s=l.helper.buildSignApi(a);$SYS&&$SYS.sign_newver&&(i="/lapi/sign/web/getinfo"),e.ajax(i,{data:s,type:"POST",dataType:"json",timeout:3e3,success:function(e){0==e.error&&(c.listdata=e.data,c.locstorage.showsuper&&c.listdata.length>=4&&(l.helper.pushPageAdvar(e.data),setTimeout(function(){u.init(),g.init()},c.showtime)))}})},c.init=function(){var t=s.get(c.locstorage.locname),a=s.get(c.tipstorage.locname);c.locstorage.showsuper=e.isNumeric(t)?parseInt(t):1,c.tipstorage.showsuper=e.isNumeric(a)?parseInt(a):1;var i=d.getRandomNum(25,35);setTimeout(function(){c.getdata(c.dataflag.rightPop),c.getAdData(c.dataflag.rightPop)},1e3*i)},c.ywinit=function(){c.ywlistdata.length>=2&&(m.init(),p.init())},u.init=function(){u.$body=e("body"),u.$body.append(a.string.join('<div class="js-live-room-recommend" id="js-live-room-recommend">','<b class="super-rmd-bg tggcontrol"></b>','<b class="super-rmd-title tggcontrol"></b>','<div class="title tggcontrol">','<img src="'+$SYS.web_url+'app/douyu/res/page/room-normal/super-rmd/sg-rgrmd-top.png" />',"</div>",'<div class="list">',"</div>",'<div class="footer super-notshow" data-flag="1"><img src="'+$SYS.web_url+'app/douyu/res/page/room-normal/super-rmd/rgrmd-foot.png" /></div>',"</div>")),u.$recommend=e("#js-live-room-recommend"),u.$list=u.$recommend.find(".list"),u.$tggcontrol=u.$recommend.find(".tggcontrol"),u.$notshow=u.$recommend.find(".super-notshow"),u.$footer=u.$recommend.find(".footer"),u.mainObj.fitSize(),u.mainObj.renderData(),u.mainObj.keaiShow(1)},u.mainObj={getTemplate:function(){return'{{each items as value i}}<div class="list-item js-monitor-sign" title="{{value.ec.desc}}" data-dysign="{{value.posid}}" data-dysign-mid="{{value.mid}}" data-dysign-gid="{{value.gid}}">{{if value.type === "img" || value.ec.innerlink !== "1"}}<a target="_blank" href="{{value.link}}">{{/if}}<div class="room-img">{{if value.type === "img"}}<img data-original="{{value.srcid}}" src="'+$SYS.web_url+'app/douyu/res/page/list-item-def-thumb.gif" title="{{value.ec.desc}}"><div class="room-img-bg"></div>{{else}}<object type="application/x-shockwave-flash" data="{{value.srcid}}" width="100%" height="100%"></object>{{/if}}{{if value.priority === "1"}}<i class="sign-spec"></i>{{/if}}</div><div class="room-info" ><div class="room-type-name">{{value.ec.name}}</div><div class="room-title">{{value.ec.desc}}</div></div>{{if value.type === "img" || value.ec.innerlink !== "1"}}</a>{{/if}}</div>{{/each}}'},renderData:function(){var e=c.listdata.splice(0,4);for(var t in e)e[t].srcid&&-1!==e[t].srcid.indexOf("swf")?e[t].type="swf":e[t].type="img",e[t].srcid=l.helper.innerPath(e[t].srcid);var a=n.compile(u.mainObj.getTemplate()),i=a({items:e});u.$list.append(i),r.build()},toggle:function(){if(0==c.showflag&&c.togglefirst&&window.DYS&&l.exposure(),c.togglefirst=0,c.showflag){u.$recommend.removeClass("active").css({right:"-"+(u.$list.width()+6)+"px"}),c.showflag=0,u.mainObj.keaiShow(1);var e=u.$footer.attr("data-flag");1!=e&&u.mainObj.notShow()}else u.$recommend.addClass("active").css({right:"0px"}),setTimeout(function(){u.$recommend.trigger("scroll")},600),c.showflag=1,u.mainObj.keaiShow(0)},keaiShow:function(e){e?(setTimeout(function(){u.$recommend.find(".super-rmd-title").stop().animate({left:"-66px"},600)},300),setTimeout(function(){u.$recommend.find(".super-rmd-bg").stop().animate({height:"99px",top:"-10px"},1e3)},600)):(u.$recommend.find(".super-rmd-bg").stop().css({height:"0px",top:"65px"}),u.$recommend.find(".super-rmd-title").stop().css("left","0px"))},fitSize:function(){var e=u.$win.height(),t=565,a=(e-t)/2;78>a&&(a=78),565>e?u.$recommend.css({top:"0px",display:"block"}):u.$recommend.css({top:a.toFixed(0)+"px",display:"block"})},notShow:function(){s.set(c.locstorage.locname,0,c.locstorage.storagetime),u.$recommend.hide()}},u.tipObj={showTip:function(){c.tipstorage.showsuper&&setTimeout(function(){c.showflag||(u.$tip.show(),u.$tip.find("button").click(function(){u.mainObj.toggle(),t.trigger("dys",{key:"dys.room.superrecommand.read"})}),u.$tip.find("a.rmd-tip-notshow").click(function(e){u.$tip.hide(),e.stopPropagation(),e.preventDefault(),t.trigger("dys",{key:"dys.room.superrecommand.nomoreshow.click"})}),u.$tip.find(".rmd-tip-close").click(function(e){u.$tip.hide()}),s.set(c.tipstorage.locname,0,c.tipstorage.storagetime),c.tipstorage.showsuper=0,t.trigger("dys",{key:"dys.room.superrecommand.show"}))},c.tiptime)},hideTip:function(){c.tipstorage.showsuper||(u.$tip.hide(),s.set(c.tipstorage.locname,0,c.tipstorage.storagetime2),c.tipstorage.showsuper=0)}},g.init=function(){u.$tggcontrol.click(function(){u.mainObj.toggle()}),u.$notshow.click(function(e){var t=u.$footer.attr("data-flag");1==t?(u.$footer.attr("data-flag",0),u.$footer.find("img").attr("src",$SYS.web_url+"app/douyu/res/page/room-normal/super-rmd/rgrmd-foot-select.png")):(u.$footer.attr("data-flag",1),u.$footer.find("img").attr("src",$SYS.web_url+"app/douyu/res/page/room-normal/super-rmd/rgrmd-foot.png"))}),window.DYS&&u.$list.find(".list-item").each(function(a){var i=this;e(i).click(function(s){var n=($ROOM.room_id,e(i).find("a").attr("data-roomid"));e(i).find("a");t.trigger("dys",{key:"dys.room.recommand.click",rid:n,pg:1,pos:a+1})})}),u.$win.resize(function(){u.mainObj.fitSize()}),e("#js-live-room-recommend").on("click",".js-monitor-sign a",function(){var a=e(this).closest(".js-monitor-sign").data("dysign");t.trigger("mod.sign.dot",a)})},m.init=function(){var i=a.string.join('<div class="rmd-rooms">','<div class="rmd-rooms-title"></div>','<ul class="rmd-rooms-list clearfix">',"</ul>","</div>");if(m.$ywrmdroom=e("#js-yw-rmd-rooms"),m.$ywrmdroom.find(".rmd-rooms").length<=0&&m.$ywrmdroom.html(i),m.$ywrmdlist=e("#js-yw-rmd-rooms").find("ul.rmd-rooms-list"),m.mainObj.renderData(),window.DYS){$ROOM.room_id;m.$ywrmdlist.find("li").each(function(a){var i=this,s=e(i).find("a").attr("data-roomid"),n=e(i).attr("data-cateid"),o=e(i).find("a");t.trigger("dys",{key:"dys.room.recommand.show",rid:s,rt:o.data("rt"),sub_rt:o.data("sbrt"),tid:n,pg:1,pos:a+1})})}},m.mainObj={getTemplate:function(){return'{{each items as value i}}<li title="{{value.title}}"><a target="_blank" href="/{{value.roomid}}" data-rt="{{value.ranktype}}" data-sbrt="{{value.recomType}}" data-cateid="{{value.cateid}}" data-roomid="{{value.roomid}}"><div class="rmd-room"><div class="rmd-room-img"><b></b><img  data-original="{{value.roompic}}" src="'+$SYS.web_url+'app/douyu/res/page/list-item-def-thumb.gif" title="{{value.title}}"></div><div class="rmd-room-title" >{{value.title}}</div></div></a></li>{{/each}}'},renderData:function(){var e=c.ywlistdata.slice(0,2),t=n.compile(m.mainObj.getTemplate()),a=t({items:e});m.$ywrmdroom.parent(".yw-collect-box").addClass("ywrmd"),m.$ywrmdlist.html(a),r.build()},rmdRefresh:function(){e("#js-yw-rmd-rooms").find(".rmd-rooms").length<=0&&c.ywlistdata.length>=2&&(m.init(),p.init())}},p.init=function(){window.DYS&&m.$ywrmdlist.find("a").each(function(a){var i=this;e(i).click(function(s){var n=($ROOM.room_id,e(i).attr("data-roomid")),o=e(i).attr("data-cateid"),r=e(i);t.trigger("dys",{key:"dys.room.recommand.click",rid:n,rt:r.data("rt"),sub_rt:r.data("sbrt"),tid:o,pg:1,pos:a+1})})})},{init:function(){c.init()},ywinit:function(){c.ywinit()},ywRmdRefresh:function(){m.mainObj.rmdRefresh()}}}),define("douyu/page/room/normal/mod/bonus",["jquery","douyu/page/room/base/api","shark/util/flash/data/1.0","shark/observer","shark/util/template/1.0","douyu/com/user","douyu/context","shark/ext/swfobject","shark/util/storage/1.0","douyu/page/room/normal/mod/chat-msg-tmp"],function(e,t,a,i,s,n,o,r,l,d){var c=e("#js-color-barrage"),u=null,g=e("#js-chat-cont"),m=null,p="bonus-swf",f=0,h=9,v=180,b=null,y=null,k=!1,w="bonusId",_="/member/cp",x=!1,T={init:function(s){var n=this;s&&(x=s,g=e("#js-live-room-normal-right"),g.addClass("diy-bonus"),i.on("mod.chat.gift.layout",function(){n.updateStatus(),m&&m.css({bottom:e("#js-chat-speak").outerHeight()})})),i.on("mod.chat.bonus.call",function(e){n.dispatch(e)}),t.reg("room_data_sabonus",function(e){n.dispatch(e)}),t.reg("room_data_sabonusget",function(e){var t,s=a.decode(e).too();return"ggbr"===s.type&&n.updateBonus(s),"ggbb"===s.type&&(t=d.peck(e),s.did!=o.get("sys.uid")&&i.fire("mod.chat.msg.shield").message)?!1:void(t&&i.trigger("mod.chat.msg.msg",t))}),t.reg("room_data_login",function(e){if(null!=o.get("sys.uid")||null!=o.get("sys.username")){var t=a.decode(e).too();0==t.ps&&0==t.es?_="/member/cp":0==t.es?_="/member/cp/changeEmail":0==t.ps?_="/member/cp/cpBindPhone":k=!0}})},updateStatus:function(){g.addClass("diy-bonus-no-notice"),m&&m.find(".bonus-outer,#bonus-video").removeAttr("style")},render:function(t){var a=this,s=parseInt(t.stl,10),n="",o=null;return n=l.get(w),t.rpid==n?!1:-v>=s?!1:(0==c.next(".bonus-handle").size()&&(u=e(a.getHandleTmpl()),c.after(u)),0==g.find(".bonus-box").size()&&(m=e(a.getBonusboxTmpl()),g.append(m),i.trigger("mod.chat.gift.layout")),y=m.find(".bonus-holder"),a.bindEvent(),setTimeout(function(){a.wait(t)},f),void(o=setInterval(function(){s--,-v>=s&&(clearInterval(o),a.destroy())},1e3)))},wait:function(t){var a=this,i=1e3*parseInt(t.stl,10),s=Math.random()*h*1e3;y.html(a.getWaitTmpl()),i-f>=1e3*-v?e('[data-loading="bonus"]').stop().animate({width:"100%"},{duration:s,queue:!0,complete:function(){a.count(t)}}):a.destroy()},count:function(t){var a=this,i=null,s=parseInt(t.stl,10);u.removeClass("status-wait").addClass("status-count"),y.html(a.getCountTmpl()),i=e("[data-count='bonus']"),b&&clearInterval(b),s>=0?(i.text(a.dateFormat(s,"mm:ss")),b=setInterval(function(){s--,0>=s?(clearInterval(b),b=null,a.ready(t)):i.text(a.dateFormat(s,"mm:ss"))},1e3)):a.ready(t)},ready:function(e){var t=this,a=s.compile(t.getReadyTmpl());y.off("click.bonusHolder"),m.removeClass("bonus-complete"),y.html(a(e)),u.removeClass("status-count").addClass("status-ready"),y.off("click.bonus").on("click.bonus",".bonus-action",function(){t.checkUser()&&t.getBonus(e)})},checkUser:function(){var t=!0;if(!n.check())return n.show("login"),t=!1;if(!k){var a=e(".bind-miss-panel");a.show(),a.find(".bind-miss-close").off("click.bonus").on("click.bonus",function(){a.hide()}).end().find(".txt-ar a").off("click.bonus").on("click.bonus",function(){window.open(_)}),t=!1}return t},getBonus:function(e){var i=y.find("[data-pid]"),s=a.encode([{name:"type",value:"ggbq"},{name:"rpid",
value:i.data("pid")},{name:"rid",value:$ROOM.room_id},{name:"rpt",value:3}]);t.exe("js_GetHongbao",s)},updateBonus:function(e){var t=this,a=null,n=parseInt(e.sl,10);return l.set(w,e.rpid,v),(a=n?s.compile(t.getSuccessTmpl()):s.compile(t.getFailureTmpl()))?(m.addClass("bonus-complete"),y.html(a(e)),u.removeClass("status-ready").addClass("status-opened"),i.trigger("mod.userinfo.change",{change:{silver:n}}),m.on("click",".bonus-close",function(){t.destroy()}),void DYS.submit({point_id:"5.14.1.0",ext:{yw:n?n:0}})):!1},getHandleTmpl:function(){return['<div class="bonus-handle status-wait fl">','<a href="javascript:;" class="status-bar status-wait"></a>','<a href="javascript:;" class="status-bar status-count" data-count="bonus"></a>','<a href="javascript:;" class="status-bar status-ready"><i></i></a>','<a href="javascript:;" class="status-bar status-opened"></a>',"</div>"].join("")},getBonusboxTmpl:function(){return['<div class="bonus-effect">','<div id="bonus-swf"></div>','<div class="bonus-outer"><div class="bonus-box">','<a class="bonus-close" href="javascript:;"></a>','<div class="bonus-holder"></div>','</div><div class="bonus-backend"></div><div class="bonus-front"></div>',"</div></div>"].join("")},getWaitTmpl:function(){return['<i class="icon-bonus-wait"></i>','<div class="bonus-bar">','<span data-loading="bonus" class="loading-bar-big">',"<strong></strong><b></b><em></em>",'<span class="lts"></span><span class="rts"></span>',"</span>","</div>红包加载中..."].join("")},getCountTmpl:function(){return['<i class="icon-bonus-count"></i>','<div class="count-panel">',"<h3>红包发放剩余时间</h3>",'<span data-count="bonus"></span>',"</div>"].join("")},getReadyTmpl:function(){return['<i class="icon-bonus-ready"></i>',"<div>",'<div class="bind-miss-panel">','<a class="bind-miss-close" href="javascript:;"></a>',"<div><em>绑定手机和邮箱后</em>才可以领取红包哦</div>",'<div class="txt-ar"><a href="javascript:;">立即绑定</a></div>',"</div>",'<a href="javascript:;" data-pid="<%=rpid%>" class="bonus-action"></a>',"</div>"].join("")},getSuccessTmpl:function(){return['<h3 class="success-title">恭喜您领取到了</h3>','<div class="bonus-tip">','<span class="yw-count"><%=sl%></span>个鱼丸',"</div>",'<i class="icon-bonus-success"></i>',"<em>鱼丸已打入您的账户</em>"].join("")},getFailureTmpl:function(){return['<h3 class="failure-title">手慢了</h3>',"<span>红包已被领完</span>",'<i class="icon-bonus-failure"></i>'].join("")},dateFormat:function(e,t){var a="";if(!e||isNaN(e))return a;var i=parseInt(e,10),s=parseInt(i%60),n=parseInt(i/60%60),o=parseInt(i/3600%60),r=parseInt(i/216e3%24);return r=r>9?r:"0"+r,o=o>9?o:"0"+o,n=n>9?n:"0"+n,s=s>9?s:"0"+s,t=t.replace("DD",r),t=t.replace("hh",o),t=t.replace("mm",n),t=t.replace("ss",s),a=t},bonusToggle:function(){m.toggle(),u.toggle(),DYS.submit({point_id:"5.14.2.0",ext:{tg:m.is(":visible")?1:0}})},bindEvent:function(){var t=this;u.off("click.bonus").on("click.bonus",function(){t.bonusToggle()}),m.off("click.bonus").on("click.bonus",".bonus-close",function(){e(this);t.bonusToggle()}),y.off("click.bonusHolder").on("click.bonusHolder",function(){var t=e(this).find(".tip_notime");t.size()<1?e(this).append("<div class='tip_notime'>还未到领取时间，请耐心等待哦</div>").find(".tip_notime").show(100).delay(2e3).hide(100):"none"==t.css("display")&&t.show(100).delay(2e3).hide(100)})},destroy:function(){b&&clearInterval(b),u&&u.off("click.bonus").remove(),m&&m.off("click.bonus").remove()},animate:function(){var t={},a={},i=null,s={};a.quality="high",a.bgcolor="#000",a.allowscriptaccess="always",a.allowfullscreen="true",a.allowFullScreenInteractive="true",a.wmode="transparent",s.id="bonus-video",s.name="bonus-video",s.align="middle",s.autoplay=!0,s.loop=!1,r.embedSWF(o.get("sys.res_url")+"douyu/images/bonus/bonus.swf?20160602",p,"325","475","11","",t,a,s),i=e("#"+s.id),m.find(".bonus-outer").hide().delay(f).show(0,function(){i.remove()}),i.on("mousedown contextmenu",function(e){return!1})},getBonusInfo:function(e){var t=null,i=[];if(e.list&&""!=e.list){i=e.list.split("/|/");for(var s=0,n=i.length;n>s;s++)if(""!=n[s]){var o=a.decode(i[s]).too();if("3"==o.rpt){t=o;break}}}return t},dispatch:function(e){var t=a.decode(e).too(),i=null,s=this;switch(t.type){case"ccrp":f=7e3,s.destroy(),s.render(t),s.animate();break;case"memberinfores":s.destroy(),f=0,i=s.getBonusInfo(t),i&&s.render(i)}}};return{init:function(e){T.init(e)}}}),define("douyu/page/room/normal/mod/layertip",["jquery","shark/observer","shark/util/storage/1.0","douyu/context"],function(e,t,a,i){var s={expiresdays:6,storageValue:!0,tipConfig:["followAnchor","paytask"],tipShow:!0},n={init:function(){this.listen()},render:function(e,t){e&&t&&(this.removeTip(t),e.append(t),this.showTip(t))},handleTip:function(e){var t=this,a=e.$el,i=e.$tip,s=e.closeEleClassName,n=e.handleFn;t.render(a,i),t.bindCloseEvent(i,s),n()},removeTip:function(e){e&&e.length>0&&e.remove()},showTip:function(e){e&&e.fadeIn()},hideTip:function(e){e&&e.fadeOut()},getRestTime:function(e,t){var a=new Date(e),i=0;return t=parseInt(t),t=t?t:0,a.setDate(a.getDate()+t),a.setHours(24),a.setMinutes(0),a.setSeconds(0),i=a.getTime()-(new Date).getTime()},getStorage:function(e){return a.get(e)},setStorage:function(e,t,i){a.set(e,t,i)},bindCloseEvent:function(e,t){var a=this;e&&t&&e.on("click",t,function(){a.hideTip(e)})},isInConfig:function(e){var t=s.tipConfig,a=!1,i=0,n=t.length;for(i=0;n>i;i++)t[i]===e&&(a=!0);return a},listen:function(){var a=this;t.on("mod.layer.tips.render",function(t){var i=t.storagename,n=e.isFunction(t.handleFn)?t.handleFn:function(){},o=a.getRestTime((new Date).getTime(),s.expiresdays),r=t.$tip,l=t.$el,d=t.storageValue||s.storageValue,c={$el:l,$tip:r,closeEleClassName:t.closeEleClassName||"",handleFn:n};if(r&&l&&s.tipShow){if(i&&a.getStorage(i))return;i&&!a.getStorage(i)?(a.handleTip(c),a.isInConfig(i)&&(s.tipShow=!1),a.setStorage(i,d,o/1e3)):i||a.handleTip(c)}}),t.on("mod.layer.tips.hide",function(e){var t=e.$tip;t&&a.hideTip(t)})}};e(function(){n.init()})}),define("douyu/page/room/normal/mod/room-menu-startup",["jquery","shark/class","shark/observer","shark/util/template/1.0","shark/util/lang/1.0","shark/util/cookie/1.0","douyu/context"],function(e,t,a,i,s,n,o){var r=t({init:function(t){this.$target=e("#J_anchorandsupermenu"),this.menuContainerRender(),this.$anchorMenuBox=this.$target.find(".live-group-box"),this.anchorMenuRender(),require.use(["douyu/page/room/normal/mod/menu"],function(){a.trigger("mod.normal.menu.starup.ready")})},anchorMenuRender:function(){var e=this.makeAnchorMenuHtml();this.$anchorMenuBox.append(e)},makeAnchorMenuHtml:function(){var e=$COLLIGATE.show_ban_keywords,t=$ROOM.room_label_right_flag,a=s.string.join("<li>",'<div class="btn-in-btns btn-plug-flow hide" data-live-group="pushflow">','<span class="group-btn-icon"></span>',"<span>推流码</span>","</div>","</li>","<li>",'<a href="javascript:;" class="btn-in-btns btn-anchor-score hide" data-live-group="anchorScore">','<span class="group-btn-icon"></span>',"<span>主播积分<em></em></span>","</a>",'<div class="group-btns-pop anchor-score-pop pop-left" data-live-group="anchorTips">','<span class="group-pop-arrow1"></span>','<span class="group-pop-arrow2"></span>','<a href="javascript:;" class="pop-close-btn"></a>','<div class="btn-pop-info">','<h3>请遵守<span class="highlight-orange">直播规范</span></h3>',"<p>创建良好网络环境</p>","</div>","</div>","</li>","<li>",'<div class="btn-in-btns btn-issue-state hide" data-live-group="publish">','<span class="group-btn-icon"></span>',"<span>发布动态</span>","</div>",'<div class="group-btns-pop issue-state-pop hide" data-live-group="publishtip">','<span class="group-pop-arrow1"></span>','<span class="group-pop-arrow2"></span>','<a href="javascript:;" class="pop-close-btn"></a>','<div class="btn-pop-info">','<h3>在此<span class="highlight-orange">发布动态</span></h3>',"<p>向水友分享新鲜事</p>","</div>","</div>","</li>",'<li class="even-wheat-pk-btn">','<div class="btn-in-btns even-wheat-pk hide" data-live-group="evenWheatPK">','<span class="group-btn-icon"><em class="even-wheat-news"></em></span>',"<span>PK邀请</span>","</div>","</li>",'<li class="draw-pop-tips-btn">','<div class="btn-in-btns btn-draw hide" data-live-group="draw">','<span class="group-btn-icon"></span>',"<span>抽奖</span>","</div>",'<div class="draw-pop pop-right hide" data-live-group="drawTips">','<div class="draw-pop-circle"></div>','<div class="draw-pop-btn"></div>','<div class="pop-close-btn"></div>',"</div>","</li>","<li>",'<div class="btn-in-btns btn-charge-task hide" data-live-group="energy-charge-btn">','<span class="group-btn-icon"></span>',"<span>充能任务</span>","</div>",'<div class="group-btns-pop charge-task-pop pop-right hide" data-energy-charge="energy-charge-tips">','<span class="group-pop-arrow1"></span>','<span class="group-pop-arrow2"></span>','<a href="javascript:;" class="charge-pop-close" data-energy-charge="popTips-close">x</a>','<div class="charge-pop-title"></div>','<div class="charge-pop-left"></div>','<div class="charge-pop-diver"></div>','<div class="charge-pop-right">','<div class="charge-pop-content">',"<span>亲密任务</span>上线了！<br>","这一次让你的表演<br>","<span>有价可循！</span>","</div>",'<div class="charge-pop-start js-charge-pop-start"></div>',"</div>","</div>","</li>","<li>",'<div class="btn-in-btns btn-cps hide" data-live-group="cps-btn">','<span class="group-btn-icon"></span>',"<span>手游推广计划</span>","</div>",'<div class="group-btns-pop cps-pop pop-right hide" data-cps="cps-tips" style="display: block;">','<span class="group-pop-arrow1"></span>','<span class="group-pop-arrow2"></span>','<a href="javascript:;" class="pop-close-btn" data-cps="popTips-close"></a>','<div class="btn-pop-info">','<h3><span class="highlight-orange">手游推广计划</span></h3>',"<p>海量优质手游合作项目，分享游戏分成收益，将自身流量稳定变现</p>","</div>","</div>","</li>","<li>",'<div class="btn-in-btns btn-won-moment hide"><span class="group-btn-icon"></span><span>精彩时刻</span> <em>Shift+C</em> </div>',"</li>","<li>",'<div class="btn-in-btns btn-play-remind hide" data-live-group="broadcast">','<span class="group-btn-icon"></span>',"<span>开播提醒</span>","</div>","</li>","<li>",'<div class="btn-in-btns btn-bid-extend cur hide" data-live-group="anchorPrice">','<span class="group-btn-icon"><em class="bid-extend-news"></em></span>',"<span>推广直播间</span>","</div>","</li>","<li>",'<div class="btn-in-btns btn-play-swicth hide" data-live-group="liveswitch">','<span class="group-btn-icon"></span>',"<span>直播开关</span>","</div>","</li>","<li>",'<div class="btn-in-btns btn-group-more" data-live-group="more">','<span class="group-btn-icon"></span>',"<span>更多</span>","</div>",'<div class="group-btns-pop sheild-keyword-pop" data-live-group="keyTips">','<span class="group-pop-arrow1"></span>','<span class="group-pop-arrow2"></span>','<a href="javascript:;" class="pop-close-btn"></a>','<div class="btn-pop-info">',"<p>快来试试！可以设置</p>",'<p><span class="highlight-orange">关键词屏蔽</span><span>啦！</span></p>',"</div>","</div>",'<dl class="btn-more-drop" data-live-group="more-menu">','<dd class="more-drop-arrow">','<i class="more-drop-arrow1"></i>','<i class="more-drop-arrow2"></i>',"</dd>","<dd>",'<div class="btn-in-btns btn-sheild-keyword hide" data-is-show="<%= showBanKeywords %>" data-live-group="keyShield">','<span class="group-btn-icon"></span>',"<span>关键词屏蔽</span>","</div>","</dd>","<dd>",'<div title="用户观看视频需要输入密码才能观看" class="btn-in-btns btn-set-password hide" data-live-group="password">','<span class="group-btn-icon"></span>',"<span>设置直播密码</span>","</div>","</dd>","<dd>",'<div class="btn-in-btns btn-tag-blacklist hide" data-is-show="<%= showTagBlacklist %>" data-live-group="tagBlacklist">','<span class="group-btn-icon"></span>',"<span>标签黑名单</span>","</div>","</dd>","<dd>",'<div class="btn-in-btns btn-barcode hide" data-live-group="extCode">','<span class="group-btn-icon"></span>',"<span>推广二维码</span>","</div>","</dd>","<dd>",'<div class="btn-in-btns btn-auto-contribute hide" data-live-group="autorec">','<span class="group-btn-icon"></span>',"<span>自动投稿</span>","</div>",'<div class="group-btns-pop auto-contribute-pop hide" data-live-group="autorectip">','<span class="group-pop-arrow1"></span>','<span class="group-pop-arrow2"></span>','<a href="javascript:;" class="pop-close-btn"></a>','<div class="btn-pop-info">','<p><span class="highlight-orange2">开启自动投稿</span>后，您的直播录像会发布到斗鱼视频。人气涨涨涨收入翻翻翻，就趁现在！</p>',"</div>","</div>","</dd>","</dl>","</li>"),n=i.compile(a),o=n({showBanKeywords:e,showTagBlacklist:t});return o},menuContainerRender:function(){var e=this.$target,t=this.makeMenuContainerHtml();e.html(t)},makeMenuContainerHtml:function(){var e,t="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;e=t?'<div class="pc-client-guide-wrap hide mac-client-guide-wrap" id="pc-client-guide"><a href="/client?platform=4" target="_blank"><div class="pc-client-version">NEW</div><div class="pc-client-main"></div></a></div>':'<div class="pc-client-guide-wrap hide" id="pc-client-guide"><a href="/client?platform=3" target="_blank"><div class="pc-client-version">NEW</div><div class="pc-client-main"></div><p class="pc-client-text">主播定制已上线</p></a></div>';var a=['<ul class="live-group-box">','<li class="room-control-box">','<div class="btn-in-btns btn-room-control hide" data-live-group="super-btn">','<span class="group-btn-icon"></span>',"<span>房间管理<em></em></span>",'<dl class="room-control-drop" data-live-group="super-list">',"</dl>","</div>","</li>","</ul>"+e].join("");return a}});return{init:function(e){return new r(e)}}}),define("douyu/page/room/normal/mod/receive-info",["jquery","shark/observer","shark/util/template/2.0","shark/util/lang/1.0","shark/util/cookie/1.0","douyu/context"],function(e,t,a,i,s,n){var o="手动填写",r={dys:function(e){t.trigger("dys",e)}},l={_data_:{allData:{},allProv:[],regionIds:[],regionArea:[]},flag:{select_flag:0},doms:{},init:function(e){var t=this;this.flag.select_flag||(this.hasBoxReady()?this.show2hide():this.getRegionInfo(function(a){t.inputToSelect(e),t.render(),t.bindEvent()}))},hasBoxReady:function(){return e(".regioninfo-box").find(".area-info").length>0},show2hide:function(){"block"==e(".regioninfo-box").css("display")?this.toggleBox(!1):this.toggleBox(!0)},getRegionInfo:function(t){var a=this,i=n.get("sys.web_url");a.flag.select_flag=1,e.ajax({url:i+"/app/douyu/js/page/room/normal/mod/provincelist.json",type:"GET",dataType:"json",success:function(e){a.flag.select_flag=0,a._data_.allData=e.region,t(e.region)},error:function(){a.flag.select_flag=0}})},render:function(){var t=e(".regioninfo-box"),s=i.string.join('<div class="area-info">','<ul class="nav">','<li data-type="1" class="active">请选择</li>','<li data-type="2">请选择</li>','<li data-type="3">请选择</li>',"</ul>",'<div class="content">','<div data-node="province" data-type="1" class="space active"></div>','<div data-node="city"data-type="2" class="space"></div>','<div data-node="country"data-type="3" class="space"></div>',"</div>","</div>"),n=a.compile(s);t.append(n()),this.toggleBox(!0),this.domReadyFunc(),this.renderProv(),this.renderCity(),this.renderCont()},domReadyFunc:function(){this.doms.$el=e(".regioninfo-box"),this.doms.$province=this.doms.$el.find('[data-node="province"]'),this.doms.$citynode=this.doms.$el.find('[data-node="city"]'),this.doms.$country=this.doms.$el.find('[data-node="country"]'),this.doms.$content=this.doms.$el.find(".area-info .content"),this.doms.$areainfo=this.doms.$el.find(".area-info")},renderProv:function(){var e=this,t=e._data_.regionIds[0],s=e._data_.allProv.length>0?e._data_.allProv:e.selectProvis(),n=i.string.join("{{ each data as item index }}","{{ if item.provid == idx }}",'<span data-id="{{index}}" data-provid="{{item.provid}}" class="choose">{{item.proval}}</span>',"{{ /if }}","{{ if item.provid != idx }}",'<span data-id="{{index}}" data-provid="{{item.provid}}">{{item.proval}}</span>',"{{ /if }}","{{ /each }}"),o=a.compile(n);this.doms.$province.html(o({data:s,idx:t})),this.doms.$content.mCustomScrollbar("destroy").mCustomScrollbar()},renderCity:function(){var e=this,t=e._data_.regionIds[1],s=e._data_.regionIds[0],n=e.selectCitys(s),o=i.string.join("{{ each data as item index }}","{{ if item.cityid == idx }}",'<span data-id="{{index}}" data-cityid="{{item.cityid}}" data-parent="{{item.parentId}}" class="choose">{{item.cityval}}</span>',"{{ /if }}","{{ if item.cityid != idx }}",'<span data-id="{{index}}" data-cityid="{{item.cityid}}" data-parent="{{item.parentId}}">{{item.cityval}}</span>',"{{ /if }}","{{ /each }}"),r=a.compile(o);this.doms.$citynode.html(r({data:n,idx:t})),this.doms.$content.mCustomScrollbar("destroy").mCustomScrollbar()},renderCont:function(e,t){var s=this,n=s._data_.regionIds[2],o=s._data_.regionIds[1],r=s._data_.regionIds[0],l=s.selectCountrys(r,o),d=i.string.join("{{ each data as item index }}","{{ if item.counid == idx }}",'<span data-id="{{index}}" data-counid="{{item.counid}}" data-parent="{{item.parentId}}" class="choose">{{item.counval}}</span>',"{{ /if }}","{{ if item.counid != idx }}",'<span data-id="{{index}}" data-counid="{{item.counid}}" data-parent="{{item.parentId}}">{{item.counval}}</span>',"{{ /if }}","{{ /each }}"),c=a.compile(d);this.doms.$country.html(c({data:l,idx:n})),this.doms.$content.mCustomScrollbar("destroy").mCustomScrollbar()},bindEvent:function(){var t=this;t.doms.$el.on("click","[data-provid]",function(a){a.stopPropagation();var i=e(this).attr("data-provid"),s=e(this).text(),n=e(this).attr("data-id");return t._data_.regionIds[0]=i,t._data_.regionArea[0]=s,0==i?(t.toggleBox(!1),t._data_.regionIds[0]=0,t._data_.regionArea[0]=s,t._data_.regionIds[1]=0,t._data_.regionArea[1]="",t._data_.regionIds[2]=0,t._data_.regionArea[2]="",void t.selectToInput()):(t.setAreaChoose(t.doms.$province,n),t.setTabName(1,s),t.changeTabs(2),void t.renderCity())}).on("click","[data-cityid]",function(a){a.stopPropagation();var i=e(this).attr("data-parent"),s=e(this).attr("data-cityid"),n=e(this).text(),o=e(this).attr("data-id");t._data_.regionIds[1]=s,t._data_.regionArea[1]=n,t.setAreaChoose(t.doms.$citynode,o),t.setTabName(2,n),t.changeTabs(3),t.renderCont(i,s)}).on("click","[data-counid]",function(a){a.stopPropagation();var i=e(this).attr("data-counid"),s=e(this).text(),n=e(this).attr("data-id");t._data_.regionIds[2]=i,t._data_.regionArea[2]=s,t.setAreaChoose(t.doms.$country,n),t.toggleBox(!1),t.selectToInput()}).on("click",".nav li",function(a){a.stopPropagation();var i=e(this).attr("data-type");t.changeTabs(i)})},toggleBox:function(t){1==t?e(".regioninfo-box").show():e(".regioninfo-box").hide()},selectToInput:function(){var e=this;if(0==e._data_.regionIds[0])var t="0/0/0",a="其他";else{var t=e._data_.regionIds.join("/"),a=e._data_.regionArea.join("/");a.indexOf(o)>0?a=a.substring(0,a.length-5):""}d.setUserArea(t,a)},inputToSelect:function(e){var t=this;e.id&&(t._data_.regionIds=e.id.split("/"),t._data_.regionArea=e.value.split("/"))},changeTabs:function(e){this.doms.$areainfo.find(".nav li").removeClass("active"),this.doms.$areainfo.find(".nav li[data-type="+e+"]").addClass("active"),this.doms.$areainfo.find(".content [data-type]").removeClass("active"),this.doms.$areainfo.find(".content [data-type="+e+"]").addClass("active")},setAreaChoose:function(e,t){e.find("span").removeClass("choose"),e.find("span[data-id="+t+"]").addClass("choose")},setTabName:function(e,t){this.doms.$areainfo.find(".nav li[data-type="+e+"]").text(t)},selectProvis:function(){function e(e,t){return e.provid-t.provid}for(var t=this._data_.allData,a=[],i=[],s=[],n=0;n<t.length;n++)1==t[n].parentId?i.push({provid:t[n].value,proval:t[n].label}):0==t[n].parentId?s.push({provid:t[n].value,proval:t[n].label}):a.push({provid:t[n].value,proval:t[n].label});return a.sort(e),i.sort(e),this._data_.allProv=a.concat(i).concat(s),this._data_.allProv},selectCitys:function(e){for(var t=this._data_.allData,a=[],i=0;i<t.length;i++)if(t[i].value==e)for(var s=t[i].children?t[i].children:[],n=0;n<s.length;n++)a.push({cityid:s[n].value,cityval:s[n].label,parentId:s[n].parentId});return a},selectCountrys:function(e,t){for(var a=this._data_.allData,i=[],s=0;s<a.length;s++)if(a[s].value==e)for(var n=a[s].children,r=0;r<n.length;r++)if(n[r].value==t)for(var l=n[r].children.length>0&&n[r].children[0].value?n[r].children:[{value:0,label:o,parentId:t}],d=0;d<l.length;d++)i.push({counid:l[d].value,counval:l[d].label,parentId:l[d].parentId});return i}},d={API:{getAddress:"/member/lottery/get_receiver_address_info",sendAddress:"/member/lottery/send_receiver_address",getCsrfCookie:"/curl/csrfApi/getCsrfCookie"},tab_type:1,doms:{},init:function(e){var t=this;this.getBoxInfo(e.id,function(a){t.render({id:e.id,prize:e.prize,data:a}),t.bindEvent()})},hasReciveInfoReady:function(){return e(".receinfo-box-wrapper").length>0},getBoxInfo:function(t,a){e.ajax({url:this.API.getAddress,data:{activity_id:t},type:"GET",dataType:"json",success:function(e){if(0==e.error){var t={reality_addr_info:{},virtual_addr_info:{}};e.data.reality_addr_info&&(t.reality_addr_info=e.data.reality_addr_info),e.data.virtual_addr_info&&(t.virtual_addr_info=e.data.virtual_addr_info),a&&a(t)}}})},render:function(t){this.hasReciveInfoReady()||e("body").append('<div class="receinfo-box-wrapper"></div>');var s=i.string.join('<div class="box-container">','<div class="header">','<p class="text">收货信息：</p>','<p class="jiangpin" data-id="{{id}}">奖品：<span>{{prize}}</span></p>','<div class="header-icon"></div>','<div class="close-icon"></div>',"</div>",'<div class="body">','<div class="title">选择您的奖品类型</div>','<div class="tab-info">','<ul class="nav">','<li class="shiwu active" data-type="1"></li>','<li class="xuni" data-type="2"></li>',"</ul>",'<div class="content">','<div data-type="1" class="space active" data-addrid="{{data.reality_addr_info.addr_id}}">','<div class="line">',"<span>*收货人：</span>",'<div class="right-bl"><input type="text" maxlength="32" name="username" value="{{data.reality_addr_info.name}}" /></div>',"</div>",'<div class="line">',"<span>*所在地区：</span>",'<div class="right-bl"><div class="select-area" name="userarea" data-regionid="{{data.reality_addr_info.region_id}}" data-val="{{data.reality_addr_info.area}}">{{data.reality_addr_info.area}}</div></div>',"</div>",'<div class="line">',"<span>*详细地址：</span>",'<div class="right-bl"><textarea class="area1" name="useraddr">{{data.reality_addr_info.addr}}</textarea></div>',"</div>",'<div class="line">',"<span>*联系电话：</span>",'<div class="right-bl"><input type="text" maxlength="15" name="userphone" value="{{data.reality_addr_info.mobile}}" /></div>',"</div>","{{ if data.reality_addr_info.display_identity }}",'<div class="line">',"<span>*身份证号：</span>",'<div class="right-bl"><input type="text" maxlength="18" name="userid" value="{{data.reality_addr_info.identity_card}}" /></div>',"</div>","{{ /if }}","</div>",'<div data-type="2" class="space" data-addrid="{{data.virtual_addr_info.addr_id}}">','<div class="line">',"<span>*收货信息：</span>","{{ if (data.virtual_addr_info.addr) }}",'<div class="right-bl"><textarea class="area2" name="virtualaddr">{{data.virtual_addr_info.addr}}</textarea></div>',"{{ else }}",'<div class="right-bl"><textarea class="area2 default" name="virtualaddr" data-type="default">请按照直播中要求的方式，填写收货信息，如游戏账号、支付宝账号等</textarea></div>',"{{ /if }}","<p>*账号相关请谨慎填写，谨防诈骗</p>","</div>","{{ if data.virtual_addr_info.display_identity }}",'<div class="line mar-bot">',"<span>*身份证号：</span>",'<div class="right-bl"><input type="text" maxlength="18" name="virtualid" value="{{data.virtual_addr_info.identity_card}}" /></div>',"</div>","{{ /if }}","</div>","</div>","</div>","</div>",'<div class="footer">',"<p>*您也可以在中奖私信中填写收货信息，7天内未填写<br/>收货信息且未发送给主播将视为放弃奖品。</p>","{{ if data.reality_addr_info.display_identity }}",'<div class="button" data-node="submitForm">发送收货信息</div>',"{{ else }}",'<div class="button" data-node="submitForm">发送给主播</div>',"{{ /if }}","</div>",'<div class="regioninfo-box"></div>',"</div>"),n=a.compile(s);e(".receinfo-box-wrapper").html(n(t)),this.tab_type=1,this.toggleReciveInfo(!0),this.domReadyFunc()},toggleReciveInfo:function(t){1==t?e(".receinfo-box-wrapper").show():e(".receinfo-box-wrapper").hide()},domReadyFunc:function(){this.doms.$el=e(".receinfo-box-wrapper"),this.doms.$tabinfo=this.doms.$el.find(".tab-info"),this.doms.$submit=this.doms.$el.find('[data-node="submitForm"]'),this.doms.$username=this.doms.$el.find('[name="username"]'),this.doms.$userarea=this.doms.$el.find('[name="userarea"]'),this.doms.$useraddr=this.doms.$el.find('[name="useraddr"]'),this.doms.$userphone=this.doms.$el.find('[name="userphone"]'),this.doms.$userID=this.doms.$el.find('[name="userid"]'),this.doms.$virtualaddr=this.doms.$el.find('[name="virtualaddr"]'),this.doms.$virtualID=this.doms.$el.find('[name="virtualid"]'),this.doms.$jiangpin=this.doms.$el.find(".jiangpin"),this.doms.$selsectArea=this.doms.$el.find(".select-area")},changeTabs:function(e){this.doms.$tabinfo.find(".nav li").removeClass("active"),this.doms.$tabinfo.find(".nav li[data-type="+e+"]").addClass("active"),this.doms.$tabinfo.find(".content [data-type]").removeClass("active"),this.doms.$tabinfo.find(".content [data-type="+e+"]").addClass("active")},changeBtnStatus:function(e){var t="发送中...",a="发送给主播",i="";1==e?(i=t,this.doms.$submit.addClass("disable")):(i=a,this.doms.$submit.removeClass("disable")),this.doms.$submit.text(i)},checkForms:function(){var t=this,a=(e(".receinfo-box-wrapper"),this.doms.$username.val()),i=this.doms.$userarea.attr("data-val"),s=this.doms.$useraddr.val(),n=this.doms.$userphone.val(),o=this.doms.$userID.val(),r=this.doms.$userarea.attr("data-regionid"),l=this.doms.$virtualaddr.val(),d=this.doms.$virtualID.val(),c=this.doms.$tabinfo.find(".content [data-type=1]").attr("data-addrid"),u=this.doms.$tabinfo.find(".content [data-type=2]").attr("data-addrid"),g=this.doms.$jiangpin.attr("data-id"),m={},p=/^1[3|4|5|7|8][0-9]{9}$/,f=/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/,h=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;if(1==this.tab_type){if(""==a)return t.showToast("请填写收货人"),!1;if(""==r)return t.showToast("请选择所在地区"),!1;if(""==s)return t.showToast("请输入详细地址"),!1;if(!(""!=n&&p.test(n)||""!=n&&f.test(n)))return t.showToast("请输入正确的联系电话"),!1;if(this.doms.$userID.length>0&&(""==o||!h.test(o)))return t.showToast("请输入正确的身份证号"),!1;m={addr_id:c||0,activity_id:g||0,type:this.tab_type,name:a,area:i,region_id:r,addr:s,mobile:n,identity_card:o}}else{if(""==l)return t.showToast("请输入收货信息"),!1;if(this.doms.$virtualaddr.hasClass("default"))return t.showToast("请输入收货信息"),!1;if(this.doms.$virtualID.length>0&&(""==d||!h.test(d)))return t.showToast("请输入正确的身份证号"),!1;m={addr_id:u||0,activity_id:g||0,type:this.tab_type,name:"",area:"",region_id:"",addr:l,mobile:"",identity_card:d}}return m},showToast:function(t){e.dialog.tips_black(t)},_getCsrfCookie:function(t){var a=this,i=s.get($SYS.tvk);if(!i)return void e.ajax({url:a.API.getCsrfCookie,type:"GET",dataType:"json",success:function(e){0===e.error&&a._getCsrfCookie(t)}});var n=$SYS.tn;t&&t({name:n,val:i})},najax:function(t){this._getCsrfCookie(function(a){t.data[a.name]=a.val,e.ajax(t)})},bindEvent:function(){var t=this;t.doms.$el.off("click"),t.doms.$el.off("change"),t.doms.$el.off("keydown"),t.doms.$el.off("keyup"),t.doms.$el.off("focus"),t.doms.$el.on("click",".tab-info .nav li",function(a){var i=e(this).attr("data-type");t.tab_type=i,t.changeTabs(i),1!=i&&l.toggleBox(!1)}).on("click",'[data-node="submitForm"]',function(){if(!t.doms.$submit.hasClass("disable")){var e=t.checkForms();e&&(t.changeBtnStatus(!0),t.najax({url:t.API.sendAddress,type:"POST",dataType:"json",data:e,success:function(e){t.changeBtnStatus(!1),0==e.error?(t.toggleReciveInfo(!1),t.showToast("发送成功！")):t.showToast(e.msg)},error:function(e){t.changeBtnStatus(!1),t.showToast("网络错误")}}),r.dys({key:"dys.room.draw.lottery.recinf.senda.click",mat:1==t.tab_type?1:0,fic:2==t.tab_type?1:0}))}}).on("change keydown keyup",'[name="useraddr"]',function(){var t=e(this).val(),a=100;t.length>a&&e(this).val(t.substring(0,a))}).on("change keydown keyup",'[name="virtualaddr"]',function(){var t=e(this).val(),a=100;t.length>a&&e(this).val(t.substring(0,a))}).on("click",'[name="userarea"]',function(t){t.stopPropagation();var a=e(this).attr("data-regionid"),i=e(this).attr("data-val");l.init({id:a,value:i})}).on("click",".close-icon",function(){t.toggleReciveInfo(!1)}).on("focus",'[data-type="default"]',function(){e(this).val(""),e(this).attr("data-type",""),e(this).removeClass("default")})},setUserArea:function(e,t){this.doms.$selsectArea.attr("data-val",t),this.doms.$selsectArea.attr("data-regionid",e),this.doms.$selsectArea.text(t)},listen:function(){function e(e){if(!(e.origin.indexOf("msg")<0)){var a=e.data?e.data:"{}",i=JSON.parse(a);"triggerReceiptInfo"==i.type&&t.init({id:i.data.dataActivityId||0,prize:i.data.dataPrizeName||0})}}var t=this;window.attachEvent?window.attachEvent("onmessage",e):window.addEventListener&&window.addEventListener("message",e,!1)}};return{init:function(e){d.init({id:e.id||0,prize:e.prize||0})},listen:function(){d.listen()}}}),define("douyu/page/room/normal/mod/draw",["jquery","shark/observer","shark/util/cookie/1.0","shark/util/flash/data/1.0","shark/util/template/2.0","shark/util/storage/1.0","douyu/context","douyu/page/room/base/api","shark/util/lang/1.0","douyu/com/user","douyu/com/get-gift-configs","douyu/page/room/normal/mod/receive-info","douyu/com/room-gift-tmp","douyu/com/exjsonp"],function(e,t,a,i,s,n,o,r,l,d,c,u,g,m){var p={urls:{endDrawAds:o.get("sys.webconfUrl")+"resource/common/interact.json",luckEnter:"/member/lottery/get_open_status",officeGift:"/member/lottery/get_official_prize",saveDrawInfo:"/member/lottery/save_activity_info",startLuckDraw:"/member/lottery/start_activity",nowLuckDrawInfo:"/member/lottery/activity_info",getActInfo:"/member/lottery/get_room_status",resetDraw:"/member/lottery/reset_activity",getGiftList:"/member/lottery/get_room_gift_list",endLuckDraw:"/member/lottery/end_activity"},luckStatus:"start",doms:{},giftConfigData:{},delayGiftQueue:!0,flashDrawBtnIsClose:{},hasJoinDrawCache:{},dataCache:{}},f={getLength:function(e){for(var t=0,a=e.length,i=-1,s=0;a>s;s++)i=e.charCodeAt(s),t+=i>=0&&128>=i?1:2;return t},cutString:function(e,t){var a=0,i=0,s=new String;i=e.length;for(var n=0;i>n;n++){var o=e.charAt(n);if(a++,escape(o).length>4&&a++,s=s.concat(o),a>=t)return s=s.concat("...")}return t>a?e:void 0}},h={crsf:"/curl/csrfApi/getCsrfCookie",getCSRFCookie:function(t){var i=this,s=a.get(o.get("sys.tvk"));return s?void(t&&t({name:$SYS.tn,value:s})):void e.ajax({url:i.crsf,type:"GET",dataType:"json",success:function(e){0===+e.error&&i.getCSRFCookie(t)}})},dys:function(e){t.trigger("dys",e)},userLevelClass:function(e){var t=120,a="",i=+e;return i?i>=100?(a="level-"+(t>i?i:t),a+=" level-size2"):a+=i>=70?"level-"+i+" level-size1":i>=10?"level-"+i+" level-bgpng level-size1":"lve-icon-1to9 level-"+i+" level-bgpng level-size1":a="level-next-1",a},timeFormate:function(e){if(!e)return!1;var t,a=+e,i=a%60;t=parseInt(a/60,10);var s=t%60;t=parseInt(t/60,10);var n=(""+t).slice(-2);return[+n?n+"小时":"",s?s+"分":"",i+"秒"].join("")},numberFormat:function(e){var t,a=+e;return t=1e4>a?a:1e6>a?Math.floor(a/100)/100+"万":1e7>a?Math.floor(a/1e3)/10+"万":Math.floor(a/1e4)+"万"},isAnchor:function(){if(void 0!=p.dataCache.isAnchor)return p.dataCache.isAnchor;var e=+o.get("sys.uid"),t=+o.get("room.owner_uid");return p.dataCache.isAnchor=e===t,p.dataCache.isAnchor},resolveUserList:function(e){var t,a=this,i=[],s=!1,n=!1,r=+o.get("sys.uid"),l=+o.get("room.owner_uid"),d=e.list.length,c=-1;r===l&&(s=!0);var u={},g=-1,m=e.adListIndex;if(m)for(var p in m)m[p]>=0&&(g=m[p]);var f=e.adListContent.ad_list?e.adListContent.ad_list:{};if(f&&g>-1)for(var p in f)f[p]&&f[p].length>0&&(u={win:f[p][g].win_pic,win_text:f[p][g].win_text,lose:f[p][g].lose_pic,lose_text:f[p][g].lose_text});if(!d)return s&&this.sendNotice("end",{list:i,giftName:e.prize,length:d}),{list:[],isAnchor:s,isNoBodyLuck:!0,drawad:u};for(var p=0;d>p;p++){t=e.list[p],+t.uid===r&&(n=!0,c=p);var h=this.getUserStarNickName(t.nickname,s,+t.uid===r);i.push({uid:t.uid,nickname:h,level:t.level,ulevelc:a.userLevelClass(t.level)
})}return this.sendNotice("end",{list:d>10?i.slice(0,10):i,giftName:e.prize,length:d>10?10:d,number:d}),{list:i,isAnchor:s,isLuck:n,join:this.numberFormat(e.join),name:e.name,gift:this.numberFormat(e.gift),number:d,prize:e.prize,offimg:e.img,index:c,joinTime:this.timeFormate(e.time),fansCount:this.numberFormat(e.fans),followCount:this.numberFormat(e.follow),lotteryRange:+e.lotteryRange,activityId:e.activityId,activityType:e.activityType,prizeType:e.prizeType,drawad:u}},sendNotice:function(e,a){var i=o.get("sys.web_url");if(!this.wordRender){var n=l.string.join('<li class="jschartli normal-notice">','<i class="icon-heart"></i>','<p class="text-content draw-luck-user-list">','{{ if (type === "start") }}',"为了回馈广大水友，",'<span class="draw-luck-name">{{ giftObj.anchorName }}</span> ',"发起抽奖活动，快来参加啦！","{{ else }}","{{ if (giftObj.length) }}","恭喜 ","{{ each giftObj.list }}",'<span class="draw-luck-name" data-uid="{{ $value.uid }}" title="{{ $value.nickname }}">{{ $value.nickname }}</span>',"{{ if ($index < (giftObj.length - 1)) }}","、","{{ /if }}","{{ /each }}","{{ if (giftObj.number > 10) }}","等{{ giftObj.number }}人","{{ /if }}",' 获得<span class="hy-org">{{ giftObj.giftName }}</span>！',"{{ else }}","当前没有一个人满足抽奖条件","{{ /if }}","{{ /if }}","</p>","</li>"),r=s.compile(n);this.wordRender=r}var d=this.wordRender({type:e,webUrl:i,giftObj:a});t.trigger("mod.chat.msg.msg",d)},countBalance:function(t,a){var i,s,n,o=p.giftConfigData;for(var r in o)i=+r,i===t&&(n=o[r]);var l=e("#js-stats-and-actions");return s=1===+n.type?+l.find('[data-login-user="silver"]').text():100*+l.find('[data-login-user="gold"]').text(),s<n.pc*a},getAdsFromActivity:function(e){m.load(p.urls.endDrawAds,"interact",e,e,"",!0)},getUserStarNickName:function(e,t,a){if(t||a)return e;var i=e,s=e.length,n="";if(5>s){for(var o=1;s>o;o++)n+="*";i=i.substring(0,1)+n}else i=i.substring(0,1)+"***"+i.substring(4,s);return i},isWinner:function(t){var a=!1;if(e.isArray(t)&&t.length>0){var i=+o.get("sys.uid");e.each(t,function(e,t){return i===+t.uid?(a=!0,!1):void 0})}return a},hasJoinDraw:function(t){if(p.hasJoinDrawCache[t])return!0;var a=n.get("drawJoinArray"),i=!1;if(a){var s=JSON.parse(a),o=(new Date).getTime(),r=[],l=!1;e.each(s,function(e,a){o-a.timestap<6048e5?(r.push(a),+t===+a.activityId&&(i=!0,p.hasJoinDrawCache[t]=!0)):l=!0}),l&&n.set("drawJoinArray",JSON.stringify(r))}return i}},v={vars:{luckType:"normal",commandType:"word",giftTipsTk:null,officialType:null,$giftLi:null,normalMax:null,lightMin:null,lightMax:null,pointGift:{giftID:null,giftNUM:null,giftPRICE:null}},flag:{showFlag:!1,ifOfficial:!0,ifChangeGift:!0},doms:{},render:{box:function(e){e.officialDefaultPic=v.getOfficialDefaultPic();var t=l.string.join('<div class="draw-gift-box draw-gift-box-400" style="display:block;">','<div class="draw-gift-title">','<div class="draw-title-txt"></div>','<a href="javascript:;" class="draw-gift-close js-luck-draw-close"></a>',"{{ if (!is_close_gift) }}",'<div class="draw-list-tab">','<span class="js-luck-word-tab active">口令抽奖<i></i></span>','<span class="js-luck-light-tab" >爆灯抽奖<i></i></span>',"</div>","{{ /if }}","</div>","{{ if (is_close_gift) }}",'<div class="draw-gift-content">',"{{ else }}",'<div class="draw-gift-content draw-gift-content-35">',"{{ /if }}",'<div class="draw-gift-info">','<i class="draw-confetti"></i>','<i class="draw-standard"></i>','<div class="draw-gift-tab">',"{{ if (is_open_general) }}",'<span class="js-luck-normal-enter active">自定义奖品</span>',"{{ /if }}","{{ if (is_open_official) }}","{{ if (is_open_general) }}",'<i></i><span class="js-luck-office-enter">官方奖品</span>',"{{ else }}",'<span class="js-luck-office-enter active">官方奖品</span>',"{{ /if }}","{{ /if }}","</div>","{{ if (is_open_general) }}",'<div class="js-luck-normal-sec">',"<!-- 普通抽奖 -->",'<div class="draw-gift-field">',"<label>奖品：</label>",'<input class="js-luck-draw-normal-gift js-normal-input" type="text" maxlength="40" placeholder="如“雷蛇鼠标”（奖品需主播自行寄送）">','<div class="draw-pergift-tips js-draw-gift-tips">',"<i></i>",'<div class="draw-pergift-tips-con">',"热门奖品：现金红包、鱼翅、贵族、房管、iPad、手机、电脑<br>","其它奖品：键盘、鼠标、Q币、点券、激活码、皮肤、游戏礼包","</div>","</div>","</div>","<!-- 提示文字 -->",'<div class="draw-gift-field">',"<label>数量：</label>",'<label class="draw-award-unit">个</label>','<input class="js-luck-draw-normal-num js-number-input js-normal-input" data-max-num="10" type="text" placeholder="不超过10个">',"</div>","</div>","{{ /if }}","{{ if (is_open_official) }}","{{ if (is_open_general) }}",'<div class="js-luck-office-sec hide">',"{{ else }}",'<div class="js-luck-office-sec">',"{{ /if }}","<!-- 官方抽奖 -->",'<div class="award-pic">',"{{ if (offGift.prize_img) }}",'<img class="js-luck-offgift-img" src="{{ offGift.prize_img }}">',"{{ else }}",'<img class="js-luck-offgift-img" src="{{ officialDefaultPic }}">',"{{ /if }}","</div>",'<div class="official-award">','<span class="official-award-name js-luck-offgift-name"  data-luck-offgift-id="{{ offGift.official_prize_id }}">{{ offGift.prize_name }}</span>','<label class="draw-award-unit">个</label>','<input class="js-luck-draw-official js-number-input js-normal-input" data-max-num="99" data-giftname="{{ offGift.prize_name }}" data-giftnum="{{ offGift.prize_left_num }}" type="text" placeholder="个数不能超过99个">','<span class="official-award-num">您还可发起<em class="js-luck-offgift-num">{{ offGift.prize_left_num }}</em>个奖品的抽奖</span>',"</div>","</div>","{{ /if }}",'<div class="draw-gift-field js-luck-shibboleth-tab">','<a href="javascript:;" class="gift-command-btn js-luck-word-enter changeHover active" >文字口令</a>',"{{ if (!is_close_gift) }}",'<a href="javascript:;" class="gift-command-btn js-luck-gift-enter changeHover">礼物口令</a>',"{{ /if }}","</div>","<!-- 文字口令 -->",'<div class="draw-gift-field draw-text-command js-luck-word-command">',"<label>设置口令：</label>",'<input class="js-luck-draw-wordc js-normal-input" maxlength="10" type="text" placeholder="水友需刷出你指定的口令才可抽奖">',"</div>","<!-- 礼物口令 -->",'<div class="draw-gift-command draw-gift-field js-luck-gift-command hide">','<label>个</label><input type="text" class="gift-command-num js-luck-draw-giftc-num js-number-input js-normal-input" data-max-num="{{ lottery_setting.gift_num_max }}" maxlength="3" placeholder="1~{{ lottery_setting.gift_num_max }}之间" >','<div class="gift-command-box">',"{{ if (giftList[0]) }}",'<input type="text" class="gift-command-type js-luck-gift-now js-luck-gift-change" data-id="{{ giftList[0].gift_id }}" readonly value="{{ giftList[0].gift_name }}">',"{{ else }}",'<input type="text" class="gift-command-type js-luck-gift-now js-luck-gift-change" data-id="" readonly value="">',"{{ /if }}",'<div class="command-arrow-box js-luck-gift-change">','<span class="js-luck-gift-change"></span>',"</div>",'<div class="gift-value-box js-luck-gift-change">500鱼翅</div>','<ul class="command-type-list js-luck-gift-list">',"{{ each giftList }}",'<li class="{{ $index === 0 ? "active" : "" }}" data-id="{{ $value.gift_id }}" data-name="{{ $value.gift_name }}" data-val="{{ $value.gift_price }}">{{ $value.gift_name }}<span class="gift-value">{{ $value.gift_price }}</span></li>',"{{ /each }}","</ul> ","</div>","</div>","<!-- 爆灯抽奖 -->",'<div class="js-luck-light-gift-command hide">','<h3 class="light-tips-h3">设置爆灯礼物和总数</h3>','<div class="draw-gift-command draw-gift-field">','<label>个</label><input type="text" class="gift-command-num js-luck-draw-giftc-num js-number-input js-normal-input" data-max-num="{{ lottery_setting.boom_gift_num_max }}"  placeholder="{{ lottery_setting.boom_gift_num_min }}~{{ lottery_setting.boom_gift_num_max }}">','<div class="gift-command-box">',"{{ if (giftList[0]) }}",'<input type="text" class="gift-command-type js-luck-gift-now js-luck-gift-change" data-id="{{ giftList[0].gift_id }}" readonly value="{{ giftList[0].gift_name }}">',"{{ else }}",'<input type="text" class="gift-command-type js-luck-gift-now js-luck-gift-change" data-id="" readonly value="">',"{{ /if }}",'<div class="command-arrow-box js-luck-gift-change">','<span class="js-luck-gift-change"></span>',"</div>",'<div class="gift-value-box js-luck-gift-change">500鱼翅</div>','<ul class="command-type-list js-luck-gift-list">',"{{ each giftList }}",'<li class="{{ $index === 0 ? "active" : "" }}" data-id="{{ $value.gift_id }}" data-name="{{ $value.gift_name }}" data-val="{{ $value.gift_price }}">{{ $value.gift_name }}<span class="gift-value">{{ $value.gift_price }}</span></li>',"{{ /each }}","</ul> ","</div>","</div>","</div>","<!-- 抽奖条件限制 -->",'<div class="draw-limit-rules-box">','<div class="draw-limit-rules">','<label class="js-limit-rules-change"">条件设置：</label>','<input type="text" class="draw-limit-rules-input js-limit-rules-change" readonly>','<div class="command-arrow-box js-limit-rules-change">','<span class="js-limit-rules-change"></span>',"</div>",'<div class="draw-limit-value-box js-limit-rules-change"><span class="js-limit-rules-change js-limit-scope" data-val="0">全部水友</span><span class="js-limit-time-box">，<span class="js-limit-rules-change js-limit-time" data-val="300">5</span>分钟</span></div>','<ul class="limit-type-list js-limit-rules-list">',"<li>","<h1>抽奖范围</h1>",'<div class="scope-first-row"><span class="item first-item" data-name="全部水友" data-val="0">全部水友</span><span class="item second-item" data-name="关注我的水友" data-val="1">关注我的水友</span></div>',"{{ if (isSetFansBadge) }}",'<div><span class="item first-item" data-name="我的粉丝团水友" data-val="2">我的粉丝团水友</span><span class="item second-item" data-name="关注我且加入粉丝团" data-val="3">关注我且加入粉丝团</span></div>',"{{ /if }}","</li>",'<li class="js-limit-time-row">',"<h1>时间</h1>",'<div class="first-time-row"><span class="col" data-val="60" data-minute="1">1分钟</span><span class="col" data-val="120" data-minute="2">2分钟</span><span class="col" data-val="180" data-minute="3">3分钟</span><span class="col" data-val="240" data-minute="4">4分钟</span><span class="col cur" data-val="300" data-minute="5">5分钟</span></div>','<div><span class="col" data-val="360" data-minute="6">6分钟</span><span class="col" data-val="420" data-minute="7">7分钟</span><span class="col" data-val="480" data-minute="8">8分钟</span><span class="col" data-val="540" data-minute="9">9分钟</span><span class="col" data-val="600" data-minute="10">10分钟</span></div>',"</li>","</ul> ","</div>","</div>","<!-- 审核已通过增加样式pass-attention -->",'<span class="submit-attention js-luck-status-check"></span>',"<!-- 按钮置灰增加样式 inreview -->",'<a class="draw-submit-btn js-luck-draw-start" href="javascript:;">提交</a>','<a class="draw-reset-btn js-luck-draw-reset" href="javascript:;">重置</a>',"<!-- 置灰增加样式  unavailable -->",'<div class="draw-gift-field draw-document-box js-luck-draw-prot">','<a href="/cms/gong/201705/11/5315.shtml" target="_blank" class="draw-document-info js-luck-prot-read">《抽奖互动规范》</a>','<a href="javascript:void(0);" class="draw-document-info js-play-rules">《玩法说明》</a>',"</div>","</div>","</div>","</div>"),a=s.compile(t);return a(e)},luck:function(e){var t=l.string.join("{{ if (list && list.length) }}","{{ if (isAnchor) }}","{{ if (lotteryRange === 3) }}",'<div class="draw-gift-box draw-end js-draw-end draw-gift-box-lotteryRange3">',"{{ else }}",'<div class="draw-gift-box draw-end js-draw-end">',"{{ /if }}","{{ else }}","{{ if (isLuck) }}",'<div class="draw-gift-box draw-win js-draw-end">',"{{ else }}",'<div class="draw-gift-box draw-regret js-draw-end">',"{{ /if }}","{{ /if }}",'<div class="draw-gift-title">','<div class="draw-title-txt"></div>','<a href="javascript:;" class="draw-gift-close js-luck-end-close"></a>',"</div>","{{ if (lotteryRange === 3) }}",'<div class="draw-scope3 draw-gift-content">',"{{ else }}",'<div class="draw-gift-content">',"{{ /if }}","{{ if (activityType == 2) }}",'<div class="draw-end-info draw-official-win">',"{{ else }}",'<div class="draw-end-info">',"{{ /if }}","{{ if (isAnchor) }}","<!-- 活动结束 -->",'<div class="draw-info-text">','<div class="drawTime">抽奖用时：<span>{{ joinTime }}</span></div>',"{{ if (lotteryRange === 0) }}",'<div class="draw-info clearfix lotteryrange0">','<div class="draw-info-item">','<div class="draw-info-item-num">{{ join }}</div>','<div class="draw-info-item-text">参与人数</div>',"</div>",'<div class="draw-info-item">','<div class="draw-info-item-num">{{ gift }}</div>','<div class="draw-info-item-text">{{ name }}</div>',"</div>",'<div class="divisionLine"></div>',"</div>","{{ else if (lotteryRange === 1) }}",'<div class="draw-info clearfix lotteryrange1">','<div class="draw-info-item">','<div class="draw-info-item-num">{{ join }}</div>','<div class="draw-info-item-text">参与人数</div>',"</div>",'<div class="draw-info-item">','<div class="draw-info-item-num">{{ gift }}</div>','<div class="draw-info-item-text">{{ name }}</div>',"</div>",'<div class="draw-info-item">','<div class="draw-info-item-num">{{ followCount }}</div>','<div class="draw-info-item-text">新增关注</div>',"</div>","</div>","{{ else if (lotteryRange === 2) }}",'<div class="draw-info clearfix lotteryrange2">','<div class="draw-info-item">','<div class="draw-info-item-num">{{ join }}</div>','<div class="draw-info-item-text">参与人数</div>',"</div>",'<div class="draw-info-item">','<div class="draw-info-item-num">{{ gift }}</div>','<div class="draw-info-item-text">{{ name }}</div>',"</div>",'<div class="draw-info-item">','<div class="draw-info-item-num">{{ fansCount }}</div>','<div class="draw-info-item-text">新增粉丝</div>',"</div>","</div>","{{ else }}",'<div class="draw-info clearfix lotteryrange3">','<div class="draw-info-item">','<div class="draw-info-item-num">{{ join }}</div>','<div class="draw-info-item-text">参与人数</div>',"</div>",'<div class="draw-info-item">','<div class="draw-info-item-num">{{ gift }}</div>','<div class="draw-info-item-text">{{ name }}</div>',"</div>",'<div class="draw-info-item">','<div class="draw-info-item-num">{{ fansCount }}</div>','<div class="draw-info-item-text">新增粉丝</div>',"</div>",'<div class="draw-info-item">','<div class="draw-info-item-num">{{ followCount }}</div>','<div class="draw-info-item-text">新增关注</div>',"</div>",'<div class="divisionLine"></div>',"</div>","{{ /if }}","</div>","{{ else }}","{{ if (isLuck) }}","<!-- 中奖啦 -->",'<div class="draw-info-text">',"<h2>恭喜您中奖啦！</h2>","{{ if (offimg) }}",'<div class="congratulation-img">','<img src="{{ offimg }}">',"</div>","{{ /if }}",'<div class="winner-award-name" title="{{ prize }}">{{ prize }}</div>',"{{ if (activityType == 2) }}","{{ if (prizeType == 4) }}",'<p id="winner-award-info">斗鱼抽奖已私信你，请快去<a class="winner-award-info">填写收货信息</a>吧~</p>',"{{ else }}","<p>中奖通知已发至您的私信，请注意查收~</p>","{{ /if }}","{{ else }}",'<p id="winner-award-info">主播已私信你，请快去<a class="winner-award-info">填写收货信息</a>吧~</p>',"{{ /if }}","</div>","{{ else }}","<!-- 很遗憾 -->",'<div class="draw-info-text">',"<span>抱歉！你与奖品擦肩而过~</span>","</div>","{{ /if }}","{{ /if }}","<!-- 获奖名单 -->",'<div class="award-winner-list">','<div class="winner-list-title-first">中奖名单<span class="more-dot"></span></div>','<div class="winner-list-title-v3"></div>','<div class="winner-list-content js-luck-end-list">',"{{ each list }}",'<li class="winner-list-item">','<a class="chat-icon-pad user-level {{ $value.ulevelc }}" data-uid="{{ $value.uid }}" title="用户等级：{{ $value.level }}"></a>',"{{ if (isLuck && $index === index) }}",'<span title="{{ $value.nickname }}" class="draw-luck-name">{{ $value.nickname }}</span>',"{{ else }}",'<span title="{{ $value.nickname }}">{{ $value.nickname }}</span>',"{{ /if }}","</li>","{{ /each }}","</div>",'<div class="winner-list-bottom"></div>',"{{ if (isAnchor) }}","{{ if (activityType == 2) }}",'<div class="winner-list-tellfans">请及时告知中奖用户查看官方私信，注意查收~</div>',"{{ else }}",'<div class="winner-list-tellfans">已通过您的账号向中奖水友发送消息，快及时联系他们寄送奖品哦~<a href="/room/my/lottery_history" target="_blank">抽奖记录</a></div>',"{{ /if }}","{{ /if }}","</div>","</div>","</div>","</div>","{{ else }}",'<div class="draw-gift-box draw-end-nobody js-draw-end">','<div class="draw-gift-title">','<div class="draw-title-txt"></div>','<a href="javascript:;" class="draw-gift-close js-luck-end-close"></a>',"</div>",'<div class="draw-gift-content">','<div class="draw-end-info">','<div class="draw-info-text">',"<h3>当前没有一个人满足抽奖条件</h3>","</div>","</div>","</div>","</div>","{{ /if }}"),a=s.compile(t);return a(e)},check:function(e){var t=l.string.join('<div class="group-btns-pop draw-tips">','<span class="group-pop-arrow1"></span>','<span class="group-pop-arrow2"></span>',"{{ if (type) }}",'<p>你发布的抽奖<span class="draw-pass">已通过</span>审核 <span class="draw-pass js-draw-start">开启抽奖</span></p>',"{{ else }}",'<p>你发布的抽奖<span class="draw-not-pass">未通过</span>审核</p>',"{{ /if }}","</div>"),a=s.compile(t);return a({type:e})},close:function(){var e=l.string.join('<div class="group-btns-pop draw-tips">','<span class="group-pop-arrow1"></span>','<span class="group-pop-arrow2"></span>',"<p>审核完成后，我们将及时通知您</p>","</div>"),t=s.compile(e);return t()}},init:function(){var e=this;e.initData(),e.checkDrawBtns(),u.listen()},initData:function(){var t=this.vars,a=this.doms;a.$container=e("body"),t.room_id=o.get("room.room_id"),t.category_id=o.get("room.cate_id"),t.uid=o.get("sys.uid"),t.luckStatus="start",t.normalGift=""},checkDrawBtns:function(){var t=this,a=+o.get("sys.uid"),i=+o.get("room.owner_uid");a===i&&t.getLuckEnter(function(a){if(a.is_open){t.vars.normalMax=a.lottery_setting.gift_num_max,t.vars.lightMax=a.lottery_setting.boom_gift_num_max,t.vars.lightMin=a.lottery_setting.boom_gift_num_min,t.luckDrawInfo=a,t.showDrawBtn();var i=n.get("luckDrawTipsShow")||0;if(3>i){var s=e(".live-group-btns").find('[data-live-group="drawTips"]');s.removeClass("hide").show(),s.on("click",".pop-close-btn",function(){s.hide()}),s.on("click",".draw-pop-btn",function(){s.hide(),t.flag.showFlag||(t.checkFirst(),h.dys({key:"dys.room.draw.lottery.car.click"}))}),s.on("click",".draw-pop-circle",function(){s.hide(),t.flag.showFlag||(t.checkFirst(),h.dys({key:"dys.room.draw.btn.click"}))}),i++,n.set("luckDrawTipsShow",i)}}})},showLuckDraw:function(t){var a=this,i=a.doms,s=a.vars;if(!a.flag.showFlag)if(a.doms.$box)a.removeLastDialog(),a.luckDrawInfo.is_open_official&&a.getOfficeGift(!0,function(e){0==e.join_type?s.officialType="Nochange":1==e.join_type?s.officialType="command":2==e.join_type?s.officialType="gift":3==e.join_type&&(s.officialType="light");var t=i.offgift;t.$name.text(e.prize_name),t.$num.text(e.prize_left_num),t.$img.attr("src",e.prize_img?e.prize_img:a.getOfficialDefaultPic())}),i.$giftList.hide(),a.hideLimitList(),a.doms.$box.show(),t(!0);else{var n=a.luckDrawInfo;n.is_open_official&&!n.is_open_general&&(s.luckType="official"),a.getOfficeGift(n.is_open_official,function(r){0==r.join_type?s.officialType="Nochange":1==r.join_type?s.officialType="command":2==r.join_type?s.officialType="gift":3==r.join_type&&(s.officialType="light"),a.getGiftList(function(l){if(0==l.length)return t();s.pointGift.giftID=l[0].gift_id,s.pointGift.giftNUM=l[0].gift_name,s.pointGift.giftPRICE=l[0].gift_price;var d=e.extend(n,{giftList:l},{offGift:r},{isSetFansBadge:o.get("room.is_set_fans_badge")}),c=e(".js-draw-end");c.length&&c.remove();var u=a.render.box(d);i.$box=e(u),i.$container.append(i.$box),a.cacheBoxDoms(),l.length>6&&i.$giftList.mCustomScrollbar(),a.bindBoxEvent(),t()})})}},showDrawBtn:function(){var t=this,a=e(".live-group-btns").find('[data-live-group="draw"]');t.doms.$actEnter=a,a.removeClass("hide"),a.bind("click",function(){t.flag.showFlag||(t.checkFirst(),h.dys({key:"dys.room.draw.btn.click"}))})},cacheBoxDoms:function(){var e=this,t=e.doms,a=t.$box;t.$input=a.find('input.js-normal-input[type="text"]'),t.$normalBtn=a.find(".js-luck-normal-enter"),t.$officeBtn=a.find(".js-luck-office-enter"),t.$normalSec=a.find(".js-luck-normal-sec"),t.$officeSec=a.find(".js-luck-office-sec"),t.$limitList=a.find(".js-limit-rules-list"),t.$limitScope=a.find(".js-limit-scope"),t.$limitTime=a.find(".js-limit-time"),t.$limitTimeBox=a.find(".js-limit-time-box"),t.$limitTimeRow=a.find(".js-limit-time-row"),t.$giftList=a.find(".js-luck-gift-list"),t.$giftListLi=t.$giftList.find("li"),t.$giftChoose=a.find(".js-luck-gift-now"),t.$giftValue=a.find(".gift-value-box"),t.$wordBtn=a.find(".js-luck-word-enter"),t.$giftBtn=a.find(".js-luck-gift-enter"),t.$wordSec=a.find(".js-luck-word-command"),t.$giftSec=a.find(".js-luck-gift-command"),t.$protRead=a.find(".js-luck-prot-read"),t.$start=a.find(".js-luck-draw-start"),t.$readProt=a.find(".js-luck-draw-prot"),t.$reset=a.find(".js-luck-draw-reset"),t.$close=a.find(".js-luck-draw-close"),t.gift={$normalGift:a.find(".js-luck-draw-normal-gift"),$giftTips:a.find(".js-draw-gift-tips"),$normalNum:a.find(".js-luck-draw-normal-num"),$offical:a.find(".js-luck-draw-official"),$word:a.find(".js-luck-draw-wordc"),$giftNum:a.find(".js-luck-draw-giftc-num"),$giftName:t.$giftChoose},t.$statusCheck=a.find(".js-luck-status-check"),t.offgift={$name:a.find(".js-luck-offgift-name"),$num:a.find(".js-luck-offgift-num"),$img:a.find(".js-luck-offgift-img"),$needNum:a.find(".gift-command-num"),$needName:a.find(".gift-command-type"),$needValue:a.find(".gift-value-box")},t.$wordTab=a.find(".js-luck-word-tab"),t.$lightTab=a.find(".js-luck-light-tab"),t.$lightSec=a.find(".js-luck-light-gift-command"),t.$shibbolethTabSec=a.find(".js-luck-shibboleth-tab")},checkFirst:function(){var e=this,t=n.get("firstLuckDraw");t?e.checkActStatus():e.showFirstGid()},checkActStatus:function(){var e=this;e.getRoomActInfo(function(){e.showLuckDrawInfo()})},showFirstGid:function(){b.init()},showLuckDrawInfo:function(){var t=this;t.getNowLuckDrawInfo(function(a){var i=a.data;switch(+i.activity_status){case 1:t.showLuckDraw(function(){t.setLastStatus(i),t.changeDrawType("audit")});break;case 2:t.showLuckDraw(function(){t.setLastStatus(i),t.changeDrawType("ready")});break;case 3:t.showLuckDraw(function(){t.setLastStatus(i),t.changeDrawType("failed",i.audit_remark)});break;case 4:case 7:e.dialog.tips_black("当前正在抽奖，请抽奖结束后再来开启~");break;case 5:t.showLuckDraw(function(e){e||(t.changeDrawType("start"),t.setLastStatus(i))});break;default:t.showLuckDraw(function(){t.changeDrawType("start")})}})},setLastStatus:function(e){var t,a=this,i=a.doms,s=i.gift,n=e.activity_type,o=e.join_type,r=e.join_condition;t=r.gift_name&&f.getLength(r.gift_name)>8?f.cutString(r.gift_name,8):r.gift_name,3===+o?a.renderLimitList(r.lottery_range):a.renderLimitList(r.lottery_range,r.expire_time),1===+o?(s.$word.val(r.command_content),i.$wordBtn.trigger("click")):2===+o?(i.$giftChoose.attr("data-id",r.gift_id),i.$giftListLi.removeClass("active"),i.$giftList.find('[data-id="'+r.gift_id+'"]').addClass("active"),i.$giftChoose.val(t),s.$giftNum.val(r.gift_num),i.$giftValue.html(r.gift_price),i.$giftBtn.trigger("click")):3===+o&&(i.$lightTab.trigger("click"),i.$giftChoose.attr("data-id",r.gift_id),i.$giftListLi.removeClass("active"),i.$giftList.find('[data-id="'+r.gift_id+'"]').addClass("active"),i.$giftChoose.val(t),s.$giftNum.eq(1).val(r.gift_num),i.$giftValue.html(r.gift_price)),2===+n?(s.$offical.val(e.prize_num),i.$officeBtn.trigger("click")):1===+n&&(s.$normalGift.val(e.prize_name),s.$normalNum.val(e.prize_num),i.$normalBtn.trigger("click"))},showStatusCheck:function(e,t){var a=this.doms;e?a.$statusCheck.html(e).css("display","inline-block"):a.$statusCheck.hide(),t?a.$statusCheck.addClass("pass-attention"):a.$statusCheck.removeClass("pass-attention")},changeDrawType:function(e,t){var a=this,i=a.doms;if(i.$box){var s=a.vars,n=i.gift;switch(e){case"start":s.luckStatus="start",a.removeAllBoxStatus(),n.$normalGift.val(""),n.$normalNum.val(""),n.$word.val(""),n.$giftNum.val(""),n.$offical.val(""),i.$start.text("提交"),i.$reset.text("重置"),i.$reset.show();var o=i.$giftListLi.eq(0);i.$giftChoose.val(o.attr("data-name")).attr("data-id",o.attr("data-id")),i.$giftValue.html(o.attr("data-val")),a.initLimitList(),i.$giftList.hide(),a.hideLimitList(),a.showStatusCheck(),i.$input.attr("readonly",!1);break;case"modify":s.luckStatus="start",a.removeAllBoxStatus(),i.$start.text("提交"),i.$reset.text("重置"),i.$reset.show(),i.$giftList.hide(),a.hideLimitList(),a.showStatusCheck(),i.$input.attr("readonly",!1);break;case"audit":s.luckStatus="audit",a.addBoxStatus("draw-audit"),i.$start.addClass("inreview"),i.$giftList.hide(),a.hideLimitList(),i.$start.text("审核中"),i.$reset.hide(),a.showStatusCheck("提交后需要等待2-3分钟完成审核"),i.$input.attr("readonly",!0);break;case"failed":s.luckStatus="failed",a.addBoxStatus("draw-failed"),i.$start.removeClass("inreview"),i.$giftList.hide(),a.hideLimitList();var r=l.string.join('<span class="not-pass">','<span class="not-pass-tips">',"<i></i>",t||"奖品名称不符合要求","</span>","</span>","审核未通过!");a.showStatusCheck(r),i.$start.text("修改"),i.$reset.hide(),i.$input.attr("readonly",!0),h.dys({key:"dys.room.draw.show.failed",commandtype:i.$wordSec.hasClass("hide")?2:1});break;case"ready":s.luckStatus="ready",a.addBoxStatus("draw-ready"),i.$start.removeClass("inreview"),i.$start.text("开启抽奖"),i.$reset.text("修改"),i.$reset.show(),i.$giftList.hide(),a.hideLimitList(),a.showStatusCheck("审核已通过！",!0),i.$input.attr("readonly",!0),h.dys({key:"dys.room.draw.show.success",commandtype:i.$wordSec.hasClass("hide")?2:1})}}},bindBoxEvent:function(){var t=this,a=t.doms,i=t.vars,s=t.flag;a.$box.on("click",function(n){var o=e(n.target),r=i.luckStatus;if(o.hasClass("js-luck-draw-close"))t.hideDrawDlg(),"audit"===r&&t.showCheckBox(1);else if(o.hasClass("js-play-rules"))t.showFirstGid();else if(o.hasClass("js-luck-draw-start"))switch(r){case"start":t.checkLuckDrawInfo();break;case"failed":t.resetLuckDraw(function(){t.changeDrawType("modify")});break;case"ready":t.submitStartLuck();var l=a.$normalBtn.hasClass("active");h.dys({key:"dys.room.draw.start.click",lotterytype:l?1:2,gfid:a.$giftBtn.hasClass("active")?a.$giftChoose.attr("data-id"):"",commandtype:a.$wordSec.hasClass("hide")?2:1})}else if(o.hasClass("js-luck-draw-reset")){if("ready"===r)return p.dyDlgHand&&p.dyDlgHand.hide(),void(p.dyDlgHand=e.dy_dialog("修改后需再次提交审核哟~是否确认修改？",{className:"shark-ui-confirm luck-draw",mask:!0,zIndex:502,buttons:[{content:"确认",callback:function(){this.hide(),t.resetLuckDraw(function(){t.changeDrawType("modify")})}},{content:"取消",callback:function(){this.hide()}}]}));t.changeDrawType("start")}if("failed"!==r&&"ready"!==r&&"audit"!==r)if(o.hasClass("js-luck-draw-normal-gift")?t.toggleGiftTips(!0):t.toggleGiftTips(!1),o.hasClass("js-luck-normal-enter")){if("normal"===i.luckType)return;if(e(".gift-command-btn").addClass("changeHover"),"command"===i.officialType&&a.$giftBtn.removeClass("off_color"),"gift"===i.officialType&&a.$wordBtn.removeClass("off_color"),"gift"===i.officialType||"light"===i.officialType){var d=a.offgift;d.$needNum.val(""),d.$needNum.css("color",""),d.$needName.val(i.pointGift.giftNUM),d.$needValue.text(i.pointGift.giftPRICE),a.$giftChoose.attr("data-id",i.pointGift.giftID),e(".gift-command-btn").css("border","1px solid #ffa544"),e(".draw-gift-command input").css("border","1px solid #f5b38b"),e(".js-luck-gift-change").css("color","#d26357"),e(".draw-gift-command label").css("color","#d26357"),e(".gift-command-num").removeAttr("readonly")}"command"===i.officialType&&(e(".gift-command-btn").css("border","1px solid #ffa544"),a.gift.$word.css("color",""),a.gift.$word.val(""),a.gift.$word.removeAttr("readonly"),e(".js-luck-word-command label").css("color","#d26357"),e(".js-luck-draw-wordc").css("border","1px solid #ffa544")),i.luckType="normal",a.$normalBtn.addClass("active"),a.$officeBtn.removeClass("active"),a.$officeSec.addClass("hide"),a.$normalSec.removeClass("hide"),t.hideLimitList(),a.$giftList.hide(),i.$giftLi&&i.$giftLi.trigger("click")}else if(o.hasClass("js-luck-office-enter")){if(!s.ifOfficial)return;e(".gift-command-btn").removeClass("changeHover"),"command"===i.officialType?(a.$wordBtn.trigger("click"),a.$giftBtn.addClass("off_color"),a.$giftBtn.css("border","1px solid #d2cec8")):"gift"===i.officialType&&(a.$giftBtn.trigger("click"),a.$wordBtn.addClass("off_color"),a.$wordBtn.css("border","1px solid #d2cec8")),"gift"!==i.officialType&&"light"!==i.officialType||t.getOfficeGift(!0,function(t){var i=a.offgift;t.is_invalid?(s.ifChangeGift=!1,a.$giftChoose.attr("data-id",t.gift_id),i.$needNum.val(t.gift_num),i.$needNum.css("color","#d2cec8"),i.$needName.val(t.gift_name),i.$needValue.text(t.gift_price),e(".draw-gift-command input").css("border","1px solid #d2cec8"),e(".js-luck-gift-change").css("color","#d2cec8"),e(".draw-gift-command label").css("color","#d2cec8"),e(".gift-command-num").attr("readonly","readonly")):s.ifChangeGift=!0}),"command"===i.officialType&&t.getOfficeGift(!0,function(t){a.gift.$word.css("color","#d2cec8"),a.gift.$word.val(t.command_content),a.gift.$word.attr("readonly","readonly"),e(".js-luck-word-command label").css("color","#d2cec8"),e(".js-luck-draw-wordc").css("border","1px solid #d2cec8")}),setTimeout(function(){i.luckType="official",a.$officeBtn.addClass("active"),a.$normalBtn.removeClass("active"),a.$normalSec.addClass("hide"),a.$officeSec.removeClass("hide"),t.hideLimitList(),a.$giftList.hide()},100)}else if(o.hasClass("js-limit-rules-change"))a.$limitList.toggle(),a.$limitList.is(":visible")?o.parents(".draw-limit-rules").addClass("arrow-up"):o.parents(".draw-limit-rules").removeClass("arrow-up");else if(o.hasClass("js-luck-gift-change")){if("official"===i.luckType&&"Nochange"!==i.officialType&&!s.ifChangeGift)return;a.$giftList.toggle(),a.$giftList.is(":visible")?o.parents(".gift-command-box").addClass("arrow-up"):o.parents(".gift-command-box").removeClass("arrow-up")}else if(o.hasClass("js-luck-word-enter")){if("official"===i.luckType&&"gift"===i.officialType)return;if("word"===i.commandType)return;i.commandType="word",a.$wordBtn.addClass("active"),a.$giftBtn.removeClass("active"),a.$wordSec.removeClass("hide"),a.$giftSec.addClass("hide")}else if(o.hasClass("js-luck-gift-enter")){if("gift"===i.commandType)return;if("official"===i.luckType&&"command"===i.officialType)return;i.commandType="gift",a.$giftBtn.addClass("active"),a.$wordBtn.removeClass("active"),a.$giftSec.removeClass("hide"),a.$wordSec.addClass("hide")}else if(o.hasClass("js-luck-word-tab")){"command"!==i.officialType&&"gift"!==i.officialType||(s.ifOfficial=!0,e(".draw-gift-tab").css("color","#cf865a")),"light"===i.officialType&&(s.ifOfficial=!1,a.$normalBtn.trigger("click"),e(".draw-gift-tab").css("color","#999999"));var c=a.$shibbolethTabSec.find("a.active").text();h.dys({key:"dys.room.draw.click.word"}),t.showStatusCheck(),a.$limitTimeBox.show(),a.$limitTimeRow.show(),t.hideLimitList(),a.$giftList.hide(),a.$wordTab.addClass("active"),a.$lightTab.removeClass("active"),a.$shibbolethTabSec.show(),"文字口令"===c?(i.commandType="word",a.$wordSec.removeClass("hide"),a.$giftSec.addClass("hide"),a.$lightSec.addClass("hide")):(i.commandType="gift",a.$wordSec.addClass("hide"),a.$giftSec.removeClass("hide"),a.$lightSec.addClass("hide"))}else if(o.hasClass("js-luck-light-tab")){if("command"!==i.officialType&&"gift"!==i.officialType||(s.ifOfficial=!1,a.$normalBtn.trigger("click"),e(".draw-gift-tab").css("color","#999999")),"light"===i.officialType&&(s.ifOfficial=!0,e(".draw-gift-tab").css("color","#cf865a")),"light"===i.commandType)return;i.commandType="light",h.dys({key:"dys.room.draw.click.light"}),t.showStatusCheck(),a.$limitTimeBox.hide(),a.$limitTimeRow.hide(),t.hideLimitList(),a.$giftList.hide(),a.$lightTab.addClass("active"),a.$wordTab.removeClass("active"),a.$shibbolethTabSec.hide(),a.$wordSec.addClass("hide"),a.$giftSec.addClass("hide"),a.$lightSec.removeClass("hide")}}),"light"===i.officialType&&a.$wordTab.trigger("click"),a.$giftList.on("click","li",function(){var t=e(this),s=t.data(),n=s.id,o=s.name,r=s.val;i.$giftLi=t,i.pointGift.giftID=n,i.pointGift.giftNUM=o,i.pointGift.giftPRICE=r,o&&f.getLength(o)>8&&(o=f.cutString(o,8)),a.$giftListLi.removeClass("active"),t.addClass("active"),a.$giftChoose.attr("data-id",n).val(o),a.$giftValue.html(r),a.$giftList.hide(),t.parents(".gift-command-box").removeClass("arrow-up")}),a.$limitList.on("click",".item",function(){var i=e(this),s=i.data(),n=s.name,o=s.val;a.$limitScope.text(n),a.$limitScope.attr("data-val",o),t.clearScopeLimitCur(),i.addClass("scopeCur"),a.$limitTimeRow.is(":visible")||t.hideLimitList();
}),a.$limitList.on("click",".col",function(){var i=e(this),s=i.data(),n=s.val,o=s.minute;a.$limitTime.text(o),a.$limitTime.attr("data-val",n),t.clearTimeLimitCur(),i.addClass("cur")}),a.$box.on("keyup",".js-number-input",function(){var t=e(this),a=t.val();if(!/\d+/.test(a))return void t.val("");var i=parseInt(a,10),s=t.attr("data-max-num");i>s&&(i=s),t.val(i)}),a.gift.$normalGift.on("keyup",function(){for(var t=e(this),a=i.normalGift,s=(t.val()||"").split(""),n=/[\u4e00-\u9fa5]/,o=0,r=t.attr("maxlength"),l=0,d=s.length;d>l;l++)o+=n.test(s[l])?2:1;r>=o?i.normalGift=s.join(""):t.val(a)})},toggleGiftTips:function(e){var t=this,a=this.doms.gift.$giftTips,i=a.is(":visible");clearTimeout(t.vars.giftTipsTk);var s=n.get("luckDrawInputTips")||0;e?1>s&&(i||(a.fadeIn(),t.vars.giftTipsTk=setTimeout(function(){a.fadeOut()},5e3),s++,n.set("luckDrawInputTips",s))):i&&a.fadeOut()},removeAllBoxStatus:function(){var e=this,t=e.doms.$box;t.removeClass("draw-audit").removeClass("draw-ready").removeClass("draw-failed")},addBoxStatus:function(e){var t=this,a=t.doms.$box;t.removeAllBoxStatus(),a.addClass(e)},hideDrawDlg:function(){var e=this;e.doms&&e.doms.$box&&(e.doms.$box.hide(),e.flag.showFlag=!1)},showEndDlg:function(t){var a=this,i=a.render.luck(t),s=e(i);a.removeLastDialog(),a.doms.$container.append(s),s.show(),a.showAdPart(t),s.find(".js-luck-end-list").mCustomScrollbar(),s.on("click",".js-luck-end-close",function(){s.remove()}),s.on("click",".winner-award-info",function(){u.init({id:t.activityId,prize:t.prize}),h.dys({key:"dys.room.draw.lottery.recinf.click"})})},showAdPart:function(t){var a=this,i=a.checkAdIsShow();if(!t.isAnchor){if(t.isLuck&&t.drawad&&t.drawad.win&&i){var s='<div class="winner-advertise-info"><div class="back"></div><div class="ad-ma"><img src="'+t.drawad.win+'" /></div><i class="close"></i></div>';e(".draw-end-info").css("backgroundSize",0),e(".congratulation-img").hide(),e(".draw-info-text h2").css("marginBottom","5px");var n=e(s);n.css({"background-size":"100%",background:"url("+t.drawad.win_text+") no-repeat",width:"320px",height:"117px"}),e(".draw-info-text").append(n),a.clickShowDialog(function(){e(".winner-advertise-info").remove(),e(".draw-end-info").css("backgroundSize",""),e(".congratulation-img").show(),e(".congratulation-img").length<=0&&e(".draw-info-text h2").css("marginBottom","96px"),a.setNowDate()})}if(!t.isLuck&&t.drawad&&t.drawad.lose&&i){var s='<div class="winner-advertise-info '+(t.isNoBodyLuck?"pos-abs-no":"pos-abs")+'"><div class="back"></div><div class="ad-ma"><img src="'+t.drawad.lose+'" /></div><i class="close"></i></div>',n=e(s);n.css({"background-size":"100%",background:"url("+t.drawad.lose_text+") no-repeat",width:"320px",height:"117px"}),e(".draw-info-text").after(n),t.isNoBodyLuck&&(e(".draw-end-info").css("backgroundSize",0),e(".draw-info-text h3").css("marginTop","-20px"),e(".draw-info-text h3").css("marginBottom","140px")),a.clickShowDialog(function(){e(".winner-advertise-info").remove(),t.isNoBodyLuck&&(e(".draw-end-info").css("backgroundSize",""),e(".draw-info-text h3").css("marginTop","114px"),e(".draw-info-text h3").css("marginBottom","46px")),a.setNowDate()})}}},checkAdIsShow:function(){var e=n.get("luckDrawAdsShow");if(e){var t=new Date,a=t.getFullYear()+"."+(t.getMonth()+1)+"."+t.getDate();return+a.split(".")[0]<+e.split(".")[0]?!1:+a.split(".")[0]>+e.split(".")[0]?!0:+a.split(".")[1]<+e.split(".")[1]?!1:+a.split(".")[1]>+e.split(".")[1]?!0:!(+a.split(".")[2]<=+e.split(".")[2])}return!0},clickShowDialog:function(t){e(".winner-advertise-info .close").on("click",function(){e.dialog({lock:!0,content:"已参加此活动，今日不再提醒",ok:t,cancel:function(){}})})},setNowDate:function(){var e=new Date,t=e.getFullYear()+"."+(e.getMonth()+1)+"."+e.getDate();n.set("luckDrawAdsShow",t)},removeLastDialog:function(){var t=e(".js-draw-end");t.length&&t.remove()},showCheckBox:function(t,a){var i=this,s=this.doms.$box.is(":visible");if(!s){var n=t?i.render.close():i.render.check(a),o=e(n);i.doms.$actEnter.find(".draw-tips").length||i.doms.$actEnter.append(o),o.show(),setTimeout(function(){o.remove()},5e3)}},checkLuckDrawInfo:function(){var t,a,i,s,n,o,r,l=this,d=l.doms,c=l.vars,u=d.gift;if("normal"===c.luckType?(i=1,t=e.trim(u.$normalGift.val()),a=u.$normalNum.val()):"official"===c.luckType&&(i=2,t=e.trim(u.$offical.attr("data-giftname")),a=u.$offical.val()),!t)return void l.showStatusCheck("奖品名称不能为空");if(!a)return void l.showStatusCheck("请设置奖品数量");if(t.length<2)return void l.showStatusCheck("奖品名称最少2个字");if(o=parseInt(d.$limitTime.attr("data-val")),r=parseInt(d.$limitScope.attr("data-val")),"word"===c.commandType){var g=e.trim(u.$word.val());if(!g)return void l.showStatusCheck("口令不能为空");s={prize_name:t,prize_num:a,activity_type:i,join_type:1,command:g,expire_time:o,lottery_range:r}}else if("gift"===c.commandType){if(n=u.$giftNum.val(),!n)return void l.showStatusCheck("礼物数量请输入1-"+c.normalMax+"之间的整数");s={prize_name:t,prize_num:a,activity_type:i,join_type:2,gift_id:u.$giftName.attr("data-id"),gift_num:n,expire_time:o,lottery_range:r}}else if("light"===c.commandType){if(n=u.$giftNum.eq(1).val(),n<c.lightMin||n>c.lightMax)return void l.showStatusCheck("礼物数量请输入"+c.lightMin+"-"+c.lightMax+"之间的整数");s={prize_name:t,prize_num:a,activity_type:i,join_type:3,gift_id:u.$giftName.attr("data-id"),gift_num:n,lottery_range:r}}l.saveLuckDrawInfo(s,function(e,t){2===e?l.changeDrawType("ready"):1===e?l.changeDrawType("audit"):l.showStatusCheck(t||"提交失败")})},submitStartLuck:function(){var t=this,a=t.vars,i=t.doms;i.gift;t.startLuckDraw(function(){t.hideDrawDlg(),a.luckStatus="start",t.removeAllBoxStatus(),i.$start.text("提交"),i.$reset.text("重置"),i.$reset.show(),t.showStatusCheck(),i.$input.attr("readonly",!1),i.$giftList.hide(),t.hideLimitList(),e.dialog.tips_black("抽奖活动已开启")})},saveLuckDrawInfo:function(e,t){this.sendAjax(p.urls.saveDrawInfo,e,function(e,a){return e?void t(3,e):void t(+a.data.status)},"POST")},getLuckEnter:function(t){this.sendAjax(p.urls.luckEnter,{},function(a,i){return a?void e.dialog.tips_black(a):void t(i.data)})},getOfficeGift:function(t,a){return t?void this.sendAjax(p.urls.officeGift,{},function(t,i){if(t)return void e.dialog.tips_black(t);var s=i.data;a(0==s.join_type?{prize_name:s.prize_name,official_prize_id:s.official_prize_id,prize_left_num:s.prize_left_num,prize_img:s.prize_img,join_type:s.join_type}:1==s.join_type?{prize_name:s.prize_name,official_prize_id:s.official_prize_id,prize_left_num:s.prize_left_num,prize_img:s.prize_img,join_type:s.join_type,command_content:s.join_condition.command_content}:{prize_name:s.prize_name,official_prize_id:s.official_prize_id,prize_left_num:s.prize_left_num,prize_img:s.prize_img,join_type:s.join_type,gift_id:s.join_condition.gift_id,is_invalid:s.join_condition.is_invalid,gift_num:s.join_condition.gift_num,gift_name:s.join_condition.gift_name,gift_price:s.join_condition.gift_price})}):void a("")},getNowLuckDrawInfo:function(t){this.sendAjax(p.urls.nowLuckDrawInfo,{room_id:this.vars.room_id,t:(new Date).getTime()},function(a,i){return a?void e.dialog.tips_black(a):void t(i)})},startLuckDraw:function(t){this.sendAjax(p.urls.startLuckDraw,{},function(a,i){return a?void e.dialog.tips_black(a):void t(i)},"POST")},getRoomActInfo:function(t){this.sendAjax(p.urls.getActInfo,{},function(a,i){if(a)return void e.dialog.tips_black(a);var s=i.data;return 0!==+s.status?void e.dialog.tips_black(s.start_info):void t(i)})},resetLuckDraw:function(t){this.sendAjax(p.urls.resetDraw,{},function(a,i){return a?void e.dialog.tips_black(a):void t(i)},"POST")},endLuckDraw:function(){this.sendAjax(p.urls.endLuckDraw,{},function(t,a){return t?(r.exe("js_luckdraw_end_fail"),void e.dialog.tips_black(t)):void 0},"POST")},getGiftList:function(e){this.sendAjax(p.urls.getGiftList,{},function(t,a){return t?void e([]):void e(a.data||[])})},initLimitList:function(){var e=this,t=this.doms;t.$limitScope.text("全部水友"),t.$limitScope.attr("data-val",0),e.clearScopeLimitCur(),t.$limitList.find(".item").eq(0).addClass("scopeCur"),t.$limitTime.text(5),t.$limitTime.attr("data-val",300),e.clearTimeLimitCur(),t.$limitList.find(".col").eq(4).addClass("cur")},renderLimitList:function(e,t){var a=this,i=this.doms;e=void 0===e?0:e;var s=parseInt(e),n=["全部水友","关注我的水友","我的粉丝团水友","关注我且加入粉丝团"];if(i.$limitScope.text(n[s]),i.$limitScope.attr("data-val",s),a.clearScopeLimitCur(),i.$limitList.find('.item[data-val="'+s+'"]').addClass("scopeCur"),2===arguments.length){t=void 0===t?300:t;var o=parseInt(t),r=o/60;i.$limitTime.text(r),i.$limitTime.attr("data-val",o),a.clearTimeLimitCur(),i.$limitList.find('.col[data-val="'+o+'"]').addClass("cur")}},hideLimitList:function(){var e=this.doms;e.$limitList.hide(),e.$box.find(".arrow-up").removeClass("arrow-up")},clearTimeLimitCur:function(){var e=this.doms;e.$limitList.find(".col").removeClass("cur")},clearScopeLimitCur:function(){var e=this.doms;e.$limitList.find(".item").removeClass("scopeCur")},getOfficialDefaultPic:function(){var e=o.get("sys.web_url");return e+"app/douyu/res/page/room-normal/draw/officialGiftDeffault.png"},sendAjax:function(e,t,a,i){if(!e)return void a("请求路径配置错误");var s=this,n=i||"GET",o={url:e,type:n,dataType:"json",data:t||{}};"POST"===n?h.getCSRFCookie(function(e){o.data[e.name]=e.value,s.sendRequest(o,a)}):s.sendRequest(o,a)},sendRequest:function(t,a){var i=function(e){0!==+e.error?a(e.msg):a(null,e)},s=function(e){a(e)},n=e.extend(t,{success:i,error:s});e.ajax(n)}};r.reg("room_draw_end",function(t){var a=JSON.parse(t),i=a.light;if(i)return void v.endLuckDraw();var s;s=a.pNum>0?l.string.join("<h3>确定结束抽奖？</h3>","<p>结束后，系统将从已参与的<span>",a.pNum,"名</span>水友中抽取满足条件的用户，来获得奖品</p>"):l.string.join("<h3>确定结束抽奖？</h3>","<p>当前还没有人参与抽奖</p>"),p.dyDlgHand&&p.dyDlgHand.hide(),p.dyDlgHand=e.dy_dialog(s,{className:"shark-ui-confirm luck-draw luck-draw-end-dlg",mask:!0,zIndex:502,buttons:[{content:"结束抽奖",callback:function(){this.hide(),v.endLuckDraw()}},{content:"再看看",callback:function(){this.hide()}}]})}),r.reg("room_draw_copy_command",function(a){return d.check()?(t.trigger("mod.msg.luckDraw.info",{type:"dcc"}),void(p.doms.$copy?p.doms.$copy.val(a):p.doms.$copy=e('#js-send-msg [data-type="cont"]').val(a))):void d.show("login")}),r.reg("room_draw_send_gift",function(a){if(!d.check())return void d.show("login");t.trigger("mod.msg.luckDraw.info",{type:"dsg"});var i=JSON.parse(a),s=i.id,n=+i.num;c.getGift().done(function(a){if(p.giftConfigData=a||{},p.giftConfigData[s]){if(h.countBalance(+s,n))return p.dyDlgHand&&p.dyDlgHand.hide(),void(p.dyDlgHand=e.dy_dialog("当前余额不足，请充值后再进行操作~",{className:"shark-ui-confirm luck-draw",mask:!0,zIndex:502,buttons:[{content:"确认",callback:function(){this.hide()}}]}));if(n>0)if(n>1){if(p.delayGiftQueue){p.delayGiftQueue=!1;var i=setTimeout(function(){p.delayGiftQueue=!0,clearTimeout(i),i=null},300),o=0,r=setInterval(function(){g.render().done(function(){var a=e('#gift-content [data-type=gift][data-giftid="'+s+'"]');t.trigger("mod.gift.draw.batch.send",{target:a,number:1,batch:1})}),o++,o>=n&&(clearInterval(r),r=null)},300)}}else g.render().done(function(){var a=e('#gift-content [data-type=gift][data-giftid="'+s+'"]');t.trigger("mod.gift.draw.batch.send",{target:a,number:1,batch:1})})}})}),r.reg("room_follow",function(){t.trigger("mod.room.msg.follow")}),r.reg("room_draw_join",function(e){var t=h.hasJoinDraw(e);r.exe("js_draw_join",{activityId:e,status:t?1:0})}),r.reg("room_draw_status",function(e,t){if(t)p.flashDrawBtnIsClose[e]=!0;else{var a=h.hasJoinDraw(e);if(!a){var i=n.get("drawJoinArray"),s=i?JSON.parse(i):[];s.length>=15&&s.shift(),s.push({activityId:e,status:1,timestap:(new Date).getTime()}),n.set("drawJoinArray",JSON.stringify(s)),p.hasJoinDrawCache[e]=!0}}}),r.reg("room_data_handler",function(a){var s=i.decode(a).too();switch(s.type){case"lde":case"lde_v2":t.trigger("mod.msg.luckDraw.info",s);var n=s.end_type;if(!n||1!==+n)return p.dyDlgHand&&p.dyDlgHand.hide(),void(p.dyDlgHand=e.dy_dialog("服务器开了一会儿小差，抽奖终止",{className:"shark-ui-confirm luck-draw",mask:!0,zIndex:502,buttons:[{content:"确认",callback:function(){this.hide()}}]}));var r=h.isAnchor(),l=h.isWinner(JSON.parse(s.win_list)),d=h.hasJoinDraw(s.activity_id);if(!r&&"3"!==s.join_type&&!l&&!d&&p.flashDrawBtnIsClose[s.activity_id])return;h.getAdsFromActivity(function(e){var t=h.resolveUserList({list:JSON.parse(s.win_list),join:s.join_count,name:s.gift_name,gift:s.gift_count,prize:s.prize_name,img:s.prize_img,time:s.join_time,fans:s.fans_count||0,follow:s.follow_count||0,lotteryRange:s.lottery_range||0,activityId:s.activity_id||0,activityType:s.activity_type||0,prizeType:s.prize_type||-1,adListIndex:JSON.parse(s.ad_list),adListContent:e.lottery_setting||{}});if(r||l||d)v.showEndDlg(t);else{v.showEndDlg(t);var a=setTimeout(function(){v.removeLastDialog(),clearTimeout(a)},5e3)}});break;case"lda":var c=s.is_pass,u=s.remark;+c?v.changeDrawType("ready"):v.changeDrawType("failed",u),v.showCheckBox(0,+c);break;case"lds":case"lds_v2":t.trigger("mod.msg.luckDraw.info",s),v.hideDrawDlg();var g=o.get("room.owner_name");v.removeLastDialog(),h.sendNotice("start",{anchorName:g});break;case"ldt":var m=+s.tips_type;1===m?(p.dyDlgHand&&p.dyDlgHand.hide(),p.dyDlgHand=e.dy_dialog("抽奖活动会于5分钟后结束，请及时开启抽奖，<br>不要让水友等太久哟~",{className:"shark-ui-confirm luck-draw",mask:!0,zIndex:502,buttons:[{content:"确认",callback:function(){this.hide()}}]})):2===m&&(p.dyDlgHand&&p.dyDlgHand.hide(),p.dyDlgHand=e.dy_dialog("主播离开一会儿，抽奖活动正常进行~",{className:"shark-ui-confirm luck-draw",mask:!0,zIndex:502,buttons:[{content:"确认",callback:function(){this.hide()}}]}));break;case"drbm":t.trigger("mod.chat.msg.send.cd",s.cd)}});var b={init:function(){this.hasTipsReady()?e(".flexslider").show():this.render()},hasTipsReady:function(){return e(".flexslider").length>0},render:function(){var t=o.get("sys.web_url"),a='<div class="flexslider luckFlexSilder"><ul class="slides"><li><img src="'+t+'app/douyu/res/page/room-normal/luckdraw-tips/1.png?20170914" /></li><li><img src="'+t+'app/douyu/res/page/room-normal/luckdraw-tips/2.png?20170914" /></li><li><img src="'+t+'app/douyu/res/page/room-normal/luckdraw-tips/3.png?20170914" /></li><li><img src="'+t+'app/douyu/res/page/room-normal/luckdraw-tips/4.png?20170914" /></li></ul><div class="startLuckDraw"></div><div class="closeLuckDraw"></div></div>';e("body").append(a),n.set("firstLuckDraw",1),e(".flexslider").flexslider({animation:"slide",animationLoop:!1,prevText:"",nextText:"",keyboard:!1,before:function(t){2==t.currentSlide&&"next"==t.direction?(e(".flexslider").find(".flex-control-nav").hide(),e(".flexslider").find(".startLuckDraw").show()):(e(".flexslider").find(".flex-control-nav").show(),e(".flexslider").find(".startLuckDraw").hide())}}),this.bindEvent()},bindEvent:function(){var t=e(".flexslider");t.on("click",".closeLuckDraw",function(){t.remove()}),t.on("click",".startLuckDraw",function(){t.remove(),v.doms.$box&&v.doms.$box.is(":visible")||v.checkActStatus()})}};return{init:function(){v.init()}}}),define("douyu/page/room/normal/mod/intimate-task-assembly",["jquery","shark/util/template/2.0","shark/util/flash/data/1.0","douyu/context"],function(e,t,a,i){function s(t){this.word="",this.status="default",e.extend(this,t),this.checkStu(),this.$tag=e(r(this))}var n={type:function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},join:function(){return Array.prototype.join.call(arguments,"")}},o=["intimate-stu-edit","intimate-stu-select","intimate-stu-audit","intimate-stu-success","intimate-stu-failed"].join(" "),r=function(){var e=n.join('<div class="intimate-task-word {{ _initcls }}" data-name="{{ task_name }}" data-type="{{ recommend_type ? recommend_type : 0 }}" data-id="{{ id }}" data-status="default">',"{{ task_name }}",'<i class="intimate-task-close"></i>','<div class="itt-audit">审核中',"<i></i>","</div>",'<div class="itt-success">已通过',"<i></i>","</div>",'<div class="itt-failed">未通过',"<i></i>","</div>","</div>");return t.compile(e)}();return s.prototype={constructor:s,checkStu:function(){switch(""+this.status){case"0":this.status="audit",this._initcls="intimate-stu-audit";break;case"1":+this.sign?(this.status="success",this._initcls="intimate-stu-success"):this.status="default";break;case"2":this.status="failed",this._initcls="intimate-stu-failed";break;default:this.status="default",this._initcls=""}},setStatus:function(e){if("string"===n.type(e)&&("audit"!==this.status||"edit"!==e))switch(this.lastStatus=this.status,e){case"edit":this.setToEdit();break;case"select":this.setToSelect();break;case"audit":this.setToAudit();break;case"success":this.setToSuccess();break;case"failed":this.setToFailed();break;default:this.setToDefault()}},setToSelect:function(){this.status="select",this.$tag.removeClass(o).addClass("intimate-stu-edit intimate-stu-select").attr("data-status","select")},setToEdit:function(){this.status="edit",this.$tag.removeClass(o).addClass("intimate-stu-edit").attr("data-status","edit")},setToAudit:function(){this.status="audit",this.$tag.removeClass(o).addClass("intimate-stu-audit").attr("data-status","audit")},setToSuccess:function(){this.status="success",this.$tag.removeClass(o).addClass("intimate-stu-success").attr("data-status","success")},setToFailed:function(){this.status="failed",this.$tag.removeClass(o).addClass("intimate-stu-failed").attr("data-status","failed")},setToDefault:function(){this.status="default",this.$tag.removeClass(o).attr("data-status","default")}},s}),define("douyu/page/room/normal/mod/intimate-task",["jquery","shark/observer","shark/util/lang/1.0","shark/util/template/2.0","shark/util/cookie/1.0","shark/util/storage/1.0","shark/util/flash/data/1.0","douyu/context","douyu/page/room/base/api","douyu/com/exjsonp","douyu/com/user","douyu/com/get-gift-configs","douyu/com/room-gift-tmp"],function(e,t,a,i,s,n,o,r,l,d,c,u,g){var m={waitSubmit:!1,crsf:"/curl/csrfApi/getCsrfCookie",getCSRFCookie:function(t){var a=this,i=s.get(r.get("sys.tvk"));return i?void(t&&t({name:$SYS.tn,value:i})):void e.ajax({url:a.crsf,type:"GET",dataType:"json",success:function(e){0===+e.error&&a.getCSRFCookie(t)}})},sendAjax:function(t){var a=this,i={url:"",type:"GET",data:{},dataType:"JSON",success:null,error:null,complete:function(){a.waitSubmit=!1}},s=e.extend(!0,i,t);s.url&&(a.waitSubmit||(a.waitSubmit=!0,"post"===s.type.toLowerCase()?a.getCSRFCookie(function(t){s.data[t.name]=t.value,e.ajax(s)}):e.ajax(s)))}},p={init:function(){this.hasTipsReady()?e("#intimacy-task-userside-guide").show():this.render()},hasTipsReady:function(){return e("#intimacy-task-userside-guide").length>0},render:function(){var t=(r.get("sys.web_url"),'<div id="intimacy-task-userside-guide" class="flexslider"><ul class="slides"><li class="slides1"></li><li class="slides2"></li><li class="slides3"></li></ul><div class="inti-immediately-start">立即体验</div><div class="inti-close-guild"></div></div>');e("body").append(t),e("#intimacy-task-userside-guide").flexslider({animation:"slide",animationLoop:!1,prevText:"",nextText:"",keyboard:!1,before:function(t){1==t.currentSlide&&"next"==t.direction?(e("#intimacy-task-userside-guide").find(".flex-control-nav").hide(),e("#intimacy-task-userside-guide").find(".inti-immediately-start").show()):(e("#intimacy-task-userside-guide").find(".flex-control-nav").show(),e("#intimacy-task-userside-guide").find(".inti-immediately-start").hide())}}),this.bindEvent()},bindEvent:function(){var t=e("#intimacy-task-userside-guide");t.off().on("click",".inti-close-guild",function(){t.remove(),f.config.isPlayMethod&&e("#userside-intimacy-task-box").show(),f.config.isPlayMethod=!1}).on("click",".inti-immediately-start",function(){t.remove(),f.init(),f.config.isPlayMethod=!1})}},f={ajaxUrls:{giftListUrl:r.get("sys.webconfUrl")+"resource/common/gift/gift_template/"+r.get("room.giftTempId")+".json",taskListsUrl:"/member/anchor_task/get_intimate_task_setting",checkTaskNameUrl:"/member/anchor_task/invite_intimate_task_check",inviteTaskUrl:"/member/anchor_task/invite_intimate_task"},config:{roomId:parseInt(r.get("room.room_id"),10),preAcceptTLArr:[],limitIntimateTaskPrice:{limit_price:.1},giftListObj:{},isPlayMethod:!1,clickIndex:0,reTaskNameArr:[],tipText:{defaultPriceTip:"礼物总价值不得低于",limitPriceTip:"礼物价值需大于当前冠名",biddingBtn:"竞价",inviteBtn:"发出邀请"},isCompete:!1,biddingTask:""},doms:{},init:function(t,a){var i=e("#userside-intimacy-task-box");if(i.length>0)i.show(),t&&(this.setInitBiddingPage(a),this.isSameRecomTaskName(a),this.biddingUpdateGiftInfo(a),this.isduplicationOfName(a));else{var s=this.render();e("body").append(s),this.renderTaskListHtml.init(),this.renderLRGiftList.init(),this.bindEvent(),t&&(this.config.isCompete=!0,this.setInitBiddingPage(a),this.config.biddingTask=a)}},bindEvent:function(){this.getDoms(),this.clickPlayMethodBtn(),this.clickCloseBtn(),this.clickRecomDelTaskBtn(),this.setDefinedTaskVal(),this.clickSendInviBtn()},getDoms:function(){this.doms.$intimacyTaskBox=e("#userside-intimacy-task-box"),this.doms=e.extend(this.doms,{$intiPlayMethod:this.doms.$intimacyTaskBox.find(".inti-play-method"),$intiCloseBtn:this.doms.$intimacyTaskBox.find(".inti-close-btn"),$intiTaskDelete:this.doms.$intimacyTaskBox.find(".inti-task-delete"),$intiRecomTaskName:this.doms.$intimacyTaskBox.find(".inti-recommend-task-name"),$intiDefinedTask:this.doms.$intimacyTaskBox.find(".inti-user-defined-task"),$intiTaskName:this.doms.$intimacyTaskBox.find(".inti-task-name"),$intiErrorTip:this.doms.$intimacyTaskBox.find(".inti-error-tip"),$intiSendInviBtn:this.doms.$intimacyTaskBox.find(".inti-send-invitation-btn"),$intiGiftPriceTip:this.doms.$intimacyTaskBox.find(".inti-gift-price-tip"),$intiGiftPriceTipPre:this.doms.$intimacyTaskBox.find(".inti-gift-price-tip-pre"),$intiBiddingTip:this.doms.$intimacyTaskBox.find(".inti-bidding-tip"),$intiBiddingUsername:this.doms.$intimacyTaskBox.find(".inti-bidding-username"),$intiBiddingGiftname:this.doms.$intimacyTaskBox.find(".inti-bidding-gift-name"),$intiMinGiftPriceOrNum:this.doms.$intimacyTaskBox.find(".inti-min-gift-price"),$intiGiftPriceTipAfter:this.doms.$intimacyTaskBox.find(".inti-gift-price-tip-after")})},setInitBiddingPage:function(e){this.doms.$intiDefinedTask.val(e),this.doms.$intiErrorTip.addClass("active")},biddingUpdateGiftInfo:function(e){var t=this.matchBiddingListInfo(e);if(t){var a=t.gift_id,i=t.gift_num;this.updateGiftInfo(a,i)}},clickPlayMethodBtn:function(){var e=this;this.doms.$intiPlayMethod.off().on("click",function(){e.config.isPlayMethod=!0,e.isShowThisBox("hide"),p.init()})},isShowThisBox:function(e){"show"===e.toLowerCase()?this.doms.$intimacyTaskBox.show():this.doms.$intimacyTaskBox.hide()},clickCloseBtn:function(){var e=this;e.doms.$intiCloseBtn.off().on("click",function(){e.isShowThisBox("hide")})},clickRecomDelTaskBtn:function(){var t=this;t.doms.$intiTaskDelete.off().on("click",function(){t.setTaskNameShowState(2,""),e("#userside-intimacy-task-box").find(".inti-task-list-name").eq(t.config.clickIndex).removeClass("active").data("state",1),t.setBiddingTip(!1)})},setTaskNameShowState:function(e,t){1===e?(this.doms.$intiRecomTaskName.removeClass("active"),this.doms.$intiDefinedTask.addClass("active").val(""),this.doms.$intiTaskName.text(t),this.doms.$intiErrorTip.addClass("active")):(this.doms.$intiRecomTaskName.addClass("active"),this.doms.$intiDefinedTask.removeClass("active"))},setDefinedTaskVal:function(){var t=this;this.doms.$intiDefinedTask.off().on("keyup keydown change input keypress",function(){for(var t=e(this).val(),a=t.length,i=/^[\u4e00-\u9fa5]$/,s=0,n=0,o=0,r=0,l=0;a>l;l++)i.test(t.charAt(l))?s++:n++,2*s+n!==39&&2*s+n!==40||(o=s,r=n);if(2*s+n>=40){var d=t.substring(0,o+r);e(this).val(d)}}).on("blur",function(){var a=e(this).val(),i=t.getValueLength(a);return 4>i?void t.doms.$intiErrorTip.removeClass("active"):(t.doms.$intiErrorTip.addClass("active"),t.isSameRecomTaskName(a),void t.isduplicationOfName(a))})},getValueLength:function(e){for(var t=/^[\u4e00-\u9fa5]$/,a=0,i=0,s=e.length;s>i;i++)t.test(e.charAt(i))?a+=2:a++;return a},getGiftInfoDoms:function(){var t=e("#userside-intimacy-task-box"),a=t.find(".inti-gift-name"),i=t.find(".inti-gift-price"),s=t.find(".inti-gift-num");return{$intiGiftName:a,$intiGiftPrice:i,$intiGiftNum:s}},isduplicationOfName:function(e){var t=this.matchBiddingListInfo(e);if(t){var a=t.gift_id,i=t.gift_num,s=t.sponsor_name;this.setBiddingTip(!0,a,i,s,this.config.tipText.limitPriceTip,"")}else this.setBiddingTip(!1)},matchBiddingListInfo:function(e){var t=this.config.preAcceptTLArr.length,a=0,i=0,s="";if(0>=t)return!1;for(var n=0;t>n;n++)if(r.get("sys.uid")!==this.config.preAcceptTLArr[n].uid&&e===this.config.preAcceptTLArr[n].task_name){a=this.config.preAcceptTLArr[n].gift_id||0,i=parseInt(this.config.preAcceptTLArr[n].gift_num,10)||0,s=this.config.preAcceptTLArr[n].sponsor_name||"";break}return i?{gift_id:a,gift_num:i,sponsor_name:s}:!1},updateGiftInfo:function(e,t){var a=this.getGiftInfoDoms(),i=this.getGiftNameAndPrice(e),s=i.gift_name,n=i.gift_price;t=parseInt(t,10),t=t>=99?t:t+1,a.$intiGiftName.text(s).data("id",e),a.$intiGiftPrice.text(n),a.$intiGiftNum.val(t)},setBiddingTip:function(e,t,a,i,s,n){if(e){var o=this.getGiftNameAndPrice(t),r=o.gift_name,l=o.gift_price;l=this.renderLRGiftList.setRealPrice(l);var d=i;if(i){var c=5,u=i.length;u>c&&(i=i.substring(0,c)+"..."),i+="："}this.doms.$intiGiftPriceTipPre.text(s),this.doms.$intiBiddingTip.removeClass("active"),this.doms.$intiBiddingUsername.text(i).attr("title",d),this.doms.$intiBiddingGiftname.text(r).data("price",l),this.doms.$intiMinGiftPriceOrNum.text(a),this.doms.$intiSendInviBtn.text(this.config.tipText.biddingBtn),this.doms.$intiGiftPriceTipAfter.text(n)}else this.doms.$intiGiftPriceTipPre.text(this.config.tipText.defaultPriceTip),this.doms.$intiBiddingTip.addClass("active"),this.doms.$intiMinGiftPriceOrNum.text(this.config.limitIntimateTaskPrice.limit_price+"鱼翅"),this.doms.$intiSendInviBtn.text(this.config.tipText.inviteBtn),this.doms.$intiGiftPriceTipAfter.text("");this.renderLRGiftList.isValidGiftPrice(),this.doms.$intiGiftPriceTip.removeClass("active")},getGiftNameAndPrice:function(e){var t=this.renderLRGiftList.config.giftInfoArr[0],a=this.config.giftListObj[e]&&this.config.giftListObj[e].gift_name||t.gift_name,i=this.config.giftListObj[e]&&this.config.giftListObj[e].gift_price||t.gift_price;return{gift_name:a,gift_price:i}},isSameRecomTaskName:function(t){var a=e("#userside-intimacy-task-box").find(".inti-task-list-name"),i=a.length;if(0===this.config.reTaskNameArr.length)for(var s=0;i>s;s++)this.config.reTaskNameArr.push(a.eq(s).text());if(this.config.reTaskNameArr.length)for(var s=0;s<this.config.reTaskNameArr.length;s++)if(t===this.config.reTaskNameArr[s]){this.setTaskNameShowState(1,t),a.eq(s).addClass("active").data("state",2).siblings().removeClass("active").data("state",1),this.config.clickIndex=s;break}},clickSendInviBtn:function(){var t=this;this.doms.$intiSendInviBtn.off().on({mousedown:function(){e(this).addClass("active")},mouseup:function(){var a="",i=e("#userside-intimacy-task-box").find(".inti-valid-icon"),s=e(this).data("isclick");if(e(this).removeClass("active"),"1"==s){if(e(this).data("isclick","2"),t.doms.$intiDefinedTask.hasClass("active"))a=t.doms.$intiTaskName.text();else{a=t.doms.$intiDefinedTask.val();var n=t.getValueLength(a);if(4>n)return e(this).data("isclick","1"),void t.doms.$intiErrorTip.removeClass("active")}if(i.hasClass("active")){var o=375;return t.setGiftPriceTipAnimate(o),void setTimeout(function(){t.doms.$intiSendInviBtn.data("isclick","1")},o)}t.ckeckTaskContidion(a)}}})},ckeckTaskContidion:function(a){var i=this,s=e("#userside-intimacy-task-box"),n=s.find(".inti-gift-name"),o=s.find(".inti-gift-num"),r=s.find(".inti-gift-price"),l=n.data("id"),d=o.val(),c=r.text();m.sendAjax({url:i.ajaxUrls.checkTaskNameUrl,type:"POST",data:{room_id:i.config.roomId,task_name:a,gift_id:l,gift_num:d},success:function(s){if(s){var n=parseInt(s.error,10);switch(n){case 0:i.sureInviteDialog(function(){i.sureSendInvitation(a,l,d)});break;case 1:-1!=c.indexOf("鱼丸")?t.trigger("mod.gift.draw.fish.dialog"):i.remindYCLow();break;case 2:i.setGiftPriceTipAnimate(375),i.renderTaskListHtml.checkPreAcceptTaskList();break;case 3:var o=s.msg.split(",")[0]||0,r=+s.msg.split(",")[1]||0;i.setBiddingTip(!0,o,r,"","当前主播任务列表已满，您需出价大于","价值的礼物才能发起。"),i.doms.$intiGiftPriceTip.addClass("active"),i.setGiftPriceTipAnimate(375);break;case 4:var u=+s.msg||0;u?(i.config.limitIntimateTaskPrice.limit_price=u,i.doms.$intiMinGiftPriceOrNum.text(u+"鱼翅"),i.setGiftPriceTipAnimate(375),i.renderLRGiftList.isValidGiftPrice()):e.dialog.tips_black("礼物总价值不得低于"+s.msg);break;default:e.dialog.tips_black(s.msg)}i.doms.$intiSendInviBtn.data("isclick","1")}},error:function(){e.dialog.tips_black("网络繁忙, 请刷新重试"),i.doms.$intiSendInviBtn.data("isclick","1")}})},sureInviteDialog:function(t){var a='<p class="inti-sponsor-invitation-title">是否发起亲密互动请求？</p><p class="inti-sponsor-invitation-content">主播接受请求后，系统将会<span>自动送出</span>对应数量的礼物</p>';e.dy_dialog(a,{className:"shark-ui-confirm intimacy-task-dialog",mask:!0,zIndex:600,buttons:[{content:"发出",className:"confirmsure",callback:function(){this.hide(),t()}},{content:"取消",callback:function(){this.hide()}}]})},sureSendInvitation:function(a,i,s){var n=this;m.sendAjax({url:n.ajaxUrls.inviteTaskUrl,type:"POST",data:{room_id:n.config.roomId,task_name:a,gift_id:i,gift_num:s},success:function(a){if(a){var i=parseInt(a.error,10);switch(i){case 0:n.isShowThisBox("hide"),e.dialog.tips_black("您已发出互动邀请，请等待主播接受");break;case 1:var s=e("#userside-intimacy-task-box").find(".inti-gift-price").text();-1!=s.indexOf("鱼丸")?t.trigger("mod.gift.draw.fish.dialog"):n.remindYCLow();break;case 2:n.setGiftPriceTipAnimate(375),n.renderTaskListHtml.checkPreAcceptTaskList();break;case 3:var o=a.msg.split(",")[0]||0,r=+a.msg.split(",")[1]||0;n.setBiddingTip(!0,o,r,"","当前主播任务列表已满，您需出价大于","价值的礼物才能发起。"),n.doms.$intiGiftPriceTip.addClass("active"),n.setGiftPriceTipAnimate(375);break;case 4:var l=+a.msg||0;l?(n.config.limitIntimateTaskPrice.limit_price=l,n.doms.$intiMinGiftPriceOrNum.text(l+"鱼翅"),n.setGiftPriceTipAnimate(375),n.renderLRGiftList.isValidGiftPrice()):e.dialog.tips_black("礼物总价值不得低于"+a.msg);break;default:e.dialog.tips_black(a.msg)}}}})},remindYCLow:function(){e.dialog({title:"提示",content:"<p>赠送失败<br/>鱼翅不足，点击获取！</p><i></i>",cancel:!0,okVal:"充值",cancelVal:"取消",skin:"gift-error",lock:!0,ok:function(){window.open("/web_game/welcome/18")}})},setGiftPriceTipAnimate:function(e){if(e)for(var t=e/3/5,a=0;3>a;a++)this.doms.$intiGiftPriceTip.animate({left:-10},2*t).animate({left:10},t).animate({left:0},2*t)},getInteract:function(){var t=e.Deferred(),a=this;return a.sprayInteract&&t.resolve(a.sprayInteract),d.load(r.get("sys.webconfUrl")+"/resource/common/interact.json","interact",function(e){a.sprayInteract=e,t.resolve(e)},function(e){t.reject(e)},function(){},!0),t.promise()},render:function(){var e=this,t=e.sprayInteract||{},s=t.mission_setting||{},n=a.string.join('<div id="userside-intimacy-task-box">','<div class="inti-title">','<a class="inti-play-method">玩法</a>','<div class="inti-close-btn"></div>',"</div>","{{ if (spray.intimate_open) }}",'<a href="{{ spray.link || "javascript:;" }}" class="spray-imt-active"><i></i>{{ spray.activity_name }}<span>{{ spray.link_name }}</span></a>',"{{ /if }}",'<div class="inti-accept-task-name">','<div class="inti-task-title">任务</div>','<div class="inti-select-task-box">','<div class="inti-select-task">','<div class="inti-recommend-task-name active"><span class="inti-task-name"></span><i class="inti-task-delete"></i></div>','<input class="inti-user-defined-task" type="text" placeholder="邀请主播表演什么，2-20个字" />',"</div>","</div>","</div>",'<div class="inti-error-tip-box"><div class="inti-error-tip active">*请输入2-20个字</div></div>','<div class="inti-ishas-task-list-wrap">',"</div>",'<div class="inti-set-gift-title">礼物设置</div>','<div class="inti-set-gift">',"</div>",'<div class="inti-gift-price-tip">','<span class="inti-gift-price-tip-pre">礼物总价值不得低于</span>','<span class="inti-bidding-tip active"><span class="inti-bidding-username"></span><span class="inti-bidding-gift-name" data-price="1">赞</span>×</span>','<span class="inti-min-gift-price">1鱼翅</span>','<span class="inti-gift-price-tip-after"></span>',"</div>",'<div class="inti-send-invitation"><div class="inti-send-invitation-btn" data-isclick="1">发出邀请</div></div>','<div class="inti-agree-tip">发出邀请表示已同意<a class="init-agree-tip-name" href="https://www.douyu.com/cms/gong/201705/17/5341.shtml" target="_blank">《亲密互动任务规范》</a></div>',"</div>");
return i.compile(n)({spray:s})},renderTaskListHtml:{doms:{},init:function(){this.getTaskListsData()},getTaskListsData:function(){var t=this;m.sendAjax({url:f.ajaxUrls.taskListsUrl,type:"POST",data:{room_id:f.config.roomId},success:function(a){if(a){var i=parseInt(a.error,10);if(0===i){var s=a.data,n=s&&s.recommend_intimate_task_list,o=s&&s.limit_intimate_task_price,r=s&&s.pre_accept_intimate_task_list;f.config.preAcceptTLArr=r||[],f.config.limitIntimateTaskPrice=o||{};var l=t.render(n),d=e("#userside-intimacy-task-box");d.find(".inti-ishas-task-list-wrap").html(l),d.find(".inti-min-gift-price").html((o.limit_price||"0.1")+"鱼翅"),f.config.isCompete&&(f.isSameRecomTaskName(f.config.biddingTask),f.biddingUpdateGiftInfo(f.config.biddingTask),f.isduplicationOfName(f.config.biddingTask)),t.bindEvent()}}}})},bindEvent:function(){this.getDoms(),this.clickChangeBatchBtn(),this.clickRecomTaskName()},getDoms:function(){var t=e("#userside-intimacy-task-box");this.doms=e.extend(this.doms,{$intiTaskListBox:t.find(".inti-task-list-box"),$intiTaskList:t.find(".inti-task-list"),$intiChangeBatch:t.find(".inti-change-batch")})},clickChangeBatchBtn:function(){var t=this,a=this.doms.$intiTaskListBox.height(),i=this.doms.$intiTaskList.height(),s=Math.ceil(i/a),n=0;return a>=i?void this.doms.$intiChangeBatch.hide():void this.doms.$intiChangeBatch.off().on("click",function(){n++,n=n>=s?0:n,e(this).removeClass("active"),t.doms.$intiTaskList.css("top",-a*n+"px")})},clickRecomTaskName:function(){var t=this;t.doms.$intiTaskList.off().on("click",".inti-task-list-name",function(){var t=e(this).index(),a=e(this).text(),i=parseInt(e(this).data("state"),10);1===i?(e(this).addClass("active").data("state",2).siblings().removeClass("active").data("state",1),f.config.clickIndex=t,f.setTaskNameShowState(1,a),f.isduplicationOfName(a)):(e(this).removeClass("active").data("state",1),f.setTaskNameShowState(2,""),f.setBiddingTip(!1))})},userSideSendGifts:function(a,i){return c.check()?(a=a||0,i=i||0,void u.getGift().done(function(s){if(s&&s[a]&&i>0)if(i>1)var n=0,o=setInterval(function(){g.render().done(function(){var i=e('#gift-content [data-type=gift][data-giftid="'+a+'"]');t.trigger("mod.gift.draw.batch.send",{target:i,number:1,batch:1})}),n++,n>=i&&(clearInterval(o),o=null)},300);else g.render().done(function(){var i=e('#gift-content [data-type=gift][data-giftid="'+a+'"]');t.trigger("mod.gift.draw.batch.send",{target:i,number:1,batch:1})})})):void c.show("login")},deleteTask:function(e){var t=0;e=parseFloat(e,10)||0;for(var a=0,i=f.config.preAcceptTLArr.length;i>a;a++)if(t=parseFloat(f.config.preAcceptTLArr[a].flow_id,10),e===t){f.config.preAcceptTLArr.splice(a,1);break}},addNewTask:function(e){var t={flow_id:e.fid,task_name:e.tn,uid:e.uid,sponsor_name:e.sn,gift_id:e.gfid,gift_num:e.gfc};f.config.preAcceptTLArr.push(t)},checkPreAcceptTaskList:function(){var e=this.getCurrentTaskName();f.isduplicationOfName(e)},getCurrentTaskName:function(){var t=e("#userside-intimacy-task-box"),a=t.find(".inti-user-defined-task"),i=t.find(".inti-task-name"),s="";return s=a.hasClass("active")?i.text():a.val()},render:function(e){var t=a.string.join('<div class="inti-recommend-title {{ taskNameData.length > 0 ? "" : "active" }}">','推荐<div class="inti-change-batch">换一批</div>',"</div>",'<div class="inti-task-list-box {{ taskNameData.length > 0 ? "" : "active" }}">','<ul class="inti-task-list">',"{{ each taskNameData as item index }}",'<li class="inti-task-list-name" data-id="{{item.id}}" data-state="1">{{item.task_name}}</li>',"{{ /each }}","</ul>","</div>",'<div class="inti-no-recommend-task-box {{taskNameData.length > 0 ? "active" : ""}}">','<div class="inti-no-recommend-task">',"<h5>您可邀请主播进行才艺表演或回答问题</h5>","<p>游戏：<span>带水友上分、秀一把露娜</span></p>","<p>娱乐：<span>椅子舞、唱歌（歌名）、来一发抽奖</span></p>","","</div>","</div>");return i.compile(t)({taskNameData:e})}},renderLRGiftList:{config:{giftInfoArr:[]},doms:{},init:function(){this.getRoomGiftListData()},getRoomGiftListData:function(){var t=this;d.load(f.ajaxUrls.giftListUrl,"roomGiftConfig",function(a){var i=[];if(a&&0!==a.length){var s=a.length;t.handleJSONData(a);for(var n=0;s>n;n++)if(1!==parseInt(a[n].isAlipay,10)){var o=parseFloat(a[n].gt,10);if(0===o||2===o){var r={};r.gift_id=a[n].id,r.gift_name=a[n].name,r.gift_price=a[n].price_name,i.push(r)}}var l=t.render(i);t.config.giftInfoArr=i,e("#userside-intimacy-task-box").find(".inti-set-gift").html(l);for(var n=0;n<i.length;n++)f.config.giftListObj[i[n].gift_id]={gift_name:i[n].gift_name,gift_price:i[n].gift_price};t.bindEvent()}})},handleJSONData:function(e){for(var t=null,a=e.length,i=0;a-1>i;i++)for(var s=0;a-i-1>s;s++)this.switchYuchiPrice(e[s])>this.switchYuchiPrice(e[s+1])&&(t=e[s],e[s]=e[s+1],e[s+1]=t)},switchYuchiPrice:function(e){return"undefined"==typeof e.pc?0:1===+e.type?e.pc/1e3:e.pc/100},bindEvent:function(){this.getDoms(),this.addScrollStyle(),this.clickPullDownBtn(),this.clickIntiPdgfOption(),this.setGiftNums()},getDoms:function(){this.doms.$intimacyTaskBox=e("#userside-intimacy-task-box"),this.doms=e.extend(this.doms,{$intiGiftInfo:this.doms.$intimacyTaskBox.find(".inti-gift-info"),$intiGiftName:this.doms.$intimacyTaskBox.find(".inti-gift-name"),$intiGiftPrice:this.doms.$intimacyTaskBox.find(".inti-gift-price"),$intiPdgfSelect:this.doms.$intimacyTaskBox.find(".inti-pdgf-select"),$intiPdgfOption:this.doms.$intimacyTaskBox.find(".inti-pdgf-option"),$intiPdgfName:this.doms.$intimacyTaskBox.find(".inti-pdgf-name"),$intiPdgfPrice:this.doms.$intimacyTaskBox.find(".inti-pdgf-price"),$intiGiftNum:this.doms.$intimacyTaskBox.find(".inti-gift-num"),$intiValidIcon:this.doms.$intimacyTaskBox.find(".inti-valid-icon")})},addScrollStyle:function(){this.doms.$intiPdgfSelect.mCustomScrollbar()},clickPullDownBtn:function(){var t=this;this.doms.$intiGiftInfo.off().on("click",function(){var a=e(this).data("state");1==a?(t.doms.$intiPdgfSelect.removeClass("active"),e(this).data("state",2)):(t.doms.$intiPdgfSelect.addClass("active"),e(this).data("state",1))})},clickIntiPdgfOption:function(){var t=this;this.doms.$intiPdgfOption.off().on("click",function(){var a=e(this).index(),i=t.doms.$intiPdgfName.eq(a).text(),s=t.doms.$intiPdgfName.eq(a).data("id"),n=t.doms.$intiPdgfPrice.eq(a).text();t.doms.$intiGiftName.text(i).data("id",s),t.doms.$intiGiftPrice.text(n),t.doms.$intiPdgfSelect.addClass("active"),t.doms.$intiGiftInfo.data("state",1),t.isValidGiftPrice(),t.stopPropagationFn()})},stopPropagationFn:function(e){var t=arguments.callee.caller.arguments[0]||window.event||e;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},setGiftNums:function(){var t=this;this.doms.$intiGiftNum.off().on("keyup keydown change input keypress",function(){var a=e(this).val();/[\D]/.test(a)&&(a=a.replace(/[\D]/g,""),e(this).val(a)),t.isValidGiftPrice()})},isValidGiftPrice:function(){var t=e("#userside-intimacy-task-box"),a=t.find(".inti-bidding-tip"),i=parseInt(this.doms.$intiGiftNum.val(),10)||0,s=this.doms.$intiGiftPrice.text(),n=this.setRealPrice(s),o=parseFloat(f.config.limitIntimateTaskPrice.limit_price,10),r=i*n;if(a.hasClass("active"))this.setIsShowValidIcon(r>=o);else{var l=t.find(".inti-bidding-gift-name"),d=t.find(".inti-min-gift-price"),c=l.data("price"),u=parseInt(d.text(),10),g=c*u;this.setIsShowValidIcon(r>g)}},setRealPrice:function(e){var t=parseFloat(e,10)||0;return t=-1!==e.indexOf("鱼丸")?t/1e3:t},setIsShowValidIcon:function(e){e?this.doms.$intiValidIcon.removeClass("active"):this.doms.$intiValidIcon.addClass("active")},render:function(e){var t=a.string.join('<div class="inti-gift-info" data-state="1">','<span class="inti-gift-name" data-id="{{giftData[0].gift_id}}">{{giftData[0].gift_name || "赞"}}</span>','<span class="inti-gift-price">{{giftData[0].gift_price || "0.1鱼翅"}}</span>','<span class="inti-pull-down"></span>','<div class="inti-pdgf-select active">',"{{ each giftData as item index }}",'<div class="inti-pdgf-option"><span class="inti-pdgf-name" data-id="{{item.gift_id}}">{{item.gift_name}}</span><span class="inti-pdgf-price">{{item.gift_price}}</span></div>',"{{ /each}}","</div>","</div>",'<span class="inti-multiply"></span>','<div class="inti-gift-num-box"><input class="inti-gift-num" type="text" placeholder="1-99" maxlength="2" />个</div>','<i class="inti-valid-icon active"></i>');return i.compile(t)({giftData:e})}}};return l.reg("room_data_handler",function(t){var a=f.renderTaskListHtml,i=o.decode(t).too(),s=i.type;switch(s){case"ittl":var n=i.list;n=o.isArray(n)?o.decode(n):[{value:n}];for(var l=null,d=null,c=0,u=n.length;u>c;c++)if(l=n[c].value,d=l&&o.decode(l).too(),d&&d.uid==r.get("sys.uid")){var g=+d.cgfc||0,m=+d.rgfc||0;if(m>g){var p=d.gfid,h=m-g;a.userSideSendGifts(p,h)}}break;case"task_qmyq":if(e("#userside-intimacy-task-box").length<=0)return;var v=parseFloat(i.ktfid,10)||0;0!==v&&a.deleteTask(v),a.addNewTask(i),a.checkPreAcceptTaskList();break;case"task_qmap":if(e("#userside-intimacy-task-box").length<=0)return;var b=i.fid;a.deleteTask(b),a.checkPreAcceptTaskList();break;case"task_qmii":if(e("#userside-intimacy-task-box").length<=0)return;var b=i.fid;a.deleteTask(b),a.checkPreAcceptTaskList();break;case"task_qmar":if(1===parseInt(i.is_pass,10)&&r.get("sys.uid")==i.uid){var p=i.gfid,h=+i.gfc;e.dialog.tips_black("主播接受了您的邀请，系统将自动送出您预设的礼物"),a.userSideSendGifts(p,h)}if(e("#userside-intimacy-task-box").length<=0)return;var b=i.fid;a.deleteTask(b),a.checkPreAcceptTaskList()}}),{init:function(){var e=r.get("sys.uid")==r.get("room.owner_uid");e||(f.getInteract().then(function(e){e&&e.mission_setting&&l.exe("js_spray_interact",JSON.stringify(e.mission_setting))}),l.reg("room_chongnengv3",function(e){var t=JSON.parse(e),a=t.type;switch(a){case"rule":0==t.data&&p.init();break;case"invite":f.init();break;case"compete":f.init(!0,t.data);break;case"give":var i=t.data||0;f.renderTaskListHtml.userSideSendGifts(i,1);break;case"send":var s=t.data;if(r.get("sys.uid")==s.uid){var i=s.gid||0,n=+s.need||0;n&&f.renderTaskListHtml.userSideSendGifts(i,n)}break;case"login":c.check()||c.show("login")}}))}}}),define("douyu/page/room/normal/mod/intimate-task-anchor",["jquery","shark/observer","shark/util/lang/1.0","shark/util/template/2.0","shark/util/cookie/1.0","shark/util/storage/1.0","shark/util/flash/data/1.0","douyu/context","douyu/com/user","douyu/com/exjsonp","douyu/page/room/base/api","douyu/page/room/normal/mod/intimate-task-assembly"],function(e,t,a,i,s,n,o,r,l,d,c,u){var g={crsf:"/curl/csrfApi/getCsrfCookie",getCSRFCookie:function(t){var a=this,i=s.get(r.get("sys.tvk"));return i?void(t&&t({name:$SYS.tn,value:i})):void e.ajax({url:a.crsf,type:"GET",dataType:"json",success:function(e){0===+e.error&&a.getCSRFCookie(t)}})},type:function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},showErrDlg:function(t,a){a&&e.dy_dialog(a,{mask:!0,zIndex:502,buttons:[{content:"确认",callback:function(){this.hide()}}]})},getStrLength:function(e){if("string"!==g.type(e))return-1;for(var t=0,a=0,i=e.length;i>a;a++)t+=e.charCodeAt(a)>255?2:1;return t},sendAjax:function(e,t,a,i){if(!e)return void a("请求路径配置错误");var s=this;if(!s.waitSubmit){s.waitSubmit=!0;var n=i||"GET",o={url:e,type:n,dataType:"json",data:t||{}};"POST"===n?s.getCSRFCookie(function(e){o.data[e.name]=e.value,s.sendRequest(o,a)}):s.sendRequest(o,a)}},sendRequest:function(t,a){var i=this,s=function(e){i.waitSubmit=!1,0!==+e.error?a(+e.error,e.msg):a(null,e)},n=function(e){i.waitSubmit=!1,a(-1,e)},o=e.extend(t,{success:s,error:n});e.ajax(o)}},m={init:function(t){this.nextCallback=t,this.hasTipsReady()?e("#intimacy-task-anchorside-guide").show():this.render()},hasTipsReady:function(){return e("#intimacy-task-anchorside-guide").length>0},render:function(){var t='<div id="intimacy-task-anchorside-guide" class="flexslider"><ul class="slides"><li class="slides1"></li><li class="slides2"></li><li class="slides3"></li></ul><div class="inti-immediately-start">立即体验</div><div class="inti-close-guild"></div></div>';e("body").append(t),e("#intimacy-task-anchorside-guide").flexslider({animation:"slide",animationLoop:!1,prevText:"",nextText:"",keyboard:!1,before:function(t){1==t.currentSlide&&"next"==t.direction?(e("#intimacy-task-anchorside-guide").find(".flex-control-nav").hide(),e("#intimacy-task-anchorside-guide").find(".inti-immediately-start").show()):(e("#intimacy-task-anchorside-guide").find(".flex-control-nav").show(),e("#intimacy-task-anchorside-guide").find(".inti-immediately-start").hide())}}),this.bindEvent()},bindEvent:function(){var t=this,a=e("#intimacy-task-anchorside-guide");a.off().on("click",".inti-close-guild",function(){a.remove(),"function"===g.type(t.nextCallback)&&t.nextCallback()}).on("click",".inti-immediately-start",function(){a.remove(),"function"===g.type(t.nextCallback)&&t.nextCallback()})}},p={price:function(e){var t=e||{},s=t.mission_setting||{},n=a.string.join('<div class="charge-task-intimate">','<div class="imt-anchor-set">',"{{ if (spray.intimate_open) }}",'<a href="{{ spray.link || "javascript:;" }}" class="spray-imt-active"><i></i>{{ spray.activity_name }}<span>{{ spray.link_name }}</span></a>',"{{ /if }}",'<a href="javascript:;" class="imt-add-close"></a>','<a href="javascript:;" class="imt-anchor-tab1">发布充能任务</a>','<a href="javascript:;" class="imt-anchor-tab2">设置亲密任务</a>','<div class="imt-teract-recommend js-teract-recommend-word imt-empty"><!-- 空列表imt-empty -->','<div class="imt-add-empty">',"</div>",'<div class="imt-teract-recommend-title">可供水友发起的亲密任务','<i class="imt-edit js-teract-recommend-edit" data-status="0">编辑</i>',"</div>",'<div class="imt-teract-recommend-content js-teract-recommend-list">','<div class="imt-teract-rec-sec js-teract-recommend-content"></div>',"</div>",'<div class="bottom-gradient"></div>',"</div>",'<div class="imt-add-self">','<div class="imt-self-box">','<input class="imt-self-input js-teract-recommend-task" maxlength="12" placeholder="自定义任务，2-6个字">','<a class="imt-self-add js-teract-recommend-add" href="javascript:;"><i>+</i>添加</a>',"</div>","</div>",'<div class="imt-teract-limit">','<div class="imt-teract-limit-title">',"任务最低礼物价值",'<input type="text" maxlength="5" class="imt-limit-price js-teract-recommend-price" placeholder="0.1">',"鱼翅","</div>",'<div class="imt-teract-limit-content">','可填<span class="js-teract-recommend-limit">0.1-2000鱼翅</span>，用户可通过竞价提升礼物价值，建议不要设置太高',"</div>",'<div class="imt-teract-limit-btn js-teract-recommend-icons"></div>',"</div>",'<div class="imt-teract-oper">','<div class="imt-teract-save js-teract-recommend-save">保存</div>',"</div>","</div>","</div>"),o=i.compile(n);return o({spray:s})}},f={imtTask:{},clearTagMark:!1,init:function(){t.on("mod.energy.imt.show",function(e){return e?void f.checkNoviceTimes():void f.showImtDlg()}),f.getInteract().then(function(e){e&&e.mission_setting&&c.exe("js_spray_interact",JSON.stringify(e.mission_setting))})},checkNoviceTimes:function(){var e=this;e.checkOtherActive(function(){e.showNoviceGuide(function(){e.showImtDlg()})})},showImtDlg:function(){var e=this;e.clearTagMark=!1,e.getInteract().then(function(){e.imtTask.$box||(e.initImtTask(),e.bindImtEvent()),e.toggleImtDlg(!0),e.imtTask.$edit.attr("data-status","0").text("编辑"),e.getImtTaskWord(function(){e.rimt&&.1!==+e.rimt.price&&e.imtTask.$price.val(e.rimt.price),e.rimt&&e.rimt.iconStatus?e.imtTask.$iconStatus.html('如果您不想水友向您发出邀请，您可以<span class="icon-close js-icon-oper" data-oper="0">关闭亲密任务</span>'):e.imtTask.$iconStatus.html('您可以点击按钮开启亲密任务<span class="icon-open js-icon-oper" data-oper="1">开启亲密任务</span>'),e.rimt&&e.rimt.priceMax&&e.imtTask.$giftLimit.text(e.rimt.priceMin+"-"+e.rimt.priceMax+"鱼翅"),e.rimt&&0!=e.rimt.total&&e.addImtWord()})})},bindImtEvent:function(){var a,i=this,s=i.imtTask;s.$price.on("input propertychange",function(t){var s=e(this),n=s.val(),o=/^\d{0,3}\.{0,1}\d{0,1}$/;if(o.test(n))a=n;else{var r="undefinde"!==g.type(a)?a:i.rimt.price||.1;s.val(r)}}),s.$iconStatus.on("click",".js-icon-oper",function(){var t=e(this),a=t.attr("data-oper");i.setEntericonStatus(a,function(){+a?s.$iconStatus.html('如果您不想水友向您发出邀请，您可以<span class="icon-close js-icon-oper" data-oper="0">关闭亲密任务</span>'):s.$iconStatus.html('您可以点击按钮开启亲密任务<span class="icon-open js-icon-oper" data-oper="1">开启亲密任务</span>')})}),s.$box.on("click",".imt-anchor-tab1",function(e){i.toggleImtDlg(),t.trigger("mod.energy.charge.show")}).on("click",".imt-add-close",function(e){i.toggleImtDlg()}).on("click",".js-teract-recommend-save",function(e){var t=s.$price.val();t=t.replace(/\.+$/,""),i.updateLimitPrice(t||.1)}).on("click",".js-teract-recommend-add",function(t){var a=i.getNewTaskName();a?(s.$task.val(""),i.updataNewTask(a,function(t){e.dy_dialog.tips_black("自定义任务需要2-3分钟审核~"),i.addImtItem(t)})):e.dy_dialog.tips_black("请输入2-6个字~")}).on("click",".js-teract-recommend-edit",function(t){var a=e(this),s=a.attr("data-status"),n=i.rimt.list,o=n.length;if(1===+s){a.attr("data-status","0").text("编辑");for(var r=0;o>r;r++){var l=n[r].target;l.setStatus(l.lastStatus)}}else{a.attr("data-status","1").text("完成");for(var d=0;o>d;d++)n[d].target.setStatus("edit");i.clearTagMark||i.createTimerTask()}}).on("click",".intimate-task-close",function(t){var a=e(this),s=a.parents(".intimate-task-word"),n=s.attr("data-type"),o=s.attr("data-id");i.removeImtKey(o,n,function(){i.removeForList(o)})})},removeForList:function(e){for(var t=this.rimt.list,a=0,i=t.length;i>a;a++){var s=t[a];if(s.id==e){s.target.$tag.remove(),t.splice(a,1);break}}t.length||this.imtTask.$word.addClass("imt-empty")},getNewTaskName:function(){var e=this.imtTask.$task.val(),t=g.getStrLength(e);return t>=4&&12>=t?e:!1},addImtItem:function(e){e.target=new u(e),this.imtTask.$listCnt.prepend(e.target.$tag),this.imtTask.$list.mCustomScrollbar("update"),this.rimt.list.push(e),this.imtTask.$word.removeClass("imt-empty")},changeImtwordStu:function(e){if(e.rid==r.get("room.room_id")){var t,a=e.id,i=!1;try{t=this.rimt.list||[]}catch(s){t=[]}for(var n=0,o=t.length;o>n;n++){var l=t[n];if(l.id==a){i=!0;var d=+e.is_pass,c=1===d?"success":"failed";l.status=1===d?1:2,l.sign=1,l.target.setStatus(c)}}i&&(this.clearMark=!0,this.createTimerTask())}},addImtWord:function(){var e=this.imtTask.$list,t=this.imtTask.$listCnt,a=this.rimt.list;t.empty();for(var i=0,s=a.length;s>i;i++){var n=a[i];n.sign&&(this.clearMark=1),n.target=new u(n),t.append(n.target.$tag)}this.imtTask.$word.removeClass("imt-empty"),e.mCustomScrollbar(),this.createTimerTask()},toggleImtDlg:function(e){e?this.imtTask.$box.show():this.imtTask.$box.hide()},showNoviceGuide:function(e){if(r.get("room.showImtNoviceGuide"))return void("function"===g.type(e)&&e());r.set("room.showImtNoviceGuide",1);var t=n.get("energyChargeImtimate")||0;1>t?(t++,n.set("energyChargeImtimate",t),m.init(e)):"function"===g.type(e)&&e()},createTimerTask:function(){var e=this,t=0;clearTimeout(e.clearTicket),this.clearMark&&(e.clearTicket=setTimeout(function(){var a=arguments;e.deleteImtSign(function(i){if(i){if(t++,t>=3)return void clearTimeout(e.clearTicket);e.clearTicket=setTimeout(function(){a.callee()},3e3)}else clearTimeout(e.clearTicket),e.clearTagMark=!0,e.clearTaskTab()})},5e3))},clearTaskTab:function(){for(var e=this.rimt.list,t=0,a=e.length;a>t;t++){var i=e[t],s=i.target,n=s.status;"failed"===n?(this.removeForList(i.id),t--,a--):"audit"===n||"default"===n||s.setToDefault()}this.updataScorll()},updataScorll:function(){this.imtTask.$list.mCustomScrollbar("update")},initImtTask:function(){this.imtTask.$box=e(p.price(this.sprayInteract)),e("body").append(this.imtTask.$box),this.cacheImtTaskDom()},getInteract:function(){var t=e.Deferred(),a=this;return a.sprayInteract&&t.resolve(a.sprayInteract),d.load(r.get("sys.webconfUrl")+"/resource/common/interact.json","interact",function(e){a.sprayInteract=e,t.resolve(e)},function(e){t.resolve(e)},function(){},!0),t.promise()},cacheImtTaskDom:function(){var e=this.imtTask;e.$list=e.$box.find(".js-teract-recommend-list"),e.$listCnt=e.$box.find(".js-teract-recommend-content"),e.$price=e.$box.find(".js-teract-recommend-price"),e.$word=e.$box.find(".js-teract-recommend-word"),e.$task=e.$box.find(".js-teract-recommend-task"),e.$edit=e.$box.find(".js-teract-recommend-edit"),e.$giftLimit=e.$box.find(".js-teract-recommend-limit"),e.$iconStatus=e.$box.find(".js-teract-recommend-icons")},checkOtherActive:function(t){var a="function"===g.type(t)?t:function(){};g.sendAjax("/member/lottery/get_room_status",{},function(t,i){t||(i&&i.data&&(0===parseInt(i.data.status,10)||3===parseInt(i.data.status,10))?a():e.dy_dialog.tips_black(i.data.start_info))},"POST")},setEntericonStatus:function(t,a){var i="function"===g.type(a)?a:function(){};g.sendAjax("/member/anchor_task/set_intimate_task_icon_status",{is_show:t},function(t,a){t||(a&&0==a.error?i():e.dy_dialog.tips_black(a.msg))},"POST")},getImtTaskWord:function(e){var t=this,a="function"===g.type(e)?e:function(){};g.sendAjax("/member/anchor_task/get_intimate_task_setting_anchor",{},function(e,i){if(e)return t.rimt={total:0,list:[],price:"0.1",priceMax:"2000",priceMin:"0.1"},void a();var s=i.data,n=s.recommend_intimate_task_list;t.rimt={total:n?n.length:0,list:n||[],price:s.limit_intimate_task_price?s.limit_intimate_task_price.limit_price:.1,priceMax:s.limit_intimate_task_price?s.limit_intimate_task_price.max_price:2e3,priceMin:s.limit_intimate_task_price?s.limit_intimate_task_price.min_price:.1,iconStatus:s.icon_status},a()},"POST")},getTaskWordClone:function(t){var a="function"===g.type(t)?t:function(){};g.sendAjax("/member/anchor_task/get_recommend_intimate_task_list_anchor",{},function(t,i){if(t)return void e.dy_dialog.tips_black(i);var s=[];i&&i.data&&(s=i.data),a(s)},"POST")},updataNewTask:function(t,a){var i="function"===g.type(a)?a:function(){};g.sendAjax("/member/anchor_task/add_recommend_intimate_task",{task_name:t},function(t,a){if(t)return void e.dy_dialog.tips_black(a);var s=e.extend({id:"-1",recommend_type:"1",task_name:"任务名称",status:0,sign:1},a.data);i(s)},"POST")},removeImtKey:function(e,t,a){var i="function"===g.type(a)?a:function(){};g.sendAjax("/member/anchor_task/delete_recommend_intimate_task",{id:e,recommend_type:t},function(e,t){e||i()},"POST")},deleteImtSign:function(e){var t="function"===g.type(e)?e:function(){};g.sendAjax("/member/anchor_task/delete_recommend_intimate_task_sign",{},function(e,a){t(e)},"POST")},updateLimitPrice:function(t){g.sendAjax("/member/anchor_task/set_intimate_task_limit_price_setting",{limit_price:t,price_unit:2},function(t,a){return t?void e.dy_dialog.tips_black(a):void e.dy_dialog.tips_black("礼物价值设置成功~")},"POST")}};return c.reg("room_chongnengv3",function(t){var a,i=JSON.parse(t),s=i.type;switch(s){case"add":f.showImtDlg();break;case"rule":0!=i.data&&m.init(function(){f.showImtDlg()});break;case"tip":a=i.data,g.showErrDlg("tip",a);break;case"toast":a=i.data,a&&e.dy_dialog.tips_black(a);break;case"login":l.check()||l.show("login")}}),c.reg("room_data_handler",function(e){var t=o.decode(e).too();"task_qmra"===t.type&&f.changeImtwordStu(t)}),{init:function(){f.init()},getTaskWordClone:function(e){f.getTaskWordClone(e)},showNoviceGuide:function(e){f.showNoviceGuide(e)}}}),define("douyu/page/room/normal/mod/energy-charge-task",["jquery","shark/observer","shark/util/lang/1.0","shark/util/template/2.0","shark/util/cookie/1.0","shark/util/storage/1.0","shark/util/flash/data/1.0","douyu/context","douyu/page/room/base/api","douyu/com/exjsonp","douyu/page/room/normal/mod/intimate-task","douyu/page/room/normal/mod/intimate-task-anchor","douyu/page/room/normal/mod/intimate-task-assembly"],function(e,t,a,i,s,n,o,r,l,d,c,u,g){var m=r.get("sys.web_url"),p={maxTaskNum:6,minLen:2,maxLen:10,active:"active",storeName:"energyChargeTaskTips2017V3",guide_storeName:"energyChargeTaskGuide2017",giftDefaultIcon:m+"app/douyu/res/page/room-normal/chargetask/gift_default.png",sprayDeviceStu:!1,sprayDeviceEx:""},f={check:{isHasEntrance:"/member/anchor_task/get_open_status",getActInfo:"/member/lottery/get_room_status",isExistsTask:"/member/anchor_task/is_exists_task"},task:{getGiftList:"/member/lottery/get_room_gift_list",list:"/member/anchor_task/get_room_task_list"},status:{add:"/member/anchor_task/add_task_inst_v3",edit:"/member/anchor_task/edit_task_inst",remove:"/member/anchor_task/del_task_inst",publish:"/member/anchor_task/start_task_inst"},active:r.get("sys.webconfUrl")+"/resource/common/interact.json"},h={taskNameFlag:!1,giftNumsFlag:!1,lock:{},guideNum:0},v=n.get(p.guide_storeName)||0,b=function(){v++,(!n.get(p.guide_storeName)||parseInt(n.get(p.guide_storeName),10)<1)&&(n.set(p.guide_storeName,v,31536e3),e(".charge-guide-one").fadeIn(),e(document).on("mousedown",function(){h.guideNum++,1===h.guideNum?(e(".charge-guide-one").fadeOut(),e(".charge-guide-two").fadeIn()):e(".charge-guide-two").fadeOut()}))},y={init:function(){var t=this,a=e("#J_anchorandsupermenu"),i=e("body");t.doms={btn:a.find('[data-live-group="energy-charge-btn"]'),popTips:a.find('[data-energy-charge="energy-charge-tips"]'),tipsEnter:a.find(".js-charge-pop-start")},t.check.isHasEntrance(function(){var a=n.get(p.storeName)||0;a++,t.doms.btn.removeClass("hide"),(!n.get(p.storeName)||parseInt(n.get(p.storeName),10)<3)&&(n.set(p.storeName,a,31536e3),t.doms.popTips.removeClass("hide").show(),t.doms.popTips.on("click.energrChargePopTipsHide",'[data-energy-charge="popTips-close"]',function(){t.doms.popTips.addClass("hide")})),e("#energy-charge-wrap").length||t.getInteract().then(function(){i.append(t.render.taskWrap()),t.getDoms(),t.bindEvent()})},function(){l.reg("room_energy_task_anchor_pop",function(){t.getInteract().then(function(){i.append(t.render.taskWrap()),t.getDoms(),t.getHtml.getTaskList(),t.bindEvent()})})})},callFlash_PopupClose:function(){l.exe("js_chongneng_host_close")},getDoms:function(){var t=this.doms,a=e("#energy-charge-wrap");t.wrap=a,t.box=a.find('[data-energy-charge="charge-task-box"]'),t.content=a.find('[data-energy-charge="energy-charge-content"]'),t.back=a.find('[data-energy-charge="back"]'),t.titleIcon=a.find('[data-energy-charge="titleIcon"]'),t.content.on("click",".intimate-task-word",function(a){var i=e(this).attr("data-name");t.content.find(".charge-task-name").val(i)})},render:{taskWrap:function(){var e=y.sprayInteract?y.sprayInteract.mission_setting||{}:{},t=a.string.join('<div class="charge-task-box" id="energy-charge-wrap">','<div class="charge-task charge-task-edit" data-energy-charge="charge-task-box">',"{{ if (spray.intimate_open) }}",'<a href="{{ spray.link || "javascript:;" }}" class="spray-task-active"><i></i>{{ spray.activity_name }}<span>{{ spray.link_name }}</span></a>',"{{ /if }}",'<a href="javascript:;" class="charge-tak-back charge-back" data-energy-charge="back">返回</a>','<a href="javascript:;" class="imt-anchor-tab1">发布充能任务</a>','<a href="javascript:;" class="imt-anchor-tab2">设置亲密任务</a>','<a href="javascript:;" class="charge-close" data-energy-charge="close"></a>','<div class="charge-task-inner">','<div class="charge-content" data-energy-charge="energy-charge-content">',"</div>","</div>",'<div class="charge-guide-one"></div>','<div class="charge-guide-two"></div>',"</div>","</div>"),s=i.compile(t),n=s({spray:e});return n},gameShows:function(){var e=a.string.join('<div class="charge-content-info">','<i class="info-title-icon"></i>',"<h3>玩法说明</h3>",'<div class="charge-content-info-text">',"<p>主播设置任务以及对应的礼物要求。</p>","<p>当水友赠送礼物达到你设定的条件后，主播须完成对应任务。</p>","</div>",'<div class="charge-instruction-steps"></div>','<a class="charge-task-btn" href="javascript:;" data-energy-charge="task-add-btn">开始添加新任务</a>',"</div>"),t=i.compile(e),s=t();return s},addOrEditTask:function(e,t){var s=a.string.join("{{ if (data && data.mstype == 1) }}",'<div class="charge-content-info spray-task-edit" data-spray="1">',"{{ else }}",'<div class="charge-content-info">',"{{ /if }}",'<span class="charge-edit-title">','<span class="charge-edit-explain">任务</span>','<input class="charge-task-name" type="text" {{ (data && data.mstype == 1) ? "readonly" : "" }} name="taskName" placeholder="填写不超过10个字，如转5圈"','{{ if (type === "编辑")}}','data-task-id="{{ data.instId }}" data-gift-id="{{ data.giftId }}" value="{{ data.taskName }}" ',"{{ /if }}",">",'<div class="charge-edit-recommend">','<div class="charge-erc-title">推荐',"</div>",'<div class="charge-erc-content empty">','<div class="charge-erc-csec"></div>',"</div>",'<div class="bottom-gradient"></div>',"</div>",'<span class="charge-edit-title">礼物设置</span>','<div class="charge-gift-box" data-energy-charge="gift-select"></div>','<span class="charge-edit-explain charge-cell">X</span>','<div class="charge-edit-num">','<input class="charge-task-num" maxLength="2" type="text" name="giftNums" placeholder="1~99"','{{ if (type === "编辑")}}','value="{{ data.giftNum }}',"{{ /if }}",'">','<span class="charge-task-unit">个</span>',"</div>",'<div class="charge-wrong-attention2" data-energy-charge="wrong-tips"></div>','<div class="spray-task-attention {{ devicestu ? "spray-open" : "spray-close" }}" id="js-spray-device-status" data-status="0">','<span class="spray-device-open"><i></i>{{ deviceex || "当前设备已开启" }}</span>','<span class="spray-device-close"><i></i>{{ deviceex || "设备未开启，请先开启设备" }}</span>',"</div>",'<a class="charge-task-btn" href="javascript:;" data-energy-charge="task-submit-btn" data-click-lock="0">','{{ if (type === "编辑")}}',"保存","{{ else }}","提交","{{ /if }}","</a>",'<div class="charge-authority-file">','<a href="https://www.douyu.com/cms/gong/201705/17/5341.shtml" target="_blank">《亲密互动规范》</a>',"</div>","</div>"),n=i.compile(s),o=n({type:e,data:t,devicestu:p.sprayDeviceStu,deviceex:p.sprayDeviceEx});return o},giftList:function(e,t,s){var n=a.string.join('<div data-energy-charge="select-sec">','<input type="text" data-gift-id="{{ selectGiftId ? selectGiftId : list[0].id }}" name="giftName" class="charge-gift-name" value="{{ selectText }}" readonly>','<div class="imt-gift-name">{{ list[0].name }}</div>','<div class="imt-gift-price">{{ list[0].price }}</div>','<div class="charge-arrow-box" data-energy-charge="select-icon">',"<span></span>","</div>","</div>",'<ul class="charge-name-list" data-energy-charge="select-list">',"{{ if (misstype) }}","{{ each list as item index }}","{{ if (item.unit == 2) }}",'<li {{ if item.id == selectGiftId }}class="active"{{ /if }}',' data-gift-name="{{ item.name }}" data-gift-id="{{ item.id }}" data-gift-price="{{ item.price }}">','<span class="e-gift-name">{{ item.name }}</span>','<span class="e-gift-price">{{ item.price }}</span>',"</li>","{{ /if }}","{{ /each }}","{{ else }}","{{ each list as item index }}",'<li {{ if item.id == selectGiftId }}class="active"{{ /if }}',' data-gift-name="{{ item.name }}" data-gift-id="{{ item.id }}" data-gift-price="{{ item.price }}">','<span class="e-gift-name">{{ item.name }}</span>','<span class="e-gift-price">{{ item.price }}</span>',"</li>","{{ /each }}","{{ /if }}","</ul>"),o=e[0].name+"("+e[0].price+")",r=e[0].id;e.forEach(function(e){e.id==t&&(r=e.id,o=e.name+"("+e.price+")")});var l=i.compile(n),d=l({list:e,selectGiftId:r,selectText:o,misstype:s||!1});return d},newTaskList:function(e){var t=a.string.join('<div class="charge-content-info">','<dl class="task-list-box" data-energy-charge="task-scroll">',"{{ each list as item }}","{{ if (item.mission_type == 1) }}",'<dd class="spray-task-item" data-task-mstype="1" data-energy-charge="task-edit-list" data-status="{{ item.taskStatus }}" data-taskId="{{ item.taskId }}" data-task-status="{{ item.taskStatus }}" data-taskName="{{ item.taskName }}" data-giftId="{{ item.giftId }}" data-giftNum="{{item.giftNum}}">',"{{ else }}",'<dd data-energy-charge="task-edit-list" data-status="{{ item.taskStatus }}" data-taskId="{{ item.taskId }}" data-task-status="{{ item.taskStatus }}" data-taskName="{{ item.taskName }}" data-giftId="{{ item.giftId }}" data-giftNum="{{item.giftNum}}">',"{{ /if }}","{{ if (item.taskStatus === 2 || item.taskStatus === 3)}}",'<div class="choose-radio" data-select-status="0" data-energy-charge="task-select"></div>',"{{ else }}",'<div class="choose-radio disable"></div>',"{{ /if }}","{{ if (item.taskStatus === 2 && item.isInvalid) }}",'<div class="charge-audit-mark charge-audit-disable"></div>',"{{ else if (item.taskStatus === 3) }}",'<div class="charge-audit-mark charge-audit-failed"></div>',"{{ else if (item.taskStatus === 1) }}",'<div class="charge-audit-mark charge-audit-audit"></div>',"{{ else if (item.taskStatus === 4) }}",'<div class="charge-audit-mark charge-audit-publish"></div>',"{{ /if }}",'<div class="charge-gift-img">','<img src="{{ item.giftIcon }}">',"</div>",'<div class="charge-gift-progress">','<div class="gift-progress-info">','<span class="progress-bar-scale">x{{ item.giftNum }}</span>','<span class="task-name">{{ item.taskName }}</span>','<span class="{{ item.taskStatusClass }}" data-energy-charge="task-audit-status">',"{{ if (item.taskStatus === 3) }}","{{ item.auditRemark }}","{{ else }}","{{ item.taskStatusText }}","{{ /if }}","</span>","</div>","</div>","{{ if (item.taskStatus === 4)}}",'<div class="gift-edit-btn">','<a class="disable" href="javascript:;">编辑</a>',"</div>","{{ else if (item.taskStatus === 1)}}",'<div class="gift-edit-btn">','<a class="disable" href="javascript:;">编辑</a>',"</div>","{{ else }}",'<div class="gift-edit-btn">','<a href="javascript:;" data-energy-charge="task-edit-btn">编辑</a>',"</div>","{{ /if }}","</dd>","{{ /each }}","</dl>",'<div class="charge-authority-file">',"<span>点击发布表示已同意</span>",'<a href="https://www.douyu.com/cms/gong/201705/17/5341.shtml" target="_blank">《亲密任务互动规范》</a>',"</div>",'<a class="charge-task-btn" href="javascript:;" data-energy-charge="task-publish-btn">发布</a>','<a class="charge-task-del-btn" data-energy-charge="task-delete-btn" href="javascript:;">删除</a>','<a class="charge-task-add-btn" data-energy-charge="task-add-btn" href="javascript:;"><i>+</i>添加</a>',"</div>"),s=i.compile(t),n=s({
list:e});return n},newTaskListEmpty:function(){var e=a.string.join('<div class="charge-content-info">','<div class="charge-empty-bk"></div>','<div class="charge-empty-tips">当前没有可发布的任务，<br>请添加新任务</div>','<a href="javascript:;" data-energy-charge="task-add-btn" class="charge-empty-add"></a>',"</div>"),t=i.compile(e),s=t();return s}},check:{isHasEntrance:function(e,t){var a=y,i={url:f.check.isHasEntrance},s={success:function(a){a&&0===parseInt(a.error,10)&&a.data&&1===parseInt(a.data.is_open,10)?e():t()},error:function(){t()}};a.sendAjax(i,s)},isOtherActive:function(t){var a=y,i={url:f.check.getActInfo},s={success:function(a){a&&a.data&&(0===parseInt(a.data.status,10)||3===parseInt(a.data.status,10))?t():e.dy_dialog.tips_black(a.data.start_info)}};a.sendAjax(i,s)},isExitsTask:function(t){var a=y,i={url:f.check.isExistsTask},s={success:function(a){a&&0===parseInt(a.error,10)&&a.data?0===parseInt(a.data.status,10)?t.notSeted():t.isSeted():e.dy_dialog.tips_black(a.msg||"获取直播间信息失败，请稍后重试",2)}};a.sendAjax(i,s)},giftNums:function(a,i,s){var n=y,o=a.nums,r=n.doms,l=/^[1-9]\d*$/;e.trim(o)?l.test(o)&&o>0&&1e3>o?(h.giftNumsFlag=!0,a.isEdit?"back-wait"===r.back.attr("data-energy-charge-type")?n.taskStatus.edit(a,s,!0):n.taskStatus.edit(a,s):(n.taskStatus.add(a,s),t.trigger("dys",{key:"dys.room.energy-chargr.submit.click"})),s.attr("data-click-lock","1")):(i.html("<i></i>请输入1~999间整数").show(),h.giftNumsFlag=!1):(i.html("<i></i>礼物数量不能为空").show(),h.giftNumsFlag=!1)},nameLength:function(e){return e?!(e.length>=p.minLen&&e.length<=p.maxLen):void 0}},getHtml:{getGiftList:function(t){var a=y,i=a.doms,s=i.wrap,n={url:f.task.getGiftList},o={success:function(n){if(n&&0===parseInt(n.error,10))if(e.isArray(n.data)&&n.data.length){var o=s.find('input[name="taskName"]'),r=o.attr("data-gift-id");i.content.find('[data-energy-charge="gift-select"]').html(a.render.giftList(a.handleData.giftList(n.data),r,t)),i.tips=s.find('[data-energy-charge="wrong-tips"]'),i.selectList=s.find('[data-energy-charge="select-list"]'),i.selectIcon=s.find('[data-energy-charge="select-icon"]'),i.selectGfname=s.find(".imt-gift-name"),i.selectGfprice=s.find(".imt-gift-price")}else i.content.find('[data-energy-charge="task-submit-btn"]').addClass("unavailable"),i.content.find('[data-energy-charge="gift-select"]').html('<input type="text" class="charge-gift-name" value="没有可用于充能任务的礼物" readonly>');else i.content.find('[data-energy-charge="task-submit-btn"]').addClass("unavailable"),i.content.find('[data-energy-charge="gift-select"]').html('<input type="text" class="charge-gift-name" value="礼物系统不可用" readonly>')}};a.sendAjax(n,o)},getTaskList:function(t){var a,i=y,s=i.doms,n={url:f.task.list},o={success:function(n){n&&0===parseInt(n.error,10)?e.isArray(n.data)?(0===n.data.length?(a=i.render.newTaskListEmpty(),i.addWrapClass("charge-no-task")):(a=i.render.newTaskList(i.handleData.taskList(n.data)),i.addWrapClass("charge-task-list"),t&&i.taskTips("提交成功，需等待2-3分钟审核",2)),s.titleIcon.show(),s.back.hide(),s.content.removeClass("charge-loading").html(a).find('[data-energy-charge="task-scroll"]').mCustomScrollbar(),s.wrap.is(":hidden")&&s.wrap.show()):e.dy_dialog.tips_black("获取任务列表失败，请稍后再试",2):e.dy_dialog.tips_black(n.msg||"获取任务列表失败，请稍后再试",2)},error:function(){i.taskTips("获取任务列表失败，请稍后再试",2)}};i.sendAjax(n,o)}},handleData:{giftList:function(t){var a=[];return e.each(t,function(e){var i=t[e];a.push({id:i.gift_id||0,name:i.gift_name||"",price:i.gift_price||"",unit:i.gift_unit})}),a},taskList:function(e){for(var t=0,a=e.length,i=[];a>t;t++){var s=e[t],n="",o="";switch(1==s.mission_type&&(p.sprayDeviceStu=s.whiff_device_status,p.sprayDeviceEx=s.whiff_device_detail),parseInt(s.task_status,10)){case 1:n="审核中",o="in-review";break;case 2:1===parseInt(s.is_invalid,10)?(n="礼物失效",o="not-approve"):(n="",o="is-approve");break;case 3:n="审核未通过",o="not-approve";break;case 4:n="已发布",o="is-publish"}i.push({taskId:s.inst_id||"",taskName:s.task_name||"",giftIcon:s.gift_icon||p.giftDefaultIcon,giftId:s.gift_id||"",giftNum:parseInt(s.gift_num,10)||0,taskStatus:parseInt(s.task_status,10)||0,taskStatusText:n,taskStatusClass:o,auditRemark:s.audit_remark||"名称违规",isInvalid:parseInt(s.is_invalid,10)||0,Remark:s.remark||"",mission_type:s.mission_type||0})}return i}},taskStatus:{add:function(t,a){var i=y,s="submit",n={url:f.status.add,type:"POST",data:{task_name:t.taskName,gift_id:t.giftId,gift_num:t.nums}},o={complete:function(){h.lock[s]=!1},success:function(t){t&&(0===parseInt(t.error,10)?(t.data&&2==t.data.status?i.getHtml.getTaskList():i.getHtml.getTaskList(!0),i.doms.back.hide(),b()):-2===parseInt(t.error,10)?(a.attr("data-click-lock","0"),e.dy_dialog(t.msg||"最多添加20条任务信息，请删除后再添加",{title:"提示",mask:!0,buttons:[{content:"确定",callback:function(){this.hide()}}]})):(a.attr("data-click-lock","0"),i.taskTips(t.msg||"提交失败，请稍后再试",2)))},error:function(){a.attr("data-click-lock","0"),i.taskTips("提交失败，请稍后再试",2)}};i.sendAjax(n,o,s)},edit:function(e,t,a){var i=y,s="submit",n={url:f.status.edit,type:"POST",data:{inst_id:e.taskId,gift_id:e.giftId,gift_num:e.nums,task_name:e.taskName}},o={complete:function(){h.lock[s]=!1},success:function(e){e&&0===parseInt(e.error,10)?i.getHtml.getTaskList(a):(t.attr("data-click-lock","0"),i.taskTips(e.msg||"保存失败，请稍后再试",2))},error:function(){t.attr("data-click-lock","0"),i.taskTips("保存失败，请稍后再试",2)}};i.sendAjax(n,o,s)},remove:function(t){var a=y,i=a.doms,s={url:f.status.remove,type:"POST",data:{inst_id:t.instId}},n={success:function(e){e&&0===parseInt(e.error,10)?(a.doms.content.find('[data-task-select="1"]').remove(),a.doms.content.find('[data-energy-charge="task-scroll"]').mCustomScrollbar("update"),0===i.wrap.find('[data-energy-charge="task-edit-list"]').length&&(a.addWrapClass("charge-no-task"),i.content.html(a.render.newTaskListEmpty()))):a.taskTips(e.msg||"删除失败，请稍后再试",2)},error:function(){a.taskTips("删除失败，请稍后再试",2)}};e.dy_dialog("删除后不可恢复，确定要删除？",{title:"删除任务",mask:!0,buttons:[{content:"删除",callback:function(){this.hide(),a.sendAjax(s,n)}},{content:"取消",callback:function(){this.hide()}}]})},publish:function(e){var a=y,i="publish",s={url:f.status.publish,type:"POST",data:{inst_ids:e.instIds}},n={complete:function(){h.lock[i]=!1},success:function(i){i&&0===parseInt(i.error,10)?(a.getHtml.getTaskList(),t.trigger("dys",{key:"dys.room.energy-chargr.publish.click",task_num:e.taskNums})):a.taskTips(i.msg||"发布任务失败，请稍后再试",2)},error:function(){a.taskTips("发布任务失败，请稍后再试",2)}};a.sendAjax(s,n,i)}},taskAudit:function(e){var t=this.doms.wrap.find('[data-energy-charge="task-edit-list"][data-taskId="'+e.inst_id+'"]'),a=t.find('[data-energy-charge="task-audit-status"]'),i=t.find(".choose-radio"),s=t.find(".gift-edit-btn a"),n=t.find(".charge-audit-mark"),o="",r="";1===parseInt(e.is_pass,10)?(o="",r="is-approve",n.remove()):0===parseInt(e.is_pass,10)&&(o=e.remark,r="not-approve",n.removeClass("charge-audit-audit").addClass("charge-audit-failed")),i.removeClass("disable"),i.attr("data-select-status","0"),i.attr("data-energy-charge","task-select"),s.removeClass("disable"),s.attr("data-energy-charge","task-edit-btn"),a.addClass(r).html(o)},giftSelect:function(e,t){var a=this;a.addWrapClass("charge-task-edit"),a.doms.content.html(a.render.addOrEditTask(e,t)),a.getHtml.getGiftList(t&&1==t.mstype),a.delayWordList()},delayWordList:function(){var e=this,t=e.doms.content.find(".charge-erc-content"),a=t.find(".charge-erc-csec");u.getTaskWordClone(function(e){t.hide();var i=!0;if(e.length)for(var s=0,n=e.length;n>s;s++){var o=e[s];i=!1,o.recommend_type=1,o.status="1",o.sign=0,o.target=new g(o),a.append(o.target.$tag)}i||t.removeClass("empty"),t.show().mCustomScrollbar()})},addWrapClass:function(e){this.doms.box.removeClass().addClass("charge-task "+e)},taskTips:function(t,a,i){t&&e.dy_dialog.tips_black(t,1e3*a)},getCSRFCookie:function(t){var a=this,i=s.get(r.get("sys.tvk"));return i?void(t&&t({name:r.get("sys.tn"),value:i})):void e.ajax({url:"/curl/csrfApi/getCsrfCookie",type:"GET",dataType:"json",success:function(e){0===e.error&&a.getCSRFCookie(t)}})},sendAjax:function(t,a,i){var s=t.url,n=t.data||{},o=a||{};if(s){if(i){if(h.lock[i])return;h.lock[i]=!0}this.getCSRFCookie(function(a){n[a.name]=a.value,e.ajax({url:s,type:t.type||"GET",data:n,dataType:"json",complete:o.complete||e.noop,success:o.success||e.noop,error:o.error||e.noop})})}},showEnergyDlg:function(e){var t=this,a=t.doms,i=a.wrap,s=a.content;return e?(a.titleIcon.hide(),t.addWrapClass("charge-task-instruction"),s.addClass("charge-loading"),i.show(),void t.getHtml.getTaskList()):void t.check.isOtherActive(function(){u.showNoviceGuide(function(){a.titleIcon.hide(),t.addWrapClass("charge-task-instruction"),s.addClass("charge-loading"),i.show(),t.getHtml.getTaskList()})})},bindEvent:function(){var a=this,i=a.doms,s=i.wrap,n=i.content;i.btn.on("click.energyChargeTaskBtn",function(){a.showEnergyDlg(),t.trigger("dys",{key:"dys.room.energy-chargr.entrance.click"})}),i.tipsEnter.on("click",function(){i.popTips.hide(),t.trigger("mod.energy.imt.show",!0)}),s.on("click.energyChargeTaskAdd",'[data-energy-charge="task-add-btn"]',function(){i.titleIcon.show(),a.addWrapClass("charge-task-edit"),a.giftSelect("添加"),i.back.html("<i></i>返回").attr("data-energy-charge-type","back-task").show()}).on("click",".imt-anchor-tab2",function(e){s.find('[data-energy-charge="close"]').trigger("click"),t.trigger("mod.energy.imt.show")}).on("focus.energyChargeTaskName",'input[name="taskName"]',function(){h.taskNameFlag||i.tips.hide()}).on("focus.energyChargeTaskGiftNums",'input[name="giftNums"]',function(){!h.giftNumsFlag&&h.taskNameFlag&&i.tips.hide()}).on("click.energyChargeGiftSelectSan",'input[name="giftName"], [data-energy-charge="select-sec"]',function(){i.selectIcon.toggleClass(p.active),i.selectList.mCustomScrollbar().toggle()}).on("click.energyChargeGiftSelectSingal",'[data-energy-charge="select-list"] li',function(t){t.stopPropagation(),i.selectIcon.toggleClass(p.active),i.selectList.toggle().find("li").removeClass(p.active),e(this).addClass(p.active),s.find('input[name="giftName"]').val(e(this).text()).attr("data-gift-id",e(this).attr("data-gift-id")),i.selectGfname.text(e(this).attr("data-gift-name")),i.selectGfprice.text(e(this).attr("data-gift-price"))}).on("click.energyChargeAddTask",'[data-energy-charge="task-submit-btn"]',function(){var t=i.tips,n=s.find('input[name="taskName"]'),o=n.val(),r=s.find(".charge-back"),l=s.find('input[name="giftNums"]').val(),d={taskName:o,taskId:n.attr("data-task-id")||"",giftId:s.find('input[name="giftName"]').attr("data-gift-id")||n.attr("data-gift-id"),nums:l,isEdit:"edit"===r.attr("data-energy-charge-type")};if("0"===e(this).attr("data-click-lock")){if(!e.trim(o))return t.html("<i></i>任务名称不能为空").show(),h.taskNameFlag=!1,!1;if(a.check.nameLength(o))return t.html("<i></i>任务名称2-10个字").show(),h.taskNameFlag=!1,!1;h.taskNameFlag=!0,a.check.giftNums(d,t,e(this))}}).on("click.energyChargeDeteleTaskMore",'[data-energy-charge="task-delete-btn"]',function(){var t=s.find('[data-task-select="1"]'),i=[],n=!1;if(t.each(function(){var t=e(this);1==t.attr("data-task-mstype")?n=!0:i.push(t.attr("data-taskId"))}),i.length>0){var o={instId:i.join(",")};a.taskStatus.remove(o)}else n?a.taskTips("喷喷任务无法被删除",2):a.taskTips("请选择任务后再删除",2)}).on("click.energyChargeEditTask",'[data-energy-charge="task-edit-btn"]',function(){var t=e(this).closest('[data-energy-charge="task-edit-list"]'),s={instId:t.attr("data-taskId"),taskName:t.attr("data-taskName"),giftId:t.attr("data-giftId"),giftNum:t.attr("data-giftNum"),mstype:t.attr("data-task-mstype")};i.box.hasClass("charge-task-stay")||i.box.hasClass("charge-task-pulish")?i.back.attr("data-energy-charge-type","back-wait"):i.back.attr("data-energy-charge-type","edit"),i.back.html("<i></i>返回").show(),a.giftSelect("编辑",s)}).on("click.energyChargeEditBack",'[data-energy-charge-type="back-task"],[data-energy-charge-type="edit"]',function(){h.taskNameFlag=!1,a.getHtml.getTaskList()}).on("click.energyChargeTaskSelect",'[data-energy-charge="task-edit-list"]',function(){var t=e(this).find('[data-energy-charge="task-select"]'),a=t.attr("data-select-status"),i="0"===a?"1":"0";"1"===i?e(this).addClass("select"):e(this).removeClass("select"),t.toggleClass(p.active).attr("data-select-status",i),t.closest('[data-energy-charge="task-edit-list"]').attr("data-task-select",i)}).on("click.energyChargeTaskPublish",'[data-energy-charge="task-publish-btn"]',function(){var t=s.find('[data-task-select="1"]'),i=[];return t.each(function(){i.push(e(this).attr("data-taskId"))}),0===i.length?void a.taskTips("请选择任务后再发布",2):i.length>6?void a.taskTips("最多只能发送6个任务",2):void a.taskStatus.publish({taskNums:i.length,instIds:i.join(",")})}).on("click.energyChargeTaskClose",'[data-energy-charge="close"]',function(){s.hide(),i.back.hide(),n.empty(),a.callFlash_PopupClose()}),l.reg("room_energy_task_anchor_pop",function(){a.getHtml.getTaskList()}),l.reg("room_data_handler",function(e){var t=o.decode(e).too();if("task_audit"===t.type)a.taskAudit(t);else if("device_ss"===t.type&&t.rid==r.get("room.room_id")){var i=1==t.status;a.sprayDeviceSc(i,t.detail)}})},getInteract:function(){var t=e.Deferred(),a=this;return a.sprayInteract&&t.resolve(a.sprayInteract),d.load(f.active,"interact",function(e){a.sprayInteract=e,t.resolve(e)},function(e){t.reject(e)},function(){},!0),t.promise()},sprayDeviceSc:function(t,a){p.sprayDeviceStu=t,p.sprayDeviceEx=a;var i=e("#js-spray-device-status");i.length&&(i.removeClass("spray-close spray-open"),t?(i.addClass("spray-open"),i.find(".spray-device-open").html("<i></i>当前设备已开启")):(i.addClass("spray-close"),a&&i.find(".spray-device-close").html("<i></i>"+a)))}};return{init:function(){var a=r.get("sys.uid")==r.get("room.owner_uid")?1:0;t.on("mod.roompoint.low",function(i){a&&(i===!0?l.reg("room_energy_task_anchor_pop",function(){e.dy_dialog.tips_black("您的积分过低，恢复后可继续使用充能任务",3)}):(y.init(),t.on("mod.energy.charge.show",function(){y.showEnergyDlg(!0)})))}),u.init(),c.init()}}}),define("douyu/page/room/normal/mod/gameRecommend",["jquery","shark/util/storage/1.0","shark/util/template/2.0","douyu/page/room/base/api","shark/observer"],function(e,t,a,i,s){var n={storeName:"cpsTip",urls:{whiteList:"/member/mgamecps/checkCpsWhitelist",getRecommend:"/ztCache/mobilegame/getroomapp",downloadLink:"/mgamecps/cps/intro?rid=",oneKeyPromote:"/member/mgamecps/oneKeyPromote",dialogStatus:"/member/mgamecps/getOpenLiveDialogStatus",joinCpsPlan:"/member/mgamecps/joinCpsPlan"}},o={init:function(){var t=this;t.getDoms(),t.userrole=!1,t.roomDataLogin=!1,this.addEvent(),i.reg("room_data_login",function(){t.roomDataLogin=!0,t.userrole&&t.getRecommend()}),i.reg("room_cps_SendExtensionNum",function(t){e.dialog.tips_black("本日发送手游推广弹窗次数已达10次")}),i.reg("room_cps_SendExtensionBack",function(t){0===t?e.dialog.tips_black("发送游戏推广弹窗成功"):e.dialog.tips_black("发送游戏推广弹窗失败")})},getDoms:function(){this.doms={$curVideo:e("#js-room-video"),$cpsEntry:e(".live-group-btns").find('[data-live-group="cps-btn"]'),$cpsTips:e(".live-group-btns").find('[data-cps="cps-tips"]')}},addEvent:function(){var t=this;this.doms.$cpsEntry.on("click",function(){s.trigger("dys",{key:"dys.room.cps.entrance.click"}),window.open("/member/mgamecps")}),this.doms.$cpsTips.on("click",".pop-close-btn",function(){t.doms.$cpsTips.hide()}),this.doms.$curVideo.on("click","#cpsPromoteModal .one-key-promote",function(){e("#cpsPromoteModal").hide(),t.promoteApp(),DYS.sub({action_code:"click_anchorlive_mgcya_popup_cya"})}),this.doms.$curVideo.on("click","#cpsPromoteModal .ignore",function(){e("#cpsPromoteModal").hide(),DYS.sub({action_code:"click_anchorlive_mgcya_popup_later"})}),this.doms.$curVideo.on("click","#cpsPromoteModal .change-app",function(){e(this).parent().hasClass("ios")?t.renderApp("ios"):e(this).parent().hasClass("android")&&t.renderApp("android")}),this.doms.$curVideo.on("click","#cpsJoinModal .checkbox i",function(){e(this).hasClass("checked")?e(this).removeClass("checked"):e(this).addClass("checked")}),this.doms.$curVideo.on("click","#cpsJoinModal .join-now",function(){e("#cpsJoinModal .checkbox i").hasClass("checked")&&(e("#cpsJoinModal").hide(),t.joinCpsPlan(),DYS.sub({action_code:"click_anchorlive_mgcya_popup_join"}))}),this.doms.$curVideo.on("click","#cpsJoinModal .ignore",function(){e("#cpsJoinModal").hide(),DYS.sub({action_code:"click_anchorlive_mgcya_popup_ignore"})}),s.on("mod.center.userrole.ready",function(e){var a=e.join();-1!==a.indexOf(2)?(t.userrole="anchor",t.checkWhiteList(),s.on("room.normal.live.broadcast.close",function(){setTimeout(function(){t.getRecommendStatus()},18e4)}),s.on("room.normal.live.broadcast.send",function(){setTimeout(function(){t.getRecommendStatus()},18e4)}),s.on("room.normal.live.broadcast.nomore",function(){setTimeout(function(){t.getRecommendStatus()},18e4)}),s.on("room.normal.live.broadcast.disable",function(){t.getRecommendStatus()})):t.userrole="user",t.roomDataLogin&&t.getRecommend()})},getRecommendStatus:function(){var t=this;e.ajax({type:"POST",url:n.urls.dialogStatus,dataType:"json",success:function(e){0===e.error&&(1===e.data.showDialog?t.showJoinCpsModal():2===e.data.showDialog&&(t.cpsApp=e.data.appList,t.showRandomApp()))}})},showRandomApp:function(){var e=0;if(this.cpsApp&&(this.cpsApp.ios.length&&(e+=1),this.cpsApp.android.length&&(e+=1),0!==e)){var t=['<div class="cps-promote-modal" id="cpsPromoteModal">',"   <p>您推广的手游空空如也，赶紧推广吧</p>",'   <div class="random-cps-app {{if rows === 2}}two-row{{/if}}">','       <div class="app-item ios"></div>','       {{if rows === 2}}<div class="divide-line"></div>{{/if}}','       <div class="app-item android"></div>',"   </div>",'   <div class="cps-modal-btn one-key-promote">一键推广</div>','   <div class="cps-modal-btn ignore">下次再说</div>',"</div>"].join(""),i=a.compile(t),s=i({rows:e});this.doms.$curVideo.find("#cpsPromoteModal").remove(),this.doms.$curVideo.append(s),this.renderApp("ios"),this.renderApp("android")}},renderApp:function(e){var t,i=['<img class="app-pic" src="{{data.icon}}">','<div class="app-name">','   <span class="name">{{data.name}}</span>','   <span class="game-platform">{{data.typeName}}</span>',"</div>","{{if data.type === 4 || data.type === 5}}",'   <div class="divide-rate">新增用户单价：<span>{{data.cpa_price}}元/个</span></div>',"{{else}}","   {{if data.rate_type === 1}}",'       <div class="divide-rate">分成比例：<span>{{data.rate}}%</span></div>',"   {{/if}}","   {{if data.rate_type === 2}}","       {{if data.rate_step.length > 1}}",'           <div class="divide-rate">分成比例：',"               <span>最高{{data.rate_max}}%</span></div>","       {{else if data.rate_step.length === 1}}",'           <div class="divide-rate">分成比例：',"               <span>{{data.rate_step[0].rate}}%</span></div>","       {{else}}",'           <div class="divide-rate">分成比例：<span>{{data.rate}}%</span></div>',"       {{/if}}","   {{/if}}","{{/if}}",'<div class="change-app"></div>'].join(""),s=a.compile(i);if("ios"===e)if(this.cpsApp.ios&&this.cpsApp.ios.length){var n=Math.floor(Math.random()*this.cpsApp.ios.length),o=this.cpsApp.ios[n];o.cpa_price=Number(o.cpa_price).toFixed(2),o.typeName=this.cpsAppTypeName(o.type),this.iosAppId=o.app_id,t=s({data:o}),this.doms.$curVideo.find("#cpsPromoteModal .app-item.ios").html(t)}else this.doms.$curVideo.find("#cpsPromoteModal .app-item.ios").remove();else if("android"===e)if(this.cpsApp.android&&this.cpsApp.android.length){var r=Math.floor(Math.random()*this.cpsApp.android.length),l=this.cpsApp.android[r];l.cpa_price=Number(l.cpa_price).toFixed(2),l.typeName=this.cpsAppTypeName(l.type),this.androidAppId=l.app_id,t=s({data:l}),this.doms.$curVideo.find("#cpsPromoteModal .app-item.android").html(t)}else this.doms.$curVideo.find("#cpsPromoteModal .app-item.android").remove()},showJoinCpsModal:function(){var e=['<div class="cps-join-modal" id="cpsJoinModal">',"   <p>诚邀您加入斗鱼手游推广计划</p>",'   <div class="intro">精选的优质手游<br>一次推广，持续获得收益</div>','   <div class="checkbox"><i></i>阅读并同意','       <a target="_blank" href="https://www.douyu.com/cms/gong/201708/15/6045.shtml">',"《斗鱼手游推广服务协议》</a>","   </div>",'   <div class="cps-modal-btn join-now">立即加入</div>','   <div class="cps-modal-btn ignore">忽略</div>',"</div>"].join("");this.doms.$curVideo.find("#cpsJoinModal").remove(),this.doms.$curVideo.append(e)},promoteApp:function(){e.ajax({type:"POST",url:n.urls.oneKeyPromote,data:{android_app_id:this.androidAppId,ios_app_id:this.iosAppId},dataType:"json",success:function(t){0===t.error?e.dialog.tips_black("推广成功"):4002===t.error?e.dialog.tips_black(t.data):4009===t.error?e.dialog.tips_black(t.data):4010===t.error?e.dialog.tips_black(t.data):e.dialog.tips_black("推广失败")},error:function(){e.dialog.tips_black("请求失败")}})},joinCpsPlan:function(){e.ajax({type:"POST",url:n.urls.joinCpsPlan,dataType:"json",success:function(t){0===t.error?e.dialog.tips_black("成功加入推广计划"):e.dialog.tips_black(t.data)},error:function(){e.dialog.tips_black("请求失败")}})},cpsAppTypeName:function(e){return 1===e?"安卓联运":2===e?"安卓CPS":3===e?"iOS CPS":4===e?"iOS CPA":5===e?"安卓联运CPA":""},getDate:function(){var e=new Date;return e.getFullYear()+e.getMonth()+e.getDate()},checkWhiteList:function(){var a=this;e.ajax({type:"POST",url:n.urls.whiteList,dataType:"json",success:function(e){if(0===e.error&&1===e.data.whitelist&&(a.doms.$cpsEntry.removeClass("hide"),0===e.data.joinPlan)){var i=t.get(n.storeName)||0;i!==a.getDate()&&(a.doms.$cpsTips.removeClass("hide"),t.set(n.storeName,a.getDate(),31536e3))}}})},getRecommend:function(){var t=this;$ROOM&&$ROOM.room_id&&e.ajax({type:"GET",url:n.urls.getRecommend,data:{r:parseInt($ROOM.nowtime/600,10),room_id:$ROOM.room_id},dataType:"json",success:function(e){if(e.data&&(e.data.ios||e.data.android)){var a=window.location.protocol+"//"+window.location.hostname+n.urls.downloadLink+$ROOM.room_id;e.data.android&&""===e.data.android.down_link&&("anchor"===t.userrole?a="":"user"===t.userrole&&(a=e.data.ios&&e.data.ios.page_url?e.data.ios.page_url:""));var s={live_cid2:window.$ROOM.cate_id,ownerName:window.$ROOM.owner_name,downLink:a};e.data.ios&&e.data.ios.down_link&&(s.ios={appId:e.data.ios.app_id,name:e.data.ios.app_name,icon:e.data.ios.app_icon,downLink:e.data.ios.down_link,url:e.data.ios.page_url}),e.data.android&&e.data.android.down_link&&(s.android={appId:e.data.android.app_id,name:e.data.android.app_name,icon:e.data.android.app_icon,downLink:e.data.android.down_link,url:e.data.android.page_url}),i.exe("js_game_recommend",s)}}})}};return{init:function(){o.init()}}}),define("douyu/com/switch",["jquery","shark/class","shark/observer"],function(e,t,a){var i=t({init:function(t){this.config=e.extend(!0,{},{target:"#switch",item:"li",content:'[data-switch="content"]',onCls:"on",tEvents:"click mouseover",currentIndex:0,handleAjax:function(){},handleResize:function(){},handleOther:function(){}},t),this.getDoms(),this.bindEvt()},getDoms:function(){var t=e(this.config.target);this.doms={$target:t,$items:t.find(this.config.item),$contens:t.find(this.config.content)}},renderItem:function(e){var e=void 0!==e?e:this.config.currentIndex,t=this.config.onCls,a=this.doms,i=a.$items,s=a.$contens;i.removeClass(t).eq(e).addClass(t),s.removeClass(t).eq(e).addClass(t)},handle:function(){var e=this.config.currentIndex,t=this.doms,a=t.$items.eq(e),i=a.attr("data-ajax"),s=a.attr("data-resize");this.renderItem(),"1"===i&&(a.attr("data-ajax","0"),this.config.handleAjax()),this.config.handleOther(e),"1"===s&&this.config.handleResize()},over:function(){this.renderItem(0)},bindEvt:function(){function t(e){e.stopPropagation(),e.preventDefault()}var a=this,i=this.config.item,s=this.doms,n=this.config.tEvents;s.$target.on(n,i,function(i){t(i);var s=e(i.currentTarget).index();a.config.currentIndex!==s&&(a.config.currentIndex=s,a.handle())})}});return{create:function(e){return new i(e)}}}),define("douyu/page/room/normal/mod/live-rank-info",["jquery","shark/observer","shark/util/lang/1.0","douyu/context","shark/util/flash/data/1.0","douyu/page/room/base/api","douyu/com/header","douyu/com/avatar","douyu/com/switch","shark/util/template/1.0"],function(e,t,a,i,s,n,o,r,l,d){var c=i.get("sys.web_url"),u={GAP_TIME:5e3,avatarDomain:i.get("sys.avatar_url"),defaultAvatar:i.get("sys.web_url")+"/app/douyu/res/com/defaultAvatar.png?20160903",resourceUrl:i.get("sys.resource_url"),maxLevel:120},g={interval:function(e,t,a){setTimeout(function(){e()!==!1&&g.interval(e,t)},t),a===!0&&e()},toSimpleNum:function(e,t,a){var i=Math.pow(10,t);return isNaN(Number(e))?e:parseFloat(Number(e)/i).toFixed(a)},toChineseNumber:function(e,t,a){var i,s=this,n=Number(e);if(isNaN(n))return e;switch(t){case"千万":i=s.toSimpleNum(e,7,a)+t;case"百万":case"t":case"T":i=s.toSimpleNum(e,6,a)+t;case"万":i=s.toSimpleNum(e,4,a)+t;break;case"千":case"k":case"K":i=s.toSimpleNum(e,3,a)+t;break;case"百":i=s.toSimpleNum(e,2,a)+t;break;default:i=e}return i},join:function(){return Array.prototype.join.call(arguments,"")}},m={doms:{},animate:{time:3e3},aniTimes:{rank:0,cont:0},rank:{now:"",next:""},init:function(){var e=this;e.cacheDoms(),e.contRestart()},cacheDoms:function(){var t=this.doms;t.$wrapper=e(".catagory-order-num-wrap .catagory-order-num-wrapper"),t.$items=e('[data-info-catagory-order="num"]'),t.$rank=t.$items.find('[data-info-catagory-order="rank"]'),t.$anisec=t.$items.find("div.catagory-order-num-item"),t.$word=t.$anisec.find("span.catagory-order-num-value-wrap"),t.$wrap=e(".catagory-order-num-wrap"),t.$content=e('[data-info-catagory-order="content"]'),this.contentRight=parseInt(t.$content.css("right"),10)||0,t.$triangle=e(".catagory-order-icon-triangle"),t.$triangle.css({right:"29px"})},setRank:function(e){this.rank.next=e},rankChange:function(e){var t=this,a=t.doms;"up"===e?a.$rank.eq(0).text(t.rank.next):"down"===e&&a.$rank.eq(2).text(t.rank.next)},getRankMark:function(){var e=this.rank;return e.next>e.now?"down":"up"},rankAnimate:function(){var e=this,t=e.doms,a=e.animate.time,i=e.getRankMark();e.rankStop(),e.rankChange(i),"up"===i?t.$wrapper.animate({top:"0px"},a,function(){e.rankRestart()}):"down"===i&&t.$wrapper.animate({top:"-44px"},a,function(){e.rankRestart()})},rankRestart:function(){var e=this.doms;e.$wrapper.css({top:"-22px"});var t=this.rank;t.now=t.next,e.$rank.eq(1).text(t.now)},rankStop:function(){this.doms.$wrapper.stop(),this.rankRestart()},contChange:function(e,t){var a=parseInt(e||"0",10);a>1e4&&(a=(a/1e4).toFixed(1)+"万");var i=' <span style="color: #F7D54E; font-weight: 600;">--</span> 贡献值',s=t?"领先后一名":"落后上一名",n=(s+i).replace(/--/,a);this.doms.$word.html(n)},contAnimate:function(){var e=this,t=e.doms,a=e.animate.time;t.$wrap.width(201),t.$triangle.css({right:"110px"}),t.$content.css({right:e.contentRight+81+"px"}),t.$anisec.css({display:"inline-block"}),t.$word.animate({left:"-100px"},a,function(){e.aniTimes.cont++,e.contRestart(),e.aniTimes.cont%3===0&&e.aniTimes.cont<9&&e.contAnimate()})},contRestart:function(){var e=this.doms;e.$anisec.hide(),e.$wrap.width(120),e.$word.css({left:0}),e.$triangle.css({right:"29px"}),e.$content.css({right:this.contentRight+"px"})},contStop:function(){this.aniTimes.cont=0,this.doms.$word.stop(),this.contRestart()}},p={reLoadCont:"",init:function(){this.initConfig(),this.getDoms(),this.handleRankPos(),this.handleDropDownPos(),this.addEvent(),this.setBannerCursor()},setBannerCursor:function(){var e=this.doms.$content.find(".yz-week-link");e.length&&!e.prop("target")&&e.css({cursor:"default"})},initConfig:function(){this.rankNum="",this.score="",this.rankList=[],this.lastTime=0,this.lastUserTime=0,this.ridState=!0,this.rids=[],this.cacheNums=[],this.cacheRun=!1},getDoms:function(){this.doms={$infoContainer:e("#anchor-info"),$container:e('[data-info-catagory-order="info"]'),$trigger:e('[data-info-catagory-order="trigger"]'),$content:e('[data-info-catagory-order="content"]'),$rankIcon:e('[data-info-catagory-order="icon"]'),$giftWeekIcon:e('[data-info-catagory-order="gift-week-icon"]'),$triangleIcon:e(".catagory-order-icon-triangle"),$numContainer:e('[data-info-catagory-order="num"].catagory-order-num'),$nums:e('[data-info-catagory-order="num"]').find(".catagory-order-num-value"),$score:e('[data-info-catagory-order="score"]'),$item:e('[data-info-catagory-order="item"]'),$lists:e('[data-info-catagory-order="lists"]'),$title:e(".catagory-order-title"),$liveContainer:e("#js-live-room-normal-left"),$share:e(".room-mes .sq-wrap"),$listScore:e('[data-info-catagory-order="score"]'),$bannerContainer:e('#anchor-info .catagory-order-container [data-type="banner"]')},this.doms.$listScore.hide(),this.doms.$item.eq(0).append('<div class="room-mes-loading"><span class="room-mes-loading-img"></span><div class="room-mes-loading-holder"></div></div>'),this.cid=e(".catagory-order-num-item").eq(0).data("cate-id"),this.tid=e(".catagory-order-num-item").eq(0).data("tag-id")},getData:function(t,a){var i={url:t.url||"",type:t.type||"GET",data:t.data||{},dataType:"json",success:function(e){a&&a(e)},error:function(e){a&&a(e)}};t.jsonp&&(i.jsonp=t.jsonp,i.callback=t.jsonCallBack),e.ajax(i)},intervalList:function(e){var t=this;if(t.listShowFlag&&!t.listTimeFlag){var a=e||60,i=arguments;t.ajaxAnchor(),t.listTimeFlag=!0,t.timeTicket=setTimeout(function(){t.listTimeFlag=!1,i.callee.apply(t,i)},1e3*a)}},ajaxBanner:function(){var t=this;return e.ajax({url:"/ajax_api_cache/room/getAnchorRankListBanner",data:{rid:i.get("room.room_id")},dataType:"json",success:function(e){0===e.error&&t.renderBanner(e)}})},renderBanner:function(e){var t=e.data,a=['<% if(src && src !== "") {%>','<a class="yz-week-link" ','<% if (url && url !== "") {%>','href="<%= url %>" target="_blank"',"<% } else {%>",'href="javascript:;"',"<% } %>",">",'<img src="<%= src %>">',"</a>","<% }%>"],i=d.compile(a.join("")),s=i(t);this.doms.$bannerContainer.html(s)},ajaxAnchor:function(){var t=this;e.ajax({url:"/column_rank_list/getAnchorRankList",type:"GET",data:{cate_id:t.cate_id,room_id:i.get("room.room_id"),uid:i.get("room.owner_uid")},success:function(e){var a=JSON.parse(e);0===+a.code&&(t.anchorRankList=a.data,t.resoveAnchorList())},error:function(){e.dialog.tips_black("主播榜列表请求失败")}})},resoveAnchorList:function(){var e=this,t=e.anchorRankList,a=t.length,s=!1;if(a)for(var n=i.get("room.room_id"),o=0;a>o;o++)t[o].rid==n&&(s=!0,e.ownAnchorData=t[o],e.ownAnchorData.index=o,e.nowRank=+e.ownAnchorData.idx);else e.ownAnchorData="";s?e.doms.$listScore.hide():e.reLoadContShowMark!==!1&&(e.reLoadContShowMark=!0,""!==e.reLoadCont&&e.showListReCont()),e.renderAnchorList()},showListReCont:function(){var e=this,t=e.reLoadCont>1e4?(e.reLoadCont/1e4).toFixed(1)+"万":parseInt(e.reLoadCont,10);e.doms.$listScore.html("落后前一名<span>"+t+"</span>贡献值"),e.doms.$listScore.show()},handleArrData:function(t){var a,i,n=[];if(!t)return n;a=t.split("/");for(var o=0,r=a.length;r>o;o++)i=s.decode(a[o]).too(),e.isPlainObject(i)&&!e.isEmptyObject(i)&&n.push(i);return n},handleAvatar:function(e){var t=u.defaultAvatar;return e&&(t=a.string.format("{0}upload/{1}_middle.jpg",u.avatarDomain,e)),t},getIconByLevel:function(e){var t=e>u.maxLevel?u.maxLevel:e,i=e>=70?"gif":"png";return a.string.format("{0}app/douyu/res/page/room-normal/level/LV{1}.{2}?v=20170922",c,t,i)},handleNobleConfig:function(e,t){var a=i.get("room.nobleConfig")||{};return"pic"===t?a[e]?u.resourceUrl+a[e].symbol.web_symbol_pic2:"":"desc"===t?a[e]&&a[e].symbol.name:void 0},formatContribute:function(e){return e>=1e4&&(e=g.toChineseNumber(e,"万",1)),e},handleRankPos:function(){var e=this.doms,t=(e.$rankIcon,e.$title),a=(e.$numContainer,0);t.removeClass("maxlength");var i=e.$share.length&&e.$share.offset().left||0,s=e.$rankIcon.length&&e.$rankIcon.offset().left||0,n=e.$rankIcon.width()||0,o=e.$trigger.length&&e.$trigger.offset().left||0,r=e.$trigger.width()||0,l=e.$giftWeekIcon.length&&e.$giftWeekIcon.offset().left||0,d=e.$giftWeekIcon.width()||0;s&&(n>i-s?e.$rankIcon.css("visibility","hidden"):e.$rankIcon.css("visibility","visible")),l&&(d>i-l-n?e.$giftWeekIcon.css("visibility","hidden"):(a=n?"-216px":"-100px",e.$giftWeekIcon.css({visibility:"visible",right:a}))),r>i-o&&t.addClass("maxlength")},handleDropDownPos:function(){var e=this.doms,t=e.$infoContainer,a=e.$content,i=a.length&&a.offset().left,s=t.length&&t.offset().left,n=s-i;
n>0?a.css("right","-"+n+"px"):a.css("right","0")},handleNumAndScore:function(){var e=this.doms,t=this.rankNum,a=this.score;!a||0>a?a="--":0==a&&1==t?a="hide":a/=100,t&&0!=t?0>t&&(t=Math.abs(t)+"+",a="hide"):(t="--",a="--"),e.$nums.html(t),"hide"!==a?e.$score.find("span").html(a):e.$score.hide()},handleRankNum:function(e){var e=(this.doms,s.decode(e).too()),t=this.handleArrData(e.ri);this.bt=e.bt,this.rankNum=t[1]&&t[1].idx||0,this.handleNumAndScore()},handleRankScore:function(e){var e=(this.doms,s.decode(e).too());this.score=e.sc,this.handleNumAndScore()},handleAnchorList:function(e){var t=this.doms,e=s.decode(e).too(),a=this.handleArrData(e.rls),i=t.$lists.find("li").eq(1).data("cate-id");e.cate_id==i&&(this.rankList=a),this.rids=[];for(var n=0;n<this.rankList.length;n++)this.rids.push(this.rankList[n].rid);this.renderAnchorList()},renderAnchorList:function(){var e=this,t=g.join('<div class="yz-week-content">','<div class="yz-rank-list">',"<ul>","<% var idx; %>","<% for (var i = 0; i < 5; i++) { %>","<% var item = list[i]; %>","<% if (item) { %>","<% if (room && i === room.index) { %>","<% if (i%2) { %>",'<li class="yz-current yz-bg">',"<% } else { %>",'<li class="yz-current">',"<% } %>","<% } else { %>","<% if (i%2) { %>",'<li class="yz-bg">',"<% } else { %>","<li>","<% } %>","<% } %>",'<a class="yz-col-left" href="/<%= item.rid %>" target=_blank>',"<% if (room) { %>","<% if (i === room.index) { %>",'<span class="yz-contrib"><em class="yz-contrib-value">当前主播</em></span>',"<% } else { %>",'<span class="yz-contrib">',"<% var score = item.sc - room.sc; %>","<% var wscore = Math.abs(score); %>","<% if (wscore > 10000) { %>",'<% wscore = parseFloat(wscore/10000).toFixed(1) + "万"; %>',"<% } else { %>","<% wscore = parseInt(wscore); %>","<% } %>","<% if (i > room.index) { %>",'领先 <em class="yz-contrib-value"> <%= wscore %> </em>贡献值',"<% } else { %>",'落后 <em class="yz-contrib-value"> <%= wscore %> </em>贡献值',"<% } %>","</span>","<% } %>","<% } %>",'<div class="yz-wp-left">',"<% idx = item.idx %>",'<span class="yz-index"><%= item.idx %></span>','<span class="yz-zhubo">','<img src="<%= item.src %>" />','<em class="yz-zhubo-icon"></em>',"</span>",'<p title="<%= item.owner_name %>"><%= item.owner_name %></p>',"<% if (item.is_live) { %>",'<div class="play-status">',"<% } else { %>",'<div class="play-status yz-stop">',"<% } %>",'<span class="yz-play"></span>','<span class="yz-fenqu"><%= item.catagory %></span>',"</div>","</div>","</a>","</li>","<% } else { %>","<% if (i%2) { %>",'<li class="yz-bg">',"<% } else { %>","<li>","<% } %>",'<a class="yz-col-left" href="javascript:;">','<div class="yz-wp-left">',"<% idx = idx ? (idx + 1) : (i + 1) %>",'<span class="yz-index"><%= idx %></span>','<span class="yz-zhubo">','<img src="<%= Vars.defaultAvatar %>" />','<em class="yz-zhubo-icon"></em>',"</span>","<p>虚位以待</p>","</div>","</a>","</li>","<% } %>","<% } %>","</ul>","</div>",'<p class="yz-week-text">',"注：列表数据每分钟更新一次","</p>","</div>"),a=d.compile(t),i=a({list:e.anchorRankList||[],room:e.ownAnchorData,Vars:u,Math:Math,parseInt:parseInt,parseFloat:parseFloat});this.doms.$item.eq(0).empty().append(i)},renderUserList:function(e){var t=this,a=e.length,i=3-a>=0?3-a:0,e=3-a>=0?e:e.slice(0,3);if(i>0)for(var s=0;i>s;s++)e.push({});var n=["<% for( var i = 0, len = list.length; i < len; i++ ){ %>",'<div class="catagory-order-item order-item-<%= i+1 %>">','<div class="order-info">','<img src="<%= list[i].avatar?list[i].avatar:defaultAvatar %>" alt="">',"<i></i>",'<p title="<%= list[i].nickname || "虚位以待" %>"><%= list[i].nickname || "虚位以待" %></p>',"</div>",'<div class="user-badge-group">',"<% if (parseInt(list[i].noble_lvl)) { %>",'<img class="user-noble" title="<%= handleNobleConfig(list[i].noble_lvl, "desc") %>" src="<%= handleNobleConfig(list[i].noble_lvl, "pic") %>">',"<% } %>","<% if (list[i].level) { %>",'<img class="user-level" src="<%= getIconByLevel(list[i].level) %>">',"<% } else { %>",'<div class="user-level">--</div>',"<% } %>","</div>",'<p class="user-contribute">周贡献：<%= formatContribute(list[i].gx) || "--" %></p>',"</div>","<% } %>"].join(""),o=d.compile(n),r=o({list:e,defaultAvatar:u.defaultAvatar,formatContribute:t.formatContribute,getIconByLevel:t.getIconByLevel,handleNobleConfig:t.handleNobleConfig,parseInt:parseInt});this.doms.$item.eq(1).empty().append(r)},getAndHandleUserList:function(e){var t=this,a={url:"/column_rank_list/getUserRankList",data:{cate_id:e}};this.getData(a,function(e){var a=[];0==e.code&&(a=e.data),t.renderUserList(a)})},handleCacheNums:function(e){var t,a=this;a.cacheNums.push(e),a.cacheRun||g.interval(function(){return t=a.cacheNums.length,t?(a.handleRankNum(a.cacheNums.splice(-1,1)),a.cacheNums.length=0,a.cacheRun=!0):a.cacheRun=!1,a.cacheRun},1e3,!0)},handleRankWel:function(e){var t="",i=e.level>=70?"":"level-bgpng",s=e.level>=100?"level-size2":" level-size1";return t=a.string.join('<li class="jschartli" data-type="list" data-level="<%=node.level%>">','<p class="text-cont rank-wel">','<i class="rank-wel-order rank-wel-order<%= node.crw %>"></i>',"<% if (node.level > 0) { %>",'<a class="chat-icon-pad user-level<% if ( node.level < 10 ) { %> lve-icon-1to9 <% } %> <%= node.uli %> <%= imgType %> <%= imgSize %> " title="用户等级：<%= node.level %>">',"</a>","<% } %>",'<a href="javascript:;" class="hy-name js-nick" rel="<%= node.uid %>" is-show-super-icon="<%= node.sahf%>" avatar="<%= node.ic %>" gid="<%= node.pg %>" title="<%= node.nn %>"><%= node.nn %></a>',"<span>欢迎您来到本直播间</span>","</p>","</li>"),render=d.compile(t),html=render({node:e,imgType:i,imgSize:s}),html},addEvent:function(){var a=this,i=this.doms,o=i.$trigger,r=i.$content,d=!1;n.reg("data_rank_num",function(e){a.handleCacheNums(e);var t=s.decode(e).too();if("rri"===t.type){var i=s.decode(t.ri).too(),n=i.idx;a.nowRank=+n,+n?(0>+n&&(n=Math.abs(+n)+"+",a.reLoadContShowMark=!1,a.doms.$listScore.hide()),m.rank.now?(m.setRank(n),m.rankAnimate(),clearTimeout(a.timeTicket),a.listTimeFlag=!1,a.intervalList()):m.rank.now=n):(a.doms.$nums.text("--"),a.reLoadContShowMark=!1,a.doms.$listScore.hide())}}),n.reg("data_rank_score",function(e){var t=s.decode(e).too();if("qausrespond"===t.type){var i=t.sc;0>+i&&(i=Math.abs(+i)),a.reLoadCont=i/100,a.reLoadContShowMark&&a.showListReCont();var n;if(a.nowRank){var o=a.nowRank;if(0===o)return;1===o?(n=t.sctn,m.contChange(n/100,!0)):m.contChange(a.reLoadCont,!1)}else if(+i)m.contChange(a.reLoadCont,!1);else{if(n=t.sctn,!+n)return;m.contChange(n/100,!0)}return m.contStop(),void m.contAnimate()}}),o.on("mouseenter",function(s){a.listShowFlag=!0,i.$content.addClass("on"),i.$triangleIcon.addClass("on"),a.cate_id=i.$lists.find("[data-cate-id]").attr("data-cate-id"),e(s.target).closest(".catagory-order-content").length||(t.trigger("dys",{key:"dys.room.title.rank.show",tid:a.tid,cid:a.cid,period:"w"}),d||(a.ajaxBanner(),d=!0),a.intervalList())}),o.on("mouseleave",function(e){a.timer=setTimeout(function(){a.listShowFlag=!1,r.removeClass("on"),i.$triangleIcon.removeClass("on")},100)}),r.on("mouseenter",function(){clearTimeout(a.timer)}),r.on("mouseleave",function(){r.removeClass("on"),i.$triangleIcon.removeClass("on")}),t.on("mod.userenter.get.rankwel",function(e){return a.handleRankWel(e)}),e(window).resize(function(){setTimeout(function(){a.handleRankPos()},100)}),l.create({target:'[data-info-catagory-order="lists"]',item:".catagory-order-name > li",content:'[data-info-catagory-order="item"]',tEvents:"click",handleOther:function(i){var s=e(this.target).find(this.item).eq(i).data("cate-id");s&&(a.currentUserTime=(new Date).getTime(),(!a.lastUserTime||a.currentUserTime-a.lastUserTime>=u.GAP_TIME)&&(a.getAndHandleUserList(s),a.lastUserTime=a.currentUserTime)),t.trigger("dys",{key:"dys.room.title.rank.star.click",tid:a.tid,pos:0})}}),i.$item.on("click","a.order-info",function(){var a=e(this).index("a.order-info"),i=e(this).data("rid");t.trigger("dys",{key:"dys.room.title.rank.star.room.click",rid:i,pos:a+1})}),i.$item.on("click","a.order-link",function(){var a=e(this).index("a.order-link"),i=e(this).data("rid");t.trigger("dys",{key:"dys.room.title.rank.star.room.click",rid:i,pos:a+1})}),i.$content.on("click",".catagory-order-link",function(){t.trigger("dys",{key:"dys.room.title.rank.total.click",cid:a.cid})})}};return{init:function(){p.init(),m.init()}}}),define("douyu/page/room/normal/mod/yuba-group-dynamic",["jquery","shark/observer","shark/util/lang/1.0","shark/util/template/2.0","shark/util/storage/1.0","douyu/context"],function(e,t,a,i,s,n){var o={vars:{reloadLimitTime:6e4,timer:null,roomId:n.get("room.room_id")},urls:{groupDynamic:n.get("room.yuba_jump_url"),yuba:n.get("sys.yubaDomain").replace(/^http(s?):/,"").replace(/\/$/g,""),getGroupDynamic:"/api/dy/Anchor/groupTrends"},data:{},init:function(){var t,a;this.doms={roomTitle:e("#anchor-info")},this.renders={renderGroupDynamic:this.renderGroupDynamicFn()},t=this.doms,a=t.roomTitle,t.anchorName=a.find("a.zb-name"),t.roomAvatar=a.find("div.anchor-pic"),this.setRoomAvatarInfo(),this.setAnchorNameTip(),this.bindEvents()},setRoomAvatarInfo:function(){var e=this.urls.groupDynamic,t=this.doms,i=a.string.join('<a data-groupdynamic="avatar" target="_blank" class="anchor-cover-wrap" href="'+e+'">','<div class="cover"></div>','<div class="yuba-icon"></div>','<div class="text">进入TA的鱼吧</div>',"</a>",'<div class="yuba-group-active">','<div class="triangle">','<div class="triangle-bg"></div>',"</div>",'<div class="hover-expand"></div>','<div class="group-title">',"<span>小组动态</span>",'<a data-groupdynamic="more" class="more fr hide" href="'+e+'" target="_blank">更多精彩内容<i class="icon"></i></a>',"</div>",'<div data-groupdynamic="list" class="list"></div>',"</div>");t.roomAvatar.append(i),t.groupDynamicList=t.roomAvatar.find('[data-groupdynamic="list"]'),t.moreLink=t.roomAvatar.find('[data-groupdynamic="more"]'),t.avatar=t.roomAvatar.find('[data-groupdynamic="avatar"]')},setAnchorNameTip:function(){this.doms.anchorName.attr({href:this.urls.groupDynamic,target:"_blank"}).append('<div class="tip" style="margin-left: -46px;"><div class="arrow"></div>进入TA的鱼吧</div>')},bindEvents:function(){var a=this,i=a.doms,s=a.vars;i.roomAvatar.on("mouseenter",function(){s.timer||(s.timer=setTimeout(function(){clearTimeout(s.timer),s.timer=null},s.reloadLimitTime),a.getGroupDynamic()),t.trigger("dys",{key:"dys.room.anchor.yuba.group.show"})}).on("click",'[data-groupdynamic="more"]',function(){var e=a.data.originalData;t.trigger("dys",{key:"dys.room.anchor.yuba.group.more.click",f_id:e.fid,t_id:e.tid})}).on("click",'[data-groupdynamic="grouppostitem"]',function(){var a=e(this).parent().index();t.trigger("dys",{key:"dys.room.anchor.yuba.group.itempost.click",jurl:this.href,pos:a})}).on("click",'[data-groupdynamic="avatar"]',function(){var i=a.data.originalData;t.trigger("dys",{key:"dys.room.title.avatar.click",f_id:i.fid,t_id:i.tid,jurl:e(this).attr("href")})}),i.anchorName.on("click",function(){t.trigger("dys",{key:"dys.room.title.anchor.click",jurl:e(this).attr("href")})})},getGroupDynamic:function(){var t=this;e.ajax({url:this.urls.yuba+this.urls.getGroupDynamic,dataType:"jsonp",data:{room_id:this.vars.roomId}}).done(function(e){var a=e&&e.data&&e.data.list||{list:null};t.data.originalData=e&&e.data||{},t.data.list=a,t.renderGroupDynamic()}).fail(function(){t.data.list={list:null},t.renderGroupDynamic()})},renderGroupDynamicFn:function(){var e=a.string.join("{{ each list as item index }}",'<div class="item">','<a data-groupdynamic="grouppostitem" class="item-wrap" href="{{ item.post_url }}" target="_blank">','<span class="item-head-pic">','<img src="{{ item.avator }}" >','<em class="icon"></em>',"</span>",'<div class="item-head-detail">','<span class="item-nickname" title="{{ currUid == item.postuid ? userNickname : item.nickname }}">{{ currUid == item.postuid ? userNickname : item.nickname }}</span>','<span class="title" title="{{ item.title }}">{{ if item.is_vote }}<i>投票</i> {{ /if }}{{ item.title }}</span>',"{{ if item.is_video }}",'<div class="item-pic-wrap">','<span class="pic-wrap is-wh">','<img src="{{ item.is_video }}">','<span><i class="icon play-icon"></i></span>',"</span>","</div>","{{ else if item.is_img }}",'<div class="item-pic-wrap {{ item.imgs.length > 1 ? "pic-wrap-more" : "" }}">',"{{ each item.imgs as img i }}","{{ if (item.imgs.length > 1 && img.width <= limitXH && img.height <= limitXH) || (item.imgs.length < 2 && img.width <= limitXW && img.height <= limitXH) || (item.imgs.length < 2 && img.width <= limitMW && img.height <= limitMH) }}",'<span class="pic-wrap">',"{{ else }}","{{ if img.width > img.height }}",'<span class="pic-wrap is-wh" style="width:{{ limitXW > limitXH*img.width/img.height ? limitXH*img.width/img.height : limitXW }}px;">',"{{ else if img.height == img.width }}",'<span class="pic-wrap is-w-h">',"{{ else if img.height > img.width }}",'<span class="pic-wrap is-hw"style="height:{{ limitMH > limitMW*img.height/img.width ? limitMW*img.height/img.width : limitMH }}px;">',"{{ /if }}","{{ /if }}",'<img src="{{ img.url }}">',"{{ if item.img_count > 3 && i == 2 }}","<em>{{ item.img_count }}张</em>","{{ /if }}","</span>","{{ /each }}","</div>","{{ /if }}",'<div class="data-bar">','<span class="watch-num">{{ item.views }}</span>','<span class="reply-num">{{ item.answer_num || "评论" }}</span>',"</div>","</div>","</a>","</div>","{{ /each }}"),t=i.compile(e);return t},renderGroupDynamic:function(){var e=this.data.list,t=this.doms,a=['<div class="empty">','<div class="empty-text">马上','<a href="'+this.urls.groupDynamic+'" target="_blank">去发帖</a>',"更容易被主播看到</div>","</div>"].join("");e.length>0?(t.moreLink.removeClass("hide"),a=this.renders.renderGroupDynamic({limitXW:130,limitMW:95,limitXH:90,limitMH:125,currUid:n.get("sys.uid"),userNickname:n.get("sys.nickname"),list:e})):t.moreLink.addClass("hide"),t.groupDynamicList.html(a)}};return{init:function(){o.init()}}}),define("douyu/page/room/normal/mod/anchor-level",["jquery","shark/class","shark/observer","shark/util/lang/1.0","shark/util/template/2.0","shark/util/flash/data/1.0","douyu/context","douyu/page/room/base/api"],function(e,t,a,i,s,n,o,r){var l={container:e("#container"),roomVideo:e("#js-room-video"),anInfoDom:e("#js-anchor-level-wrap")},d={ownerName:o.get("room.owner_name"),rid:o.get("room.room_id"),uid:o.get("room.owner_uid"),url:{stayLv:"/anchor_level/getLevelInfo"},maxLevel:100,maxExp:255545e3},c={formatDotZero:function(e){return String(e).replace(/(\.\d*?)0+$/g,"$1").replace(/\.$/,"")},formatDecimals:function(e,t){var a=new RegExp("(\\.\\d{"+t+"})\\d*$"),i=e+"",s=i.replace(a,"$1");return s=c.formatDotZero(s)},formatContribute:function(e,t){return e>=1e4&&(e=c.formatDecimals(e/1e4,t)+"万"),e}},u={_inited:!1,init:function(e){var t=this;t.getDoms(),o.get("sys.uid")==d.uid&&(t.doms.lookLevelIntro.show(),t.doms.anchorLevelIcon.attr({href:"/room/level/index",target:"_blank"})),t.bindEvent(),this._inited=!0},getDoms:function(){var e=l.anInfoDom;this.doms={hoverWrap:e.find('[data-type-anchor="hover-wrap"]'),upLvNeedExpBox:e.find('[data-type-anchor="upLv-need-exp-box"]'),upLvMaxBox:e.find('[data-type-anchor="upLv-max-exp-box"]'),upLvNeedExp:e.find('[data-type-anchor="upLv-need-exp"]'),currLv:e.find('[data-type-anchor="current-lv"]'),nextLv:e.find('[data-type-anchor="next-lv"]'),proBar:e.find('[data-type-anchor="level-progress-bar"]'),curExpText:e.find('[data-type-anchor="exp-txt"]'),stayLvGetExp:e.find('[data-type-anchor="stayLv-get-exp"]'),stayLvNeedExp:e.find('[data-type-anchor="stayLv-need-exp"]'),stayLvTime:e.find('[data-type-anchor="stayLv-time"]'),anchorLevelIcon:e.find("[data-anchor-levelimg]"),lookLevelIntro:e.find('[data-type-anchor="look-level-introduce"]')}},sendAjax:function(t,a){var i=t.url,s=t.type||"GET",n=t.data||{},o=a||{},r=o.success||e.noop,l=o.error||e.noop;i&&e.ajax({url:i,type:s,data:n,dataType:"json",success:r,error:l})},leInfoHandle:function(e){var t=parseFloat(e.o_exp,10)/100||0,a=parseFloat(e.o_minexp,10)/100||0,i=parseFloat(e.o_upexp,10)/100||100,s=t-a,n=parseInt(e.o_lev,10)||1,o=2,r=!1,l=0;return o=n<d.maxLevel?n+1:n,l=s?s/(i+s):0,l=c.formatDecimals(100*l,1),i=c.formatContribute(i,2),t>d.maxExp&&(l=100,r=!0),{level:n,nextLv:o,bar:l,needExp:i,isMaxLv:r}},stayLeHandle:function(e){var t=parseFloat(e.keep_exp,10)||0,a=parseFloat(e.exp_distance,10)||0,i=(e.end_time||"----.--.-- 23:59")+"前",s=0===a?1:0;return t=c.formatContribute(t,2),a=c.formatContribute(a,2),{stayLv:t,needExp:a,limitTime:i,isComplete:s}},levelRender:function(t){var a=this;a.doms||a.getDoms();var i=a.doms,s={};s=a.leInfoHandle(t)||{},e.isEmptyObject(s)||(i.anchorLevelIcon.attr("data-anchor-levelimg",s.level),i.currLv.attr({"data-anchor-leveltext":s.level,title:"主播等级："+s.level}).text("Lv."+s.level),s.isMaxLv||s.level>=d.maxLevel?(i.nextLv.hide(),i.upLvNeedExpBox.hide(),i.upLvMaxBox.show()):(i.nextLv.attr({"data-anchor-nextleveltext":s.nextLv,title:"主播等级："+s.nextLv}).text("Lv."+s.nextLv),i.upLvNeedExpBox.show(),i.upLvNeedExp.text(s.needExp),i.upLvMaxBox.hide(),i.nextLv.show()),i.proBar.width(s.bar+"%"),i.curExpText.text(s.bar+"%"))},stayLvCB:{success:function(t){var a=u,i=a.doms,s={};if(t&&!e.isEmptyObject(t)){if(s=a.stayLeHandle(t)||{},e.isEmptyObject(s))return;i.stayLvNeedExp.text(s.stayLv),s.isComplete?(l.anInfoDom.find('[data-type-anchor="stay-level-text"]').hide(),s.needExp="已完成"):l.anInfoDom.find('[data-type-anchor="stay-level-text"]').show(),i.stayLvGetExp.text(s.needExp),i.stayLvTime.text(s.limitTime)}},error:function(){}},bindEvent:function(){var e=this,t=e.doms;e.timer=null,l.anInfoDom.on("mouseenter",function(){var a;t.hoverWrap.show(),e.timer||(a={url:d.url.stayLv,type:"POST",data:{roomId:d.rid}},e.sendAjax(a,e.stayLvCB),e.timer=setTimeout(function(){clearTimeout(e.timer),e.timer=null},2e3))}).on("mouseleave",function(){t.hoverWrap.hide()}),t.lookLevelIntro.length&&t.lookLevelIntro.on("click",function(){a.trigger("dys",{key:"dys.room.anchorLevel.lookIntro.click"})})}},g=function(){var n=o.get("sys.uid")==d.uid?1:0,r=t({state:!0,timer:null,init:function(t,a){var i=this,s=e('[data-tyep-anchor="upOrDown-tip"]');s.length&&s.remove(),i.render(t,a),i.bindEvent()},dialogHtml:function(e,t){var a=this,n=e,o=a.handleTextData(t),r=i.string.join('<div class="anchortip-inplayer {{ textData.typeClassName }}" id="upOrDown-tip" data-tyep-anchor="upOrDown-tip">','<div class="anchortip-inplayer-placehodler anchortip-inplayer-center"></div>','<div class="anchortip-inplayer-con anchortip-inplayer-center">','<a class="anchortip-inplayer-close" data-type-anchor="upOrDown-close"></a>','<div class="anchortip-inplayer-tipimg"></div>','<span class="anchortip-inplayer-text1">','<span class="anchortip-inplayer-center">{{ textData.text1.a }}</span>','<span class="anchortip-inplayer-anchorname anchortip-inplayer-text-hightlight anchortip-inplayer-center">{{ infoData.ownerName }}</span>','<span class="anchortip-inplayer-center">{{ textData.text1.b }}</span>','<span class="anchortip-inplayer-anchorlevel anchortip-inplayer-center {{ textData.hlClassName }}">{{ infoData.level }}</span>','<span class="anchortip-inplayer-center">{{ textData.text1.c }}</span>',"</span>",'<span class="anchortip-inplayer-text2">','<span class="anchortip-inplayer-center">{{ textData.text2.a }}</span>','<span class="anchortip-inplayer-exp anchortip-inplayer-text-hightlight anchortip-inplayer-center">{{ infoData.expLess }}</span>','<span class="anchortip-inplayer-text-hightlight">{{ textData.text2.b }}</span>',"</span>","</div>","</div>"),l=s.compile(r),d=l({infoData:n,textData:o});return d},chatHtml:function(e,t){var a,n,o,r=e;switch(t){case"levelUp":a=i.string.join('<li class="anchortip-inchat anchortip-inchat--rankup normal-notice" data-type="list">','<i class="icon-heart"></i>','<div class="anchortip-inchat-cont clearfix">','<div class="anchortip-inchat-r">','<span class="anchortip-inchat-text">','恭喜<a class="anchortip-inchat-highlight anchortip-inchat-anchorname">{{ infoData.ownerName }}</a>',"主播等级达到",'<span class="anchortip-inchat-highlight"> {{ infoData.level }}</span> 级，继续挑战新的保级任务吧',"</span>","</div>","</div>","</li>");break;case"stayFail":a=i.string.join('<li class="anchortip-inchat--protectLevelFail normal-notice" infoData-type="list">','<i class="icon-heart"></i>','<div class="anchortip-inchat-cont clearfix">','<div class="anchortip-inchat-r">','<span class="anchortip-inchat-text">',"很遗憾，",'<a class="anchortip-inchat-anchorname anchortip-inchat-highlight">{{ infoData.ownerName }}</a>',"<span > {{ infoData.level }}</span>级保级失败，扣除",'<span class="anchortip-inchat-exp anchortip-inchat-highlight">{{ infoData.expLess }}</span> 经验值',"</span>","</div>","</div>","</li>")}return n=s.compile(a),o=n({infoData:r})},render:function(e,t){var i,s=this,o={};e&&(o=s.handleData(e,t),n||o.isPopup?(i=s.dialogHtml(o,t),l.roomVideo.append(i)):(i=s.chatHtml(o,t),a.trigger("mod.chat.msg.msg",i)))},handleData:function(e,t){var a={};switch(t){case"levelUp":a.level=parseInt(e.lev,10)||1,a.expLess="";break;case"stayFail":a.level=parseInt(e.llev,10)||1,a.expLess=c.formatContribute(parseInt(e.ddct,10)/100,2)||0}return n?a.ownerName="":a.ownerName=d.ownerName||"",a.isPopup=parseInt(e.pu,10)||0,a},handleTextData:function(e){var t={text1:{},text2:{}};switch(e){case"levelUp":n?(t.text1.a="恭喜您，主播等级达到",t.text1.b=""):(t.text1.a="恭喜",t.text1.b="主播等级达到"),t.text1.c="级",t.text2.a="继续挑战新的保级任务吧",t.text2.b="",t.hlClassName="anchortip-inplayer-text-hightlight",t.typeClassName="anchortip-inplayer--rankup";break;case"stayFail":n?t.text1.a="很遗憾，您":t.text1.a="很遗憾，",t.text1.b="",t.text1.c="级保级失败",t.text2.a="扣除",t.text2.b="经验值",t.hlClassName="",t.typeClassName="anchortip-inplayer--protectLevelFail"}return t},remove:function(t){var a=this.state;a&&e(t).fadeOut("800",function(){e(t).remove(),a=!1})},bindEvent:function(){var t=this,a=e("#upOrDown-tip");a.on("click",'[data-type-anchor="upOrDown-close"]',function(){t.remove(a),clearTimeout(t.timer)}),t.timer=setTimeout(function(){t.remove(a),clearTimeout(t.timer)},3e3)}});return{create:function(e,t){return new r(e,t)}}},m=function(){var a=t({init:function(t,a){var i,s,n=this;t&&(i=n.handleData(t,a),s=e(n.render(i)),l.roomVideo.append(s),clearTimeout(n.timer),n.timer=setTimeout(function(){n.remove(s)},3e3))},render:function(e){var t=i.string.join('<div class="anchor-protectlevel-task">','<div class="anchor-protectlevel-task-placehodler anchor-protectlevel-task-center"></div>','<div class="anchor-protectlevel-task-con anchor-protectlevel-task-center">','<span class="anchor-protectlevel-task-center">您今日{{ data.type }}有效直播已达</span>','<span class="anchor-protectlevel-task-center anchor-protectlevel-task-highlight">','<span class="anchor-protectlevel-task-time">{{ data.time }}</span> 分钟',"</span>",'<span class="anchor-protectlevel-task-center">奖励</span>','<span class="anchor-protectlevel-task-center anchor-protectlevel-task-highlight">','<span class="anchor-protectlevel-task-exp">{{ data.exp }}</span> 经验值',"</span>","</div>","</div>"),a=s.compile(t),n=a({data:e});return n},handleData:function(e,t){var a,i,s={};return e?("single"===t?(s.type="单场",a=i=100):"total"===t&&(s.type="累计",a=i=300),s.time=parseInt(e.st,10)||a,i=parseInt(e.exp,10)/100||i,s.exp=c.formatContribute(i,2),s):!1},remove:function(t){e(t).fadeOut("800",function(){e(t).remove()})}});return{create:function(e,t){return new a(e,t)}}};return a.on("mod.anthor.levelInfo.get",function(e){"memberinfores"===e.type&&(u._inited||u.init(),u.levelRender(e))}),r.reg("room_data_handler",function(e){var t=n.decode(e).too(),a=t.type;switch(a){case"synexp":u.levelRender(t);break;case"upbc":g().create(t,"levelUp");break;case"dgbc":g().create(t,"stayFail");break;case"slta":m().create(t,"single");break;case"tlta":m().create(t,"total")}}),{init:function(){u.init()}}}),define("douyu/page/room/normal/mod/anchor-impress",["jquery","shark/util/lang/1.0","shark/util/template/1.0","shark/util/storage/1.0","shark/util/cookie/1.0","douyu/context","shark/observer","douyu/com/user"],function(e,t,a,i,s,n,o,r){var l=n.get("room.room_id"),d=['<div class="impress-dialog">','<div class="impress-dialog-title">印象标签</div>','<div class="impress-dialog-close">&times;</div>','<div class="impress-dialog-change <%= allTags.length > 10 ? "" : "hide" %>"><span>换一批</span><div class="impress-change-btn"></div></div>','<div class="impress-dialog-label">选择对TA的印象：</div>','<div class="impress-dialog-notips <%= allTags.length > 0 ? "hide" : "" %>">还没有人评价ta，写出对你对ta的印象吧</div>',"<% if (allTags && allTags.length > 0){%>",'<div class="impress-dialog-cont impress-all">','<div class="impress-dialog-list clearfix">',"<% for(var j=0;j<allTags.length;j++){%>",'<div class="impress-dialog-item" ',' data-id="<%= allTags[j].id %>"',' data-tag="<%= allTags[j].tag %>"',"><%= allTags[j].tag %></div>","<%}%>","</div>","</div>","<% } %>",'<div class="impress-dialog-diy"><span class="diy-add-sign"></span>自定义</div>','<div class="impress-input-box hide clearfix">','<div class="input-error">','<span class="input-error-icon"></span>','<span class="input-error-text"></span>','<span class="input-error-close">&times;</span>','<div class="input-error-arrow"></div>','<div class="input-error-arrow2"></div>',"</div>",'<input type="text" class="impress-dialog-input" placeholder="输入标签（最多4个字）" maxlength="4">','<span class="impress-dialog-edit disable">提交</span>','<span class="impress-dialog-split"></span>','<span class="impress-dialog-cancel">取消</span>',"</div>",'<div class="impress-dialog-label">我对TA的印象：</div>','<div class="impress-dialog-holder"></div>','<div class="impress-dialog-cont impress-mine hide">','<div class="impress-dialog-list clearfix">',"</div>","</div>",'<div class="impress-dialog-save">保存标签</div>','<div class="impress-dialog-tips">说明：已选标签审核通过后，将进入主播标签库</div>',"</div>"].join(""),c=['<label class="label">TA的标签：</label>','<div class="impress-list clearfix">',"<% for(var j=0;j<tags.length;j++){%>","<% var item = tags[j] %>",'<a href="/directory/tags/<%= item.id %>" class="impress-item" ',' data-id="<%= item.id %>"',' data-tag="<%= item.tag %>"',"><%= item.tag %></a>","<%}%>","</div>",'<div class="impress-add"><span class="impress-icon"></span>印象标签</div>'].join(""),u=null,g=null,m=[],p={showIndex:0,tempTags:null,pageSize:10,init:function(){1===+$ROOM.room_label_right_flag?p.getRoomTag():e(".live-room-normal-left").addClass("no-anchor-impress")},bindEvent:function(){p.$trigger.on("click",p.getAllTag),p.$container.on("click",".impress-dialog-close",p.destory),p.$container.on("click",".impress-dialog-change",p.changePage),p.$container.on("click",".impress-all .impress-dialog-item",p.choseImpress),p.$container.on("click",".impress-dialog-diy",p.showEditInput),p.$container.on("click",".impress-dialog-edit:not(.disable)",p.saveNewImpress),p.$container.on("click",".impress-dialog-cancel",p.hideEditInput),p.$container.on("click",".impress-remove",p.removeImpress),p.$container.on("click",".impress-dialog-save:not(.disable)",p.saveMineImpress),p.$container.on("click",".input-error-close",p.hideInputError),o.on("mod.normal.title.layout",function(){p.layout()})},renderDialog:function(){if(!p.$dialog){p.dialogRender||(p.dialogRender=a.compile(d));var t=p.dialogRender({allTags:g}),i=p.$dialog=e(t);p.$container.append(i),p.$holder=i.find(".impress-dialog-holder"),p.$mine=i.find(".impress-mine"),p.$mineList=p.$mine.find(".impress-dialog-list"),p.$all=i.find(".impress-all"),p.$allItems=p.$all.find(".impress-dialog-item"),p.$diy=i.find(".impress-dialog-diy"),p.$inputBox=i.find(".impress-input-box"),p.$input=i.find(".impress-dialog-input"),p.$saveBtn=i.find(".impress-dialog-save"),p.$errorBox=i.find(".input-error"),p.$errorText=i.find(".input-error-text"),p.getUserTag()}p.$input.on("blur keyup",function(){var e=p.$dialog.find(".impress-dialog-edit"),t=p.$input.val();t.length>0?e.removeClass("disable"):e.addClass("disable")})},renderMyTag:function(t){t&&t.length>0?(p.$holder.addClass("hide"),p.$mine.removeClass("hide")):(p.$holder.removeClass("hide"),p.$mine.addClass("hide"));var a=[];p.$allItems.removeClass("selected"),e.each(t,function(e,t){a.push('<div class="impress-dialog-item">','<span class="impress-text">',t,"</span>",'<span class="impress-remove">&times;</span>',"</div>"),p.selecteImpress(null,t)}),a=a.join(""),p.$mineList.html(a)},renderRoomTag:function(){p.$container=e("#container"),p.$impress=e("#anchor-info .anchor-impress").show();var t=a.compile(c),i=t({tags:m});p.$impress.html(i),p.$trigger=p.$impress.find(".impress-add"),p.bindEvent()},changePage:function(){var e=p.showIndex+p.pageSize;e>=p.$allItems.length&&(e=0),p.$allItems.hide(),p.$allItems.slice(e,e+p.pageSize).show(),p.showIndex=e},selecteImpress:function(e,t){e?p.$allItems.filter("[data-id="+e+"]").addClass("selected"):p.$allItems.filter("[data-tag="+t+"]").addClass("selected")},choseImpress:function(){var t=e(this),a=t.data();t.hasClass("selected")?p.removeMineImpress(a.tag+""):p.addMineImpress(a.tag+"")},addMineImpress:function(e){return p.tempTags.length>=5?void p.toast("maxTag"):(p.tempTags.push(e),void p.renderMyTag(p.tempTags))},removeMineImpress:function(t){var a=e.inArray(t,p.tempTags);-1!==a&&(p.tempTags.splice(a,1),p.renderMyTag(p.tempTags))},saveMineImpress:function(){var t=p.$mine.find(".impress-text");if(0===t.length)return void p.toast("saveNull");var a=[];e.each(t,function(){a.push(e(this).text())}),p.getCSRFCookie(function(t){var i=e.extend(t,{room_id:l,tag_list:a});p.requestData("/wgapi/livenc/anchor/tag/mark",JSON.stringify(i),function(e){0===+e.code?(p.toast("succ"),u=p.tempTags.slice(0),p.destory()):p.toast(e.msg||"fail")},"post","application/json")})},removeImpress:function(){var t=e.trim(e(this).closest(".impress-dialog-item").find(".impress-text").text());p.removeMineImpress(t)},saveNewImpress:function(){var t=e.trim(p.$input.val()),a=e.inArray(t,p.tempTags);if(-1!==a)return void p.showInputError("tagExist");var i=/^[0-9a-zA-Z\u4E00-\u9FA5]+$/;return i.test(t)?t.length>4?void p.showInputError("maxText"):(p.hideInputError(),void p.requestData("/wgapi/livenc/anchor/tag/check",{room_id:l,tag_name:t},function(e){e.data&&0===+e.data.status?(p.addMineImpress(t),p.$input.val(""),p.$input.trigger("blur")):p.showInputError("tagErr")})):void p.showInputError("textError")},showEditInput:function(){p.$diy.addClass("hide"),p.$inputBox.removeClass("hide")},hideEditInput:function(){p.$input.val(""),p.$diy.removeClass("hide"),p.$inputBox.addClass("hide")},destory:function(){p.$input.off("blur keyup"),p.$dialog.hide(),p.tempTags=[],p.$dialog.remove(),p.$dialog=null},getCSRFCookie:function(t){var a=this,i=s.get(n.get("sys.tvk"));if(!i)return void e.ajax({url:"/curl/csrfApi/getCsrfCookie",type:"GET",dataType:"json",success:function(e){0===+e.error&&a.getCSRFCookie(t)}});var o={};o[$SYS.tn]=i,t&&t(o)},requestData:function(t,a,i,s,n){e.ajax({url:t,data:a,type:s||"get",dataType:"json",contentType:n,success:i||e.noop})},getAllTag:function(){var e=r.check();return e?void(g?p.renderDialog():p.requestData("/wgapi/live/anchor/tag/top",{room_id:l},function(e){0===+e.code?(g=e.data||[],p.renderDialog()):p.error(e.msg)})):(r.show("login"),!1)},getUserTag:function(){u?(p.tempTags=u.slice(0),p.renderMyTag(p.tempTags)):(p.requestData("/wgapi/livenc/anchor/tag/user",{room_id:l},function(e){0===+e.code?(u=e.data.tag_list||[],p.tempTags=u.slice(0),p.renderMyTag(u)):p.error(e.msg)}),p.tempTags=[])},getRoomTag:function(){p.requestData("/wgapi/live/anchor/tag/top3",{room_id:l,cate2:$ROOM.cate_id},function(t){0===+t.code&&(e(".live-room-normal-left").removeClass("no-anchor-impress"),m=t.data||[],p.renderRoomTag(),o.trigger("mod.normal.title.layout"))})},error:function(t){e.dialog.tips_black(t||"网络错误",1)},toast:function(t){var a={succ:"主播印象提交成功",fail:"主播印象提交失败，请重试",maxTag:"亲，最多可选5个主播标签哦~",tips:"审核通过后的标签将进入主播标签库<br>亲，因为有你的标签，让水友又更了解主播一点了~ ",saveNull:"请至少选择一个标签"},i=e('<div class="impress-dialog-toast"><span class="inlie-text"></span></div>'),s=a[t]?a[t]:t;p.$container.append(i),i.find(".inlie-text").html(s),i.animate({top:"-=10"},300),i.delay(1e3).animate({opacity:0},300,function(){i.remove()})},showInputError:function(e){var t={maxText:"哎呀，字数太多了，不能超过4个字哦~",
textError:"标签只能包含汉字，英文，数字",tagExist:"你已添加该标签",tagErr:"标签包含敏感词"},a=t[e]?t[e]:e;p.$errorText.text(a),p.$errorBox.show()},hideInputError:function(){p.$errorBox.hide()},layout:function(){var t=p.$impress.find(".impress-item");if(3===t.length){var a=e("#anchor-info").width();e("#anchor-info .sq-wrap").outerWidth(!0);t.eq(2).show().css("opacity",0);var i=p.$impress.outerWidth(!0);0>=a-i-350?t.eq(2).hide():t.eq(2).show(),t.eq(2).css("opacity",1)}}};return p}),define("douyu/page/room/normal/mod/share",["jquery","shark/util/flash/data/1.0","shark/observer","shark/class","douyu/page/room/base/api","douyu/context","shark/util/template/2.0","shark/util/storage/1.0","douyu/com/ajax"],function(e,t,a,i,s,n,o,r,l){var d={};d.templateSettings={evaluate:/%([\s\S]+?)%/g,interpolate:/%=([\s\S]+?)%/g,escape:/%-([\s\S]+?)%/g},d.template=function(t,a,i){var s=/\\|'|\r|\n|\u2028|\u2029/g,n=function(e){return"\\"+escapes[e]};!a&&i&&(a=i),a=e.extend({},a,d.templateSettings);var o=RegExp([(a.escape||noMatch).source,(a.interpolate||noMatch).source,(a.evaluate||noMatch).source].join("|")+"|$","g"),r=0,l="__p+='";t.replace(o,function(e,a,i,o,d){return l+=t.slice(r,d).replace(s,n),r=d+e.length,a?l+="'+\n((__t=("+a+"))==null?'':_.escape(__t))+\n'":i?l+="'+\n((__t=("+i+"))==null?'':__t)+\n'":o&&(l+="';\n"+o+"\n__p+='"),e}),l+="';\n",a.variable||(l="with(obj||{}){\n"+l+"}\n"),l="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+l+"return __p;\n";try{var c=new Function(a.variable||"obj","_",l)}catch(u){throw u}var g=function(e){return c.call(this,e)},m=a.variable||"obj";return g.source="function("+m+"){\n"+l+"}",g};var c=($SYS.res_url.replace(/https?:/,"")+"images/ZeroClipboard.swf",['<div class="con hide" data-share-content="content">','<i class="arrow-icon"></i>','<div class="mouseenter-cover"></div>','<div class="share-more clearfix">','<div class="share-title js-share-title">呼唤小伙伴们前来围观吧</div>','<div class="share-third-list">','<!-- <h3 class="h3">呼唤小伙伴们前来围观吧</h3> -->','<div class="s-more" data-share-btn="more">','<ul class="trd-ullist clearfix">',"<li>",'<a class="sm1" href="javascript:;" title="分享到新浪微博" data-to="sinawb" target="_blank"></a>',"</li>","<li>",'<a class="sm4" href="javascript:;" title="分享到QQ" data-to="qq" target="_blank"></a>',"</li>","<li>",'<a class="sm3" href="javascript:;" title="分享到QQ空间" data-to="qzone" target="_blank"></a>',"</li>","</ul>","</div>","</div>",'<div class="wx-qcode">','<div class="wxqrimgbg">','<div class="wxqrimg"></div>','<i class="wex-icon"></i>',"</div>","<p>微信扫码分享</p>","</div>","</div>",'<div class="addr">','<div class="tt">',"<ul>",'<li class="hover" data-share-path="video">直播间地址</li>','<li data-share-path="flash">flash地址</li>','<li data-share-path="common">通用代码</li>',"</ul>","</div>",'<div class="s-box">','<div class="cc" style="display:block;">','<input class="inn" type="text" data-share-input="path" readonly>','<a href="javascript:;" class="s_copy btn" data-share-copy="btn">复制链接</a>',"</div>","</div>","</div>","</div>"].join("")),u={data:{orgin:"呼唤小伙伴们前来围观吧",activeShare:null},mouseTimer:0,init:function(){u.$shareBtn=e("#share-content"),u.shareData=null,u.addEvent()},addEvent:function(){var t=this;u.$shareBtn.on("mouseenter",function(){u.shareData||u.getWbShareConfig(),u.initShareBox()}),u.$shareBtn.on("mouseleave",function(){u.destoryShareBox()}),u.$shareBtn.on("click","[data-share-path]",function(){u.$shareBtn.find("[data-share-path]").removeClass("hover");var t=e(this);t.addClass("hover");var a=t.attr("data-share-path");u.changeShareLink(a)}),u.$shareBtn.on("click","[data-to]",function(t){var a=e(this);u.shareToThird(a.data("to"),a)}),a.on("mod.weibo.share",function(e){s.exe("js_shareSuccess",e.exp)}),a.on("mod.msg.luckDraw.info",function(e){"memberinfores"===e.type?"1"!=e.rafst&&"1"!=e.rafst_v2||t.tryShowDrawShare():"lds"===e.type||"lds_v2"===e.type?t.tryShowDrawShare():"lde"===e.type||"lde_v2"===e.type?t.luckDrawEnd():"dcc"!==e.type&&"dsg"!==e.type||t.tryShowDrawShare(!0)})},luckDrawEnd:function(){this.data.draw=null,this.data.activeShare=null},formatDate:function(e){var t,a,i,s;return t=new Date,a=("0000"+t.getFullYear()).substr(-4),i=("00"+(t.getMonth()+1)).substr(-2),s=("00"+t.getDate()).substr(-2),a+"-"+i+"-"+s},tryShowDrawShare:function(t){var a,i,s=this,o=r.get("drawShareTips"),l=s.formatDate();if(o=o?JSON.parse(o):{},n.get("room.owner_uid")==n.get("sys.uid"))s.data.draw="抽奖活动已开启！<br>快通知你的粉丝前来参加吧！",s.data.activeShare="draw-anchor",a=o.anchor||0,i=o.anchorTime||"0",3>a&&l>i&&(a++,o=e.extend(o,{anchor:a,anchorTime:l}),r.set("drawShareTips",JSON.stringify(o)),s.initShareBox(),s.autoTimer=setTimeout(function(){s.destoryShareBox(),clearTimeout(s.autoTimer)},5e3));else if(s.data.draw="抽奖活动已开启！<br>快通知你的小伙伴前来参加吧！",s.data.activeShare="draw-user",t&&(a=o.user||0,i=o.userTime||"0",3>a&&l>i)){a++,o=e.extend(o,{user:a,userTime:l}),r.set("drawShareTips",JSON.stringify(o));var d=['<div class="share-draw-tips">','<span class="share-draw-arraw"></span>',"<span>房间正在抽奖！分享一下攒攒人品~</span>","</div>"].join(""),c=e(d);u.$shareBtn.append(c);var g=setTimeout(function(){c.remove(),clearTimeout(g)},5e3)}},initShareBox:function(){clearTimeout(u.autoTimer);var t=u.$shareBtn;u.$shareContent||(u.$shareContent=e(c),t.append(u.$shareContent),u.$sharePathInput=t.find("[data-share-input=path]"),u.$copyBtn=t.find("[data-share-copy=btn]"),u.$weixinQrcode=t.find(".wxqrimg"),u.$sharePathInput.val($ROOM.share.video),u.initZclip(),u.renderQRcode(),a.trigger("dys",{key:"dys.room.title.share.show"})),this.data.draw&&t.find(".js-share-title").html(this.data.draw),u.$shareContent.removeClass("hide"),t.removeClass("out"),clearTimeout(u.mouseTimer)},changeShareLink:function(e){var t=$ROOM.share[e]||"";u.$sharePathInput.val(t)},destoryShareBox:function(){clearTimeout(u.mouseTimer),u.mouseTimer=setTimeout(function(){u.$shareContent.addClass("hide"),u.$shareBtn.addClass("out"),u.$shareContent.remove(),u.$shareContent=null,e("#global-zeroclipboard-html-bridge").off("mouseenter.shareRoom mouseleave.shareRoom")},100)},initZclip:function(){if(window.ZeroClipboard){ZeroClipboard.config({swfPath:$SYS.web_url+"app/douyu/third/zclip-2.02/ZeroClipboard.swf?20171011"});var t=new ZeroClipboard(u.$copyBtn[0]);t.on("copy",function(i){t.setText(u.$sharePathInput.val()),e.dialog.tips_black("已成功复制到您的剪切板",1.5),a.trigger("dys",{key:"dys.room.title.url.copy"})}),e("#global-zeroclipboard-html-bridge").on("mouseenter.shareRoom",function(){clearTimeout(u.mouseTimer)}),e("#global-zeroclipboard-html-bridge").on("mouseleave.shareRoom",function(){u.destoryShareBox()})}},clone:function(e,t){e=e?e:{},t||(t=e);for(var a in t)e[a]=t[a];return e},helperTmpl:function(e,t){var a,i="";if(d){var s=u.clone(d.templateSettings);d.templateSettings={evaluate:/%([\s\S]+?)%/g,interpolate:/%([\s\S]+?)%/g,escape:/%-([\s\S]+?)%/g},a=d.template(e),i=a(t),d.templateSettings=s}return i},getWbShareConfig:function(){l({url:"/wb_share/shareContents",type:"get",cache:!0,dataType:"json",data:{rid:n.get("room.room_id"),cid2:n.get("room.cate_id")}}).then(function(e){e&&0===+e.error&&e.data&&u.generateShareText(e.data)})},generateShareText:function(e){({roomName:n.get("room.room_name"),anchorName:n.get("room.owner_name"),roomId:n.get("room.room_id"),url:window.location.href});e&&(u.shareData={shareContent:e.description,shareTitle:e.title})},shareToThird:function(t,i){var s,o=$ROOM.room_url,r="我正在 "+$ROOM.room_name+" 的房间观看直播 / 主播"+$ROOM.owner_name+"，欢迎大家前来围观 / 来自#斗鱼TV#游戏直播！",l="我正在 "+$ROOM.room_name+" 的房间观看直播 / 主播"+$ROOM.owner_name+"，欢迎大家前来围观 / 来自#斗鱼TV#游戏直播！";$SYS.uid&&(o+="?fromuid="+$SYS.uid);var d={sinawb:"wb",qq:"qq",qzone:"qz"};if("draw-user"===u.data.activeShare){o+=-1!==o.indexOf("?")?"&type=luck":"?type=luck",d[t]&&(o+="&source="+d[t]);var c=n.get("room.owner_name"),g=parseInt(2*Math.random(),10)?"什么？主播【"+c+"】又在偷偷抽奖！点击进入直播间，手快有手慢无！":"主播【"+c+"】回馈粉丝在直播间开启抽奖啦！点击进入直播间，好福利不容错过！";r=g+o+" #斗鱼抽奖# #"+c+"#"}else"draw-anchor"===u.data.activeShare?(o+=-1!==o.indexOf("?")?"&type=luck":"?type=luck",d[t]&&(o+="&source="+d[t]),r="我的直播间正在限时抽奖，先到先得，赶紧来戳！ "+o+" #斗鱼抽奖# #"+n.get("room.owner_name")+"#"):u.shareData&&u.shareData.shareContent&&(r=u.shareData.shareContent||"");u.shareData&&u.shareData.shareTitle&&(l=u.shareData.shareTitle||"");var m=null;switch(t){case"sinawb":s="http://service.weibo.com/share/share.php??",m={url:o,title:l,pic:$ROOM.room_pic,appkey:979098171,ralateuid:3982726153};break;case"qq":s="http://connect.qq.com/widget/shareqq/1_index.html?",m={url:o,desc:r,title:l,pics:$ROOM.room_pic};break;case"qzone":s="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?",m={url:o,desc:r,title:l,pics:$ROOM.room_pic}}a.trigger("dys",{key:"dys.room.title.share.click",type:t});var p=[];e.each(m,function(e,t){p.push(e+"="+encodeURIComponent(t))});var f=s+p.join("&");i.attr("href",f)},randomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},renderQRcode:function(){var e="Microsoft Internet Explorer"==navigator.appName&&parseInt(navigator.userAgent.toLowerCase().match(/msie ([\d.]+)/)[1])<9?"table":"canvas",t=$ROOM.room_url.replace(/\?[\w\W]+/,"");u.$weixinQrcode.qrcode({render:e,width:77,height:77,text:t})}};return u}),define("douyu/page/room/normal/mod/qr-code",["jquery","douyu/context","shark/observer"],function(e,t,a){var i=['<div class="con hide clearfix" data-qrcode-content="content">','<i class="arrow-icon"></i>','<div class="mouseenter-cover"></div>','<div class="q-app-box fl">',"<h3>","<span>手机看直播，畅享超清画质</span>",'<a class="download clearfix fr" href="/client" target="_blank">','<i class="down-icon "></i>','<span class="down-text ">下载斗鱼app</span>',"</a>","</h3>",'<p class="q-des">斗鱼app扫描二维码，<a class="highlight">继续观看</a>精彩直播</p>','<div class="q-ewm clearfix">','<div class="q-ewm-fl fl">',"<span>1.点击APP右上方“扫一扫”</span>",'<img src="'+$SYS.web_url+'/app/douyu/res/page/room-normal/room-vactive-img1.png?v=20160602"></div>','<div class="q-ewm-fr fr">',"<span>2.对准下方二维码</span>",'<div class="qrcodebg"> <b data-qrcode-img="img"></b> </div>',"</div>","</div>","</div>","</div>"].join(""),s={renderBox:function(){if(!s.$content){var e=this.$qrcodeBtn;e.append(i),s.$content=e.find('[data-qrcode-content="content"]'),s.$qrcodeImg=e.find("[data-qrcode-img=img]"),s.renderQRcode()}s.$content.removeClass("hide"),s.$qrcodeBtn.removeClass("out"),a.trigger("dys",{key:"dys.room.title.phone.show"})},destoryBox:function(){s.$content.addClass("hide"),s.$qrcodeBtn.addClass("out"),s.$content.remove(),s.$content=null},init:function(){this.$qrcodeBtn=e("#qrcode-content"),this.addEvent()},addEvent:function(){e("#qrcode-content").on("mouseenter",function(){s.renderBox()}).on("mouseleave",function(){s.destoryBox()})},renderQRcode:function(){var e="Microsoft Internet Explorer"==navigator.appName&&parseInt(navigator.userAgent.toLowerCase().match(/msie ([\d.]+)/)[1])<9?"table":"canvas",t=$ROOM.room_url.replace(/\?[\w\W]+/,"");s.$qrcodeImg.qrcode({render:e,width:70,height:70,text:t})}};return s}),define("douyu/page/room/normal/mod/guess-game/guess-game-common",["jquery","shark/observer","shark/util/cookie/1.0","shark/util/storage/1.0","douyu/context"],function(e,t,a,i,s){var n={cache:{},waitSubmit:!1,crsf:"/curl/csrfApi/getCsrfCookie",getCSRFCookie:function(t){var i=this,n=a.get(s.get("sys.tvk"));return n?void(t&&t({name:$SYS.tn,value:n})):void e.ajax({url:i.crsf,type:"GET",dataType:"json",success:function(e){0===+e.error&&i.getCSRFCookie(t)}})},sendAjax:function(t,a){var i=this,s={url:"",type:"GET",data:{},dataType:"JSON",success:null,error:null,complete:function(){i.waitSubmit=!1}},n=e.extend(!0,s,t),o=n.success,r=n.error;o&&(n.success=function(){i.waitSubmit=!1,o.apply(window,arguments)}),r&&(n.error=function(){i.waitSubmit=!1,r.apply(window,arguments)}),n.url&&(!a&&i.waitSubmit||(i.waitSubmit=!0,"post"===n.type.toLowerCase()?i.getCSRFCookie(function(t){n.data[t.name]=t.value,e.ajax(n)}):e.ajax(n)))},isAnchor:function(){var e=this;if(void 0!=e.cache.isAnchor)return e.cache.isAnchor;var t=+s.get("sys.uid"),a=+s.get("room.owner_uid");return e.cache.isAnchor=t===a,e.cache.isAnchor},isLiving:function(){var e=+s.get("room.show_status");return 1===e},per:function(e,t,a){var i=parseInt(e),s=parseInt(t),n=i+s;if(0==n)return"0%";var o=a?i:s,r=Math.floor(o/n*100);return r+"%"},numToFix:function(e){return e.toFixed(1)},formatTotalBidNum:function(e){var t,a;if(t=parseInt(e))if(t>=1e5&&1e8>t){var i=(t/1e4).toFixed(1);a=i+"万"}else if(t>=1e8){var i=(t/1e8).toFixed(1);a=i+"亿"}else a=t;else a=0;return a},mathAbs:function(e){var t=+e;return Math.abs(t)},getGuessGameGuide:function(){var e=i.get("guessGameGuideShowFlag")||!1;return e},getSetUserAuthority:function(){var e=i.get("setUserAuthorityFlag")||!1;return e},keyHandler:function(e){var t=e.split("-");return{qid:t[0],option:t[1]}},triggerSilverChange:function(e){var a=parseInt(e);a>=0&&t.trigger("mod.userinfo.change",{current:{silver:a}})},formatEt:function(e){var t=parseInt(e/60);10>t&&(t="0"+t);var a=parseInt(e%60);10>a&&(a="0"+a);var i=t+":"+a+"后封盘";return i},suitVideoChange:function(){var t,a=e("#js-room-video").width();return t=a>968?"big4":a>746?"big3":"small3"},dys:function(e){t.trigger("dys",e)},base64_encode:function(e){var t,a,i,s,n,o,r,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d="",c=0;for(e=this.utf8_encode(e);c<e.length;)t=e.charCodeAt(c++),a=e.charCodeAt(c++),i=e.charCodeAt(c++),s=t>>2,n=(3&t)<<4|a>>4,o=(15&a)<<2|i>>6,r=63&i,isNaN(a)?o=r=64:isNaN(i)&&(r=64),d=d+l.charAt(s)+l.charAt(n)+l.charAt(o)+l.charAt(r);return d},utf8_encode:function(e){for(var t=String(e).replace(/\r\n/g,"\n"),a="",i=0;i<t.length;i++){var s=t.charCodeAt(i);128>s?a+=String.fromCharCode(s):s>127&&2048>s?(a+=String.fromCharCode(s>>6|192),a+=String.fromCharCode(63&s|128)):(a+=String.fromCharCode(s>>12|224),a+=String.fromCharCode(s>>6&63|128),a+=String.fromCharCode(63&s|128))}return a}};return n}),define("douyu/page/room/normal/mod/guess-game/guess-game-popup",["jquery","shark/observer","shark/util/cookie/1.0","shark/util/flash/data/1.0","shark/util/template/2.0","shark/util/storage/1.0","douyu/context","douyu/page/room/base/api","shark/util/lang/1.0","douyu/com/user","douyu/com/exjsonp","douyu/page/room/normal/mod/guess-game/guess-game-common"],function(e,t,a,i,s,n,o,r,l,d,c,u){var g={data:{},doms:{},guideShow:!1,firstOpenMark:!0,render:{guide:function(e,t){var a=e,i=t;return l.string.join('<div class="guess-active-guide js-guess-active-guide">','<a href="javascript:;" class="guess-guide-close"></a>','<div class="active-gift"></div>','<div class="guide-active-time">',"活动时间：",'<span class="js-guess-active-start">'+a+"</span>"," - ",'<span class="js-guess-active-end">'+i+"</span>","</div>",'<a href="javascript:;" class="to-guess">立即参与竞猜</a>',"</div>")},active:function(e){var t=l.string.join('<div class="guess-active-task">','<a href="javascript:;" class="guess-active-close"></a>','<div class="guess-active-item guess-active-betting">','<div class="guess-item-title">投注：<span>投注 ≥ <span class="js-bet-task-limit">{{ bet.condition || 100 }}</span>鱼丸</span></div>','<div class="guess-item-first">','首次必得<span class="guess-item-price js-bet-task1-first">{{ bet.task1 ? bet.task1.max : 0 }}个</span>盛典星光',"</div>",'<div class="guess-item-get">','已获得<span class="guess-item-price js-bet-task1-get">{{ bet.task1 ? bet.task1.current : 0 }}/{{ bet.task1 ? bet.task1.max : 0 }}</span>星光',"</div>",'<div class="guess-item-every">',"每次投注可获得随机星光","</div>",'<div class="guess-item-get">','已获得<span class="guess-item-price js-bet-task2-get">{{ bet.task2 ? bet.task2.current : 0 }}/{{ bet.task2 ? bet.task2.max : 0 }}</span>星光',"</div>","</div>",'<div class="guess-active-item guess-active-guess">','<div class="guess-item-title">开猜：</div>','<div class="guess-item-first">','首次必得<span class="guess-item-price js-banker-task1-first">{{ banker.task1 ? banker.task1.max : 0 }}个</span>盛典星光',"</div>",'<div class="guess-item-get">','已获得<span class="guess-item-price js-banker-task1-get">{{ banker.task1 ? banker.task1.current : 0 }}/{{ banker.task1 ? banker.task1.max : 0 }}</span>星光',"</div>",'<div class="guess-item-every">',"每次开猜可获得随机星光","</div>",'<div class="guess-item-get">','已获得<span class="guess-item-price js-banker-task2-get">{{ banker.task2 ? banker.task2.current : 0 }}/{{ banker.task2 ? banker.task2.max : 0 }}</span>星光',"</div>","</div>",'<div class="guess-active-explain">* 获得星光道具在背包中查看，每个时段送出星光道具数量有限，发完为止<br>* 同一个主题只能获得一次投注奖励</div>',"</div>"),a=s.compile(t);return a({bet:e.bet||{},banker:e.banker||{}})}},getInteract:function(t){var a=e.Deferred(),i=this;return i.data.interact?(a.resolve(i.data.interact),a.promise()):(c.load(o.get("sys.webconfUrl")+"resource/common/interact.json","interact",function(e){i.data.interact=e,a.resolve(e)},function(e){a.reject(e)},function(){},!0),a.promise())},getServerTime:function(){var t=e.Deferred(),a=this;return a.data.serverTime&&t.resolve(a.data.serverTime),e.ajax({url:"/api/v1/timestamp",type:"GET",dataType:"JSON",success:function(e){0==e.error?(a.data.serverTime=e.data,t.resolve(e.data)):t.reject(e)},error:function(e){t.reject(e)}}),t.promise()},getActiveState:function(){var t=this,a=e.Deferred();return e.when(t.getInteract(),t.getServerTime()).then(function(e,i){if(e&&e.quiz_setting&&e.quiz_setting.daily_task){var s=e.quiz_setting.daily_task.start_time,n=e.quiz_setting.daily_task.end_time;e.quiz_setting.daily_task.server_time=i,e.active_status=i>=s&&n>=i,e.active_status&&(e.guide_show=parseInt(i,10)-parseInt(s,10)<259200)}t.interact=e,a.resolve(e)},function(e){a.reject(e)}),a.promise()},init:function(){this.doms.$video=e("#js-room-video")},showActiveDialog:function(){var e=this;u.sendAjax({url:"/member/quiz/daily_task",type:"GET",dataType:"JSON",success:function(t){0==t.error&&t.data&&e.renderActiveData(t.data)}})},renderActiveData:function(t){var a=this,i=a.doms;if(a.firstOpenMark)a.firstOpenMark=!1,i.$dialog=e(a.render.active(t)),i.$video.append(i.$dialog),a.cacheActiveDoms(),i.$dialog.on("click",".guess-active-close",function(){i.$dialog.hide()});else{var s=t.bet,n=t.banker;s&&(s.condition&&i.betLimit.text(s.condition),i.bet1First.text(s.task1.max+"个"),i.bet1Get.text(s.task1.current+"/"+s.task1.max),i.bet2Get.text(s.task2.current+"/"+s.task2.max)),n&&(i.banker1First.text(n.task1.max+"个"),i.banker1Get.text(n.task1.current+"/"+n.task1.max),i.banker2Get.text(n.task2.current+"/"+n.task2.max)),i.$dialog.show()}},cacheActiveDoms:function(){var e=this,t=e.doms,a=t.$dialog;t.betLimit=a.find(".js-bet-task-limit"),t.bet1First=a.find(".js-bet-task1-first"),t.bet1Get=a.find(".js-bet-task1-get"),t.bet2Get=a.find(".js-bet-task2-get"),t.banker1First=a.find(".js-banker-task1-first"),t.banker1Get=a.find(".js-banker-task1-get"),t.banker2Get=a.find(".js-banker-task2-get")},getFormatDate:function(e){var t,a,i,s,n;return e?(t=1e3*parseInt(e,10),a=new Date(t),s=("00"+(a.getMonth()+1)).substr(-2),n=("00"+a.getDate()).substr(-2),s+"月"+n+"日"):(a=new Date,i=("0000"+a.getFullYear()).substr(-4),s=("00"+(a.getMonth()+1)).substr(-2),n=("00"+a.getDate()).substr(-2),i+"-"+s+"-"+n)},tryShowGuide:function(){var e=this,t=e.interact;if(t&&t.quiz_setting&&t.quiz_setting.daily_task){e.staticData=t;var a=n.get("guessYearActiveShowTime")||"",i=e.getFormatDate();t.guide_show&&i>a&&(n.set("guessYearActiveShowTime",i),e.showActiveGuide())}},showActiveGuide:function(){var t=this.staticData.quiz_setting.daily_task,a=this.getFormatDate(t.start_time),i=this.getFormatDate(t.end_time),s=this.render.guide(a,i),n=e(s);this.doms.$video.append(n),this.guideShow=!0,n.on("click",".guess-guide-close",function(){n.remove(),this.guideShow=!1}).on("click",".to-guess",function(){e(".guess-game-btn").trigger("click"),n.remove(),this.guideShow=!1})},getActiveShowStatus:function(){return this.guideShow}},m={doms:{},vars:{mainMsg:null,odds_before:null,DeJin_before:null,odds_now:null,DeJin_now:null,Betting_now:null,title_num:1,roomId:$ROOM.room_id,titleHistory:[],user_num:null},flag:{},scrollTimer:null,powerTimer:null,cacheDealerDoms:function(){var t=this.doms,a=e(".guess-tip-dealer");t.$Dealer=a,t.$chooseTrue=a.find(".guess-tip-dealer-choose_one"),t.$chooseFalse=a.find(".guess-tip-dealer-choose_two"),t.$chooseNotice=a.find(".choose-notice"),t.$odds_choose=a.find(".guess-tip-dealer-odds_num"),t.$DeJin_choose=a.find(".guess-tip-dealer-DeJin_num"),t.$odds_yours=a.find(".guess-tip-dealer-freedom_odds"),t.$DeJin_yours=a.find(".guess-tip-dealer-freedom_DeJin"),t.$Dealer_sureBtn=a.find(".guess-tip-dealer-sureBtn"),t.$Dealer_helper=a.find(".guess-tip-dealer-help"),t.$Dealer_helper_content=a.find(".guess-tip-dealer-help-tip_out"),t.$Dealer_myFishBall=a.find(".guess-tip-dealer-my_fishBall_num");var i=e(".guess-tip-betting");t.$Betting=i,t.$Betting_yours=i.find(".guess-tip-betting-input input"),t.$Betting_choose=i.find(".guess-tip-betting-num"),t.$odds_value=i.find(".guess-tip-betting-msgOdds span"),t.$win_value=i.find(".guess-tip-betting-msgWin span"),t.$Betting_fishBall=i.find(".guess-tip-betting-msgOwn span"),t.$Betting_Btn=i.find(".guess-tip-betting-doneBtn");var s=e(".ancher-result");t.$Ancher_result_helper=s.find(".ancher-result-help"),t.$Ancher_result_helper_content=s.find(".ancher-result-help-tip_out"),t.$Ancher_result_choose=s.find(".ancher-result-help-tip_out");e(".guess-setting")},render:{enter:function(e){var t=l.string.join('<div class="guess-game-wrap">','<div class="guess-game-btn"></div>','<div class="guess-ancher-reminding-out">','<div class="guess-ancher-reminding">','<div class="guess-ancher-reminding-close"></div>','<div class="guess-ancher-reminding-img"></div>','<div class="guess-ancher-reminding-content">','<span class="guess-ancher-reminding-title">互动竞猜让直播效果爆炸!</span>','<span class="guess-ancher-reminding-text">你要的互动、收益、话题、人气... 开启竞猜全都有!</span>',"</div>",'<div class="guess-ancher-reminding-part"></div>',"</div>","</div>",'<div class="guess-user-reminding-out">','<div class="guess-user-reminding js-new-guess-entertips">','<div class="guess-user-reminding-close"></div>','<img class="guess-user-reminding-img" src={{ pic }} />','<div class="guess-user-reminding-content">','<span class="guess-user-reminding-name" title="{{ name }}">{{ name }}</span>','<span class="guess-user-reminding-title">邀请您参与互动竞猜</span>','<span class="guess-user-reminding-text">鱼丸奖金池爆满，快来抢!</span>',"</div>",'<div class="guess-user-reminding-part"></div>',"</div>","</div>",'<div class="guess-user-reminding-out-special">','<div class="guess-user-reminding-special js-new-guess-entertips-special">','<div class="guess-user-reminding-close-special"></div>','<img class="guess-user-reminding-img-special" src={{ pic }} />','<div class="guess-user-reminding-content-special">','<span class="guess-user-reminding-name-special" title="{{ name }}">{{ name }}</span>','<span class="guess-user-reminding-title-special">邀请您参与互动竞猜</span>','<span class="guess-user-reminding-text-special">赢鱼丸，抢星光，为主播打CALL</span>',"</div>",'<div class="guess-user-reminding-part-special"></div>',"</div>","</div>","</div>"),a=s.compile(t);return a(e)},dealer:function(t){var a=l.string.join('<div class="guess-tip-dealer" data-qid={{ changeMsg.qid }}>','<div class="guess-tip-dealer-close2"></div>','<div class="guess-tip-dealer-help-tip_out">','<span class="guess-tip-dealer-help-tip">您的底金可以被其他玩家购买,</br>若您猜对可以获得其他玩家购买的金额.</span>','<span class="guess-tip-dealer-part"></span>',"</div>",'<div class="guess-tip-dealer-title">我要开猜','<div class="rulesBox">','<i class="iconHorn"></i>','<div class="scrollBox">','<div class="scrollBody1 J-scrollBody1">',"<p>开猜后，您的底金会被其他用户购买</p>","<p>猜对即可获得用户投注到您的开猜上的鱼丸</p>","<p>赔率设得越高，开猜越容易被其他用户买</p>","<p>若开猜没有被购买，这部分鱼丸会返还给您</p>","</div>",'<div class="scrollBody2 J-scrollBody2">',"</div>","</div>",'<div class="tipsTextBox">','<div class="tipsTitle">开猜说明</div>','<div class="tipsRow"><i class="iconNum">1</i>开猜后，您的底金会被其他用户购买</div>','<div class="tipsRow"><i class="iconNum">2</i>猜对即可获得用户投注到您的开猜上的鱼丸</div>','<div class="tipsRow"><i class="iconNum">3</i>赔率设得越高，开猜越容易被其他用户买</div>','<div class="tipsRow"><i class="iconNum">4</i>若开猜没有被购买，这部分鱼丸会返还给您</div>','<div class="tipsArrow"></div>',"</div>","</div>","</div>",'<div class="guess-tip-dealer-topic_out">','<span class="guess-tip-dealer-topic">主　题：</span>','<span class="guess-tip-dealer-topic_content">{{ changeMsg.title }}</span>',"</div>",'<div class="guess-tip-dealer-choose_out">','<span class="guess-tip-dealer-choose">猜胜方：</span>','<span class="guess-tip-dealer-choose_one" data-chooseNum=1>{{ changeMsg.chooseOne }}</span>','<span class="guess-tip-dealer-choose_two" data-chooseNum=2>{{ changeMsg.chooseTwo }}</span>','<span class="choose-notice"></span>',"</div>",'<div class="guess-tip-dealer-odds_out">','<span class="guess-tip-dealer-odds">赔　率：</span>','<span class="guess-tip-dealer-odds_num guess-tip-dealer-odds_one dealer_active">{{ sureMsg.odds[0] }}</span>','<span class="guess-tip-dealer-odds_num">{{ sureMsg.odds[1] }}</span>','<span class="guess-tip-dealer-odds_num">{{ sureMsg.odds[2] }}</span>','<span class="guess-tip-dealer-odds_num">{{ sureMsg.odds[3] }}</span>','<span class="guess-tip-dealer-odds_num">{{ sureMsg.odds[4] }}</span>','<input class="guess-tip-dealer-freedom_odds" onKeypress="return (event.which||event.keyCode) !=32" maxlength="3"  placeholder="输入0.1至9.9"/>',"</div>",'<div class="guess-tip-dealer-DeJin_out">','<span class="guess-tip-dealer-DeJin">底　金：</span>','<span class="guess-tip-dealer-DeJin_num guess-tip-dealer-DeJin_one dealer_active">{{ sureMsg.base_gold[0] }}</span>','<span class="guess-tip-dealer-DeJin_num">{{ sureMsg.base_gold[1] }}</span>','<span class="guess-tip-dealer-DeJin_num">{{ sureMsg.base_gold[2] }}</span>','<span class="guess-tip-dealer-DeJin_num">{{ sureMsg.base_gold[3] }}</span>','<input class="guess-tip-dealer-freedom_DeJin" onKeypress="return (event.which||event.keyCode) !=32" maxlength="9" placeholder="输入{{ sureMsg.min_base_gold }}及以上"/>',"</div>",'<div class="guess-tip-dealer-my_fishBall">','我的鱼丸  <span class="guess-tip-dealer-my_fishBall_num" data-login-user="silver">{{ changeMsg.fishBall }}</span>','<span class="division">|</span>','赢则最多得  <span class="expectFishBall">{{ calcSilverFunc(sureMsg.odds[0], sureMsg.base_gold[0]) }}</span>',"</div>",'<div class="guess-tip-dealer-sureBtnOut">','<div class="guess-tip-dealer-sureBtn">确 定</div>',"</div>","</div>"),i=e.extend({},t,{calcSilverFunc:function(e,t){return m.calcSilverFunc(e,t)}}),n=s.compile(a);return n(i)},betting:function(e){var t=l.string.join('<div class="guess-tip-betting-total">','<div class="guess-tip-betting" data-bankerid={{ sbid }} data-qid={{ qid }} data-balance={{ leaves }} data-option="{{ option }}">','<div class="guess-tip-betting-close"></div>','<div class="guess-tip-betting-error"></div>','<div class="guess-tip-betting-input">','<input maxlength="9" placeholder="输入{{ betting_choice.min_bet_gold }}~{{ leaves }}"/>',"</div>",'<div class="guess-tip-betting-numBtnOut">','<div class="guess-tip-betting-numBtnIn">','<span class="guess-tip-betting-num">{{ betting_choice.bet_amount[0] }}</span>','<span class="guess-tip-betting-num guess-tip-betting-num-left">{{ betting_choice.bet_amount[1] }}</span>','<span class="guess-tip-betting-num guess-tip-betting-num-left">{{ betting_choice.bet_amount[2] }}</span>','<span class="guess-tip-betting-num guess-tip-betting-num-left">全部</span>',"</div>","</div>",'<div class="guess-tip-betting-msgOut">','<span class="guess-tip-betting-msgOdds">赔率 <span>{{ odds }}</span></span>','<span class="guess-tip-betting-msgOdds11">|</span>','<span class="guess-tip-betting-msgWin">赢则获得 <span>0</span></span>','<span class="guess-tip-betting-msgOdds11">|</span>','<span class="guess-tip-betting-msgOwn">我的鱼丸 <span data-login-user="silver">{{ myball }}</span></span>',"</div>",'<div class="guess-tip-betting-doneBtnOut">','<span class="guess-tip-betting-doneBtn">投注</span>',"</div>","</div>",'<div class="guess-tip-betting-part"></div>',"</div>"),a=s.compile(t);return a(e)},ancher_result:function(e){var t=l.string.join('<div class="ancher-result">','<div class="ancher-result-close3"></div>','<p class="ancher-result-title">提交结果</p>',"{{ each part}}",'<div class="ancher-result_one" data-qid={{ $value.qid }}>','<span class="ancher-result_title">{{ $value.title }}</span>','<div class="ancher-result_time">','<span class="ancher-result_min">{{ $value.endTime }}</span>',"</div>",'<div class="ancher-answerAndNum">','<span class="ancher-result_answer" data-chooseId=1>{{ $value.chooseOne }}</span>','<span class="ancher-result_answer ancher-result_answer-left" data-chooseId=2>{{ $value.chooseTwo }}</span>','<span class="ancher-result_answer ancher-result_answer-left" data-chooseId=3>流局</span>','<div class="ancher-result-help">?</div>','<div class="ancher-result-help-tip_out">','<span class="ancher-result-help-tip">选中流局后，此竞猜无效，将返还用户投注鱼丸</span>','<span class="ancher-result-part"></span>',"</div>","</div>","</div>","{{ /each }}",'<div class="ancher-knowBtnOut">','<div class="ancher-knowBtn-false">取　消</div>','<div class="ancher-knowBtn-true">提　交</div>',"</div>","</div>"),a=s.compile(t);return a(e)},setting_have:function(e){var t=l.string.join('<div class="guess-setting-have">','<div class="guess-setting-have-close"></div>','<p class="guess-setting-have-title">竞猜主题设置</p>','<div class="guess-setting-have-retitle">','<span class="guess-setting-have-ask">您最多可同时发起3个主题(<span>已选中：<span class="guess-setting-have-ask-num">0</span>个</span>)</span>','<a href="https://www.douyu.com/cms/gong/201712/25/6965.shtml" target="_blank" class="guess-setting-have-rule" >玩法介绍</a>',"</div>",'<div class="guess-setting-have-main">','<div class="guess-setting-have-mainIn">',"{{ each }}","{{ if ($value.status==0||$value.status==2) }}",'<div class="guess-setting_one guess-setting_oneStop" data-titleId = {{ $value.quize_id }}  data-limit-time = {{ $value.stop_timestamp }}>',"{{ if ($value.status==0) }}",'<div class="guess-setting_one-audit guess-setting_one-auditYes"></div>','<span class="guess-setting_one-changeNo"></span>',"{{ /if }}","{{ if ($value.status==2) }}",'<div class="guess-setting_one-audit guess-setting_one-auditNo"></div>','<span class="guess-setting_one-changeNo guess-setting_one-change"></span>',"{{ /if }}",'<span class="guess-setting_one-false"></span>','<span class="guess-setting_one-error">{{ $value.remark }}</span>','<span class="guess-setting_one-close"></span>','<div class="guess-setting_one-contain">','<div class="guess-setting_one-lineOne">','<span class="guess-setting_one-title">{{ $value.quize_theme }}</span>',"{{ if ($value.stop_timestamp!=0) }}",'<span class="guess-setting_one-middle">|</span>','<span class="guess-setting_one-time">发起后<span>{{ $value.stop_timestamp/60 }}分钟</span>封盘</span>',"{{ /if }}","</div>",'<div class="guess-setting_one-lineTwo">','<span class="guess-setting_one-chooseOne">{{ $value.first_option_name }}</span>','<span class="guess-setting_one-vs">vs</span>','<span class="guess-setting_one-chooseTwo">{{ $value.second_option_name }}</span>',"</div>","</div>","</div>","{{ /if }}","{{ if ($value.status==1) }}",'<div class="guess-setting_one" data-titleId = {{ $value.quize_id }}  data-limit-time = {{ $value.stop_timestamp }}>',"{{ if ($value.is_invalid==1) }}",'<span class="guess-setting_one-false"></span>','<span class="guess-setting_one-error">主题失效，请重新编辑或删除</span>',"{{ /if }}","{{ if ($value.is_invalid==0) }}",'<span class="guess-setting_one-sure"></span>',"{{ /if }}",'<span class="guess-setting_one-close"></span>','<span class="guess-setting_one-changeNo guess-setting_one-change"></span>','<div class="guess-setting_one-contain">','<div class="guess-setting_one-lineOne">','<span class="guess-setting_one-title">{{ $value.quize_theme }}</span>',"{{ if ($value.stop_timestamp!=0) }}",'<span class="guess-setting_one-middle">|</span>','<span class="guess-setting_one-time">发起后<span>{{ $value.stop_timestamp/60 }}分钟</span>封盘</span>',"{{ /if }}","</div>",'<div class="guess-setting_one-lineTwo">','<span class="guess-setting_one-chooseOne">{{ $value.first_option_name }}</span>','<span class="guess-setting_one-vs">vs</span>','<span class="guess-setting_one-chooseTwo">{{ $value.second_option_name }}</span>',"</div>","</div>","</div>","{{ /if }}","{{ /each }}","</div>","</div>",'<div class="guess-setting-have-knowBtnOut">','<div class="have-add_title">+添加主题</div>','<div class="guess-setting-have-knowBtn">发起竞猜</div>',"</div>","</div>"),a=s.compile(t);
return a(e)},setting_add:function(e){var t=l.string.join('<div class="guess-setting-edit">','<div class="guess-setting-edit-close"></div>','<div class="guess-setting-edit-back">返回</div>','<p class="guess-setting-edit-title">编辑竞猜主题</p>','<div class="guess-setting-edit-retitle">','<span class="guess-setting-edit-ask">竞猜内容</span>','<span class="guess-setting-edit-rule"></span>',"</div>",'<div class="guess-setting-edit-main">','<input class="guess-setting-edit-editTitle" onKeypress="return (event.which||event.keyCode) !=32" maxlength="15" placeholder="竞猜主题（1-15个字）" />','<div class="guess-setting-edit-editChoose">','<input class="guess-setting-edit-chooseOne" onKeypress="return (event.which||event.keyCode) !=32" maxlength="5" placeholder="选项A（1-5个字）"/>','<span class="guess-setting-edit-editVs">VS</span>','<input class="guess-setting-edit-chooseTwo" onKeypress="return (event.which||event.keyCode) !=32" maxlength="5" placeholder="选项B（1-5个字）"/>',"</div>",'<div class="guess-setting-edit-time">','<div class="guess-setting-edit-timeName">定时封盘</div>','<div class="guess-setting-edit-timeEach">',"{{ each time_choose.stop_timestamp}}","{{ if ($value==0) }}",'<span class="guess-setting-edit-timeOne guess-setting-edit-timeFloat guess-setting-edit-timeActive" data-limit-time="{{$value}}">不限制</span>',"{{ /if }}","{{ if ($value!=0&&$index==3) }}",'<span class="guess-setting-edit-timeOne guess-setting-edit-timeFloat " data-limit-time="{{$value}}">{{$value/60}}分钟</span>',"{{ /if }}","{{ if ($value!=0&&$index!=3) }}",'<span class="guess-setting-edit-timeOne" data-limit-time="{{$value}}">{{$value/60}}分钟</span>',"{{ /if }}","{{ /each }}","</div>","</div>","</div>",'<div class="guess-setting-edit-knowBtnOut">','<div class="guess-setting-edit-knowBtn">提交审核</div>',"</div>","</div>"),a=s.compile(t);return a(e)},user_result:function(e){var t=l.string.join('<div class="guess-user-result">','<div class="guess-user-close3"></div>','<div class="guess-user-result-head"></div>','<p class="guess-user-title"></p>',"{{ each part}}",'<div class="guess-user-result_one">','<div class="guess-user-resultAndTitle">','<span class="guess-user-result_title"><i class="iconNum">{{$index+1}}</i>{{ $value.qt }}</span>',"</div>",'<div class="guess-user-answerAndNum">',"{{ if ($value.qet==2) }}",'<span class="guess-user-result_answer" style="color:#999999;">{{ $value.won }}</span>',"{{ /if }}","{{ if ($value.qet==1) }}",'<span class="guess-user-result_answer">胜利方：{{ $value.won }}</span>',"{{ /if }}","{{ if ($value.ec>=0&&$value.qet==1) }}",'<span class="guess-user-result_num">+{{ $value.ec }}鱼丸</span>',"{{ /if }}","{{ if ($value.qet==2) }}",'<span class="guess-user-result_num" style="color:#ff7700;" >返回竞猜鱼丸</span>',"{{ /if }}","{{ if ($value.ec<0) }}",'<span class="guess-user-result_num" style="color:#999999;" >{{ $value.ec }}鱼丸</span>',"{{ /if }}","</div>","</div>","{{ /each }}",'<div class="guess-user-knowBtnOut">','<div class="guess-user-knowBtn">我知道了</div>',"</div>","</div>"),a=s.compile(t);return a(e)},anchor_resultSure:function(e){var t=l.string.join("{{ each part}}",'<div class="anchor_resultSure-one">','<span class="anchor_resultSure-one-left">{{ $value.title }}</span>','<span class="anchor_resultSure-one-right">{{ $value.choose }}</span>',"</div>","{{ /each }}"),a=s.compile(t);return a(e)},noPass:function(e){var t=l.string.join('<div class="guess-noPass">','<div class="guess-noPass-close"></div>','<div class="guess-noPass-title">提示</div>','<div class="guess-noPass-content">{{ content }}</div>','<div class="guess-noPass-knowBtnOut">','<div class="guess-noPass-knowBtn">知道啦</div>',"</div>","</div>"),a=s.compile(t);return a(e)},userSet:function(e){var t=l.string.join('<div class="guess-userPermissions">','<div class="guess-userPermissions-close"></div>','<div class="guess-userPermissions-title">发起竞猜权限设置</div>','<div class="guess-userPermissions-tip">','<div class="guess-userPermissions-voice"></div>','<div class="guess-userPermissions-move">',"<div>被勾选的用户将可以在您的直播间发起竞猜,主播可以专心直播啦</div>","<div>用户发起的竞猜正常结束后，您也可以获得鱼丸抽成加热度</div>","<div>若您需自己发起竞猜，可随时结束用户的竞猜，请提交正确结果</div>","<div>请合理分配发起权限，若用户发起竞猜违规，将收回您的权限</div>","</div>","</div>",'<div class="guess-userPermissions-instructions">','<div class="guess-userPermissions-instructionsTitle">权限设置说明</div>','<div class="guess-userPermissions-instructionsOne">1</div>','<div class="guess-userPermissions-instructionsTwo">2</div>','<div class="guess-userPermissions-instructionsThree">3</div>','<div class="guess-userPermissions-instructionsFour">4</div>','<div class="guess-userPermissions-contentOne">被勾选的用户将可以在您的直播间发起竞猜,主播可以专心直播啦</div>','<div class="guess-userPermissions-contentTwo">用户发起的竞猜正常结束后，您也可以获得鱼丸抽成加热度</div>','<div class="guess-userPermissions-contentThree">若您需自己发起竞猜，可随时结束用户的竞猜，请提交正确结果</div>','<div class="guess-userPermissions-contentFour">请合理分配发起权限，若用户发起竞猜违规，将收回您的权限</div>',"</div>","{{ each pageIfShow as show }}",'{{ if (show=="management") }}','<div class="guess-userPermissions-admin">',"{{ if (msg.management==0) }}",'<div class="guess-userPermissions-adminIf"></div>',"{{ /if }}","{{ if (msg.management==1) }}",'<div class="guess-userPermissions-adminIf guess-userPermissions-adminIfSure"></div>',"{{ /if }}",'<div class="guess-userPermissions-name">房管</div>',"</div>","{{ /if }}",'{{ if (show=="specific_users") }}','<div class="guess-userPermissions-user">','<div class="guess-userPermissions-userSet">',"{{ if (msg.specific_permission==0) }}",'<div class="guess-userPermissions-userIf"></div>','<div class="guess-userPermissions-name">指定用户</div>','<input class="guess-userPermissions-input" maxlength="50" disabled="disabled" onKeypress="return (event.which||event.keyCode) !=32" placeholder="请输入用户昵称" />','<div class="guess-userPermissions-search">添加</div>',"{{ /if }}","{{ if (msg.specific_permission==1) }}",'<div class="guess-userPermissions-userIf guess-userPermissions-userIfSure"></div>','<div class="guess-userPermissions-name">指定用户</div>','<input class="guess-userPermissions-input guess-userPermissions-inputYes" maxlength="50" onKeypress="return (event.which||event.keyCode) !=32" placeholder="请输入用户昵称" />','<div class="guess-userPermissions-search guess-userPermissions-searchYes">添加</div>',"{{ /if }}","</div>",'<div class="guess-userPermissions-list">',"{{ if (msg.specific_user.length==0) }}","最多指定8个用户哦","{{ /if }}","{{ if (msg.specific_user.length!=0) }}","{{ each msg.specific_user }}",'<div class="guess-userPermissions-userOne title="{{ $value.nickname }}">','<div class="guess-userPermissions-userOne-close"></div>','<img class="guess-userPermissions-userPic" title="{{ $value.nickname }}" src="{{ $value.icon }}" />','<div class="guess-userPermissions-username" title="{{ $value.nickname }}">{{ $value.nickname }}</div>',"</div>","{{ /each }}","{{ /if }}","</div>",'<div class="guess-userPermissions-cover"></div>',"</div>","{{ /if }}","{{ /each }}",'<div class="guess-userPermissions-knowBtnOut">','<div class="guess-userPermissions-knowBtn">确　定</div>',"</div>","</div>"),a=s.compile(t);return a(e)},userSetAdd:function(e){var t=l.string.join('<div class="guess-userPermissions-userOne" title="{{ data.nickname }}">','<div class="guess-userPermissions-userOne-close"></div>','<img class="guess-userPermissions-userPic" title="{{ data.nickname }}" src="{{ data.icon }}" />','<div class="guess-userPermissions-username" title="{{ data.nickname }}">{{ data.nickname }}</div>',"</div>"),a=s.compile(t);return a(e)}},popTips:function(){var t=this;t.doms;u.isAnchor()||t.guessMainPanel.isPanelShow()||(e("#js-guess-start").hide(),g.getActiveState().then(function(t){t.active_status?e(".guess-user-reminding-special").show():e(".guess-user-reminding").show(),u.dys({key:"dys.room.guess-game.showtip"})},function(){e(".guess-user-reminding").show()}))},chooseNotice:function(e){var t=this,a=t.doms,i="若竞猜结果为【"+e+"】，则您获胜";a.$chooseNotice.text(i).show()},hasChooseOdds:function(){var t,a=this,i=a.doms,s=e(".guess-tip-dealer-odds_out").find(".dealer_active"),n=+i.$odds_yours.val();return t=0===n&&0===s.length?0:n>0?n:+s.text()},hasChoosePrincipal:function(){var t,a=this,i=a.doms,s=e(".guess-tip-dealer-DeJin_out").find(".dealer_active"),n=s.text(),o=i.$DeJin_yours.val();return o?t=+o:"全部"!==n?t=+n:"全部"===n&&(t=i.$Dealer_myFishBall.text()),t},calcSilverFunc:function(e,t){var a=this,i=+e,s=+t,n=+a.vars.mainMsg.quiz_setting.divided_rate;if(a.guessMainPanel.guessData.guessList.length>0&&(n=100-Number(a.guessMainPanel.guessData.guessList[0].aktp)),i>0){var o=Math.floor(s/i*n/100);return o}return!1},calcSilver:function(){var e=this,t=e.doms,a=e.hasChoosePrincipal(),i=e.hasChooseOdds();if(i>0){var s=e.calcSilverFunc(i,a);t.$Dealer.find(".expectFishBall").text(s)}},scrollRules:function(){function e(a){var s;if(a)s=5e3;else{var n=i.scrollTop();n>=o?i.scrollTop(0):(n++,i.scrollTop(n)),s=n%26?10:5e3}t.clearScrollTimer(),t.scrollTimer=setTimeout(e,s)}var t=this,a=t.doms,i=a.$Dealer.find(".scrollBox"),s=a.$Dealer.find(".J-scrollBody1"),n=a.$Dealer.find(".J-scrollBody2"),o=s.height();n.html(s.html()),e(!0)},clearScrollTimer:function(){var e=this;e.scrollTimer&&clearInterval(e.scrollTimer)},showEnter:function(){var a=this,i=JSON.parse(n.get("ifAnchorNote")),s={name:$ROOM.owner_name,pic:e(".anchor-pic").find("img").attr("src")};g.tryShowGuide();var o=this.render.enter(s);u.dys({key:"dys.room.guess-game.anchor.showenter"}),t.trigger("mod.chat.action.view.add",{flag:"anchor_quiz",dom:o,lock:!0,tips:"猜直播，赢鱼丸，加热度！"}),f.tryShow("dom"),a.bindTipEvent(),!i&&u.isAnchor()&&(e(".guess-ancher-reminding").show(),n.set("ifAnchorNote",JSON.stringify(!0))),e(document).on("click",".guess-game-btn",function(){return u.dys({key:"dys.room.anchor.guess.click"}),d.check()?(e(".guess-user-reminding").hide(),e(".guess-user-reminding-special").hide(),e(".guess-ancher-reminding").hide(),void a.guessMainPanel.initMainPanel()):void d.show("login")})},showDealer:function(t){var a=this.doms,i={sureMsg:this.vars.mainMsg.quiz_setting,changeMsg:t};this.removeSome();var s=this.render.dealer(i);a.$dealer=e(s),e("body").append(a.$dealer),this.bindDealerEvent(),a.$dealer.show(),this.scrollRules()},showBetting:function(t,a,i){var s=this.doms,n=this.vars.mainMsg.quiz_setting.max_bet_gold,o={betting_choice:this.vars.mainMsg.quiz_setting,odds:a.odds,qid:a.qid,sbid:a.sbid,leaves:a.leaves>n?n:a.leaves,myball:e(".fishBall_NUM").html(),option:"left"==a.leftOrRight?1:2};this.removeSome();var r=this.render.betting(o);s.$betting=e(r),t.append(s.$betting),this.bindBettingEvent(i),s.$betting.show(),"right"==a.leftOrRight?t.find(".guess-tip-betting-part").css("left","310px"):"left"==a.leftOrRight&&t.find(".guess-tip-betting-part").css("left","45px")},showAncherResult:function(t){var a=this.doms;config={part:t},a.$ancher_result&&e(".ancher-result").remove();var i=this.render.ancher_result(config);a.$ancher_result=e(i),e("body").append(a.$ancher_result),this.bindAncher_resultEvent(),a.$ancher_result.show()},showUserResult:function(t){var a=this.doms;config={part:t},a.$user_result&&e(".guess-user-result").remove();var i=this.render.user_result(config);a.$user_result=e(i),e("body").append(a.$user_result),this.bindUserResultEvent(),a.$user_result.show()},showSetting:function(){var t=this.doms,a=this.vars,i=this;e(".guess-setting-have").length&&e(".guess-setting-have").remove(),e(".guess-setting-edit").length&&e(".guess-setting-edit").remove(),u.sendAjax({url:u.isAnchor()?"/member/quiz/get_quiz_list":"/member/quiz/user_get_quiz_list",type:"GET",data:u.isAnchor()?{t:(new Date).getTime()}:{room_id:a.roomId,t:(new Date).getTime()},success:function(a){if(0==a.data.length)p.init(),i.bindSettingNoneEvent();else{var s=i.render.setting_have(a.data);t.$setting_have=e(s),e("body").append(t.$setting_have),i.showHistory(),i.bindSettingHaveEvent(),t.$setting_have.show()}}})},Setting_add:function(){u.dys({key:"dys.room.guess-game.addTitle",is_anch:u.isAnchor()?1:0});var t=this.doms,a={num:this.vars.title_num,time_choose:this.vars.mainMsg.quiz_setting},i=this.render.setting_add(a);t.$settingAdd=e(i),e("body").append(t.$settingAdd),this.bindSettingAddEvent(),t.$settingAdd.show()},showNoPass:function(t){var a=this.doms;if(!e(".guess-noPass").length){var i={content:t},s=this.render.noPass(i);a.$noPass=e(s),e("body").append(a.$noPass),this.bindNoPassEvent(),a.$noPass.show()}},showPowerSet:function(){var t=this.doms,a=(this.vars,this);e(".guess-userPermissions").length||u.sendAjax({url:"/member/quiz/get_start_setting",type:"POST",data:{room_id:a.vars.roomId,cate2_id:$ROOM.cate_id},success:function(i){if(0==i.error){var s={pageIfShow:a.guessMainPanel.data.authorityData.show_fild,msg:i.data},n=a.render.userSet(s);t.$userSet=e(n),e("body").append(t.$userSet),a.bindUserSetEvent(),a.powerTimerEvent(),i.data.specific_permission?e(".guess-userPermissions-cover").hide():e(".guess-userPermissions-cover").show()}else e.dialog.tips_black(i.msg)}})},powerTimerEvent:function(){var t=this;t.clearTimer(),t.powerTimer=setInterval(function(){e(".guess-userPermissions-move").animate({top:"-26px"}),setTimeout(function(){e(".guess-userPermissions-move").css("top","0px");var t=e(e(".guess-userPermissions-move").children("div")[0]).text();e(e(".guess-userPermissions-move").children("div")[0]).remove(),e(".guess-userPermissions-move").append("<div>"+t+"</div>")},1e3)},4e3)},clearTimer:function(){var e=this;e.powerTimer&&clearInterval(e.powerTimer)},addUser:function(t){var a=(this.doms,this.render.userSetAdd(t));e(".guess-userPermissions-list").append(e(a))},renderMainMsg:function(e){var t=this;g.getActiveState().then(function(a){t.vars.mainMsg=a,e()})},bindTipEvent:function(){var t=this;e(".guess-user-reminding-close").on("click",function(){e(".guess-user-reminding").hide()}),e(".guess-user-reminding").on("click",function(a){a.stopPropagation(),u.dys({key:"dys.room.guess-game.fromtips"});var i=e(a.target);if(!i.hasClass("guess-user-reminding-close")&&d.check())t.guessMainPanel.initMainPanel(),e(".guess-user-reminding").hide();else if(!i.hasClass("guess-user-reminding-close")&&!d.check())return e(".guess-user-reminding").hide(),void d.show("login")}),e(".guess-user-reminding-close-special").on("click",function(){e(".guess-user-reminding-special").hide()}),e(".guess-user-reminding-special").on("click",function(a){a.stopPropagation(),u.dys({key:"dys.room.guess-game.fromtips"});var i=e(a.target);if(!i.hasClass("guess-user-reminding-close-special")&&d.check())t.guessMainPanel.initMainPanel(),e(".guess-user-reminding-special").hide();else if(!i.hasClass("guess-user-reminding-close-special")&&!d.check())return e(".guess-user-reminding-special").hide(),void d.show("login")}),e(".guess-ancher-reminding-close").on("click",function(){e(".guess-ancher-reminding").hide()}),e(".guess-ancher-reminding").on("click",function(a){var i=e(a.target);!i.hasClass("guess-ancher-reminding-close")&&d.check()&&(t.guessMainPanel.initMainPanel(),e(".guess-ancher-reminding").hide())})},bindDealerEvent:function(){var t=this;this.cacheDealerDoms();var a,i=t.doms,s=t.vars;t.flag;s.odds_now=null,s.DeJin_now=null;var n=e(".guess-tip-dealer");n.mousedown(function(t){var a=t||event,i=e(a.target);if(!i.hasClass("guess-tip-dealer-freedom_odds")&&!i.hasClass("guess-tip-dealer-freedom_DeJin")){var s=a.clientX-n.position().left,o=a.clientY-n.position().top;e(document).mousemove(function(t){var a=t.clientX,i=t.clientY,r=i-o,l=a-s,d=e(window).width(),c=e(window).height();0>r?r=0:r>c&&(r=c),0>l?l=0:l>d&&(l=d),n.css({top:r,left:l})})}}),e(document).mouseup(function(){e(this).unbind("mousemove")}),e(".guess-tip-dealer").on("mouseover",function(t){var a=e(t.target);a.hasClass("dealer_active")||(a.hasClass("guess-tip-dealer-choose_one")||a.hasClass("guess-tip-dealer-choose_two")||a.hasClass("guess-tip-dealer-odds_num")||a.hasClass("guess-tip-dealer-DeJin_num"))&&a.addClass("dealer_hover")}),e(".guess-tip-dealer").on("mouseout",function(t){var a=e(t.target);a.hasClass("dealer_active")||(a.hasClass("guess-tip-dealer-choose_one")||a.hasClass("guess-tip-dealer-choose_two")||a.hasClass("guess-tip-dealer-odds_num")||a.hasClass("guess-tip-dealer-DeJin_num"))&&a.removeClass("dealer_hover")}),e(".guess-tip-dealer").on("click",function(n){var o=e(n.target);if(o.hasClass("guess-tip-dealer-close2"))i.$dealer.hide(),t.clearScrollTimer();else if(o.hasClass("guess-tip-dealer-choose_one")){i.$chooseFalse.removeClass("dealer_active"),i.$chooseTrue.addClass("dealer_active"),i.$chooseTrue.removeClass("dealer_hover");var r=i.$chooseTrue.text();t.chooseNotice(r)}else if(o.hasClass("guess-tip-dealer-choose_two")){i.$chooseTrue.removeClass("dealer_active"),i.$chooseFalse.addClass("dealer_active"),i.$chooseFalse.removeClass("dealer_hover");var r=i.$chooseFalse.text();t.chooseNotice(r)}else if(o.hasClass("guess-tip-dealer-odds_num"))i.$odds_choose.removeClass("dealer_active"),o.addClass("dealer_active"),o.removeClass("dealer_hover"),s.odds_before=o,i.$odds_yours.val(""),t.calcSilver();else if(o.hasClass("guess-tip-dealer-DeJin_num"))i.$DeJin_choose.removeClass("dealer_active"),o.addClass("dealer_active"),o.removeClass("dealer_hover"),s.DeJin_before=o,"全部"==o.html()?i.$DeJin_yours.val(i.$Dealer_myFishBall.html()):i.$DeJin_yours.val(""),t.calcSilver();else if(o.hasClass("guess-tip-dealer-sureBtn")){if(!e(".guess-tip-dealer").find(".guess-tip-dealer-choose_out .dealer_active").length)return void e.dialog.tips_black("请选择你认为的胜方");var l,d,c=e(".guess-tip-dealer-DeJin_out .dealer_active").html(),g=e(".guess-tip-dealer-odds_out .dealer_active").html(),m=s.mainMsg.quiz_setting.min_base_gold,p=s.mainMsg.quiz_setting.max_base_gold;if(0==+i.$odds_yours.val()&&!e(".guess-tip-dealer-odds_out .dealer_active").length)return void e.dialog.tips_black("赔率不能为0");if(l=i.$odds_yours.val()>0?100*i.$odds_yours.val():100*g,i.$DeJin_yours.val()){if(+i.$DeJin_yours.val()<m)return void e.dialog.tips_black("底金最少为"+m);if(+i.$DeJin_yours.val()>p)return void e.dialog.tips_black("底金最多为"+p);d=1*i.$DeJin_yours.val()}else"string"==typeof c&&"全部"!=c?d=c:"全部"==c&&(d=i.$Dealer_myFishBall.html());a=e(".guess-tip-dealer").find(".guess-tip-dealer-choose_out .dealer_active").attr("data-chooseNum");var f={room_id:s.roomId,quiz_id:i.$dealer.attr("data-qid"),option:a,amount:d,loss_per_cent:1*l.toFixed(0)};u.sendAjax({url:"/member/quiz/become_banker",type:"POST",data:f,success:function(a){switch(a.error){case 0:0==a.data.ndsdprop?e.dialog.tips_black("开猜成功!"):e.dialog.tips_black("开猜成功!获得"+a.data.ndsdprop+"盛典星光"),i.$dealer.remove(),u.triggerSilverChange(a.data.balance),t.guessMainPanel.saveJoinToPool(f.quiz_id,f.option,!0),t.guessMainPanel.handleUserJoinPool(t.guessMainPanel.guessData.userJoinPool,!1);break;case-1:e.dialog.tips_black(a.msg);break;case 283:e.dialog.tips_black("鱼丸不足！"),u.triggerSilverChange(a.data.balance),e(".guess-tip-dealer-my_fishBall_num").html(a.data.balance);break;case 514006:e.dialog.tips_black("开猜失败，竞猜不存在！"),i.$dealer.remove();break;case 514007:e.dialog.tips_black("开猜失败，竞猜已封盘！"),i.$dealer.remove();break;case 514008:e.dialog.tips_black("开猜失败，竞猜已结束！"),i.$dealer.remove();break;case 514015:e.dialog.tips_black("正在开猜中，请勿重复操作")}0==a.error?u.dys({key:"dys.room.guess-game.suredealer",stat:1,odd:f.loss_per_cent,cost:f.amount}):u.dys({key:"dys.room.guess-game.suredealer",stat:2,odd:f.loss_per_cent,cost:f.amount})}})}}),i.$Dealer_helper.hover(function(){i.$Dealer_helper_content.show()},function(){i.$Dealer_helper_content.hide()}),i.$odds_yours.on("change keydown",function(e){function t(e){return e>=48&&57>=e?!0:e>=96&&105>=e?!0:8==e}var a=e.which||e.keyCode;return t(a)?void 0:!1}),i.$odds_yours.on("keyup",function(t){var a=t.which||t.keyCode,n=1*this.value,o=i.$odds_yours.val().length;1==o&&8!=a&&(n+=".",i.$odds_yours.val(n)),1==o&&8==a&&i.$odds_yours.val(""),o&&i.$odds_choose.removeClass("dealer_active"),n>=0&&10>n&&10*n%1==0?(i.$odds_choose.removeClass("dealer_active"),s.odds_now=n):o?i.$odds_yours.val(""):s.odds_now=n,""==this.value&&(s.odds_before?s.odds_before.addClass("dealer_active"):e(".guess-tip-dealer-odds_one").addClass("dealer_active"))}),i.$odds_yours.on("change keyup keypress",function(){t.calcSilver()}),i.$DeJin_yours.on("change keydown keyup keypress",function(){i.$DeJin_choose.removeClass("dealer_active");var t=1*this.value,a=i.$Dealer_myFishBall.html();i.$DeJin_yours.val().length;t>=0&&a>=t&&t%1==0?s.DeJin_now=t:t>a?i.$DeJin_yours.val(a):i.$DeJin_yours.val(s.DeJin_now),0==this.value&&(i.$DeJin_yours.val(""),s.DeJin_before?s.DeJin_before.addClass("dealer_active"):e(".guess-tip-dealer-DeJin_one").addClass("dealer_active"))}),i.$DeJin_yours.on("change keyup keypress",function(){t.calcSilver()})},bindBettingEvent:function(t){var a=this;this.cacheDealerDoms();var i=a.doms,s=a.vars;a.flag;s.Betting_now=null;var n=s.mainMsg.quiz_setting.divided_rate/100;a.guessMainPanel.guessData.guessList.length>0&&(n=(100-Number(a.guessMainPanel.guessData.guessList[0].aktp))/100),e(".guess-tip-betting").on("mouseover",function(t){var a=e(t.target);a.hasClass("betting_active")||a.hasClass("guess-tip-betting-num")&&a.addClass("betting_hover")}),e(".guess-tip-betting").on("mouseout",function(t){var a=e(t.target);a.hasClass("betting_active")||a.hasClass("guess-tip-betting-num")&&a.removeClass("betting_hover")}),e(".guess-tip-betting-input input").on("keydown",function(t){function a(e){return e>=48&&57>=e?!0:e>=96&&105>=e?!0:8==e}var i=t.which||t.keyCode;return e(".guess-tip-betting-error").html(""),a(i)?void 0:!1}),e(".guess-tip-betting").on("click",function(o){var r=e(o.target);if(r.hasClass("guess-tip-betting-close"))r.parents(".guess-tip-betting-total").remove();else if(r.hasClass("guess-tip-betting-num")){i.$Betting_choose.removeClass("betting_active"),r.addClass("betting_active"),e(".guess-tip-betting-error").html(""),r.removeClass("betting_hover");var l=1*r.parents(".guess-tip-betting").attr("data-balance"),d=r.html();"全部"==d?l<i.$Betting_fishBall.html()?i.$Betting_yours.val(l):i.$Betting_yours.val(i.$Betting_fishBall.html()):i.$Betting_yours.val(d),i.$Betting_yours.css("font-size","18px"),i.$Betting_yours.css("font-weight","bold");var c=1*i.$odds_value.html(),g=1*i.$Betting_yours.val(),m=parseInt(g*c*n);i.$win_value.html(m)}else if(r.hasClass("guess-tip-betting-doneBtn")){var p=s.mainMsg.quiz_setting.min_bet_gold,l=r.parents(".guess-tip-betting").attr("data-balance"),f=1*r.parents(".guess-tip-betting").find("input").val();if(!f)return e(".guess-tip-betting-error").html("请输入投注数量"),void a.inputAnimate();if(p>f)return e(".guess-tip-betting-error").html("最少投注"+p+"鱼丸"),void a.inputAnimate();if(f>l)return e(".guess-tip-betting-error").html("最多投注"+l+"鱼丸"),void a.inputAnimate();var h={room_id:s.roomId,quiz_id:r.parents(".guess-tip-betting").attr("data-qid"),banker_id:r.parents(".guess-tip-betting").attr("data-bankerid"),bet_amount:f},v=r.parents(".guess-tip-betting").data("option");u.sendAjax({url:"/member/quiz/user_bet",type:"POST",data:h,success:function(i){switch(i.error){case 0:0!=i.data.ndsdprop&&e.dialog.tips_black("下注成功!获得"+i.data.ndsdprop+"盛典星光"),e(".guess-tip-betting-total").remove(),t(h.bet_amount),u.triggerSilverChange(i.data.balance),a.guessMainPanel.saveJoinToPool(h.quiz_id,v,!0),a.guessMainPanel.handleUserJoinPool(a.guessMainPanel.guessData.userJoinPool,!1);break;case-1:e.dialog.tips_black(i.msg);break;case 283:e(".guess-tip-betting-error").html("鱼丸不足！"),u.triggerSilverChange(i.data.balance),e(".guess-tip-betting-input input").focus();break;case 514006:e.dialog.tips_black("投注失败，竞猜不存在！"),e(".guess-tip-betting-total").remove();break;case 514007:e.dialog.tips_black("投注失败，竞猜已封盘！"),e(".guess-tip-betting-total").remove();break;case 514008:e.dialog.tips_black("投注失败，竞猜已结束！"),e(".guess-tip-betting-total").remove();break;case 514009:e.dialog.tips_black("投注失败，开猜不存在！"),e(".guess-tip-betting-total").remove();break;case 514010:if(e(".guess-tip-betting-error").html("投注失败，资金池不足！"),i.data.banker_id>0){var s=(i.data.loss_per_cent/100).toFixed(1);e(".guess-tip-betting-input input").attr("placeholder","输入"+p+"~"+i.data.max_count),e(".guess-tip-betting").attr("data-balance",i.data.max_count),e(".guess-tip-betting").attr("data-bankerid",i.data.banker_id),e(".guess-tip-betting-msgOdds span").html(s),a.inputAnimate()}else e(".guess-tip-betting-total").remove(),e.dialog.tips_black("投注失败！资金池已买完，等待开猜")}0==i.error?u.dys({key:"dys.room.guess-game.surebetting",stat:1,num:h.bet_amount}):u.dys({key:"dys.room.guess-game.surebetting",stat:2,num:h.bet_amount})}})}}),i.$Betting_yours.on("change keydown keyup keypress",function(){i.$Betting_choose.removeClass("betting_active");var t=1*i.$odds_value.html(),a=1*this.value,o=1*i.$Betting_fishBall.html(),r=1*e(".guess-tip-betting").attr("data-balance"),l=r>o?o:r;i.$Betting_yours.val().length;a>0&&a%1==0&&l>=a?(s.Betting_now=a,i.$Betting_yours.css("font-size","18px"),i.$Betting_yours.css("font-weight","bold")):a>l?(i.$Betting_yours.val(l),a=l):0==a?(e(this).val(""),i.$Betting_yours.css("font-size","14px"),i.$Betting_yours.css("font-weight","")):(i.$Betting_yours.val(s.Betting_now),a=s.Betting_now);var d=parseInt(a*t*n);i.$win_value.html(d)})},bindAncher_resultEvent:function(){var t=this;this.cacheDealerDoms();var a=t.doms,i=t.vars;t.flag;e(".ancher-result").on("click",function(s){var n=e(s.target);if(n.hasClass("ancher-result-close3")||n.hasClass("ancher-knowBtn-false"))a.$ancher_result.hide();else if(n.hasClass("ancher-result_answer"))n.parent().children(".ancher-result_answer").removeClass("ancher-result_answer_active"),n.addClass("ancher-result_answer_active"),e(".ancher-result_answer_active").length==e(".ancher-result_one").length&&e(".ancher-knowBtn-true").addClass("ancher-knowBtn-true-ready");else if(n.hasClass("ancher-knowBtn-true")){if(!n.hasClass("ancher-knowBtn-true-ready"))return;u.dys({key:"dys.room.guess-game.resultEndSubmit",is_anch:u.isAnchor()?1:0});var o=u.isAnchor()?{quize_data:t.submitResult()}:{room_id:i.roomId,quize_data:t.submitResult()},r={part:t.submitResultSure()},l=t.render.anchor_resultSure(r);e.dy_dialog(l,{className:"shark-ui-confirm guessResult-sure",mask:!0,zIndex:502,title:"请再次确认竞猜结果！",buttons:[{content:"返回",callback:function(){this.hide()}},{content:"提交",callback:function(){var a=this;u.sendAjax({url:u.isAnchor()?"/member/quiz/finish_quiz":"/member/quiz/user_finish_quiz",type:"POST",data:o,success:function(i){a.hide(),0==i.error?(u.dys({key:"dys.room.guess-game.resultEnd",is_anch:u.isAnchor()?1:0}),e.dialog.tips_black(i.msg),e(".ancher-result").remove()):-1==i.error?(e(".ancher-result").remove(),e.dialog.tips_black(i.msg)):-2==i.error&&(e(".ancher-result").remove(),t.showNoPass(i.msg))}})}}]})}}),a.$Ancher_result_helper.on("mouseover",function(t){e(t.target).parent().children(".ancher-result-help-tip_out").show()}),a.$Ancher_result_helper.on("mouseout",function(t){e(t.target).parent().children(".ancher-result-help-tip_out").hide()})},bindSettingNoneEvent:function(){var t=this;e(".guess-setting-none").on("click",function(a){var i=e(a.target);i.hasClass("guess-setting-none-close")?e(".guess-setting-none").remove():i.hasClass("none-add_title")&&(e(".guess-setting-none").remove(),t.Setting_add())})},bindSettingHaveEvent:function(){var t=this;this.cacheDealerDoms();var a=(t.doms,t.vars);a.title_num=e(".guess-setting_one-sureYes").length,e(".guess-setting-have-ask-num").text(this.vars.title_num),0!=a.title_num&&e(".guess-setting-have-knowBtn").addClass("guess-setting-have-knowBtn-true"),e(".guess-setting-have-main").mCustomScrollbar(),e(".guess-setting-have").on("click",function(i){var s=e(i.target);if(s.hasClass("guess-setting-have-close"))e(".guess-setting-have").remove();else if(s.hasClass("have-add_title")){if(10==e(".guess-setting_one").length)return void e.dialog.tips_black("最多添加10个主题~");a.titleHistory=t.collectId(),e(".guess-setting-have").hide(),t.Setting_add()}else if(s.hasClass("guess-setting_one-change")){var n=s.parents(".guess-setting_one").attr("data-titleId"),o=s.parents(".guess-setting_one").find(".guess-setting_one-title").text(),r=s.parents(".guess-setting_one").find(".guess-setting_one-chooseOne").text(),l=s.parents(".guess-setting_one").find(".guess-setting_one-chooseTwo").text(),d=s.parents(".guess-setting_one").attr("data-limit-time");a.titleHistory=t.collectId(),e(".guess-setting-have").hide(),t.Setting_add(),e(".guess-setting-edit").attr("data-titleId",n),e(".guess-setting-edit-editTitle").val(o),e(".guess-setting-edit-chooseOne").val(r),e(".guess-setting-edit-chooseTwo").val(l),e(".guess-setting-edit-timeOne").each(function(t,a){e(a).removeClass("guess-setting-edit-timeActive"),e(a).attr("data-limit-time")==d&&e(a).addClass("guess-setting-edit-timeActive")}),0==e(".guess-setting-edit-timeActive").length&&e(e(".guess-setting-edit-timeOne")[0]).addClass("guess-setting-edit-timeActive")}else if(s.hasClass("guess-setting_one-close"))u.sendAjax({url:u.isAnchor()?"/member/quiz/del_quiz":"/member/quiz/user_del_quiz",type:"POST",data:u.isAnchor()?{quize_id:s.parents(".guess-setting_one").attr("data-titleId")}:{room_id:a.roomId,quize_id:s.parents(".guess-setting_one").attr("data-titleId")},success:function(i){if(0==i.error){var n=s.parents(".guess-setting_one").find(".guess-setting_one-sureYes").length;a.title_num=a.title_num-n,e(".guess-setting-have-ask-num").html(a.title_num),s.parents(".guess-setting_one").remove(),e(".guess-setting_one").length||(e(".guess-setting-have").remove(),t.showSetting())}else e.dialog.tips_black(i.msg)}});else if(s.hasClass("guess-setting-have-knowBtn")){if(!s.hasClass("guess-setting-have-knowBtn-true"))return void e.dialog.tips_black("请勾选竞猜主题");var c=t.collectId();u.sendAjax({url:u.isAnchor()?"/member/quiz/start_quiz_v2":"/member/quiz/user_start_quiz",type:"POST",data:u.isAnchor()?{quize_ids:c}:{room_id:a.roomId,quize_ids:c},success:function(i){0==i.error?(u.dys({key:"dys.room.guess-game.suresetting",is_anch:u.isAnchor()?1:0,stat:1,num:c.length}),e.dialog.tips_black(i.msg),e(".guess-setting-have").remove(),a.titleHistory=c):-1==i.error?(u.dys({key:"dys.room.guess-game.suresetting",is_anch:u.isAnchor()?1:0,stat:2,num:c.length}),e.dialog.tips_black(i.msg),"number"==typeof i.data.index&&e(".guess-setting_one-sureYes").each(function(t,s){t==i.data.index&&(e(s).removeClass("guess-setting_one-sureYes"),e(s).removeClass("guess-setting_one-sure"),e(s).addClass("guess-setting_one-false"),e(s).parents(".guess-setting_one").append(e('<span class="guess-setting_one-error">'+i.msg+"</span>")),a.title_num--,e(".guess-setting-have-ask-num").html(a.title_num),0==a.title_num&&e(".guess-setting-have-knowBtn").removeClass("guess-setting-have-knowBtn-true"))})):-2==i.error&&(u.dys({key:"dys.room.guess-game.suresetting",is_anch:u.isAnchor()?1:0,stat:2,num:c.length}),e(".guess-setting-have").remove(),t.showNoPass(i.msg))}})}}),e(".guess-setting_one").on("click",function(t){var i=e(t.target);if(!i.hasClass("guess-setting_one-close")&&!i.hasClass("guess-setting_one-change")&&1!=e(this).find(".guess-setting_one-false").length)if(e(this).find(".guess-setting_one-sureYes").length)e(this).find(".guess-setting_one-sure").removeClass("guess-setting_one-sureYes"),a.title_num--,0==a.title_num&&e(".guess-setting-have-knowBtn").removeClass("guess-setting-have-knowBtn-true"),e(".guess-setting-have-ask-num").html(a.title_num);else{if(3==a.title_num)return void e.dialog.tips_black("最多只能同时发布3个主题哦~");0==a.title_num&&e(".guess-setting-have-knowBtn").addClass("guess-setting-have-knowBtn-true"),e(this).find(".guess-setting_one-sure").addClass("guess-setting_one-sureYes"),a.title_num++,e(".guess-setting-have-ask-num").html(a.title_num)}}),e(".guess-setting_one").hover(function(){e(this).find(".guess-setting_one-close").show()},function(){e(this).find(".guess-setting_one-close").hide()})},bindSettingAddEvent:function(){var t=this;this.cacheDealerDoms();var a=(t.doms,t.vars);e(".guess-setting-edit-editTitle").on("change keydown keyup keypress",function(){""!=e(this).val()&&(e(this).removeClass("guess-setting-edit-error"),t.clearError())}),e(".guess-setting-edit-chooseOne").on("change keydown keyup keypress",function(){if("选项不能相同"==e(".guess-setting-edit-rule").html()){if(e(".guess-setting-edit-chooseOne").val()==e(".guess-setting-edit-chooseTwo").val())return;
e(this).removeClass("guess-setting-edit-error"),e(".guess-setting-edit-chooseTwo").removeClass("guess-setting-edit-error")}else{if(""==e(this).val())return;e(this).removeClass("guess-setting-edit-error")}t.clearError()}),e(".guess-setting-edit-chooseTwo").on("change keydown keyup keypress",function(){if("选项不能相同"==e(".guess-setting-edit-rule").html()){if(e(".guess-setting-edit-chooseOne").val()==e(".guess-setting-edit-chooseTwo").val())return;e(this).removeClass("guess-setting-edit-error"),e(".guess-setting-edit-chooseOne").removeClass("guess-setting-edit-error")}else{if(""==e(this).val())return;e(this).removeClass("guess-setting-edit-error")}t.clearError()}),e(".guess-setting-edit-timeOne").on("mouseover",function(t){var a=e(t.target);a.hasClass("guess-setting-edit-timeActive")||a.addClass("guess-setting-edit-timeHover")}),e(".guess-setting-edit-timeOne").on("mouseout",function(t){var a=e(t.target);a.hasClass("guess-setting-edit-timeActive")||a.removeClass("guess-setting-edit-timeHover")}),e(".guess-setting-edit").on("click",function(i){var s=e(i.target);if(s.hasClass("guess-setting-edit-close"))e(".guess-setting-edit").remove();else if(s.hasClass("guess-setting-edit-back"))e(".guess-setting-edit").remove(),e(".guess-setting-have").show();else if(s.hasClass("guess-setting-edit-timeOne"))e(".guess-setting-edit-timeOne").removeClass("guess-setting-edit-timeActive"),e(".guess-setting-edit-timeOne").removeClass("guess-setting-edit-timeHover"),s.addClass("guess-setting-edit-timeActive");else if(s.hasClass("guess-setting-edit-knowBtn")){var n=t.checkIfAdd(),o=e(".guess-setting-edit").attr("data-titleId");if(!n)return;if(o){var r={quize_id:o,quize_theme:n.quize_theme,first_option_name:n.first_option_name,second_option_name:n.second_option_name,stop_timestamp:n.stop_timestamp},l={room_id:a.roomId,quize_id:o,quize_theme:n.quize_theme,first_option_name:n.first_option_name,second_option_name:n.second_option_name,stop_timestamp:n.stop_timestamp};u.sendAjax({url:u.isAnchor()?"/member/quiz/edit_quiz":"/member/quiz/user_edit_quiz",type:"POST",data:u.isAnchor()?r:l,success:function(a){if(0==a.error)u.dys({key:"dys.room.guess-game.addSure",is_anch:u.isAnchor()?1:0}),e.dialog.tips_black("已提交审核，请等待1-2分钟~"),e(".guess-setting-edit").remove(),t.showSetting();else if(e(".guess-setting-edit-rule").html(a.msg),a.data.key)switch(a.data.key){case"quize_theme":e(".guess-setting-edit-editTitle").addClass("guess-setting-edit-error");break;case"first_option_name":e(".guess-setting-edit-chooseOne").addClass("guess-setting-edit-error");break;case"second_option_name":e(".guess-setting-edit-chooseTwo").addClass("guess-setting-edit-error")}}})}else u.sendAjax({url:u.isAnchor()?"/member/quiz/add_quiz":"/member/quiz/user_add_quiz",type:"POST",data:u.isAnchor()?n:{room_id:a.roomId,quize_theme:n.quize_theme,first_option_name:n.first_option_name,second_option_name:n.second_option_name,stop_timestamp:n.stop_timestamp},success:function(a){if(0==a.error)u.dys({key:"dys.room.guess-game.addSure",is_anch:u.isAnchor()?1:0}),e.dialog.tips_black("已提交审核，请等待1-2分钟~"),e(".guess-setting-edit").remove(),t.showSetting();else if(e(".guess-setting-edit-rule").html(a.msg),a.data.key)switch(a.data.key){case"quize_theme":e(".guess-setting-edit-editTitle").addClass("guess-setting-edit-error");break;case"first_option_name":e(".guess-setting-edit-chooseOne").addClass("guess-setting-edit-error");break;case"second_option_name":e(".guess-setting-edit-chooseTwo").addClass("guess-setting-edit-error")}}})}})},bindUserSetEvent:function(){var t=this,a=(t.doms,t.vars);a.user_num=e(".guess-userPermissions-userOne").length,e(".guess-userPermissions-tip").hover(function(){e(".guess-userPermissions-instructions").show()},function(){e(".guess-userPermissions-instructions").hide()}),e(".guess-userPermissions-instructions").hover(function(){e(".guess-userPermissions-instructions").show()},function(){e(".guess-userPermissions-instructions").hide()}),e(".guess-userPermissions").on("click",function(i){var s=e(i.target);if(s.hasClass("guess-userPermissions-close"))e(".guess-userPermissions").remove(),t.clearTimer();else if(s.hasClass("guess-userPermissions-adminIf")&&!s.hasClass("guess-userPermissions-adminIfSure"))s.addClass("guess-userPermissions-adminIfSure");else if(s.hasClass("guess-userPermissions-adminIf")&&s.hasClass("guess-userPermissions-adminIfSure"))s.removeClass("guess-userPermissions-adminIfSure");else if(s.hasClass("guess-userPermissions-userIf")&&!s.hasClass("guess-userPermissions-userIfSure"))s.addClass("guess-userPermissions-userIfSure"),e(".guess-userPermissions-input").addClass("guess-userPermissions-inputYes"),e(".guess-userPermissions-input").removeAttr("disabled"),e(".guess-userPermissions-search").addClass("guess-userPermissions-searchYes"),e(".guess-userPermissions-cover").hide();else if(s.hasClass("guess-userPermissions-userIf")&&s.hasClass("guess-userPermissions-userIfSure"))s.removeClass("guess-userPermissions-userIfSure"),e(".guess-userPermissions-input").removeClass("guess-userPermissions-inputYes"),e(".guess-userPermissions-input").attr("disabled","disabled"),e(".guess-userPermissions-search").removeClass("guess-userPermissions-searchYes"),e(".guess-userPermissions-cover").show();else if(s.hasClass("guess-userPermissions-searchYes"))if(a.user_num<8){if("最多指定8个用户哦"==e(".guess-userPermissions-list").text()&&e(".guess-userPermissions-list").text(""),t.userNoRepeat())return;var n=e(".guess-userPermissions-inputYes").val();u.sendAjax({url:"/member/quiz/add_start_user",type:"POST",data:{specific_user:n},success:function(i){0==i.error?(t.addUser(i),a.user_num++):e.dialog.tips_black(i.msg),e(".guess-userPermissions-inputYes").focus(),e(".guess-userPermissions-inputYes").val("")}})}else e.dialog.tips_black("最多添加8个用户哦~");else if(s.hasClass("guess-userPermissions-userOne-close"))s.parents(".guess-userPermissions-userOne").remove(),a.user_num--,0==a.user_num&&e(".guess-userPermissions-list").text("最多指定8个用户哦");else if(s.hasClass("guess-userPermissions-knowBtn")){var o=t.powerMsg();u.sendAjax({url:"/member/quiz/edit_start_setting",type:"POST",data:o,success:function(a){if(0==a.error){var i=t.powerPointMsg();u.dys({key:"dys.room.guess-game.powerSure",is_admin:i.admin,num:i.user}),e.dialog.tips_black("权限设置成功"),t.clearTimer(),e(".guess-userPermissions").remove()}else e.dialog.tips_black(a.msg)}})}})},bindUserResultEvent:function(){e(".guess-user-result").on("click",function(t){var a=e(t.target);(a.hasClass("guess-user-knowBtn")||a.hasClass("guess-user-close3"))&&e(".guess-user-result").hide()})},bindNoPassEvent:function(){e(".guess-noPass").on("click",function(t){var a=e(t.target);(a.hasClass("guess-noPass-knowBtn")||a.hasClass("guess-noPass-close"))&&e(".guess-noPass").remove()})},checkIfAdd:function(){var t=null,a=e(".guess-setting-edit-editTitle").val(),i=e(".guess-setting-edit-chooseOne").val(),s=e(".guess-setting-edit-chooseTwo").val(),n=e(".guess-setting-edit-timeActive").attr("data-limit-time");if(""==a&&(e(".guess-setting-edit-editTitle").addClass("guess-setting-edit-error"),t=0),""==i&&(e(".guess-setting-edit-chooseOne").addClass("guess-setting-edit-error"),t=0),""==s&&(e(".guess-setting-edit-chooseTwo").addClass("guess-setting-edit-error"),t=0),0==t)return e(".guess-setting-edit-rule").html("竞猜主题未填写完整"),!1;if(i==s)return e(".guess-setting-edit-chooseOne").addClass("guess-setting-edit-error"),e(".guess-setting-edit-chooseTwo").addClass("guess-setting-edit-error"),e(".guess-setting-edit-rule").html("选项不能相同"),!1;var o={quize_theme:a,first_option_name:i,second_option_name:s,stop_timestamp:n};return o},submitResult:function(){var t,a,i,s,n,o,r=e(".ancher-result_one").length,l=[];return e(".ancher-result_one").each(function(r,l){0==r?(t=e(l).attr("data-qid"),s=e(l).find(".ancher-result_answer_active").attr("data-chooseId")):1==r?(a=e(l).attr("data-qid"),n=e(l).find(".ancher-result_answer_active").attr("data-chooseId")):2==r&&(i=e(l).attr("data-qid"),o=e(l).find(".ancher-result_answer_active").attr("data-chooseId"))}),1==r?l=[{quize_id:t,option_type:s}]:2==r?l=[{quize_id:t,option_type:s},{quize_id:a,option_type:n}]:3==r&&(l=[{quize_id:t,option_type:s},{quize_id:a,option_type:n},{quize_id:i,option_type:o}]),l},submitResultSure:function(){var t,a,i,s,n,o,r=e(".ancher-result_one").length,l=[];return e(".ancher-result_one").each(function(r,l){0==r?(t=e(l).find(".ancher-result_title").html(),s=e(l).find(".ancher-result_answer_active").html()):1==r?(a=e(l).find(".ancher-result_title").html(),n=e(l).find(".ancher-result_answer_active").html()):2==r&&(i=e(l).find(".ancher-result_title").html(),o=e(l).find(".ancher-result_answer_active").html())}),1==r?l=[{title:t,choose:s}]:2==r?l=[{title:t,choose:s},{title:a,choose:n}]:3==r&&(l=[{title:t,choose:s},{title:a,choose:n},{title:i,choose:o}]),l},submitResultNum:function(){var t=e("#guess-main-panel").find(".guess-game-box"),a=[];return t.each(function(t,i){var s=e(i).find(".guess-game-box-theme").attr("data-qs");1!=+s&&2!=+s||a.push({title:e(i).attr("data-qt"),chooseOne:e(i).attr("data-fon"),chooseTwo:e(i).attr("data-son"),endTime:e(i).find(".et").text(),qid:e(i).attr("data-qid")})}),a},removeSome:function(){e(".guess-tip-dealer").length&&e(".guess-tip-dealer").remove(),e(".guess-tip-betting-total").length&&e(".guess-tip-betting-total").remove()},clearError:function(){0==e(".guess-setting-edit-error").length&&e(".guess-setting-edit-rule").html("")},collectId:function(){var t=[];return e(".guess-setting_one-sureYes").each(function(a,i){var s=e(i).parents(".guess-setting_one").attr("data-titleId");t.push(s)}),t},inputAnimate:function(){e(".guess-tip-betting-num").removeClass("betting_active");var t=e(".guess-tip-betting-input input");t.stop(!0),t.val(""),t.css("font-size","14px"),t.css("font-weight",""),t.focus(),t.animate({marginLeft:-20},100,"easeOutBounce"),t.animate({marginLeft:20},100,"swing"),t.animate({marginLeft:-8},100,"easeOutBounce"),t.animate({marginLeft:8},100,"swing"),t.animate({marginLeft:0},100,"swing")},showHistory:function(){var t=this.vars.titleHistory;e(".guess-setting_one").each(function(a,i){for(var s=0;s<t.length;s++)t[s]==e(i).attr("data-titleId")&&e(i).find(".guess-setting_one-sure").addClass("guess-setting_one-sureYes")})},powerMsg:function(){var t=null,a=null,i=[];t=e(".guess-userPermissions-adminIfSure").length?1:0,a=e(".guess-userPermissions-userIfSure").length?1:0,e(".guess-userPermissions-username").each(function(t,a){i.push(e(a).text())});var s={management:t,specific_permission:a,specific_users:i};return s},userNoRepeat:function(){var t=e(".guess-userPermissions-inputYes").val(),a=!1;return e(".guess-userPermissions-username").each(function(i,s){e(s).text().toUpperCase()==t.toUpperCase()&&(e.dialog.tips_black("用户已被添加在列表中"),a=!0)}),a},powerPointMsg:function(){var t=null,a=null;return t=e(".guess-userPermissions-adminIfSure").length?1:0,a=e(".guess-userPermissions-userIfSure").length?e(".guess-userPermissions-userOne").length:0,config={admin:t,user:a}},init:function(e){var t=this;t.guessMainPanel=e,$ROOM.room_id&&$ROOM.cate_id&&u.sendAjax({url:"/lapi/interact/quiz/openStatus",type:"GET",data:{room_id:$ROOM.room_id,cate2_id:$ROOM.cate_id},success:function(e){if(0==e.error){if(1==e.data.is_open)t.renderMainMsg(function(){t.showEnter()});else if(0==e.data.is_open)return}else-1==e.error}},!0)}},p={init:function(){this.hasTipsReady()?e(".flexslider").show():this.render()},hasTipsReady:function(){return e(".flexslider").length>0},render:function(){var t=o.get("sys.web_url"),a=u.isAnchor()?'<div class="flexslider guess-setting-none"><ul class="slides"><li><img src="'+t+'app/douyu/res/page/room-normal/guess-game/anchor1.png" /></li><li><img src="'+t+'app/douyu/res/page/room-normal/guess-game/anchor2.png" /></li><li><img src="'+t+'app/douyu/res/page/room-normal/guess-game/anchor3.png" /></li></ul><div class="guess-setting-none-close"></div><div class="guess-setting-none-title">竞猜主题设置</div><div class="guess-setting-none-retitle"><a href="https://www.douyu.com/cms/gong/201712/25/6965.shtml" target="_blank" class="guess-setting-none-rule">玩法介绍</a></div><div class="none-add_title">+添加主题</div></div>':'<div class="flexslider guess-setting-none"><ul class="slides"><li><img src="'+t+'app/douyu/res/page/room-normal/guess-game/user1.png" /></li><li><img src="'+t+'app/douyu/res/page/room-normal/guess-game/user2.png" /></li><li><img src="'+t+'app/douyu/res/page/room-normal/guess-game/user3.png" /></li></ul><div class="guess-setting-none-close"></div><div class="guess-setting-none-title">竞猜主题设置</div><div class="guess-setting-none-retitle"><a href="https://www.douyu.com/cms/gong/201712/25/6965.shtml" target="_blank" class="guess-setting-none-rule">玩法介绍</a></div><div class="none-add_title">+添加主题</div></div>';e("body").append(a),e(".flexslider").flexslider({animation:"slide",animationLoop:!0,prevText:"",nextText:"",keyboard:!1})}},f={flag:{api:!1,dom:!1},tryShow:function(e){var t=this;if("api"===e){if(t.flag.api=!0,g.getActiveShowStatus())return;t.flag.dom&&m.popTips()}else if("dom"===e){if(t.flag.dom=!0,g.getActiveShowStatus())return;t.flag.api&&m.popTips()}}};return r.reg("room_data_handler",function(t){var a=i.decode(t).too();switch(a.type){case"quiz_audit":e(".guess-setting_one").each(function(t,i){e(i).attr("data-titleid")==a.qid&&(1==a.is_pass?(e(i).removeClass("guess-setting_oneStop"),e(i).find(".guess-setting_one-false").addClass("guess-setting_one-sure"),e(i).find(".guess-setting_one-false").removeClass("guess-setting_one-false"),e(i).find(".guess-setting_one-changeNo").addClass("guess-setting_one-change"),e(i).find(".guess-setting_one-audit").removeClass("guess-setting_one-auditYes")):(e(i).find(".guess-setting_one-changeNo").addClass("guess-setting_one-change"),e(i).find(".guess-setting_one-audit").removeClass("guess-setting_one-auditYes"),e(i).find(".guess-setting_one-audit").addClass("guess-setting_one-auditNo"),e(i).find(".guess-setting_one-error").text(a.remark)))})}}),{msgCenter:f,guessActive:g,guessPopup:m}}),define("douyu/page/room/normal/mod/guess-game/guess-game",["jquery","shark/observer","shark/util/cookie/1.0","shark/util/flash/data/1.0","shark/util/template/2.0","shark/util/storage/1.0","douyu/context","douyu/page/room/base/api","shark/util/lang/1.0","douyu/com/user","douyu/com/exjsonp","douyu/page/room/normal/mod/guess-game/guess-game-popup","douyu/page/room/normal/mod/guess-game/guess-game-common"],function(e,t,a,i,s,n,o,r,l,d,c,u,g){var m={doms:{},url:{recommendList:"/member/quiz/get_recommend_quiz_list",authority:"/lapi/interact/quiz/quizStartAuthority",guessRecordByLua:"/lapi/interact/quiz/myPlayInfo",myJoinStatus:"/lapi/interact/quiz/myJoinStatus",closeQuiz:"/member/quiz/close_quiz"},data:{},sliderData:{maxRight:0,currentRight:0,step:300},guessData:{guessList:[],guessStatusPool:[],guessEndPool:[],guessSingleEndPool:[],restartPool:[],userJoinPool:[],timer:{}},defaultObj:{fbid:"0",fbmc:"0",fbuid:"0",fobc:"0",folpc:"0",sbid:"0",sbmc:"0",sbuid:"0",sobc:"0",solpc:"0",scs:"0",wo:"0",fjoin:!1,sjoin:!1},clickStatus:{},cache:{},cornerTimer:{},render:{mainPanel:function(t){var a=l.string.join("{{ if (isAnchor && smallScreen) }}",'<div class="guess-main-panel anchor smallScreen" id="guess-main-panel">',"{{ else if (isAnchor)}}",'<div class="guess-main-panel anchor" id="guess-main-panel">',"{{ else }}",'<div class="guess-main-panel" id="guess-main-panel">',"{{ /if }}",'<div class="guess-main-panel-header clearfix">','<div class="panel-right">',"{{ if (isAnchor) }}",'<a class="myGuess" href="/member/quiz/history" target="_blank">我的竞猜</a>',"{{ else }}",'<a class="myGuess" href="/member/quiz/history?action=answer" target="_blank">我的竞猜</a>',"{{ /if }}",'<span class="division"></span>',"{{ if (isAnchor && isShowAuthoritySet) }}",'<a href="javascript:void(0);" class="setAuthority J-setAuthority">发起权限',"{{ if (!setUserAuthority) }}",'<div class="tipsTextBox">','<div class="tipsText">让水友为您发竞猜！专心直播涨热度</div>','<div class="tipsArrow"></div>',"</div>","{{ /if }}","</a>",'<span class="division"></span>',"{{ /if }}",'<a href="https://kefu.douyu.com/" target="_blank">在线客服</a>','<span class="division"></span>',"{{ if (isAnchor) }}",'<a class="helpBtn" href="//www.douyu.com/cms/gong/201712/25/6965.shtml" target="_blank">玩法</a>',"{{ else }}",'<a class="helpBtn" href="//www.douyu.com/cms/gong/201712/05/6829.shtml" target="_blank">玩法介绍</a>',"{{ /if }}",'<i class="guess-main-panel-close"></i>',"</div>",'<div class="panel-left">',"{{ if (!isAnchor) }}",'<span>鱼丸 : </span><em class="fishBall_NUM" data-login-user="silver"></em>',"{{ if (silverQaData && isArray(silverQaData) && silverQaData.length > 0) }}",'<i class="silverQa">?','<div class="tipsTextBox" style="top:{{ silverQaTop }};">','<div class="tipsText">获得更多鱼丸，竞猜嗨翻天：</div>',"{{ each silverQaData }}",'<div class="tipsText"><i class="icon-circle"></i>{{$value}}</div>',"{{ /each }}",'<div class="tipsArrow"></div>',"</div>","</i>","{{ /if }}","{{ /if }}",'<div class="fishball-mall hide"></div>',"{{ if (identy > 1) }}","{{ if (isAnchor && guessList.length > 0 && guessList[0].suid != uid) }}",'<span class="batch J-headerNotice"><span class="guessUserName" title="{{ guessList[0].sname }}">{{ guessList[0].sname }}</span>发起的{{ guessList.length }}个竞猜进行中：</span><a class="batch-submission batchSubmit clickBtn1" href="javascript:void(0);">批量结束</a>',"{{ else }}",'<span class="batch J-headerNotice">{{ guessList.length }}个竞猜进行中：</span><a class="batch-submission batchSubmit clickBtn1" href="javascript:void(0);">批量结束</a>',"{{ /if }}","{{ /if }}",'<a href="javascript:void(0);" class="guessFestival"></a>',"</div>","{{ if (isAnchor) }}",'<a class="resetGuessGame clickBtn" href="javascript:void(0);" id="resetGuessGame">重新发起竞猜</a>',"{{ else }}",'<a class="resetGuessGame clickBtn" href="javascript:void(0);" id="resetGuessGame">发起竞猜</a>',"{{ /if }}","</div>",'<div class="guess-game-box-body">',"</div>",'<div class="slide-bar right-bar"></div>','<div class="slide-bar left-bar"></div>',"{{ if (isAnchor && !isNotFirstTime) }}",'<div class="mask">','<div class="guidePic"></div>',"</div>","{{ /if }}","</div>"),i=e.extend({},t,{isAnchor:g.isAnchor(),identy:m.getIdenty(),isShowAuthoritySet:m.getAuthoritySet(),isNotFirstTime:g.getGuessGameGuide(),uid:o.get("sys.uid"),setUserAuthority:g.getSetUserAuthority(),smallScreen:m.isSmallScreen(),silverQaData:u.guessPopup.vars.mainMsg.quiz_setting.silver_source,silverQaTop:m.silverQaTop(),isArray:function(t){return e.isArray(t)}}),n=s.compile(a);return n(i)},guessGameBox:function(t,a){var i;switch(t.guessList.length){case 1:i="one-box";break;case 2:i="two-box";break;case 3:i="three-box";break;default:i=""}var n=e.extend({},t,{boxBodyClass:i,animateClass:a?"hasAnimate":"",isAnchorClass:g.isAnchor()?"isAnchor":"",isAnchor:g.isAnchor(),identy:m.getIdenty(),per:function(e,t,a){return g.per(e,t,a)},numToFix:function(e){return g.numToFix(e)},mathAbs:function(e){return g.mathAbs(e)},formatTotalBidNum:function(e){return g.formatTotalBidNum(e)},formatEt:function(e){return g.formatEt(e)},uid:+o.get("sys.uid")}),r=l.string.join('<div class="hasGuessBox {{boxBodyClass}} {{animateClass}} {{isAnchorClass}}">',"{{ each guessList }}",'<div class="guess-game-box guess-game-box{{$index}}',"{{ if ($index != 0) }}"," gap","{{ /if }}",'" data-qid="{{$value.qid}}" data-qt="{{$value.qt}}" data-fon="{{$value.fon}}" data-son="{{$value.son}}" data-index="{{$index}}">','<div class="guess-game-update-box">','<div class="guess-game-box-theme',"{{ if (+$value.qs >= 3) }}"," guessEnd","{{ /if }}",'" data-qs="{{$value.qs}}" data-suid="{{$value.suid}}" data-sname="{{$value.sname}}">','<div class="guess-game-box-main">','<div class="guess-game-box-header clearfix">','<div class="box-left"><i class="iconNum">{{$index+1}}</i>{{$value.qt}}</div>',"{{ if (isAnchor) }}",'<div class="box-right noEndBtn">',"{{ if (+$value.qs === 1) }}","{{ if (+$value.et > 0) }}",'<span class="et" data-et="{{$value.et}}">{{formatEt($value.et)}}</span>',"{{ /if }}","{{ else if (+$value.qs === 2) }}",'<span class="rightBar seal">已封盘</span>',"{{ /if }}","</div>","{{ else }}",'<div class="box-right noEndBtn">',"{{ if (+$value.qs === 1) }}","{{ if (+$value.et > 0) }}",'<span class="et" data-et="{{$value.et}}">{{formatEt($value.et)}}</span>',"{{ /if }}",'<a class="rightBar beginGuess" href="javascript:void(0);">','<div class="tipsTextBox">','<div class="tipsText">开猜有机会赢得更多鱼丸哦</div>','<div class="tipsArrow"></div>',"</div>","</a>",'{{ else if (+$value.qs === 2 && $value.scs === "0") }}','<span class="rightBar seal">已封盘</span>','{{ else if (+$value.qs === 2 && $value.scs === "1") }}','<span class="rightBar seal noGap">主播意外下播封盘','<div class="sealTips">?','<div class="tipsTextBox">','<div class="tipsText">超过5分钟后未开播判为流局，</br>将返还您投注鱼丸</div>','<div class="tipsArrow"></div>',"</div>","</div>","</span>","{{ else if (+$value.qs === 3) }}","{{ if ($value.ec && +$value.ec >= 0) }}",'<span class="rightBar seal noGap">赢{{ mathAbs(+$value.ec) }}鱼丸</span>',"{{ else if ($value.ec && +$value.ec < 0) }}",'<span class="rightBar seal noGap">输{{ mathAbs(+$value.ec) }}鱼丸</span>',"{{ /if }}","{{ else if (+$value.qs === 4) }}","{{ if ($value.ec && +$value.ec === 0) }}",'<span class="rightBar seal noGap">返还参与鱼丸</span>',"{{ /if }}","{{ /if }}","</div>","{{ /if }}","</div>",'<div class="guess-game-box-container">','<a class="item item-left',"{{ if (+$value.wo === 1) }}"," win","{{ else if (+$value.qs === 2) }}"," plug","{{ else if ((+$value.folpc === 0 || !$value.folpc || +$value.fbmc ===0 || !$value.fbmc) && +$value.qs === 1 ) }}"," waitGuess","{{ /if }}",'" data-loss="{{numToFix($value.folpc/100)}}" data-bankerId="{{$value.fbid}}" data-balance="{{$value.fbmc}}">','<div class="item-price">',"{{ if (+$value.qs === 3 && +$value.wo === 1) }}","胜利","{{else if (+$value.qs === 3 && +$value.wo === 2) }}","失败","{{else if (+$value.qs === 4) }}","流局","{{else if (($value.folpc && +$value.folpc > 0) && +$value.fbmc > 0 && +$value.qs <= 2) }}","赔率{{numToFix($value.folpc/100)}}","{{ else}}",'<div class="waitGuessText">',"<p>等待</p>","<p>开猜</p>","</div>","{{ /if }}",'<div class="arrow"></div>',"</div>",'<div class="item-guess-content">','<div class="progress" style="width:{{per(+$value.fobc, +$value.sobc, true)}};"></div>',"<span>{{$value.fon}}</span>","</div>","{{ if (!isAnchor && $value.fjoin) }}",'<i class="icon-hasBid" data-option="1"></i>',"{{ /if }}","</a>",'<div class="item-middle">VS</div>','<a class="item item-right',"{{ if (+$value.wo === 2) }}"," win","{{ else if (+$value.qs === 2) }}"," plug","{{ else if ((+$value.solpc === 0 || !$value.solpc || +$value.sbmc ===0 || !$value.sbmc) && +$value.qs === 1 ) }}"," waitGuess","{{ /if }}",'" data-loss="{{numToFix($value.solpc/100)}}" data-bankerId="{{$value.sbid}}" data-balance="{{$value.sbmc}}">','<div class="item-price">',"{{ if (+$value.qs === 3 && +$value.wo === 2) }}","胜利","{{else if (+$value.qs === 3 && +$value.wo === 1) }}","失败","{{else if (+$value.qs === 4) }}","流局","{{else if (($value.solpc && +$value.solpc > 0) && +$value.sbmc > 0 && +$value.qs <= 2) }}","赔率{{numToFix($value.solpc/100)}}","{{ else}}",'<div class="waitGuessText">',"<p>等待</p>","<p>开猜</p>","</div>","{{ /if }}",'<div class="arrow"></div>',"</div>",'<div class="item-guess-content">','<div class="progress" style="width:{{per(+$value.fobc, +$value.sobc, false)}};"></div>',"<span>{{$value.son}}</span>","</div>","{{ if (!isAnchor && $value.sjoin) }}",'<i class="icon-hasBid" data-option="2"></i>',"{{ /if }}","</a>","</div>",'<div class="guess-game-box-footer clearfix">','<div class="fr footer-right">投注总额: <span class="bidNum" data-bidNum="{{ $value.sobc ? $value.sobc : 0 }}">{{ formatTotalBidNum($value.sobc) }}</span></div>','<div class="fl footer-left">投注总额: <span class="bidNum" data-bidNum="{{ $value.fobc ? $value.fobc : 0 }}">{{ formatTotalBidNum($value.fobc) }}</span></div>',"</div>","</div>","{{ if (isAnchor || (identy === 2 && uid == $value.suid)) }}",'<div class="guess-game-box-footer-plus">','<div class="division"></div>',"{{ if (+$value.qs === 1) }}",'<div class="foot-button foot-button-left stopBidBtn">封&nbsp;&nbsp;&nbsp;&nbsp;盘</div>',"{{ else }}",'<div class="foot-button foot-button-left stopBidBtn disable">已封盘</div>',"{{ /if }}","{{ if (+$value.qs === 1 || +$value.qs === 2) }}",'<div class="foot-button foot-button-right endBtn">结&nbsp;&nbsp;&nbsp;&nbsp;束</div>',"{{ else }}",'<div class="foot-button foot-button-right endBtn disable">已结束</div>',"{{ /if }}","</div>","{{ /if }}","</div>","</div>","</div>","{{ /each }}","</div>"),d=s.compile(r);return d(n)},reRenderTheme:function(t,a){var i=l.string.join('<div class="guess-game-box-theme',"{{ if (+qs >= 3) }}"," guessEnd","{{ /if }}",'" data-qs="{{qs}}" data-suid="{{suid}}" data-sname="{{sname}}">','<div class="guess-game-box-main">','<div class="guess-game-box-header clearfix">','<div class="box-left"><i class="iconNum">{{index+1}}</i>{{qt}}</div>',"{{ if (isAnchor) }}",'<div class="box-right noEndBtn">',"{{ if (+qs === 1) }}","{{ if (+et > 0) }}",'<span class="et" data-et="{{et}}">{{formatEt(et)}}</span>',"{{ /if }}","{{ else if (+qs === 2) }}",'<span class="rightBar seal">已封盘</span>',"{{ /if }}","</div>","{{ else }}",'<div class="box-right noEndBtn">',"{{ if (+qs === 1) }}","{{ if (+et > 0 ) }}",'<span class="et" data-et="{{et}}">{{formatEt(et)}}</span>',"{{ /if }}",'<a class="rightBar beginGuess" href="javascript:void(0);">','<div class="tipsTextBox">','<div class="tipsText">开猜有机会赢得更多鱼丸哦</div>','<div class="tipsArrow"></div>',"</div>","</a>",'{{ else if (+qs === 2 && scs === "0") }}','<span class="rightBar seal">已封盘</span>','{{ else if (+qs === 2 && scs === "1") }}','<span class="rightBar seal noGap">主播意外下播封盘','<div class="sealTips">?','<div class="tipsTextBox">','<div class="tipsText">超过5分钟后未开播判为流局，</br>将返还您投注鱼丸</div>','<div class="tipsArrow"></div>',"</div>","</div>","</span>","{{ else if (+qs === 3) }}","{{ if (ec && +ec >= 0) }}",'<span class="rightBar seal noGap">赢{{ mathAbs(+ec) }}鱼丸</span>',"{{ else if (ec && +ec < 0) }}",'<span class="rightBar seal noGap">输{{ mathAbs(+ec) }}鱼丸</span>',"{{ /if }}","{{ else if (+qs === 4) }}","{{ if (ec && +ec === 0) }}",'<span class="rightBar seal noGap">返还参与鱼丸</span>',"{{ /if }}","{{ /if }}","</div>","{{ /if }}","</div>",'<div class="guess-game-box-container">','<a class="item item-left',"{{ if (+wo === 1) }}"," win","{{ else if (+qs === 2) }}"," plug","{{ else if ((+folpc === 0 || !folpc || +fbmc ===0 || !fbmc) && +qs === 1 ) }}"," waitGuess","{{ /if }}",'" data-loss="{{numToFix(folpc/100)}}" data-bankerId="{{fbid}}" data-balance="{{fbmc}}">','<div class="item-price">',"{{ if (+qs === 3 && +wo === 1) }}","胜利","{{else if (+qs === 3 && +wo === 2) }}","失败","{{else if (+qs === 4) }}","流局","{{else if ((folpc && +folpc > 0) && +fbmc > 0 && +qs <= 2) }}","赔率{{numToFix(folpc/100)}}","{{ else}}",'<div class="waitGuessText">',"<p>等待</p>","<p>开猜</p>","</div>","{{ /if }}",'<div class="arrow"></div>',"</div>",'<div class="item-guess-content">','<div class="progress" style="width:{{per(+fobc, +sobc, true)}};"></div>',"<span>{{fon}}</span>","</div>","{{ if (!isAnchor && fjoin) }}",'<i class="icon-hasBid" data-option="1"></i>',"{{ /if }}","</a>",'<div class="item-middle">VS</div>','<a class="item item-right',"{{ if (+wo === 2) }}"," win","{{ else if (+qs === 2) }}"," plug","{{ else if ((+solpc === 0 || !solpc || +sbmc ===0 || !sbmc) && +qs === 1 ) }}"," waitGuess","{{ /if }}",'" data-loss="{{numToFix(solpc/100)}}" data-bankerId="{{sbid}}" data-balance="{{sbmc}}">','<div class="item-price">',"{{ if (+qs === 3 && +wo === 2) }}","胜利","{{else if (+qs === 3 && +wo === 1) }}","失败","{{else if (+qs === 4) }}","流局","{{else if ((solpc && +solpc > 0) && +sbmc > 0 && +qs <= 2) }}","赔率{{numToFix(solpc/100)}}","{{ else}}",'<div class="waitGuessText">',"<p>等待</p>","<p>开猜</p>","</div>","{{ /if }}",'<div class="arrow"></div>',"</div>",'<div class="item-guess-content">','<div class="progress" style="width:{{per(+fobc, +sobc, false)}};"></div>',"<span>{{son}}</span>","</div>","{{ if (!isAnchor && sjoin) }}",'<i class="icon-hasBid" data-option="2"></i>',"{{ /if }}","</a>","</div>",'<div class="guess-game-box-footer clearfix">','<div class="fr footer-right">投注总额: <span class="bidNum" data-bidNum="{{ sobc ? sobc : 0 }}">{{ formatTotalBidNum(sobc) }}</span></div>','<div class="fl footer-left">投注总额: <span class="bidNum" data-bidNum="{{ fobc ? fobc : 0 }}">{{ formatTotalBidNum(fobc) }}</span></div>',"</div>","</div>","{{ if (isAnchor || (identy === 2 && uid == suid)) }}",'<div class="guess-game-box-footer-plus">','<div class="division"></div>',"{{ if (+qs === 1) }}",'<div class="foot-button foot-button-left stopBidBtn">封&nbsp;&nbsp;&nbsp;&nbsp;盘</div>',"{{ else }}",'<div class="foot-button foot-button-left stopBidBtn disable">已封盘</div>',"{{ /if }}","{{ if (+qs === 1 || +qs === 2) }}",'<div class="foot-button foot-button-right endBtn">结&nbsp;&nbsp;&nbsp;&nbsp;束</div>',"{{ else }}",'<div class="foot-button foot-button-right endBtn disable">已结束</div>',"{{ /if }}","</div>","{{ /if }}","</div>"),n=e.extend({},t,{index:a,isAnchor:g.isAnchor(),identy:m.getIdenty(),per:function(e,t,a){return g.per(e,t,a)},numToFix:function(e){return g.numToFix(e)},formatTotalBidNum:function(e){return g.formatTotalBidNum(e)},mathAbs:function(e){return g.mathAbs(e)},formatEt:function(e){return g.formatEt(e)},uid:o.get("sys.uid")}),r=s.compile(i);return r(n)},anchorNoSetGuessGame:function(t){var a=l.string.join("{{ if (list.length > 0) }}","{{ if (identy === 2) }}",'<div class="noGuessBox userStart">',"{{ if (isLiving) }}",'<div class="guessGameStartBtn clickBtn">发起竞猜','<div class="tipsTextBox">','<div class="tipsText">竞猜内容由你定,猜你想猜的</div>','<div class="tipsArrow"></div>',"</div>","</div>","{{ /if }}",'<div class="secondSmallTitle">主播还未发起竞猜，您可发起竞猜或看看下面正在进行的竞猜~</div>',"{{ else }}",'<div class="noGuessBox">','<div class="noGuessTitle">当前主播还未发起竞猜~</div>','<div class="secondTitle">看看下面正在进行的竞猜吧</div>',"{{ /if }}",'<div class="guessGuideList">','<div class="guessGuideListBox {{listSize}}">',"{{ each list }}",'<a href="/{{ $value.room_id }}" target="_blank" data-rid="{{ $value.room_id }}" class="guessGuideBox',"{{ if ($index != 0) }}"," gap1","{{ /if }}",'">',"{{ if $value.avatar }}",'<div class="imageBox"><img src="{{ $value.avatar }}"/></div>',"{{ else }}",'<div class="imageBox"><img src="{{ defaultAvatar }}"/></div>',"{{ /if }}",'<div class="recommendBox">','<h2 title="{{ $value.user_nickname }}">{{ $value.user_nickname }}</h2>','<p class="firstMsg">{{ numFormat($value.player_count) }}人正在竞猜</p>',"<p>{{ $value.room_tag_name }}</p>","</div>","</a>","{{ /each }}","</div>",'<a class="moreGuess gap1" href="/directory/all#quiz_rooms" target="_blank">','<i class="moreBtn"></i>','<div class="moreText">更多竞猜</div>',"</a>","</div>","</div>","{{ else }}","{{ if (identy === 2) }}",'<div class="noGuessBox userStartNoList">','<div class="noGuessTitle">当前主播还未发起竞猜~</div>',"{{ if (isLiving) }}",'<div class="secondTitle">竞猜内容由你定，猜你想猜的</div>','<div class="guessGameStartBtn clickBtn">发起竞猜</div>',"{{ /if }}","</div>","{{ else }}",'<div class="noGuessBox">','<div class="noGuessTitle mt">当前主播还未发起竞猜~</div>',"</div>","{{ /if }}","{{ /if }}"),i=s.compile(a),n=o.get("sys.web_url")+"/app/douyu/res/com/defaultAvatar.png?20171210",r=e.extend({},t,{isAnchor:g.isAnchor(),identy:m.getIdenty(),isLiving:g.isLiving(),defaultAvatar:n,listSize:g.suitVideoChange(),numFormat:function(e){return g.formatTotalBidNum(e)}});return i(r)},selfNoSetGuessGame:function(){var e=l.string.join('<div class="noGuessBox anchorSelf">','<div class="noGuessTitle">当前没有发起竞猜~</div>','<div class="secondTitle">您可以发起竞猜，带给水友更多欢乐！</div>','<div class="guessGameStartBtn">发起竞猜</div>',"</div>"),t=s.compile(e);return t()},bidAnimation:function(e,t){var a=l.string.join('<div class="bid {{side}}">+{{number}}<i class="iconPop"></i></div>'),i=s.compile(a);return i({number:e,side:t})},recommendLoading:function(){var e=l.string.join('<div class="loadingBox">','<div class="recommendLoading"></div>',"<div>正在加载中...</div>","</div>"),t=s.compile(e);return t()},hotTip:function(e){var t=l.string.join('<div class="hotTip">{{hotText}}</div>'),a=s.compile(t);
return a({hotText:e})},waitGuessBanner:function(){var e=l.string.join('<div class="waitGuessBanner">','<i class="icon-i"></i>当前无人开猜, 开猜也可赢鱼丸哦~ ','<span class="beginGuess">开猜</span>',"</div>"),t=s.compile(e);return t()},stopBidTip:function(e){var t=l.string.join('<div class="stopBidTip">{{ tipMsg }}</div>'),a=s.compile(t);return a({tipMsg:e})},guessRecordLoading:function(){var e=l.string.join('<div class="guessRecordLoading"></div>'),t=s.compile(e);return t()},guessRecordBox:function(e){var t=l.string.join("{{ if (option == 2) }}",'<div class="guessRecordBox option2" data-option="{{option}}">',"{{ else }}",'<div class="guessRecordBox" data-option="{{option}}">',"{{ /if }}",'<div class="arrowBox"><div class="boxArrow"></div></div>',"</div>"),a=s.compile(t);return a({option:e.quiz_option})},guessRecord:function(e,t){var a=l.string.join('<div class="guessRecord" data-time="{{time}}">','<div class="guessRecordContent">',"{{ if (listData.bet_list.length > 0) }}",'<table class="HeaderBag">','<thead><tr><th class="firstRow">投注数</th><th class="secondRow">赔率</th><th class="thirdRow">赢则得</th></tr></thead>',"</table>","<table>","<tbody>","{{ each listData.bet_list }}",'<tr><td class="firstRow">{{formatTotalBidNum($value.amount)}}</td><td class="secondRow">{{numToFix($value.loss_per_cent/100)}}</td><td class="thirdRow income">{{$value.income}}</td></tr>',"{{ /each }}","</tbody>","</table>","{{ /if }}","{{ if (listData.banker_list.length > 0) }}",'<table class="HeaderBag">','<thead><tr><th class="firstRow">开猜底金</th><th class="secondRow">赔率</th><th class="thirdRow">已被购买</th></tr></thead>',"</table>","<table>","<tbody>","{{ each listData.banker_list }}",'<tr><td class="firstRow">{{formatTotalBidNum($value.amount)}}</td><td class="secondRow">{{numToFix($value.loss_per_cent/100)}}</td><td class="income thirdRow">{{$value.used}}</td></tr>',"{{ /each }}","</tbody>","</table>","{{ /if }}","</div>","</div>"),i=s.compile(a);return i({listData:e,formatTotalBidNum:function(e){return g.formatTotalBidNum(e)},time:t,numToFix:function(e){return g.numToFix(e)}})},ensureStopBid:function(e){var t=l.string.join('<div class="ensureOutBox">','<div class="ensureBox">','<div class="content clearfix">','<div class="icon-cube"></div>','<div class="row1">确定要封盘吗？</div>','<div class="row2">封盘后观众无法投注和开猜</div>',"</div>","<div>",'<div class="ensureBoxBtn comfirmStopBid" data-qid="{{ qid }}">确&nbsp;&nbsp;定</div>','<div class="ensureBoxBtn cancelStopBid" data-qid="{{ qid }}">取&nbsp;&nbsp;消</div>',"</div>",'<div class="tipsArrow"></div>',"</div>",'<div class="themeMask"></div>',"</div>"),a=s.compile(t);return a({qid:e.qid})}},bidAnimation:function(t,a){var i=this,s=i.render.bidAnimation(a.num,a.side),n=e(s),o=t.find(".item-"+a.side),r="left"===a.side?"right":"left",l=t.find(".item-"+r);t.append(n),n.animate({top:27},{duration:1e3,easing:"easeOutCirc",complete:function(){n.fadeOut("slow",function(){n.remove()})}});var d=o.parents(".guess-game-box"),c=d.find(".footer-"+a.side).find(".bidNum"),u=+c.attr("data-bidNum"),m=u+a.num;c.text(g.formatTotalBidNum(m)),c.attr("data-bidNum",m);var p=d.find(".footer-"+r).find(".bidNum").attr("data-bidNum"),f=i.getPercent(m,p,1),h=i.getPercent(m,p,0);o.find(".progress").css({width:f}),l.find(".progress").css({width:h})},ifShowSliderBar:function(){var t=this,a=t.doms,i=e("#js-room-video").width(),s=e("#guess-main-panel").find(".hasGuessBox");if(s.length){var n=s.width();if(n>i){var o=n-i;t.sliderData.maxRight==t.sliderData.currentRight&&0!=t.sliderData.currentRight&&o<t.sliderData.maxRight&&(t.sliderData.currentRight=o,a.$guessBoxBody.css({right:t.sliderData.currentRight})),t.sliderData.maxRight=o,e("#guess-main-panel").attr("data-slidecanshow","yes")}else t.sliderData.currentRight=0,t.sliderData.maxRight=0,e("#guess-main-panel").attr("data-slidecanshow","no"),a.$guessBoxBody.css({right:0})}},guessIsEnd:function(){var t=this,a=(t.doms,!0),i=0,s=!1,n="",r=+o.get("sys.uid");return e.each(t.guessData.guessList,function(e,t){var o=+t.qs;3>o&&(a=!1,i++);var l=+t.suid;n=t.sname,s=r!==l}),{isEndFlag:a,guessingNum:i,isOrtherStartGuess:s,sname:n}},changeHeader:function(){var e=this,t=e.doms,a=m.getIdenty();if(a>1){var i=t.$manPanel.find(".J-headerNotice"),s=t.$manPanel.find(".batch"),n=t.$manPanel.find(".batchSubmit"),o=t.$manPanel.find(".resetGuessGame"),r=e.guessIsEnd(),l=!1;r.isEndFlag?(s.hide(),n.removeClass("show"),o.show()):(3===a&&r.isOrtherStartGuess?i.html('<span class="guessUserName" title="'+r.sname+'">'+r.sname+"</span>发起的"+r.guessingNum+"个竞猜进行中："):3===a?i.html(r.guessingNum+"个竞猜进行中："):2!==a||r.isOrtherStartGuess?(l=!0,s.hide(),n.removeClass("show"),o.hide()):i.html(r.guessingNum+"个竞猜进行中："),l||(s.show(),n.addClass("show"),o.hide()))}},mainPanelToBegin:function(){var t=this,a=t.doms;if(a.$manPanel){var i=t.render.guessGameBox(t.guessData,!0);a.$hasGuessBox=e(i),a.$guessBoxBody.html(a.$hasGuessBox),t.changeHeader(),t.ifShowSliderBar(),t.countDownLoop(),setTimeout(function(){a.$hasGuessBox.removeClass("hasAnimate")},20)}},guessBeginToEnd:function(){var t=this;t.doms;e(".guess-game-box").addClass("guessEnd")},guessMainPanelShowAnimation:function(e){var t=this,a=t.doms,i=setTimeout(function(){a.$manPanel.addClass("show"),e&&e(),clearTimeout(i)},10)},handleUserJoinPool:function(t,a){var i=this,s=i.doms,n=i.guessData.guessList,o=n.length;if(o>0){for(var r=0,l=t.length;l>r;r++)for(var d=t[r],c=0;o>c;c++){var u=n[c];if(u.qid===d.qid&&i.hasDiffProperty(d,u)&&(e.extend(u,d),!a&&s.$manPanel)){var g=s.$manPanel.find('.guess-game-box[data-qid="'+u.qid+'"]');g.length>0&&i.updateTheme(u,c,g.find(".guess-game-update-box"))}}t.length=0}},handleSingleEndPool:function(t,a){var i=this,s=i.doms,n=+o.get("sys.uid"),r=i.guessData.guessList,l=r.length;if(l>0){for(var d=0,c=t.length;c>d;d++)for(var u=t[d],g=0;l>g;g++){var m=r[g];if(m.qid===u.qid&&(e.extend(m,{ec:u.ec}),!a&&s.$manPanel)){var p=s.$manPanel.find('.guess-game-box[data-qid="'+m.qid+'"]');if(p.length>0){i.updateTheme(m,g,p.find(".guess-game-update-box"));var f=i.getIdenty();+m.aktp>0&&(1===f||2===f&&n!=m.suid)&&0!==+m.ec&&i.addHot(p,"已为主播增加热度值")}}}t.length=0}},handleStatusPool:function(){for(var t=this,a=t.doms,i=+o.get("sys.uid"),s=!1,n=!1,r=!1,l=t.guessData.guessList,d=t.guessData.guessStatusPool,c=0,u=d.length;u>c;c++)for(var g=d[c],p=0,f=l.length;f>p;p++){var h=l[p];if(h.qid===g.qid)if(t.hasDiffProperty(g,h)){if(+g.qs!==+h.qs&&(s=!0,2===+h.qs&&1===+g.qs&&(n=!0,t.guessData.restartPool.push({qid:g.qid})),3===+g.qs&&(r=!0)),e.extend(h,g),t.isPanelShow()){var v=a.$manPanel.find('.guess-game-box[data-qid="'+h.qid+'"]');if(v.length>0){t.updateTheme(h,p,v.find(".guess-game-update-box"));var b=t.getIdenty();if(r&&+h.aktp>0&&(3===b||2===b&&i==h.suid)&&(+h.fobc>0||+h.sobc>0)){var y=3===b?"已为您增加热度值":"已为主播增加热度值";t.addHot(v,y)}}}}else e.extend(h,g)}if(s){var k=t.guessIsEnd();k.isEndFlag&&(t.data.activityStatus="end",m.data.hasGetEndData?(delete m.data.hasGetEndData,m.data.hasGetEndData={}):m.data.hasGetEndData={})}if(t.isPanelShow()&&s)var w=setTimeout(function(){t.changeHeader(),n&&t.restartCountDown(t.guessData.restartPool),clearTimeout(w)},50)},hasDiffProperty:function(t,a){var i=!1;return e.each(t,function(e,t){return t!==a[e]&&"et"!=e?(i=!0,!1):void 0}),i},updateTheme:function(e,t,a){var i=this,s=i.doms;if(s.$manPanel){var n=i.render.reRenderTheme(e,t);a.html(n)}},updateFishBall:function(){var t=this,a=t.doms,i=e("#js-stats-and-actions"),s=i.find('[data-login-user="silver"]').text();a.$manPanel.find('[data-login-user="silver"]').text(s)},isPanelShow:function(){var e=this,t=e.doms;return t.$manPanel&&t.$manPanel.hasClass("show")},countDown:function(t){var a=this,i=a.doms,s=a.guessData.timer;s[t]||(s[t]=setInterval(function(){if(!i.$manPanel)return clearInterval(s[t]),void delete s[t];var n=i.$manPanel.find('[data-qid="'+t+'"]').find(".et");if(!a.isPanelShow()||0===n.length)return clearInterval(s[t]),void delete s[t];if(second=n.attr("data-et"),second-=1,second<0)return clearInterval(s[t]),void delete s[t];n.attr("data-et",second);var o=parseInt(second/60);10>o&&(o="0"+o);var r=parseInt(second%60);10>r&&(r="0"+r);var l=o+":"+r+"后封盘";n.text(l);var d=e(".ancher-result").find('[data-qid="'+t+'"]');d&&d.length>0&&d.find(".ancher-result_min").text(l)},1e3))},countDownLoop:function(){var t=this,a=t.doms,i=a.$manPanel.find(".et");0!==i.length&&i.each(function(a,i){var s=parseInt(e(this).attr("data-et")),n=+e(this).parents(".guess-game-box").attr("data-qid");s>0&&t.countDown(n)})},restartCountDown:function(t){var a=this;t.length>0&&(e.each(t,function(e,t){a.countDown(t.qid)}),t.length=0)},getPercent:function(e,t,a){var i=parseInt(e),s=parseInt(t),n=i+s;if(0==n)return"0%";var o=a?i:s,r=Math.floor(o/n*100);return r+"%"},guessGuideClose:function(){var e=this,t=e.doms,a=g.isAnchor(),i=g.getGuessGameGuide();if(a&&!i){n.set("guessGameGuideShowFlag",!0);var s=setTimeout(function(){var a=t.$manPanel.find(".mask");e.isPanelShow()&&a.length>0&&t.$manPanel.find(".mask").remove(),clearTimeout(s)},1e4)}},addLoading:function(){var e=this,t=e.doms,a=e.render.recommendLoading();t.$guessBoxBody.append(a)},removeLoading:function(){var e=this,t=e.doms,a=t.$manPanel.find(".loadingBox");a.length>0&&a.remove()},clearSliderData:function(){var e=this;e.sliderData.currentRight=0,e.sliderData.maxRight=0},isSmallScreen:function(){var t=e("#js-room-video").width();return 684>t},screenAdaption:function(){var e=this,t=e.doms;e.isSmallScreen()?g.isAnchor()&&e.isPanelShow()&&!t.$manPanel.hasClass("smallScreen")&&t.$manPanel.addClass("smallScreen"):g.isAnchor()&&e.isPanelShow()&&t.$manPanel.hasClass("smallScreen")&&t.$manPanel.removeClass("smallScreen")},anchorRecommendAdaption:function(){var e=this,t=e.doms;if(e.isPanelShow()&&t.$manPanel.find(".guessGuideList").length>0){var a=g.suitVideoChange();t.$manPanel.find(".guessGuideListBox").removeClass("big4").removeClass("big3").removeClass("small3"),t.$manPanel.find(".guessGuideListBox").addClass(a)}},addHot:function(t,a){var i=this,s=t.find(".hotTip");if(s&&0===s.length){var n=i.render.hotTip(a),o=e(n);t.append(o),o.fadeIn(1e3);var r=setTimeout(function(){o.fadeOut(1e3),clearTimeout(r)},5e3)}},stopBidTip:function(t,a){var i=this,s=t.find(".stopBidTip");if(s&&0===s.length){var n=i.render.stopBidTip(a),o=e(n);t.append(o),o.fadeIn(100);var r=setTimeout(function(){o.fadeOut(),clearTimeout(r)},2e3)}},silverQaTop:function(){var t,a=u.guessPopup.vars.mainMsg.quiz_setting.silver_source;return t=a&&e.isArray(a)&&a.length?-(17*(a.length+1)+16+22):0,t+"px"},getAuthority:function(){var a=this,i=e.Deferred();if(a.clickStatus.authorityIsSending)return i.reject(),i.promise();if(a.data.authorityData)return i.resolve(a.data.authorityData),i.promise();var s=t.fire("mod.center.userrole.get");return s&&e.isArray(s)?(a.clickStatus.authorityIsSending=!0,e.ajax({url:a.url.authority,type:"GET",data:{room_id:o.get("room.room_id"),cate2_id:o.get("room.cate_id"),uid:o.get("sys.uid"),is_anchor:g.isAnchor()?1:0,is_manager:s.isRoomAdmin()?1:0,t:(new Date).getTime()},dataType:"JSON",success:function(e){a.clickStatus.authorityIsSending=!1,0==e.error?(a.data.authorityData=e.data,i.resolve(e.data)):i.resolve()},error:function(e){a.clickStatus.authorityIsSending=!1,i.resolve()}})):i.resolve(),i.promise()},getIdenty:function(){var e,t=this,a=+o.get("sys.uid"),i=+o.get("room.owner_uid");return e=a===i?3:t.data.authorityData&&1===t.data.authorityData.can_start_quiz?2:1},getAuthoritySet:function(){var e,t=this;return e=!(!t.data.authorityData||1!==t.data.authorityData.change_start)},addGuessRecordLoading:function(t){var a=this,i=a.render.guessRecordLoading(),s=e(i);t.append(s)},removeRecordLoading:function(e){e.find(".guessRecordLoading").length>0&&e.find(".guessRecordLoading").remove()},showHasBidList:function(t,a,i){var s=this,n=(s.doms,t.find('.guessRecordBox[data-option="'+a.quiz_option+'"]'));n.length>0&&n.remove();var o=t.find(".guessRecordBox");o.hide();var r=s.render.guessRecordBox({quiz_option:a.quiz_option}),l=e(r);t.append(l),s.addGuessRecordLoading(l),g.sendAjax({url:s.url.guessRecordByLua,type:"GET",data:a,success:function(t){if(s.removeRecordLoading(l),0===t.error){var n=(new Date).getTime(),o=a.quiz_id+"-"+a.quiz_option,r=t.data.banker_list.length+t.data.bet_list.length;if(r>0){i&&(s.data.hasGetEndData[o]=t.data);var d=s.render.guessRecord(t.data,n),c=e(d);l.append(c),c.find(".guessRecordContent").mCustomScrollbar(),c.fadeIn(300)}}},error:function(){s.removeRecordLoading(l)}},!0)},saveJoinToPool:function(e,t,a){var i,s=this;i=1===+t?{qid:e,fjoin:a}:{qid:e,sjoin:a},s.guessData.userJoinPool.push(i)},initUserCornerByLua:function(){var t=this;if(t.guessData.guessList.length>0&&!t.data.hasGetCorner){if(t.clickStatus.myJoinStatusSending)return;t.clickStatus.myJoinStatusSending=!0;var a=[];e.each(t.guessData.guessList,function(e,t){a.push(+t.qid)});var i={room_id:+o.get("room.room_id"),user_id:+o.get("sys.uid"),quiz_list:a.join(","),t:(new Date).getTime()};e.ajax({url:t.url.myJoinStatus,type:"GET",data:i,dataType:"JSON",success:function(a){t.clickStatus.myJoinStatusSending=!1,0===a.error&&e.isPlainObject(a.data)&&(t.data.hasGetCorner=!0,e.each(a.data.join_list,function(e,a){t.saveJoinToPool(a.qid,a.opt,!0)}),t.handleUserJoinPool(t.guessData.userJoinPool,!1))},error:function(e){t.clickStatus.myJoinStatusSending=!1}})}},waitGuessAnimation:function(t){var a=this;if(!(t.find(".waitGuessBanner").length>0)){var i=a.render.waitGuessBanner(),s=e(i);t.append(s),s.fadeIn();var n=setTimeout(function(){s.fadeOut(300,function(){s.remove()}),clearTimeout(n)},3500)}},removeAllWaitguess:function(){var e=this,t=e.doms;t.$manPanel.find(".waitGuessBanner").remove()},removeAllStopBid:function(){var e=this,t=e.doms;t.$manPanel.find(".ensureOutBox").remove()},delayShowCorner:function(e,t){var a=this;a.cornerTimer[e]=setTimeout(function(){t()},200)},clearCornerTimer:function(e){var t=this,a=t.cornerTimer;clearTimeout(a[e]),delete a[e]},closeMainPanel:function(){var e=this,t=e.doms;t.$manPanel.removeClass("show");var a=setTimeout(function(){t.$manPanel.remove(),t.$manPanel=void 0,clearTimeout(a)},350)},getAnchorRecommend:function(t){var a=this,i=a.doms;i.$guessBoxBody.find(".hasGuessBox").length>0||(a.addLoading(),g.sendAjax({url:a.url.recommendList,type:"GET",data:{t:(new Date).getTime()},success:function(i){a.removeLoading();var s=i.data;0===i.error&&e.isArray(s)?t&&t({list:s}):e.dialog.tips_black(i.msg)},error:function(){a.removeLoading()}}))},initMainPanel:function(){var t=this,a=t.doms;a.container=e("#js-room-video"),t.isPanelShow()||(t.getAuthority().then(function(i){var s=t.render.mainPanel(t.guessData);if(a.$manPanel=e(s),a.container.append(a.$manPanel),a.$guessBoxHeader=e(".guess-main-panel-header"),a.$guessBoxBody=e(".guess-game-box-body"),a.$activeEnter=a.$manPanel.find(".guessFestival"),t.guessData.guessList.length>0){var n=t.render.guessGameBox(t.guessData);a.$hasGuessBox=e(n),a.$guessBoxBody.html(a.$hasGuessBox),t.changeHeader(),t.countDownLoop()}else if(g.isAnchor()){var o=t.render.selfNoSetGuessGame();a.$noGuessBox=e(o),a.$guessBoxBody.html(a.$noGuessBox)}else t.getAnchorRecommend(function(i){if(!(a.$guessBoxBody.find(".hasGuessBox").length>0)){var s=t.render.anchorNoSetGuessGame(i);a.$noGuessBox=e(s),a.$guessBoxBody.html(a.$noGuessBox);var n=setTimeout(function(){a.$noGuessBox.addClass("show"),clearTimeout(n)},10)}});t.guessGuideClose(),t.updateFishBall(),u.guessActive.getActiveState().then(function(t){t.active_status&&a.$activeEnter.addClass("show"),t.shop&&1==t.shop["switch"]&&e(".fishball-mall").removeClass("hide")}),t.guessMainPanelShowAnimation(function(){t.ifShowSliderBar(),t.bindMainPanelEvent()})}),t.initUserCornerByLua())},bindMainPanelEvent:function(){var a=this,i=a.doms;i.$manPanel.on("mouseover",function(){var t=e(this);"yes"===t.attr("data-slidecanshow")&&t.find(".slide-bar").show()}).on("mouseout",function(){var t=e(this);t.find(".slide-bar").hide()}),i.$manPanel.on("click",".guess-main-panel-close",function(){u.guessPopup.removeSome(),a.closeMainPanel(),a.clearSliderData()}),i.$manPanel.on("mouseover",".item",function(t){var a=e(this);if(e(t.target).hasClass("icon-hasBid"))return void a.removeClass("hover");var i=+a.parents(".guess-game-box-theme").attr("data-qs"),s=a.hasClass("waitGuess"),n=+a.attr("data-balance");return i>=2||g.isAnchor()||s||0===n?void a.removeClass("hover"):void a.addClass("hover")}).on("mouseout",".item",function(){var t=e(this);t.removeClass("hover")}),i.$manPanel.on("click",".item",function(){var t=e(this),i=+t.parents(".guess-game-box-theme").attr("data-qs"),s=t.hasClass("waitGuess"),n=+t.attr("data-balance");if(!g.isAnchor()&&s){var o=t.parents(".guess-game-box");a.waitGuessAnimation(o)}if(!(i>=2||g.isAnchor()||s||0===n)){a.removeAllWaitguess();var r=null;t.hasClass("item-left")?r="left":t.hasClass("item-right")&&(r="right");var l=t.parents(".guess-game-box"),d={leftOrRight:r,odds:t.attr("data-loss"),sbid:t.attr("data-bankerid"),qid:l.attr("data-qid"),leaves:t.attr("data-balance")};u.guessPopup.showBetting(l,d,function(e){a.bidAnimation(l,{num:e,side:r})}),g.dys({key:"dys.room.guess-game.item.click"})}}),i.$manPanel.on("click",".icon-hasBid",function(e){e.stopPropagation()}).on("mousedown",".icon-hasBid",function(e){e.stopPropagation()}).on("mouseup",".icon-hasBid",function(e){e.stopPropagation()}),i.$manPanel.on("mouseover",".icon-hasBid",function(t){var i=e(this),s=e(this).data("option"),n=i.parents(".guess-game-box"),r=n.find(".guessRecordBox"),l=n.find('.guessRecordBox[data-option="'+s+'"]'),d=n.data("qid"),c=d+"-"+s;a.clearCornerTimer(c);var u=(new Date).getTime();if("end"!==a.data.activityStatus){var g=l.find(".guessRecord").data("time");g=g?+g:0;var m=u-g;if(l.length>0&&5e3>=m)r.hide(),a.delayShowCorner(c,function(){l.show()});else{var p={room_id:+o.get("room.room_id"),user_id:+o.get("sys.uid"),quiz_id:d,quiz_option:s};a.delayShowCorner(c,function(){a.showHasBidList(n,p)})}}else if(l.length>0&&a.data.hasGetEndData[c])r.hide(),a.delayShowCorner(c,function(){l.show()});else{var p={room_id:+o.get("room.room_id"),user_id:+o.get("sys.uid"),quiz_id:d,quiz_option:s};a.delayShowCorner(c,function(){a.showHasBidList(n,p,!0)})}}).on("mouseout",".icon-hasBid",function(t){var i=e(this),s=e(this).data("option"),n=i.parents(".guess-game-box"),o=n.find('.guessRecordBox[data-option="'+s+'"]'),r=n.data("qid"),l=r+"-"+s;a.clearCornerTimer(l),o.hide()}),i.$manPanel.on("mouseover",".guessRecordBox",function(t){var a=e(this);a.show()}).on("mouseout",".guessRecordBox",function(t){var a=e(this);a.hide()}),i.$manPanel.on("mousedown",".item",function(){g.isAnchor()||e(this).addClass("bidClick")}).on("mouseup",".item",function(){g.isAnchor()||e(this).removeClass("bidClick")}),i.$manPanel.on("click",".beginGuess",function(){var t=e(this).parents(".guess-game-box"),i={title:t.attr("data-qt"),chooseOne:t.attr("data-fon"),chooseTwo:t.attr("data-son"),fishBall:e(".fishBall_NUM").html(),qid:t.attr("data-qid")};a.removeAllWaitguess(),u.guessPopup.showDealer(i),g.dys({key:"dys.room.guess-game.user.beginguess"})}),i.$manPanel.on("click",".guessGameStartBtn",function(){u.guessPopup.showSetting(),g.dys({key:"dys.room.guess-game.anchor.create",is_anch:g.isAnchor()?1:0})}),i.$manPanel.on("click",".endBtn",function(){if(!e(this).hasClass("disable")){var t=e(this).parents(".guess-game-box"),a=[{title:t.attr("data-qt"),chooseOne:t.attr("data-fon"),chooseTwo:t.attr("data-son"),endTime:e(this).parents(".guess-game-box").find(".et").text(),qid:t.attr("data-qid")}];u.guessPopup.showAncherResult(a),g.dys({key:"dys.room.guess-game.anchor.batchend",is_anch:g.isAnchor()?1:0,type:1})}}),i.$manPanel.on("click",".stopBidBtn",function(){if(!e(this).hasClass("disable")){a.removeAllStopBid();var t=e(this).parents(".guess-game-box");if(!(t.find(".ensureOutBox").length>0)){var s=t.attr("data-qid"),n=a.render.ensureStopBid({qid:s});i.$ensureOutBox=e(n),t.append(i.$ensureOutBox)}}}),i.$manPanel.on("click",".comfirmStopBid",function(){var t=e(this),i=t.data("qid"),s=t.parents(".ensureOutBox"),n=t.parents(".guess-game-box");g.sendAjax({url:a.url.closeQuiz,type:"POST",data:{room_id:+o.get("room.room_id"),quiz_id:i},success:function(t){s.remove();var i=+t.error;0===i?e.dialog.tips_black("封盘成功"):514028!==i&&514026!==i||a.stopBidTip(n,t.msg)},error:function(){s.remove()}})}),i.$manPanel.on("click",".cancelStopBid",function(){var t=e(this).parents(".ensureOutBox");t.remove()}),i.$manPanel.on("click",".batchSubmit",function(){u.guessPopup.showAncherResult(u.guessPopup.submitResultNum()),g.dys({key:"dys.room.guess-game.anchor.batchend",is_anch:g.isAnchor()?1:0,type:2})}),i.$manPanel.on("mousedown",".clickBtn",function(){e(this).addClass("mousePress")}).on("mouseup",".clickBtn",function(){e(this).removeClass("mousePress")}),i.$manPanel.on("mousedown",".clickBtn1",function(){e(this).addClass("mousePress")}).on("mouseup",".clickBtn1",function(){e(this).removeClass("mousePress")}),i.$manPanel.on("click","#resetGuessGame",function(){u.guessPopup.showSetting(),g.dys({key:"dys.room.guess-game.anchor.create",is_anch:g.isAnchor()?1:0})}),i.$manPanel.on("click",".guessFestival",function(){u.guessActive.showActiveDialog()}),i.$manPanel.on("click",".guessGuideBox",function(){var t=e(this).attr("data-rid");g.dys({key:"dys.room.guess-game.user.recommend.click",rid:t})}),i.$manPanel.on("click",".myGuess",function(){g.dys({key:"dys.room.guess-game.user.record.click"})}),i.$manPanel.on("click",".helpBtn",function(){g.dys({key:"dys.room.guess-game.user.help.click"});var e=i.$manPanel.find(".mask");g.isAnchor()&&e.length>0&&e.remove()}),i.$manPanel.on("click",".J-setAuthority",function(){u.guessPopup.showPowerSet(),g.getSetUserAuthority()||(n.set("setUserAuthorityFlag",!0),e(this).find(".tipsTextBox").remove()),g.dys({key:"dys.room.guess-game.anchor.quizset.click"})}),i.$manPanel.on("click",".left-bar",function(){var e=a.sliderData.currentRight-a.sliderData.step;if(0>e){var t=a.sliderData.currentRight;if(!(t>0&&t<a.sliderData.step))return;e=0}a.sliderData.currentRight=e,i.$guessBoxBody.animate({right:a.sliderData.currentRight})}),i.$manPanel.on("click",".right-bar",function(){var e=a.sliderData.currentRight+a.sliderData.step;if(e>a.sliderData.maxRight){var t=a.sliderData.maxRight-a.sliderData.currentRight;if(!(t>0&&t<a.sliderData.step))return;e=a.sliderData.maxRight}a.sliderData.currentRight=e,i.$guessBoxBody.animate({right:a.sliderData.currentRight})}),i.$manPanel.on("click",".fishball-mall",function(){var e=JSON.stringify({room_id:$ROOM.room_id});g.dys({key:"dys.room.guess-game.mall-ennter.click"}),window.open(u.guessPopup.vars.mainMsg.shop.mallurl+"?share_token="+g.base64_encode(e))}),e(window).on("resize",function(){var e=setTimeout(function(){a.ifShowSliderBar(),a.screenAdaption(),a.anchorRecommendAdaption(),clearTimeout(e)},20)}),e(document).on("click",".left-btn",function(){var e=setTimeout(function(){a.ifShowSliderBar(),a.screenAdaption(),a.anchorRecommendAdaption(),clearTimeout(e)},20)}),t.on("mod.userinfo.updateSilverGold",function(t){a.isPanelShow()&&!isNaN(t.silver)&&(i.$manPanel.find('[data-login-user="silver"]').text(t.silver),e(".guess-tip-dealer").length>0&&e(".guess-tip-dealer").find('[data-login-user="silver"]').text(t.silver))})},init:function(){var e=this;u.guessPopup.init(e),u.guessActive.init()}};return r.reg("room_data_handler",function(t){var a=i.decode(t).too();switch(a.type){case"rquiziln":var s=a.qril,n=0,o=!1,r=!1;if(""===s&&(r=!0),!r){s=i.isArray(s)?i.decode(s):[{value:s}];var l=m.guessData.guessList.length;0!=l&&(n=m.guessData.guessList[0].qbid,m.guessData.guessList.length=0);for(var d=0,c=s.length;c>d;d++){var p=s[d].value,f=p&&i.decode(p).too();if(f){n===f.qbid&&(o=!0);var h=e.extend({},m.defaultObj,f);m.guessData.guessList.push(h)}}m.guessData.guessSingleEndPool.length>0&&m.handleSingleEndPool(m.guessData.guessSingleEndPool,!0)}o||r||(m.mainPanelToBegin(),g.isAnchor()||(m.data.activityStatus="begin",m.data.hasGetEndData?(delete m.data.hasGetEndData,m.data.hasGetEndData={}):m.data.hasGetEndData={},m.isPanelShow()&&m.initUserCornerByLua())),m.guessData.guessList.length>0&&u.msgCenter.tryShow("api");break;case"rquizisn":var s=a.qril;s=i.isArray(s)?i.decode(s):[{value:s}],m.guessData.guessStatusPool.length=0;for(var d=0,c=s.length;c>d;d++){var p=s[d].value,f=p&&i.decode(p).too();f&&m.guessData.guessStatusPool.push(f)}m.handleStatusPool();break;case"quizprn":var s=a.qprl;if(""===s)return;s=i.isArray(s)?i.decode(s):[{value:s}],m.guessData.guessEndPool.length=0;for(var d=0,c=s.length;c>d;d++){var p=s[d].value,f=p&&i.decode(p).too();f&&m.guessData.guessEndPool.push(f)}!g.isAnchor()&&m.guessData.guessEndPool.length>0&&(u.guessPopup.showUserResult(m.guessData.guessEndPool),m.handleSingleEndPool(m.guessData.guessEndPool,!1));break;case"quen":var s=a.quel;if(""===s)return;s=i.isArray(s)?i.decode(s):[{value:s}],m.guessData.guessSingleEndPool.length=0;for(var d=0,c=s.length;c>d;d++){var p=s[d].value,f=p&&i.decode(p).too();f&&m.guessData.guessSingleEndPool.push(f)}g.isAnchor()||m.handleSingleEndPool(m.guessData.guessSingleEndPool,!1)}}),r.reg("room_shopBroadCast_click",function(e){window.open(u.guessPopup.vars.mainMsg.shop.mallurl+"?share_token="+e)}),{init:function(){m.init()}}}),define("douyu/page/room/normal/mod/task",["jquery","shark/observer","shark/util/flash/data/1.0","shark/util/lang/1.0","shark/util/template/2.0","shark/util/storage/1.0","douyu/context","douyu/com/user","douyu/com/vcode-v3","douyu/page/room/base/api"],function(e,t,a,i,s,n,o,r,l,d){Date.prototype.Format=function(e){var t=e,a={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in a)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?a[i]:("00"+a[i]).substr((""+a[i]).length)));return t};var c={init:function(){this.config={isFlashReady:!1,roomId:o.get("room.room_id"),hasGetTaskList:!1,panelOpen:!1,taskData:[],urls:{noviceList:"/task_new/dailyTask",webGameList:"/task_new/pageTasks",webGameTask:"/task_new/pageDetail/",iosList:"/task_new/iosTasks",iosTask:"/task_new/iosDetail",androidList:"/task_new/androidTasks",androidTask:"/task_new/androidDetail",recommendList:"/task_new/recomTasks",recordList:"/member/task/getRewardHistory",getReward:"/member/task/reward_new",getCaptcha:"/member/task/captcha2",getRemindPrice:"/member/task/getTaskPrizeBalance",getDoneTask:"/member/task/receive_tasks"},reward:{silver:0,coupon:0,caviar:0,prop:0,game:0,lottery:0},recommendOffset:0,webOffset:0,iosOffset:0,androidOffset:0,recordLast_jid:0,recordLast_rtime:0,loadLock:{},geetest:{}},this.getDoms(),this.generateRenders(),this.renderMain(),this.switchTab("recommend"),this.addEvent()},getDate:function(){var e=new Date;return e.getFullYear()+e.getMonth()+e.getDate()},getDoms:function(){var t=e('<div class="task-case"></div>');e("body").append(t),this.doms={taskPanel:t,taskBtn:e("#js-room-task-trigger"),awardNum:e("#js-room-task-trigger .js-awardnum"),statusNActions:e("#js-stats-and-actions"),header:e("#header")}},generateRenders:function(){this.renders={};var e=this.renders;e.mainRender=s.compile(this.getTemplate("main")),e.recommendRender=s.compile(this.getTemplate("recommend")),e.gameListRender=s.compile(this.getTemplate("gameList")),e.noviceRender=s.compile(this.getTemplate("novice")),e.noviceTaskRender=s.compile(this.getTemplate("noviceTask")),e.gameSideCardRender=s.compile(this.getTemplate("gameSideCard")),e.recordRender=s.compile(this.getTemplate("recordCard")),e.pagerRender=s.compile(this.getTemplate("pager")),e.gameAllTaskRender=s.compile(this.getTemplate("gameAllTask")),e.webGameTaskRender=s.compile(this.getTemplate("webGameTask")),e.doneListRender=s.compile(this.getTemplate("taskDoneCard"))},encodeHTML:function(t){var a=e("<p></p>");return a.html(t),a.text()},dataProcessor:function(e,t,a){var i,s,n,o,r,l=t,d=$ROOM.nowtime;switch(e){case"recommend":n=t.list;for(i in n){o=n[i],o.totalSilver=0,1===o.gtt?(o.platform="页游",o.gameType="web"):2===o.gtt||7===o.gtt?(o.platform="苹果",o.gameType="ios"):4!==o.gtt&&3!==o.gtt||(o.platform="安卓",o.gameType="android");for(i in o.ts)o.totalSilver+=o.ts[i].silver,this.taskTypeFormat(o.ts[i],o.gtt)}return l.recommend=!0,l;case"web":n=l.list;for(i in n){o=n[i],o.platform="页游",o.gameType="web",o.gtt=1,o.totalSilver=0;for(s in o.ts)o.totalSilver+=o.ts[s].silver,this.taskTypeFormat(o.ts[s],o.gtt)}return l;case"webAll":o=l,o.platform="页游",o.gameType="web",o.gtt=1;for(s in o.ts)r=o.ts[s],r.task_desc=this.encodeHTML(r.task_desc),this.taskTypeFormat(r,o.gtt);return l;case"ios":n=l.list;for(i in n){o=n[i],o.platform="苹果",o.gameType="ios",o.url=encodeURI(o.detail_url+"&source_type=iosGame"),o.totalSilver=0,2===o.gtt?o.is_new=1:o.is_new=0;for(s in o.ts)r=o.ts[s],o.totalSilver+=r.silver,r.status="activing",this.taskTypeFormat(r,o.gtt)}return l;case"iosAll":o=l,o.platform="苹果",o.gameType="ios",o.url=encodeURI(o.detail_url+"&source_type=iosGame"),o.size=o.size+"MB",2===o.gtt?o.is_new=1:o.is_new=0;for(s in o.ts)r=o.ts[s],r.task_desc=this.encodeHTML(r.task_desc),r.status="activing",r.startTime=new Date(1e3*r.e_s_t).Format("yyyy/MM/dd"),r.endTime=new Date(1e3*r.e_e_t).Format("yyyy/MM/dd"),this.taskTypeFormat(r,o.gtt);return l;case"android":n=l.list;for(i in n){o=n[i],o.platform="安卓",o.gameType="android",o.gtt=o.game_type,o.totalSilver=0,o.down_url&&(o.url=encodeURI(o.down_url+"?appId="+o.app_id));for(s in o.ts)r=o.ts[s],o.totalSilver+=r.silver,o.is_new?d<r.e_s_t?r.status="nostart":r.e_e_t&&d>r.e_e_t?r.status="ended":r.status="activing":r.status="activing",this.taskTypeFormat(r,o.gtt)}return l;case"androidAll":o=l,o.platform="安卓",o.gameType="android",o.gtt=o.game_type,o.down_url&&(o.url=encodeURI(o.down_url+"?appId="+o.app_id)),isNaN(1*o.size)||(o.size=o.size+"MB");for(s in o.ts)r=o.ts[s],r.task_desc=this.encodeHTML(r.task_desc),o.is_new?(d<r.e_s_t?r.status="nostart":r.e_e_t&&d>r.e_e_t?r.status="ended":r.status="activing",r.startTime=new Date(1e3*r.e_s_t).Format("yyyy/MM/dd"),r.endTime=new Date(1e3*r.e_e_t).Format("yyyy/MM/dd")):(r.status="activing",r.startTime=new Date(1e3*r.start_time).Format("yyyy/MM/dd"),r.endTime=new Date(1e3*r.stop_time).Format("yyyy/MM/dd")),this.taskTypeFormat(r,o.gtt);return l;default:return t}},taskTypeFormat:function(e,t){1===t||3===t?3===Number(e.task_type)?e.task_type_class="charge":e.task_type_class="ingame":2!==t&&7!==t&&4!==t||(e.tt_type<=3?e.task_type_class="charge":4===e.tt_type?e.task_type_class="ingame":5===e.tt_type?e.task_type_class="live":6===e.tt_type&&(e.task_type_class="login"))},renderMain:function(){var e={};this.doms.taskPanel.html(this.renders.mainRender(e))},renderWebGameTask:function(t,a){var i=this;this.request(this.config.urls.webGameTask+"/"+t,function(t){var s;return t.app_id?(s=i.dataProcessor("webAll",t),a.html(i.renders.webGameTaskRender(s)),i.waitScrolling?setTimeout(function(){i.scrollToTask(i.waitScrolling.tid,i.waitScrolling.list),i.waitScrolling=null},200):a.parents(".mCustomScrollbar").mCustomScrollbar("scrollTo",0),a.parents(".task-content").find(".play-btn-bottom").attr("href",s.click_url),void i.updateTask("webAll")):void e.dialog.tips_black("该游戏已下架")},"allTaskLock")},renderRecommend:function(){var e=this,t=this.config.urls.recommendList;-1!==e.config.recommendOffset&&this.request(t,{offset:e.config.recommendOffset,limit:10},function(t){var a=e.dataProcessor("recommend",t);if(0===t.total)return void e.doms.taskPanel.find(".recommend").addClass("task-empty");if(e.config.recommendOffset+=t.list.length,e.config.recommendOffset>=t.total&&(e.config.recommendOffset=-1),e.doms.taskPanel.find(".recommend").hasClass("task-loading")){e.doms.taskPanel.find(".recommend").html(e.renders.recommendRender(a)).removeClass("task-loading");var i=a.list[0],s=e.doms.taskPanel.find(".recommend .recommend-game-list");1===i.gtt?(e.renderWebGameTask(i.app_id,s),e.doms.taskPanel.find(".recommend .footer-fix").show()):(e.renderAllTask(i.app_id,i.is_new,i.gameType,s),
e.doms.taskPanel.find(".recommend .footer-fix").hide()),setTimeout(function(){e.doms.taskPanel.find(".recommend .task-status-list").eq(0).addClass("open"),e.doms.taskPanel.find(".recommend .trigger-icon").eq(0).addClass("open"),e.doms.taskPanel.find(".recommend .task-game-list-bar .task-status").eq(0).addClass("active")},100),e.doms.taskPanel.find(".recommend .recommend-task-main").mCustomScrollbar({mouseWheel:{scrollAmount:100},scrollInertia:0,callbacks:{onScroll:function(){var t=this.mcs.draggerTop;e.doms.taskPanel.find(".recommend .game-info .qr-code").length?t>20?(e.doms.taskPanel.find(".recommend .game-top-info").show(),e.doms.taskPanel.find(".recommend .game-info .qr-code").hide()):(e.doms.taskPanel.find(".recommend .game-top-info").hide(),e.doms.taskPanel.find(".recommend .game-info .qr-code").show()):e.doms.taskPanel.find(".recommend .game-info .qr-code").hide()}}}),e.doms.taskPanel.find(".recommend .task-game-list-bar").mCustomScrollbar({mouseWheel:{scrollAmount:100},scrollInertia:0,callbacks:{onTotalScrollOffset:300,onTotalScroll:function(){e.renderRecommend()}}})}e.doms.taskPanel.find(".recommend .task-game-list-bar .mCSB_container").append(e.renders.gameSideCardRender(a)),e.taskStatus&&(e.updateTask(),e.renderDoneList())},"recommendListLock")},renderWebGame:function(){var e=this,t=this.config.urls.webGameList;-1!==e.config.webOffset&&this.request(t,{offset:e.config.webOffset,limit:10},function(t){var a=e.dataProcessor("web",t);return 0===e.config.webOffset&&0===t.list.length?void e.doms.taskPanel.find(".web-game").addClass("task-empty"):(e.config.webOffset+=t.list.length,e.config.webOffset>=t.total&&(e.config.webOffset=-1),e.config.taskData=e.config.taskData.concat(a.list),e.doms.taskPanel.find(".web-game").hasClass("task-loading")&&(e.doms.taskPanel.find(".web-game").html(e.renders.recommendRender(a)).removeClass("task-loading"),e.renderWebGameTask(a.list[0].app_id,e.doms.taskPanel.find(".web-game .recommend-game-list")),setTimeout(function(){e.doms.taskPanel.find(".web-game .task-status-list").eq(0).addClass("open"),e.doms.taskPanel.find(".web-game .trigger-icon").eq(0).addClass("open"),e.doms.taskPanel.find(".web-game .task-game-list-bar .task-status").eq(0).addClass("active")},100),e.doms.taskPanel.find(".web-game .recommend-task-main").mCustomScrollbar({mouseWheel:{scrollAmount:100},scrollInertia:0}),e.doms.taskPanel.find(".web-game .task-game-list-bar").mCustomScrollbar({mouseWheel:{scrollAmount:100},scrollInertia:0,callbacks:{onTotalScrollOffset:300,onTotalScroll:function(){e.renderWebGame()}}})),0!==t.list.length&&e.doms.taskPanel.find(".web-game .task-game-list-bar .mCSB_container").append(e.renders.gameSideCardRender(a)),void(e.taskStatus&&e.updateTask("web")))},"webgameListLock")},renderIOS:function(){var e=this,t=this.config.urls.iosList;-1!==e.config.iosOffset&&this.request(t,{offset:e.config.iosOffset,limit:10},function(t){var a=e.dataProcessor("ios",t);if(0===e.config.iosOffset&&0===t.list.length)return void e.doms.taskPanel.find(".ios-game").addClass("task-empty");if(e.config.iosOffset+=t.list.length,e.config.iosOffset>=t.total&&(e.config.iosOffset=-1),e.config.taskData=e.config.taskData.concat(a.list),e.doms.taskPanel.find(".ios-game").hasClass("task-loading")){e.doms.taskPanel.find(".ios-game").html(e.renders.gameListRender(a)).removeClass("task-loading"),e.doms.taskPanel.find(".ios-game .game-main").mCustomScrollbar({mouseWheel:{scrollAmount:100},scrollInertia:0,callbacks:{onScroll:function(){var t=this.mcs.draggerTop;t>20?(e.doms.taskPanel.find(".ios-game .game-top-info").show(),e.doms.taskPanel.find(".ios-game .game-info .qr-code").hide()):(e.doms.taskPanel.find(".ios-game .game-top-info").hide(),e.doms.taskPanel.find(".ios-game .game-info .qr-code").show())}}});var i=a.list[0];e.renderAllTask(i.app_id,i.is_new,"ios",e.doms.taskPanel.find(".ios-game .game-main .mCSB_container")),setTimeout(function(){e.doms.taskPanel.find(".ios-game .task-status-list").eq(0).addClass("open"),e.doms.taskPanel.find(".ios-game .trigger-icon").eq(0).addClass("open"),e.doms.taskPanel.find(".ios-game .task-game-list-bar .task-status").eq(0).addClass("active")},100),e.doms.taskPanel.find(".ios-game .task-game-list-bar").mCustomScrollbar({mouseWheel:{scrollAmount:100},scrollInertia:0,callbacks:{onTotalScrollOffset:300,onTotalScroll:function(){e.renderIOS()}}})}e.doms.taskPanel.find(".ios-game .task-game-list-bar .mCSB_container").append(e.renders.gameSideCardRender(a)),e.taskStatus&&e.updateTask("ios")},"iosListLock")},renderAndroid:function(){var e=this,t=this.config.urls.androidList;-1!==e.config.androidOffset&&this.request(t,{offset:e.config.androidOffset,limit:10},function(t){var a=e.dataProcessor("android",t);if(0===e.config.androidOffset&&0===t.list.length)return void e.doms.taskPanel.find(".android-game").addClass("task-empty");if(e.config.androidOffset+=t.list.length,e.config.androidOffset>=t.total&&(e.config.androidOffset=-1),e.config.taskData=e.config.taskData.concat(a.list),e.doms.taskPanel.find(".android-game").hasClass("task-loading")){e.doms.taskPanel.find(".android-game").html(e.renders.gameListRender(a)).removeClass("task-loading"),e.doms.taskPanel.find(".android-game .game-main").mCustomScrollbar({mouseWheel:{scrollAmount:100},scrollInertia:0,callbacks:{onScroll:function(){var t=this.mcs.draggerTop;t>20?(e.doms.taskPanel.find(".android-game .game-top-info").show(),e.doms.taskPanel.find(".android-game .game-info .qr-code").hide()):(e.doms.taskPanel.find(".android-game .game-top-info").hide(),e.doms.taskPanel.find(".android-game .game-info .qr-code").show())}}});var i=a.list[0];e.renderAllTask(i.app_id,i.is_new,"android",e.doms.taskPanel.find(".android-game .game-main .mCSB_container")),setTimeout(function(){e.doms.taskPanel.find(".android-game .task-status-list").eq(0).addClass("open"),e.doms.taskPanel.find(".android-game .trigger-icon").eq(0).addClass("open"),e.doms.taskPanel.find(".android-game .task-game-list-bar .task-status").eq(0).addClass("active")},100),e.doms.taskPanel.find(".android-game .task-game-list-bar").mCustomScrollbar({mouseWheel:{scrollAmount:100},scrollInertia:0,callbacks:{onTotalScrollOffset:300,onTotalScroll:function(){e.renderAndroid()}}})}e.doms.taskPanel.find(".android-game .task-game-list-bar .mCSB_container").append(e.renders.gameSideCardRender(a)),e.updateRemind(a.list),e.taskStatus&&e.updateTask("android")},"androidListLock")},renderNovice:function(){var e=this,t=this.config.urls.noviceList;this.request(t,function(t){var a=t[0];e.doms.taskPanel.find(".novice").html(e.renders.noviceRender(a)).removeClass("task-loading"),e.taskStatus&&e.updateTask("novice")},"noviceListLock")},renderRecord:function(){var e=this,t=this.config.urls.recordList;-1!==this.config.recordLast_jid&&this.request(t,{last_jid:e.config.recordLast_jid,last_rtime:e.config.recordLast_rtime,limit:10},function(t){var a=t.list;return e.doms.taskPanel.find(".record").hasClass("task-loading")&&e.doms.taskPanel.find(".record").removeClass("task-loading"),0===e.config.recordLast_jid&&0===a.length?void e.doms.taskPanel.find(".record").addClass("no-record"):(1===t.pager.ov&&(e.config.recordLast_jid=-1),void(a.length&&(e.config.recordLast_jid=a[a.length-1].jid,e.config.recordLast_rtime=a[a.length-1].dl,e.doms.taskPanel.find(".record").hasClass("mCustomScrollbar")?e.doms.taskPanel.find(".record .mCSB_container").append(e.renders.recordRender({list:a})):(e.doms.taskPanel.find(".record").append(e.renders.recordRender({list:a})),e.doms.taskPanel.find(".record").mCustomScrollbar({mouseWheel:{scrollAmount:100},scrollInertia:0,callbacks:{onTotalScrollOffset:100,onTotalScroll:function(){e.renderRecord()}}})),e.renderQRcode(e.doms.taskPanel.find(".record .qr-img")))))},"recordListLock")},renderDoneList:function(){var e,t,a,i,s=this,n=[];if(this.taskStatus)for(e in this.taskStatus)i=this.taskStatus[e],i.a>0&&(Number(0!==i.tn)||i.tid>14)&&n.push(i.tn+"_"+i.tid+"_"+i.adid);n.length&&(s.config.cardData&&s.config.doneData?(s.doms.taskPanel.find(".recommend .recommend-task-main .mCSB_container").html(s.renders.doneListRender({list:s.config.doneData})),s.renderQRcode(s.doms.taskPanel.find(".task-done-card .qr-img")),s.doms.taskPanel.find(".recommend .footer-fix").hide()):this.request(s.config.urls.getDoneTask,"POST",{str_key:n},function(o){if(o.length){n=[],s.config.cardData=o;for(e in o){var r,l;if(i=o[e],i.silver=0,i.prop=[],i.coupon=0,i.caviar=0,i.gold=0,r=4===i.g_t?1:2===i.g_t?2:0,l=7===i.g_t?s.taskStatus["15-0-"+i.app_id]:s.taskStatus[i.task_id+"-"+r+"--1"],l&&l.ps>0){for(t in i.levels)if(t>=l.a-l.ps&&t<l.a)if(4===i.g_t||2===i.g_t||7===i.g_t){var d=i.levels[t].reward;if(d.silver&&d.silver.num&&(i.silver+=Number(d.silver.num)),d.gold&&(i.gold+=Number(d.gold)),d.coupon&&d.coupon.length)for(a in d.coupon)i.coupon+=Number(d.coupon[a].money);d.caviar&&(i.caviar+=Number(d.caviar)),d.prop&&"object"==typeof d.prop&&i.prop.push(d.prop),d.props&&d.props.length&&(i.prop?i.prop=i.prop.concat(d.props):i.prop=d.props),d.lottery&&d.lottery.length&&(i.lottery?i.lottery=i.lottery.concat(d.lottery):i.lottery=d.lottery),d.gift&&d.gift.length&&(i.gift?i.gift=i.gift.concat(d.gift):i.gift=d.gift)}else 1!==i.g_t&&3!==i.g_t||(i.levels[t].silver&&(i.silver+=Number(i.levels[t].silver)),i.levels[t].prop&&(i.prop=i.prop.concat(i.levels[t].props)));n.push(i)}}s.config.doneData=n,n.length&&(s.doms.taskPanel.find(".recommend").removeClass("task-loading task-empty"),s.doms.taskPanel.find(".recommend .task-game-list-bar .mCSB_container").prepend('<div class="get-reward-list active"><span>'+n.length+"</span>个可领取奖励</div>"),s.doms.taskPanel.find(".recommend .recommend-task-main .mCSB_container").show().html(s.renders.doneListRender({list:n})),s.renderQRcode(s.doms.taskPanel.find(".task-done-card .qr-img")),s.doms.taskPanel.find(".recommend .footer-fix").hide(),s.doms.taskPanel.find(".recommend .task-game-list-bar .task-status").removeClass("active"))}},"doneListLock"))},renderAllTask:function(t,a,i,s){var n,o=this;"android"===i?n=this.config.urls.androidTask+"?app_id="+t+"&is_new="+a:"ios"===i&&(n=this.config.urls.iosTask+"?app_id="+t),this.request(n,function(t){var a;return t.app_id?("android"===i?a=o.dataProcessor("androidAll",t):"ios"===i&&(a=o.dataProcessor("iosAll",t)),s.html(o.renders.gameAllTaskRender(a)),o.waitScrolling?setTimeout(function(){o.scrollToTask(o.waitScrolling.tid,o.waitScrolling.list),o.waitScrolling=null},200):s.parents(".mCustomScrollbar").mCustomScrollbar("scrollTo",0),o.renderQRcode(o.doms.taskPanel.find(".game-task-panel .qr-img")),o.updateTask("all"),void("android"===i&&o.updateRemind([a]))):void e.dialog.tips_black("该游戏已下架")},"allTaskLock")},renderQRcode:function(t){var a="Microsoft Internet Explorer"===navigator.appName&&parseInt(navigator.userAgent.toLowerCase().match(/msie ([\d.]+)/)[1],10)<9?"table":"canvas";e(t).each(function(){var t=e(this);if(!t.data("render")){var i=t.data("url");if(t.qrcode({render:a,width:t.width(),height:t.height(),text:i,correctLevel:1}),t.parents(".game-info").length){var s=t.parents(".task-content.active").find(".game-top-info .qr-img");s.find("canvas").remove(),s.qrcode({render:a,width:s.width(),height:s.height(),text:i,correctLevel:1})}t.data("render",!0)}})},getPropInfo:function(e){var t=this.doms.taskPanel.find('.task-reward.gift[data-pid="'+e+'"]');this.request("/ztCache/mobilegame/getPropPacks",{propid:e},function(e){var a=e.gift_data,i='<div class="gift-info"><div class="arrow"></div>';for(var s in a)i+='<div class="prop">',i+='<img src="'+a[s].icon+'"/>',i+='<div class="name">'+a[s].prop_name+"×"+a[s].prop_cnt+"</div>",i+="</div>";i+="</div>",t.append(i)},"propInfo"+e)},getGameGiftInfo:function(e){var t=this.doms.taskPanel.find('.task-reward.game[data-gid="'+e+'"]');this.request("/ztCache/mobilegame/getGiftLite",{gid:e},function(e){var a=e,i='<div class="game-info"><div class="arrow"></div><p>礼包码内容</p><div class="content">'+a.content.replace(/\n/g,"<br>")+"</div>";a.useMethod&&(i+='<p>使用方法</p><div class="method">'+a.useMethod.replace(/\n/g,"<br>")+"</div>"),i+='<div class="method">领取的礼包请在安卓斗鱼App“游戏中心-礼包-已领取”中查看</div>',i+="</div>",t.append(i)},"giftInfo"+e)},addEvent:function(){var t=this;this.doms.taskBtn.on("click",function(){t.openTaskPanel(),DYS.sub({action_code:"click_task"})}),this.doms.taskPanel.on("click",".task-close",function(){t.toggleTaskPanel()}),this.doms.taskPanel.on("click",".back",function(){t.doms.taskPanel.find(".game-task-panel").remove()}),this.doms.taskPanel.on("click",".task-tabs-item",function(){var a=e(this).data("tab");t.switchTab(a)}),this.doms.taskPanel.on("click",".get-reward-list",function(){e(this).addClass("active"),t.renderDoneList(),t.doms.taskPanel.find(".recommend .game-top-info").hide()}),this.doms.taskPanel.on("click",".game-side-card .task-status",function(){var a=e(this).data("tid"),i=e(this).parents(".task-game-list-bar").next();return e(".get-reward-list").removeClass("active"),e(this).parents(".task-game-list-bar").find(".task-status").removeClass("active"),e(this).addClass("active"),i.find('.game-task-all[data-tid="'+a+'"]').length?(t.scrollToTask(a,i),!1):(t.waitScrolling={tid:a,list:i},void DYS.sub({action_code:"click_task_ltask",ext:{task_id:a}}))}),this.doms.taskPanel.on("click",".game-side-card",function(){var a=e(this),i=Number(a.data("gtt")),s=a.data("id"),n=a.data("isnew"),o=a.parents(".task-game-list-bar").next().find(".mCSB_container");t.waitScrolling||(a.find(".task-status-list").slideToggle(),a.find(".trigger-icon").hasClass("open")?a.find(".trigger-icon").removeClass("open"):a.find(".trigger-icon").addClass("open"),e(".get-reward-list").removeClass("active"),e(this).parents(".task-game-list-bar").find(".task-status").removeClass("active"),e(this).find(".task-status").eq(0).addClass("active")),o.find('.game-task-panel[data-id="'+s+'"]').length||o.find('.web-game-task[data-id="'+s+'"]').length||(1===i?(t.renderWebGameTask(s,o),t.doms.taskPanel.find(".recommend .game-top-info").hide(),t.doms.taskPanel.find(".recommend .footer-fix").show()):3===i||4===i?(t.renderAllTask(s,n,"android",o),t.doms.taskPanel.find(".recommend .footer-fix").hide()):2!==i&&7!==i||(t.renderAllTask(s,n,"ios",o),t.doms.taskPanel.find(".recommend .footer-fix").hide()),DYS.sub({action_code:"click_task_lgame",ext:{game_id:s,game_name:e(this).find(".name").attr("title")}}))}),this.doms.taskPanel.on("click",".play-btn-bottom",function(e){DYS.sub({action_code:"click_task_detail_pgame"})}),this.doms.taskPanel.on("click",".action-btn.done, .get-reward-btn.done",function(){var a=e(this).parents(".game-task-all, .novice-task, .task-item"),i=e(this).parents(".task-game-card, .game-task-panel, .web-game-task"),s=Number(i.data("id")),n=Number(a.data("tid")),o=Number(a.data("gtt"));return 7===o?t.getAward(s,o):t.getAward(n,o),e(this).hasClass("action-btn")?1===e(this).parent().data("tid")?DYS.sub({action_code:"click_task_get_mail"}):2===e(this).parent().data("tid")?DYS.sub({action_code:"click_task_get_chaphoto"}):14===e(this).parent().data("tid")&&DYS.sub({action_code:"click_task_get_phone"}):DYS.sub({action_code:"click_task_detail_get"}),!1}),this.doms.taskPanel.on("click",".one-key",function(){var a=e(this).parents(".task-done-card"),i=Number(a.data("id")),s=Number(a.data("tid")),n=Number(a.data("gtt")),o=0,r=0,l=0;a.find(".gift").each(function(){o+=e(this).data("num")}),a.find(".game").each(function(){r+=e(this).data("num")}),a.find(".lottery").each(function(){l+=e(this).data("num")});var d={caviar:a.find(".platform-coin").data("num")||0,coupon:a.find(".coupon").data("num")||0,silver:a.find(".silver").data("num")||0,prop:o,game:r,lottery:l,gold:a.find(".gold").data("num")||0};7===n?t.getAward(i,n,d):t.getAward(s,n,d)}),this.doms.taskPanel.on("click",".action-btn.disabled, .action-btn.done, .get-reward-btn.disabled",function(e){return e.preventDefault(),!1}),this.doms.taskPanel.on("click",".show-more",function(){e(this).parent().hasClass("open")?e(this).parent().removeClass("open"):e(this).parent().addClass("open")}),e("body").on("click",".v3-sign-close",function(){e(".v3-sign-wrap").remove(),t.gee&&t.gee.destroy()}),this.doms.taskPanel.on("mouseenter",".task-reward.gift",function(){e(this).find(".gift-info").length||t.getPropInfo(e(this).data("pid"))}),this.doms.taskPanel.on("mouseenter",".task-reward.game",function(){e(this).find(".game-info").length||t.getGameGiftInfo(e(this).data("gid"))}),d.reg("room_data_login",function(){t.config.isFlashReady=!0}),d.reg("room_data_tasklis",function(e){var i,s,n,o=0,r=a.decode(e).too();if(r&&r.list){for(i=a.isArray(r.list)?a.decode(r.list):[{value:r.list}],r={};o<i.length;o++){s=a.decode(i[o].value).too();for(n in s)s[n]=+s[n]||0;r[s.tid+"-"+s.tn+"-"+s.adid]=s}t.taskStatus=r,t.config.hasGetTaskList=!0,0!==t.doms.taskPanel.find(".recommend-task-main").length&&(t.updateTask(),t.renderDoneList())}}),d.reg("room_data_taskcou",function(e){t.config.isFlashReady=!0;var i=a.decode(e).too();i&&i.ps>0&&t.doms.awardNum.text(i.ps).show()})},openTaskPanel:function(){var e=this;return r.check()?void(e.config.isFlashReady&&(e.config.hasGetTaskList||d.exe("js_queryTask"),0===e.doms.taskPanel.find(".recommend-task-main").length&&e.renderRecommend(),e.toggleTaskPanel(),e.doms.awardNum.text("").hide())):void r.show("login")},toggleTaskPanel:function(){this.config.panelOpen?(this.doms.taskPanel.hide(),this.config.panelOpen=!1):(this.doms.taskPanel.show(),this.config.panelOpen=!0)},switchTab:function(t){var a;switch(e(".task-tabs-item, .task-content").removeClass("active"),e('.task-tabs-item[data-tab="'+t+'"]').addClass("active"),e(".task-content."+t).addClass("active"),e(".task-content."+t).find(".recommend-task-main, .record").mCustomScrollbar("scrollTo",0),t){case"recommend":a=1;break;case"web-game":a=2,e(".task-content."+t).hasClass("task-loading")&&this.renderWebGame();break;case"android-game":a=3,e(".task-content."+t).hasClass("task-loading")&&this.renderAndroid();break;case"ios-game":a=4,e(".task-content."+t).hasClass("task-loading")&&this.renderIOS();break;case"novice":e(".task-content."+t).hasClass("task-loading")&&this.renderNovice(),a=5;break;case"record":a=6,e(".task-content."+t).hasClass("task-loading")&&this.renderRecord()}DYS.sub({action_code:"click_task_type",ext:{type:a}})},scrollToTask:function(e,t){t.mCustomScrollbar("scrollTo",t.find('.game-task-all[data-tid="'+e+'"]'),{scrollInertia:300})},updateTask:function(t){var a,i,s,n,o,r,l,d,c,u=this.taskStatus;for(var g in u){if(n=!0,l=u[g],c=l.tn,o=l.adid,r=l.tid,0===Number(l.tn)&&(n=!1),t||(s=this.doms.taskPanel),"ios"===t&&(s=this.doms.taskPanel.find(".task-content.ios-game")),"android"===t&&(s=this.doms.taskPanel.find(".task-content.android-game")),"web"===t&&(s=this.doms.taskPanel.find(".task-content.web-game")),"ios"!==t&&"android"!==t&&"web"!==t&&t||(i=-1===o?1===c?s.find('.game-side-card[data-gtt="4"] .task-status[data-tid="'+r+'"]'):2===c?s.find('.game-side-card[data-gtt="2"] .task-status[data-tid="'+r+'"]'):s.find('.game-side-card .task-status[data-tid="'+r+'"]'):s.find('.game-side-card[data-id="'+o+'"] .task-status'),i.find(".done-num").text(l.a),i.each(function(){if(Number(l.a)>=Number(e(this).data("all"))){e(this).find(".done-num").attr("done",1);var t=e(this).parents(".game-side-card").find(".done-num[done=1]").length;e(this).parents(".game-side-card").find(".complete-status").text(t)}})),"all"===t||!t){var m;m=-1===o?1===c?this.doms.taskPanel.find('.game-task-panel .game-task-all[data-tid="'+r+'"][data-gtt="4"]'):2===c?this.doms.taskPanel.find('.game-task-panel .game-task-all[data-tid="'+r+'"][data-gtt="2"]'):this.doms.taskPanel.find('.game-task-panel .game-task-all[data-tid="'+r+'"]'):this.doms.taskPanel.find('.game-task-panel[data-id="'+o+'"]'),d=Number(m.data("gtt")),(4!==d&&2!==d||!n)&&(1!==d&&3!==d&&5!==d||n)&&-1===o||m.length&&(m.find(".complete-status").each(function(t){t<l.a&&e(this).addClass("done").text("已完成")}),m.find(".task-status i").text(l.a),l.ps>0&&m.find(".get-reward-btn").addClass("done").removeClass("disabled"),0===l.ps&&l.a>0&&m.find(".get-reward-btn").addClass("disabled").removeClass("done"))}if("webAll"!==t&&t||(a=this.doms.taskPanel.find('.web-game-task .game-task-all[data-tid="'+r+'"]'),a.length&&(a.find(".complete-status span").text(l.a),l.ps>0?a.find(".get-reward-btn").addClass("done").removeClass("disabled"):a.find(".get-reward-btn").addClass("disabled").removeClass("done"))),!("novice"!==t&&t||n)){var p=this.doms.taskPanel.find('.novice-task[data-tid="'+r+'"]');p.length&&(l.ps>0&&p.find(".action-btn").removeClass("todo").addClass("done").text("领取"),0===l.ps&&l.a>0&&p.find(".action-btn").removeClass("todo").addClass("disabled").text("已领取"))}}},updateRemind:function(e){var t,a,i=this,s=[];for(t in e)if(1===e[t].is_new)for(a in e[t].ts)s.push(e[t].ts[a].task_id);s=s.join(","),s&&this.request(this.config.urls.getRemindPrice,{task_ids:s},function(e){for(t in e)"-1"!==e[t].tpb&&(e[t].tpb>0?i.doms.taskPanel.find('[data-tid="'+e[t].tid+'"] .remain-num').text("剩余"+e[t].tpb+"份").show():i.doms.taskPanel.find('[data-tid="'+e[t].tid+'"] .remain-num').text("抢光了").show())})},getAward:function(t,a,i){var s=this,n={idpre:"task_reward",op_type:29,success:function(n){s.gee.destroy(),e(".v3-sign-wrap").remove();var r={geetest_challenge:n.geetest_challenge,geetest_validate:n.geetest_validate,geetest_seccode:n.geetest_seccode,room_id:o.get("room.room_id"),task_id:t,game_type:a};e.ajax("/member/task/reward_new",{type:"POST",data:r,dataType:"json",success:function(n){0===n.error?(s.gee&&(s.gee.destroy(),e(".v3-sign-wrap").remove()),s.handleReward(n,t,a,i)):e.dialog.tips_black(n.msg,2)},error:function(){e.dialog.tips_black("领取失败！",2)}})},error:function(){e.ajax("/member/task/reward_new",{type:"POST",data:data,dataType:"json",success:function(n){0===n.error?(s.gee&&(s.gee.destroy(),e(".v3-sign-wrap").remove()),s.handleReward(n,t,a,i)):e.dialog.tips_black(n.msg,2)},error:function(){e.dialog.tips_black("领取失败！",2)}})}};e("body").append('<div class="v3-sign-wrap"><div class="v3-sign-close">×</div><span class="v3-sign-lsq"></span><div class="v3-sign-header"><span>验证通过</span>后可以领取对应奖励</div><div class="v3-sign-area"></div><div class="captcha-gt" id="v3-sign-captcha-gt"></div><div class="v3-sign"></div></div>'),s.gee=l.init(e("#v3-sign-captcha-gt"),n,{product:"custom",width:"100%",area:".v3-sign-area",next_width:"260px",bg_color:"transparent"})},handleReward:function(t,a,i,s){var n,o,r,l=this,d=l.doms.statusNActions,c=l.doms.header;if(t)if(n=t.error,0===n){if(o=t.data){var u=0;if(7===i?r=l.taskStatus["15-0-"+a]:(4===i?u=1:2===i&&(u=2),r=l.taskStatus[a+"-"+u+"--1"]),r){if("presult"in o){if(0!==Number(o.presult)&&0!==Number(o.result))return void e.dialog.tips_black("领取失败！",3)}else if(0!==Number(o.result))return void e.dialog.tips_black("领取失败！",3);if(0===Number(o.result)&&(+o.sb>0&&(d.find('[data-login-user="silver"]').text(+o.sb),c.find('[data-login-user="silver"]').text(+o.sb)),+o.gb>0&&(d.find('[data-login-user="gold"]').text(+o.gb),c.find('[data-login-user="gold"]').text(+o.gb))),e.dialog.tips_black("恭喜您，已成功领取奖励！",3),r.ps=0,l.updateTask(),s){var g;l.updateReward(s),g=7===i?l.doms.taskPanel.find('.task-done-card[data-id="'+a+'"]'):l.doms.taskPanel.find('.task-done-card[data-tid="'+a+'"]'),g.remove(),0===l.doms.taskPanel.find(".task-done-card").length?l.doms.taskPanel.find(".get-reward-list").remove():l.doms.taskPanel.find(".get-reward-list span").text(l.doms.taskPanel.find(".task-done-card").length)}else 7===i?l.doms.taskPanel.find('.task-done-card[data-id="'+a+'"]').remove():l.doms.taskPanel.find('.task-done-card[data-tid="'+a+'"]').remove(),0===l.doms.taskPanel.find(".task-done-card").length?l.doms.taskPanel.find(".get-reward-list").remove():l.doms.taskPanel.find(".get-reward-list span").text(l.doms.taskPanel.find(".task-done-card").length);if(l.config.doneData&&l.config.doneData.length)for(var m=0;m<l.config.doneData.length;m++)7===i&&Number(l.config.doneData[m].app_id)===a?l.config.doneData.splice(m,1):Number(l.config.doneData[m].task_id)===a&&l.config.doneData[m].g_t===i&&l.config.doneData.splice(m,1)}}}else t.msg?e.dialog.tips_black(t.msg,1):e.dialog.tips_black("领取失败",1)},updateReward:function(e){var t=[];e.caviar&&(this.config.reward.caviar+=e.caviar),this.config.reward.caviar>0&&t.push("<span>"+this.config.reward.caviar+"</span>鱼籽"),e.coupon&&(this.config.reward.coupon+=e.coupon),this.config.reward.coupon>0&&t.push("<span>"+this.config.reward.coupon+"</span>元代金券"),e.silver&&(this.config.reward.silver+=e.silver),this.config.reward.silver>0&&t.push("<span>"+this.config.reward.silver+"</span>鱼丸"),e.gold&&(this.config.reward.gold+=e.gold),this.config.reward.gold>0&&t.push("<span>"+this.config.reward.gold+"</span>鱼翅"),e.prop&&(this.config.reward.prop+=e.prop),this.config.reward.prop>0&&t.push("<span>"+this.config.reward.prop+"</span>个道具礼包"),e.game&&(this.config.reward.game+=e.game),this.config.reward.game>0&&t.push("<span>"+this.config.reward.game+"</span>个游戏礼包"),e.lottery&&(this.config.reward.lottery+=e.lottery),this.config.reward.lottery>0&&t.push("<span>"+this.config.reward.lottery+"</span>次抽奖机会"),this.doms.taskPanel.find(".gift-list").show(),this.doms.taskPanel.find(".gift-list div").html(t.join("、"))},getTemplate:function(e){switch(e){case"main":return i.string.join('<div class="task-top">','<div class="task-tabs-item task-tabs-item-first" data-tab="recommend">',"<span>推荐任务</span>","</div>",'<div class="task-tabs-item" data-tab="web-game">',"<span>页游任务</span>","</div>",'<div class="task-tabs-item" data-tab="ios-game">',"<span>苹果任务</span>","</div>",'<div class="task-tabs-item" data-tab="android-game">',"<span>安卓任务</span>","</div>",'<div class="task-tabs-item" data-tab="novice">',"<span>新手任务</span>","</div>",'<div class="task-tabs-item" data-tab="record">',"<span>领取记录</span>","</div>",'<div class="task-close"></div>',"</div>",'<div class="task-content-wrap">','<div class="task-content task-loading recommend active"></div>','<div class="task-content task-loading web-game"></div>','<div class="task-content task-loading ios-game"></div>','<div class="task-content task-loading android-game"></div>','<div class="task-content task-loading novice"></div>','<div class="task-content task-loading record"></div>',"</div>");case"gameSideCard":return i.string.join("{{ each list as game index }}",'<div class="game-side-card" data-id="{{game.app_id}}"  data-isnew="{{game.is_new}}" data-gtt="{{game.gtt}}">','<div class="name-info" title="{{game.name}}"><span class="name">{{game.name}}</span>(<span class="complete-status">0</span>/{{game.tt}})</div>',"{{if game.totalSilver > 0}}",'<div class="total-reward {{if !recommend}}no-recommend{{/if}}">最高可得<span>{{game.totalSilver}}</span>鱼丸</div>',"{{/if}}","{{if recommend}}",'<div class="platform">{{game.platform}}</div>',"{{/if}}",'<div class="trigger-icon"></div>','<div class="task-status-list">',"{{each game.ts as task }}",'<div class="task-status" data-tid="{{task.task_id}}"  data-all="{{task.levels_cnt}}"><i class="{{task.task_type_class}}"></i><span class="task-name">{{task.name}}</span>(<span class="done-num">0</span>/{{task.levels_cnt}})</div>',"{{/each}}","</div>","</div>","{{/each}}");case"recommend":return i.string.join('<div class="task-game-list-bar">',"</div>",'<div class="recommend-task-main">','<div class="recommend-game-list">',"</div>","</div>",'<div class="game-top-info">',"<p>使用斗鱼APP扫码下载</p>",'<div class="qr-img"></div>',"</div>",'<div class="footer-fix"><a class="play-btn-bottom" target="_blank"></a>');case"gameList":return i.string.join('<div class="task-game-list-bar">',"</div>",'<div class="game-main">',"</div>",'<div class="game-top-info">',"<p>使用斗鱼APP扫码下载</p>",'<div class="qr-img"></div>',"</div>");case"novice":return i.string.join('<div class="novice-title">任务说明：完成任务后，返回任务大厅领取鱼丸</div>','<div class="novice-task-main">',"<p>{{ts.length}}个任务</p>",'<div class="novice-game-list">',"{{ each ts as task index}}",this.getTemplate("noviceTask"),"{{/each}}","</div>","</div>");case"noviceTask":return i.string.join('<div class="novice-task" data-tid="{{task.tId}}" data-gtt="5">','<div class="task-icon task-{{task.tId}}"></div>','<div class="task-name">{{task.tName}}</div>',"{{ if task.award.caviar}}",'<div class="task-reward platform-coin">',"<i></i>{{task.award.caviar}}鱼籽</div>","{{/if}}","{{ if task.award.coupon}}",'<div class="task-reward coupon">',"<i></i>{{task.award.coupon}}元代金券</div>","{{/if}}","{{ if task.award.silver}}",'<div class="task-reward silver">',"<i></i>{{ task.award.silver}}鱼丸</div>","{{/if}}","{{ if task.award.prop}}",'<div class="task-reward gift">',"<i></i><span>{{task.award.prop}}</span>个道具</div>","{{/if}}",'<div class="task-description">打开斗鱼个人中心，在基本资料中完成{{task.tName}}</div>','<a class="action-btn todo" href="{{task.cUrl}}" target="_blank">{{task.cName}}</a>',"</div>");case"taskDoneCard":return i.string.join('<div class="gift-list">您已成功领取到：<div></div></div>',"{{each list as task index}}",'<div class="task-done-card" data-id="{{task.app_id}}" data-tid="{{task.task_id}}" {{if (task.g_t === 3 && task.sst !== "old_android")}}data-gtt="1"{{else}}data-gtt="{{task.g_t}}"{{/if}}>','<div class="task-title">','<div class="task-name">{{task.name}}</div>','<div class="game-name">{{task.app_name}}</div>','<div class="platform {{if task.g_t === 2 || task.g_t === 7}}ios{{else if (task.g_t === 3 && task.sst === "old_android") || task.g_t === 4}}android{{else}}web{{/if}}"></div>',"</div>",'<div class="reward-list">',"{{ if task.caviar > 0}}",'<div class="task-reward platform-coin" data-num="{{task.caviar}}"><i></i>{{task.caviar}}鱼籽</div>',"{{/if}}","{{ if task.coupon > 0}}",'<div class="task-reward coupon" data-num="{{task.coupon}}"><i></i>{{task.coupon}}元代金券</div>',"{{/if}}","{{ if task.silver > 0}}",'<div class="task-reward silver" data-num="{{task.silver}}"><i></i>{{task.silver}}鱼丸</div>',"{{/if}}","{{ if task.gold > 0}}",'<div class="task-reward gold" data-num="{{task.gold}}"><i></i>{{task.gold}}鱼翅</div>',"{{/if}}","{{ if task.prop && task.prop.length}}","{{each task.prop as prop}}",'<div class="task-reward gift" data-pid="{{prop.prop_id}}" data-num="{{prop.prop_num}}">',"<i></i>{{if prop.prop_num > 1}}{{prop.prop_num}}个{{/if}}<span>{{prop.prop_name}}</span>","</div>","{{/each}}","{{/if}}","{{ if task.gift && task.gift.length}}","{{each task.gift as gift}}",'<div class="task-reward game" data-gid="{{gift.id}}" data-num="{{gift.num}}">',"<i></i>{{if gift.num > 1}}{{gift.num}}个{{/if}}<span>{{gift.name}}</span>","</div>","{{/each}}","{{/if}}","{{ if task.lottery && task.lottery.length}}","{{each task.lottery as lottery}}",'<div class="task-reward lottery" data-url="{{lottery.id}}" data-num="{{lottery.num}}">',"<i></i>{{lottery.num}}次<span>抽奖机会</span>",'<div class="lottery-info">','<div class="arrow"></div>',"<p>{{lottery.name}}</p>",'<div class="lottery-url qr-img" data-url="{{lottery.mg_act_url}}"></div>',"<span>斗鱼APP扫码参与抽奖</span>","</div>","</div>","{{/each}}","{{/if}}",'<div class="get-reward-btn active one-key">领取</div>',"</div>","</div>","{{/each}}");case"recordCard":return i.string.join("{{ each list as record}}",'<div class="record-card">','<div class="task-title">','<span class="task-name" title="{{record.name}}">{{record.name}}</span>','<span class="time">{{record.receive_time}}</span>','<span class="game-name" title="{{record.app_name}}">{{record.app_name}}</span>',"</div>",'<div class="reward-list">',"{{ each record.level as level}}",'<div class="reward-detail">','<span class="task-description" title="{{level.condition}}">{{level.condition}}</span>',"{{if level.reward}}",'<div class="rewards">',"{{if level.reward.caviar}}",'<span class="task-reward platform-coin"><i></i>{{level.reward.caviar}}鱼籽</span>',"{{/if}}","{{if level.reward.coupon && level.reward.coupon.length}}","{{each level.reward.coupon as coupon}}",'<span class="task-reward coupon"><i></i>{{coupon.name}}</span>',"{{/each}}","{{/if}}","{{if level.reward.silver}}",'<span class="task-reward silver"><i></i>{{level.reward.silver}}鱼丸</span>',"{{/if}}","{{if level.reward.gold}}",'<span class="task-reward gold"><i></i>{{level.reward.gold}}鱼翅</span>',"{{/if}}","{{if level.reward.prop && level.reward.prop.length}}","{{each level.reward.prop as prop}}",'<span class="task-reward gift" data-pid={{prop.prop_id}}><i></i>{{if prop.prop_num > 1}}{{prop.prop_num}}个{{/if}}<span>{{prop.prop_name}}</span></span>',"{{/each}}","{{/if}}","{{ if level.reward.gift && level.reward.gift.length}}","{{each level.reward.gift as gift}}",'<div class="task-reward game" data-gid="{{gift.id}}">',"<i></i>{{if gift.num > 1}}{{gift.num}}个{{/if}}<span>{{gift.name}}</span>","</div>","{{/each}}","{{/if}}","{{ if level.reward.lottery && level.reward.lottery.length}}","{{each level.reward.lottery as lottery}}",'<div class="task-reward lottery" data-url="{{lottery.id}}">',"<i></i>{{lottery.num}}次<span>抽奖机会</span>",'<div class="lottery-info">','<div class="arrow"></div>',"<p>{{lottery.name}}</p>",'<div class="lottery-url qr-img" data-url="{{lottery.mg_act_url}}"></div>',"<span>斗鱼APP扫码参与抽奖</span>","</div>","</div>","{{/each}}","{{/if}}","</div>","{{/if}}","</div>","{{/each}}","</div>","</div>","{{/each}}");
case"gameAllTask":return i.string.join('<div class="game-task-panel" data-id="{{app_id}}">','<div class="game-info">','<img class="game-icon" src="{{icon}}"/>','<div class="game-name">{{name}}</div>','<div class="game-type">{{cid2_name}} | {{size}}</div>','<div class="game-description">{{desc}}</div>','<div class="divide-line"></div>','<div class="qr-code">','<div class="qr-img" data-url="{{url}}"></div>',"<p>斗鱼APP扫码下载</p>","</div>","</div>",'{{if gameType === "ios"}}','<div class="ios-tip"><i></i>任务需知','<div class="tip-popup">','<div class="background"></div>','<div class="arrow-up"></div>',"<p>• 若为充值类任务或其他游戏内任务，则必须先完成激活任务后，才可继续进行其他任务。<br><br>• 必须从最新版斗鱼APP跳转到app store下载游戏才可以完成任务。<br><br>• 如任务无法完成，请检查 设置-隐私-广告 中的限制广告跟踪功能 是否已开启。如已开启，请关闭限制广告跟踪功能后重新从斗鱼APP下载游戏。</p>","</div>","</div>","{{/if}}",'{{if gameType === "android"}}','<div class="ios-tip"><i></i>任务需知','<div class="tip-popup">','<div class="background"></div>','<div class="arrow-up"></div>',"<p>• 请务必确认您已使用您的斗鱼账号登录游戏。只有使用斗鱼账号登录才可能获得任务奖励。<br><br>• 部分手机厂商会以系统安全为由欺骗您并替换您从斗鱼下载的游戏安装包，请在安装游戏时务必注意系统提示，斗鱼确保您从官方app内下载的任何手游都是安全无毒的。</p>","</div>","</div>","{{/if}}",'<div class="reward-time-rule"><i></i>奖励领取期限','<div class="rule-popup">','<div class="background"></div>','<div class="arrow-up"></div>',"<p>奖励领取期限说明</p>","<p>1. 每日、每周、每月任务，必须在完成任务的周期内领取奖励，否则将失去领取机会</p>","<p>2. 短期且仅可完成一次的任务，必须在任务结束后24小时内领取奖励，否则将失去领取机会</p>","<p>3. 长期在线且仅可完成一次的任务，需要在任务完成后30天内领取奖励，否则将失去领取机会</p>","</div>","</div>",'<div class="task-main">',"{{ each ts as task index}}",'<div class="game-task-all" data-tid="{{task.task_id}}" data-gtt="{{gtt}}">','<div class="task-title">','<img class="task-icon" src="{{task.icon}}"/>','<div class="task-name" title="{{task.name}}">','<span class="name-text">{{task.name}}</span>','<span class="task-status">(<i>0</i>/{{task.levels.length}})</span>',"{{ if task.is_limit === 1}}",'<span class="remain-num">剩余0份</span>',"{{/if}}","</div>",'<div class="status {{task.status}}"></div>','<div class="tag-list">',"{{ if task.tag}}",'<span class="tag">{{task.tag}}</span>',"{{/if}}","{{ if task.reset_type}}",'<span class="tag">{{ if task.reset_type === 1}}每日任务{{ else if task.reset_type === 2}}每周任务{{ else if task.reset_type === 3}}每月任务{{ else if task.reset_type === 4}}{{if task.t_type === 1}}长期任务{{else}}短期任务{{/if}}{{/if}}<i class="help"></i>','<div class="help-popup">','<div class="arrow-up"></div>','<div class="background"></div>',"<p>1.每日、每周、每月任务，必须在完成任务的周期内领取奖励，否则将失去领取机会</p>","<p>2.短期且仅可完成一次的任务，必须在任务结束后24小时内领取奖励，否则将失去领取机会</p>","<p>3.长期在线且仅可完成一次的任务，需要在奖励完成后30天内领取奖励，否则将失去领取机会</p>","</div>","</span>","{{/if}}","</div>",'<div class="task-description">{{#task.task_desc}}</div>',"</div>",'<div class="task-list">',"{{ each task.levels as level }}",'<div class="task-item">',"{{ if is_new === 1 || task.gtt === 7}}",'<span class="task-detail">{{level.desc}}，获得</span>','<div class="rewards">',"{{ if level.reward.caviar}}",'<div class="task-reward platform-coin">',"<i></i>{{level.reward.caviar}}鱼籽","</div>","{{/if}}","{{ if level.reward.coupon}}","{{each level.reward.coupon as coupon}}",'<div class="task-reward coupon">',"<i></i>{{coupon.name}}","</div>","{{/each}}","{{/if}}","{{ if level.reward.silver && level.reward.silver.num}}",'<div class="task-reward silver">',"<i></i>{{level.reward.silver.num}}鱼丸","</div>","{{/if}}","{{ if level.reward.gold}}",'<div class="task-reward gold">',"<i></i>{{level.reward.gold}}鱼翅","</div>","{{/if}}","{{ if level.reward.prop && level.reward.prop.prop_num}}",'<div class="task-reward gift" data-pid="{{level.reward.prop.prop_id}}">',"<i></i>{{if level.reward.prop.prop_num > 1}}{{level.reward.prop.prop_num}}个{{/if}}<span>{{level.reward.prop.prop_name}}</span>","</div>","{{/if}}","{{ if level.reward.gift && level.reward.gift.length}}","{{each level.reward.gift as gift}}",'<div class="task-reward game" data-gid="{{gift.id}}">',"<i></i>{{if gift.num > 1}}{{gift.num}}个{{/if}}<span>{{gift.name}}</span>","</div>","{{/each}}","{{/if}}","{{ if level.reward.lottery && level.reward.lottery.length}}","{{each level.reward.lottery as lottery}}",'<div class="task-reward lottery" data-url="{{lottery.id}}">',"<i></i>{{lottery.num}}次<span>抽奖机会</span>",'<div class="lottery-info">','<div class="arrow"></div>',"<p>{{lottery.name}}</p>",'<div class="lottery-url qr-img" data-url="{{lottery.mg_act_url}}"></div>',"<span>斗鱼APP扫码参与抽奖</span>","</div>","</div>","{{/each}}","{{/if}}","</div>","{{else}}","{{ if task.task_type == 1}}",'<span class="task-detail">',"单天等级提升{{level.up_grade}}级，可获得</span>","{{ else if task.task_type == 2}}",'<span class="task-detail">',"达到{{level.to_grade}}级，可获得</span>","{{ else if task.task_type == 3}}",'<span class="task-detail">',"单天充值满{{level.rmb}}RMB，可获得</span>","{{ else if task.task_type == 5}}",'<span class="task-detail">',"到达{{level.to_grade}}战斗力，可获得</span>","{{/if}}",'<div class="rewards">','{{ if level.silver && level.silver !== "0"}}','<div class="task-reward silver">',"<i></i>{{level.silver}}鱼丸","</div>","{{/if}}","{{ if level.props && level.props.length}}","{{each level.props as prop}}",'<div class="task-reward gift" data-pid="{{prop.prop_id}}">',"<i></i>{{if prop.prop_num > 1}}{{prop.prop_num}}个{{/if}}<span>{{prop.prop_name}}</span>","</div>","{{/each}}","{{/if}}","</div>","{{/if}}",'<span class="complete-status">未完成</span>','<div class="clearfix"></div>',"</div>","{{/each}}",'<div class="task-footer">',"{{ if task.t_type !== 1}}",'<span class="time">{{task.startTime}} 至 {{task.endTime}}</span>',"{{/if}}","{{if task.reward_channel === 2}}",'<div class="channel-tip"><i></i>提示','<div class="tip-popup">','<div class="background"></div>','<div class="arrow-right"></div>',"<p>此任务的奖励会自动发放，无需手动领取。完成任务后请关注站内信通知。</p>","<p>必须从最新版本斗鱼app跳转至app store下载游戏才可以完成任务。如果任务无法完成，请检查设置-隐私-广告中的限制广告跟踪功能是否已开启。如已开启，请关闭限制广告跟踪功能后重新从斗鱼app下载游戏。</p>","</div>","</div>","{{else}}",'<div class="get-reward-btn disabled">全部领取</div>',"{{/if}}","</div>","</div>","</div>","{{/each}}","</div>","</div>");case"webGameTask":return i.string.join('<p class="task-num">{{ts.length}}个任务</p>','<div class="web-game-task" data-id="{{app_id}}">',"{{ each ts as task index}}",'<div class="game-task-all" data-tid="{{task.task_id}}" data-gtt="{{gtt}}">','<div class="task-title">','<img class="task-icon" src="{{task.icon}}"/>','<div class="task-name" title="{{task.name}}">{{task.name}}</div>','<div class="status"></div>','<div class="task-description">{{#task.task_desc}}</div>',"</div>",'<div class="task-list">','<div class="task-footer">','<div class="complete-status">任务完成进度 <span>0</span>/{{task.levels.length}}</div>','<div class="get-reward-btn disabled">领取</div>',"</div>","</div>","</div>","{{/each}}","</div>");default:return""}},request:function(t,a,i,s,n){var o=this,r=a,l=i,d=s,c=n;"string"!=typeof r&&(c=d,d=l,l=r,r="GET"),"function"==typeof l&&(c=d,d=l),c&&o.config.loadLock[c]||(c&&(o.config.loadLock[c]=!0),e.ajax({url:t,type:r,data:l,dataType:"json",success:function(t){c&&(o.config.loadLock[c]=!1),0===t.error?d(t.data):e.dialog.tips_black(t.msg)},error:function(t){c&&(o.config.loadLock[c]=!1),e.dialog.tips_black("请求失败")}}))}};return{init:function(){c.init()}}}),define("douyu/page/room/normal/mod/task-addon",["jquery","shark/observer","shark/util/cookie/1.0","shark/util/storage/1.0","douyu/context","douyu/com/user"],function(e,t,a,i,s,n){var o={storageName:"paytask",taskTimeout:!1,taskReady:!1},r={init:function(e){this.getDoms(),this.render()},getDoms:function(){this.doms={$target:e("#js-room-video"),$taskPanel:e("#js-room-task-panel")}},render:function(){var e=this;t.on("pay.task.ready",function(){o.taskReady=!0,e.check()}),t.on("pay.task.timeout",function(){o.taskTimeout=!0,e.check()})},check:function(){return o.taskReady&&o.taskTimeout?void this.makeHtml():!1},getRestTime:function(e){var t,a;return e=parseInt(e,10),e=e?e:0,t=new Date,t.setDate(t.getDate()+e),t.setHours(24),t.setMinutes(0),t.setSeconds(0),a=t.getTime()-(new Date).getTime()},makeHtml:function(){var a=this,i=['<div class="pay-task">','<a href="javascript:;" class="pay-task-btn pay-task-open">&nbsp</a>','<a href="javascript:;" class="pay-task-btn pay-task-notip">&nbsp</a>','<a href="javascript:;" class="pay-task-btn pay-task-close">&nbsp</a>',"</div>"].join(""),s=e(i);t.trigger("mod.layer.tips.render",{storagename:o.storageName,$tip:s,$el:a.doms.$target,closeEleClassName:"",handleFn:function(){s.animate({bottom:45},1e3),s.find(".pay-task-open").on("click",function(e){t.trigger("mod.task.tid64.undo.showpanel"),s.hide(),t.trigger("dys",{key:"dys.room.task.new.get"})}),s.find(".pay-task-notip").on("click",function(e){s.hide(),t.trigger("dys",{key:"dys.room.task.new.nomore"})}),s.find(".pay-task-close").on("click",function(e){s.hide(),t.trigger("dys",{key:"dys.room.task.new.close"})})}}),t.trigger("dys",{key:"dys.room.task.guide.show"})}};return{init:function(){r.init()}}}),define("douyu/page/room/normal/mod/vcode-v3-sign",["jquery","shark/class","shark/util/lang/1.0","shark/util/template/2.0","douyu/context","douyu/com/sign","douyu/com/imgp","douyu/com/vcode-v3"],function(e,t,a,i,s,n,o,r){var l={sign:null,V3Instance:null},d=t({init:function(t){this.config=e.extend(!0,{},{title:"验证码",title1:"",shadow:{opacity:.7},pid:30010},t),this.render(),this.bindEvt()},v3Init:function(){var t=this,a=e("#v3-sign-captcha-gt");l.V3Instance=r.init(a,{op_type:27,idpre:t.config.idpre,success:t.config.success||function(){},error:t.v3Error||function(){}},{product:"custom",width:"100%",area:".v3-sign-area",next_width:"260px",bg_color:"transparent"})},render:function(){var t=this.make(),a=e("body");this.config.$pop=e(t.pop),this.config.$shadow=e(t.shadow),a.append(this.config.$pop),a.append(this.config.$shadow),this.config._is_show=!1,this.v3Init(),this.show()},tpls:function(){var e=this,t=function(t){var s=a.string.join('<div class="v3-sign-wrap">','<div class="v3-sign-close">&times;</div>','<span class="v3-sign-lsq"></span>','<div class="v3-sign-header">',"<span>{{ title1 }}</span>{{ title2 }}","</div>",'<div class="v3-sign-area"></div>','<div class="captcha-gt" id="v3-sign-captcha-gt"></div>','<div class="v3-sign"></div>',"</div>"),n=i.compile(s),o=n({title1:e.config.title1,title2:e.config.title});return o},s=function(){var t=a.string.join('<div class="v3-sign-shadow" style="opacity: {{ opacity }}; filter: {{ filterOpacity }}"></div>'),s=i.compile(t),n=s({opacity:e.config.shadow.opacity,filterOpacity:"Alpha(Opacity="+100*e.config.shadow.opacity+")"});return n};return{pop:t(),shadow:s()}},make:function(){var t=this.tpls();return{pop:e(t.pop),shadow:e(t.shadow)}},v3Error:function(){e("#v3-sign-captcha-gt").text("验证码加载失败，请稍后重试。")},showSign:function(){var t=this.config.pid,i=s.get("room.user_best_cq"),n=e("[data-dysign="+t+"]").clone().attr({style:""});if(n.size()&&e.trim(n.html())&&!(i>0)){var o=a.string.join('<div class="vcode9-sign">','<div class="s-cdown">','<span class="closetxt"><em>0</em>s 后可关闭广告</span>','<span class="closebtn" style="">关闭</span>','<span class="cqnosign">酬勤用户免广告</span>',"</div>",'<div class="s-box"></div>',"</div>"),r=this;this.config.$sign=e(o),this.config.$pop.find(".v3-sign").append(this.config.$sign),this.config.$sign.find(".s-box").empty().append(n),this.config.$sign.find(".s-cdown .closebtn").one("click",function(){r.hideSign()}),this.cdownSign()}},cdownSign:function(){var e=this.config.$sign,t=this;e&&(this.config.signCount=15,e.show(),e.find(".s-cdown .closetxt em").text(5),e.find(".s-cdown .closetxt").show(),e.find(".s-cdown .closebtn").hide(),o.build(),l.isExposured||(n.exposure(),l.isExposured=!0),this.config.signTimer=setInterval(function(){t.config.signCount--,t.config.signCount<0&&(t.hideSign(),clearInterval(t.config.signTimer)),t.config.signCount<10?(e.find(".s-cdown .closetxt").hide(),e.find(".s-cdown .closebtn").show()):e.find(".s-cdown .closetxt em").text(t.config.signCount-10)},1e3))},hideSign:function(){this.config.$sign&&(this.config.$sign.hide(),this.config.$sign.find(".s-box").empty()),this.config.signTimer&&clearInterval(this.config.signTimer)},show:function(){var e=this;this.config.$pop.fadeIn(function(){e.config._is_show=!0,e.config.sign&&l.V3Instance&&e.showSign()})},hide:function(){var e=this;this.config.$pop.fadeOut(function(){e.config._is_show=!1,e.config.sign&&e.hideSign()})},destroy:function(){this.config.$pop.remove(),this.config.$shadow.remove(),l.V3Instance&&e.isFunction(l.V3Instance.destroy)&&l.V3Instance.destroy()},refresh:function(){l.V3Instance&&e.isFunction(l.V3Instance.refresh)&&l.V3Instance.refresh()},bindEvt:function(){var e=this;this.config.$pop.on("click",".v3-sign-close",function(){return e.destroy(),!1})}}),c={create:function(e){return new d(e)}};return c}),define("douyu/page/room/normal/mod/olyw",["jquery","shark/class","shark/observer","shark/util/lang/1.0","douyu/context","douyu/com/user","douyu/page/room/base/api","shark/util/flash/data/1.0","shark/util/template/1.0","shark/util/storage/1.0","douyu/page/room/normal/mod/vcode-v3-sign","douyu/page/room/normal/mod/super-recommended"],function(e,t,a,i,s,n,o,r,l,d,c,u){var g,m,p,f=(window.DYS,{yw:{state:{open:"open",close:"close"}}});g=t({tmpl:function(){var t=['<div class="ywtipbox" data-tip-title="tip">','<a class="get-box" href="javascript:;">','<i class="yw-icon"></i>','<span class="g-time">领取</span>',"</a>",'<div class="yw-warmTip tip"><div class="arrow"></div><span class="getyw-time">领取</span></div>',"</div>",'<div class="yw-collect-box hide">','<span class="close"></span>','<ul class="cb-list">',"<li>",'<span class="wait-get"></span>','<a href="javascript:;" class="next-btn">等待中</a>',"</li>","<li>",'<span class="wait-get"></span>','<a href="javascript:;" class="next-btn">等待中</a>',"</li>","<li>",'<span class="wait-get"></span>','<a href="javascript:;" class="next-btn">等待中</a>',"</li>","<li>",'<span class="wait-get"></span>','<a href="javascript:;" class="next-btn">等待中</a>',"</li>","<li>",'<span class="wait-get"></span>','<a href="javascript:;" class="next-btn">酬勤专享</a>',"</li>","<li>",'<span class="wait-get"></span>','<a href="javascript:;" class="next-btn">酬勤专享</a>',"</li>","</ul>",'<div class="c-txt get-state-special">别着急，奖励正在准备中，鱼丸、经验、道具等你来</div>','<p class="yw-app-des">',"手机看直播专享奖励，暴击<b>1000</b>鱼丸等你来领！",'<a href="/client" target="_blank"  class="download-btn">立即下载</a>',"</p>","<!-- 领鱼丸失败 -->",'<div class="get-defeat hide">',"<h3>领取失败</h3>","<p>您本次领取鱼丸的地点和之前观看地点冲突,本段观看时长将被清零,继续观看后可领取。</p>","<p>造成此问题的原因可能是因为您的账号已经被盗,建议您及时修改密码以及已绑定邮箱的密码</p>","</div>",'<div class="get-defeat2 hide">',"<h3>领取失败</h3>","<p>您今天领取的鱼丸已经超过数量上限啦，休息一下明日再来吧</p>","</div>","</div>",'<div class="get-fc get-fc2 hide">','<a href="javascript:;" title="关闭"></a>',"</div>"];e(".get-yw").html(t.join(""))},init:function(){this.tmpl(),this.timer=null,this.config=e.extend(!0,{},{ncqMaxLev:4,cqMaxLev:6,islog:!1,roomPointLow:!1,target:"#js-stats-and-actions .get-yw",time:".getyw-time",ywBtnText:".g-time",pic:".g-pic",pop:".get-yw .yw-collect-box",personal_yw:'[data-login-user="silver"]',state:f.yw.state.close,firstLoad:!0,timer:!0,ywGetHigh:"yw-get-high",ywOver:"yw-over",ywMake:"yw-make",list:{wait:{timeText:"等待",content:"别着急，奖励正在准备中，鱼丸、经验、道具等你来",cls:"get-state-next",pic:"wait-get",cqPic:"w-cq-get",btn:"next-btn",text:"等待中",cqText:"酬勤专享"},may:{timeText:"领取",content:"请点击领取您的奖励！",cls:"get-state-udrw",pic:"may-get",cqPic:"cq-get",btn:"may-btn",text:"可领取"},yet:{timeText:"",content:"",cls:"get-state-ard",pic:"yet",cqPic:"yet",btn:"yet-btn",text:"已领取"},over:{timeText:"完成",content:'<span class="moretask" style="cursor: pointer;">做任务领取更多鱼丸！</span>',cls:"get-state-ard",pic:"yet-get",cqPic:"yet-get",btn:"yet-btn",text:"已领取"}}}),this.state={cq:0,level:0,time:0,over:!1,yw:0,exp:0},this.getDoms(),this.render(),this.bindEvt()},getDoms:function(){var t=this,a=e(this.config.target),i=e(this.config.pop);this.doms={$el:a,$time:e(t.config.time),$ywBtnText:e(t.config.ywBtnText),$pic:e(t.config.pic),$pop:i,$personal_yw:e(t.config.personal_yw).eq(0),$yws:i.find(".cb-list li"),$ywPics:i.find(".cb-list li span"),$ywBtns:i.find(".cb-list li a"),$text:i.find(".c-txt"),$getBox:a.find(".get-box")}},render:function(){var e=this;this.initList(),this.observer=a.create(this),this.observer.on("login",this.isLog),this.observer.on("toggle",this.toggle),this.observer.on("cq.over",function(t){e.renderTime("cqover",t),e.renderList("cqover",t),e.renderText("over")}),this.observer.on("ncq.over",function(t){e.renderTime("ncqover",t),e.renderList("ncqover",t),e.config.firstLoad&&t.over&&e.renderText("over")}),this.observer.on("wait",function(t){e.renderTime("wait",t),e.renderList("wait",t)}),this.observer.on("may",function(t){e.renderTime("may",t),e.renderList("may",t),t.over?e.renderText("over"):e.renderText("may")}),a.on("mod.userinfo.userinfoready",function(){e.config.userinfo=!0}),a.on("mod.olyw.destroy",function(t){t=!t,e.toggleBan(t)}),a.on("mod.chouqin.change",function(t){e.setState({cq:4})}),a.on("mod.roompoint.low",function(t){e.config.roomPointLow=!!t}),o.reg("room_data_chest",function(t){e.getFlashTime(t)}),o.reg("room_data_olyw",function(e){a.trigger("mod.chat.msg.res.olyw.luckburst",e)})},setState:function(t){var a=this;this.state=e.extend(!0,{},a.state,t)},initList:function(){var e=this.doms.$el;e.find(".cb-list li");this.renderAllList("wait",this.config.cqMaxLev),this.renderText("wait")},getFlashTime:function(e){var t=r.decode(e),a=Number(t[0].value),i=Number(t[1].value),s=Number(t[2].value);this.config.isBan||(i=i?i+60:i,this.setState({cq:s,level:a,time:i}),this.config.firstLoad&&(this.updateTime(),this.config.firstLoad=!1))},updateTime:function(){var e=this,t=(this.doms.$el,this.doms.$time,this.doms.$ywBtnText,this.state);return this.setState({over:!1}),t.cq&&t.level>this.config.cqMaxLev?(this.setState({over:!0}),void this.observer.trigger("cq.over",t)):(!t.cq&&t.level>this.config.ncqMaxLev&&(this.setState({over:!0}),this.observer.trigger("ncq.over",t)),t.time>=1?(this.state.time--,this.observer.trigger("wait",t)):(clearTimeout(e.timer),e.config.timer=null,this.observer.trigger("may",e.state)),void(e.config.timer&&(e.timer=setTimeout(function(){e.updateTime()},1e3))))},renderTime:function(e,t){var a=this.config.list,i=0;if(t.time)var s=(s=Math.floor(t.time/60))<10?"0"+s:s,n=(n=t.time%60)<10?"0"+n:n,i=s+":"+n;this.config.cqMaxLev+1;"cqover"===e&&(this.doms.$ywBtnText.html(a.over.timeText).data("isshowtit",!1),this.doms.$time.html(a.over.timeText),this.doms.$getBox.removeClass(this.config.ywMake).removeClass(this.config.ywGetHigh).addClass(this.config.ywOver)),"ncqover"===e&&(this.doms.$ywBtnText.html(a.may.timeText).data("isshowtit",!1),this.doms.$time.html(i||a.may.timeText),this.doms.$getBox.removeClass(this.config.ywMake).removeClass(this.config.ywGetHigh).addClass(this.config.ywOver)),"wait"===e&&(this.doms.$ywBtnText.html(a.wait.timeText).data("isshowtit",!0),this.doms.$time.html(i),this.doms.$getBox.addClass(this.config.ywMake).removeClass(this.config.ywGetHigh).removeClass(this.config.ywOver)),"may"===e&&(this.doms.$ywBtnText.html(a.may.timeText).data("isshowtit",!1),this.doms.$time.html(a.may.timeText),this.doms.$getBox.removeClass(this.config.ywMake).addClass(this.config.ywGetHigh).removeClass(this.config.ywOver),t.over&&(this.doms.$ywBtnText.html(a.over.timeText).data("isshowtit",!1),this.doms.$time.html(a.over.timeText),this.doms.$getBox.removeClass(this.config.ywMake).removeClass(this.config.ywGetHigh).addClass(this.config.ywOver)))},renderList:function(e,t){var a=this.config.list;this.doms;"cqover"===e&&this.renderAllList("yet",this.config.cqMaxLev),"ncqover"===e&&this.renderAllList("yet",this.config.ncqMaxLev),"wait"===e&&this.renderAllList("yet",t.level-1),"may"===e&&(this.renderAllList("yet",t.level-1),t.level>this.config.ncqMaxLev?this.doms.$yws.eq(t.level-1).find("span").removeClass().addClass(a.may.cqPic).end().find("a").html(a.may.text).removeClass().addClass(a.may.btn):this.doms.$yws.eq(t.level-1).find("span").removeClass().addClass(a.may.pic).end().find("a").html(a.may.text).removeClass().addClass(a.may.btn)),"yet"===e&&this.renderAllList("yet",t.level)},renderAllList:function(t,a){var i=this,s=this.config.list;"yet"===t&&this.doms.$yws.each(function(t,i){a>t&&e(i).find("span").removeClass().addClass("yet").end().find("a").html(s.yet.text).removeClass().addClass(s.yet.btn)}),"wait"===t&&this.doms.$yws.each(function(t,n){a>t&&(t+1<=i.config.ncqMaxLev?e(n).find("span").removeClass().addClass(s.wait.pic).end().find("a").html(s.wait.text).removeClass().addClass(s.wait.btn):e(n).find("span").removeClass().addClass(s.wait.cqPic).end().find("a").html(s.wait.cqText).removeClass().addClass(s.wait.btn))})},renderText:function(e,t){var a=this.config.list;switch(e){case"wait":this.doms.$text.removeClass().addClass("c-txt").addClass(a.wait.cls).html(a.wait.content);break;case"may":this.doms.$text.removeClass().addClass("c-txt").addClass(a.may.cls).html(a.may.content);break;case"yet":t&&this.doms.$text.removeClass().addClass("c-txt").addClass(t.cls).html(t.content);break;case"over":this.doms.$text.removeClass().addClass("c-txt").addClass(a.over.cls).html(a.over.content);break;default:this.doms.$text.removeClass().addClass("c-txt").addClass(a.wait.cls).html(a.wait.content)}},renderTip:function(e,t){var a=this.doms.$pop;"yw"===e?a.append('<div class="exp-add"><div class="exprience1"><p><span> +'+t+"鱼丸</span></p></div></div>"):"exp"===e?a.append('<div class="exp-add"><div class="exprience1"><p><span> +'+t+"经验</span></p></div></div>"):"prop"===e&&a.append('<div class="exp-add"><div class="exprience1"><p><span> +'+t+"</span></p></div></div>");var i=a.find(".exprience1"),s=(a.width()-i.width())/2;i.css({position:"absolute",left:s,top:"80px","z-index":200}),i.stop().animate({top:"5px"},1e3).fadeOut("slow",function(){i.remove()})},checkTotalYw:function(t){var i;return this.config.userinfo?(i=this.doms.$personal_yw.text(),i>=2e3?(e.dialog.alert("鱼丸存量达到2000啦! 暂时无法在线领鱼丸(其他获取鱼丸途径不受影响),<br>送点鱼丸给主播再来领取吧!"),a.trigger("dys",{key:"dys.room.yw.get.fail",em:"鱼丸存量超过2000啦! 暂时无法在线领鱼丸(其他获取鱼丸途径不受影响),<br>送点鱼丸给主播再来领取吧!"})):t&&t()):t&&t(),i},handleReturn:function(t,i){var s=t.result,n=parseInt(t.leve),o=this.state.cq,r=t.gift_count||0,l=t.exp/100||0,d=(this.doms.$personal_yw,{}),c="";if(2==s)e.dialog({content:"当前ip输入验证码时错误次数过多，请等待一天后在重新尝试！",icon:"warning",okVal:"确定",ok:function(){}});else if(1==s)e.dialog.tips_black("验证码输入错误",1),p.refresh();else if(0==s){p.destroy(),a.trigger("mod.userinfo.change",{change:{silver:r}}),a.trigger("dys",{key:"dys.room.yw.get.success",yw:r,jy:l});var u=parseInt(t.lack_time);if(u&&(u+=60),this.setState({cq:o,level:n,time:u}),c=t.props?"prop":r?l?"cq":"yw":"exp","yw"===c)d=r>=1e3?{content:"幸运女神眷顾您，恭喜您领取了<b>"+r+"个鱼丸</b>！",cls:"get-state-special"}:{content:"恭喜你领取了<b>"+r+"个鱼丸</b>，领取酬勤专享鱼丸可获双倍鱼丸！",cls:"get-state-ard"},this.renderTip(c,r);else if("exp"===c)d={content:"恭喜你领取了<b>"+l+"经验</b>，领取酬勤专享经验可获双倍经验！",cls:"get-state-ard"},this.renderTip(c,l);else if("cq"===c)d=r>=1e3?{content:"幸运女神眷顾您，恭喜您领取了<b>"+r+"个鱼丸</b>！",cls:"get-state-special"}:{content:"恭喜你领取了<b>"+r+"个鱼丸</b>和<b>"+l+"</b>点经验，领取酬勤专享鱼丸可获双倍经验！",cls:"get-state-ard"},this.renderTip(c,l);else if("prop"===c){var g=[];e(t.props).each(function(e,t){g.push("<b>"+t.count+"个"+t.name+"</b>")}),g=g.join("和"),d={content:"恭喜你领取了"+g,cls:"get-state-ard"},this.renderTip(c,d.content)}this.renderText("yet",d),u?(this.renderTime("wait",this.state),this.renderList("yet",this.state),this.setState({level:n+1})):(this.setState({level:n+1}),this.renderTime("may",this.state)),(!o||o&&6>n)&&(this.config.timer=!0,this.updateTime()),o&&6===n&&(this.setState({over:!0}),this.observer.trigger("cq.over",this.state)),o||4!==n||this.observer.trigger("ncq.over",this.state)}else{s+="";var m="",f="/member";switch(s){case"216":m="需要绑定手机和邮箱才能领取鱼丸！",f="/member";break;case"218":m="需要绑定手机才能领取鱼丸!",f="/member#phone";break;case"219":m="需要绑定邮箱才能领取鱼丸!",f="/member#mod_email";break;case"270":m="请稍后再试!";break;case"283":m="鱼丸存量超过2000啦! 暂时无法在线领鱼丸(其他获取鱼丸途径不受影响),<br>送点鱼丸给主播再来领取吧!";break;case"212":m="非酬勤用户无法领取!";break;case"5803":m="您的背包已满，使用一些再来领取吧";break;default:m="鱼丸领取失败！"}a.trigger("dys",{key:"dys.room.yw.get.fail",em:m}),"363"==s?e(".get-defeat").removeClass("hide").show():"214"==s&&e(".get-defeat2").removeClass("hide").show(),"216"==s||"218"==s||"219"==s?(e.dialog({content:m,title:"提示",icon:"warning",cancelVal:"以后再说",okVal:"立即绑定",lock:!0,ok:function(){window.location.href=f,a.trigger("dys",{key:"dys.room.yw.get.bind.action"})},cancel:function(){p.destroy(),a.trigger("dys",{key:"dys.room.yw.get.bind.close"})}}),a.trigger("dys",{key:"dys.room.yw.get.bind.show"})):e.dialog.alert(m)}},toggleCqTip:function(){var t=arguments,i="",s=this;t.length&&"open"===t[0]?(i='<div class="cq-dialog"><div class="cq-tit"><h3>提示</h3><a href="javascript:;" class="close">×</a></div><div class="cq-cont"><p class="yw-notic-des">噢，第五、六次领取机会为酬勤用户专享，快去给主播赠送一次酬勤来获得海量鱼丸的领取机会吧!</p></div><div class="cq-foot"><a href="javascript:;">赠送酬勤</a><a href="javascript:;" class="cancel">还是算了</a></div></div>',e("body").append(i),e(".cq-dialog").on("click",".close",function(){s.toggleCqTip()}),e(".cq-dialog").on("click",".cancel",function(){s.toggleCqTip()}),e(".cq-dialog").on("click",".cq-foot a:first",function(){s.config.roomPointLow?e.dialog.tips_black("主播由于多次违规，积分过低，礼物和酬勤系统不可用！",3):(a.trigger("mod.gift.openCQWindowAndInit"),s.toggleCqTip())})):e(".cq-dialog").remove()},handleSubmit:function(t){var a=this,i=this.state.cq,n="open";!i&&t>=4?this.toggleCqTip(n):this.checkTotalYw(function(){p=c.create({idpre:"gt-captcha-olyw-",sign:!0,title:"后可以领取对应奖励",title1:"验证通过",shadow:{opacity:0},success:function(i){var n=e.extend({leve:a.state.level,room_id:s.get("room.room_id")},i);e.ajax("/member/cp/get_box_reward",{type:"POST",data:n,dataType:"json",success:function(e){a.handleReturn(e,t)},error:function(e){}})}})})},isLog:function(){this.config.islog=!0},toggleBan:function(e){a.trigger("dys",{key:"dys.room.olyw.btn.click"}),e?(clearTimeout(this.timer),this.config.isBan=!0,this.doms.$pop.hide().addClass("hide")):(this.config.isBan=!1,this.doms.$ywBtnText.show(),a.trigger("dys",{key:"dys.room.yw.get.show"}))},open:function(){this.config.state=f.yw.state.open,this.doms.$pop.removeClass("hide").show(),e("#js-yw-rmd-rooms").length<=0?(this.doms.$pop.find(".yw-app-des").eq(0).before('<div id="js-yw-rmd-rooms"></div>'),u.ywinit()):u.ywRmdRefresh(),a.trigger("dys",{key:"dys.room.yw.get.show"})},close:function(){this.config.state=f.yw.state.close,this.doms.$pop.addClass("hide").hide()},toggle:function(){this.config.state===f.yw.state.open?this.close():this.config.isBan||this.open()},bindEvt:function(){function t(e){e.stopPropagation(),e.preventDefault()}var i=this,s=this.doms.$el,o=(this.doms.$lead_close,this.doms.$pop),r=e("#js-stats-and-actions .ywtipbox"),l=r.find(".g-time");o.on("click",".close",function(e){t(e),i.observer.trigger("toggle")}),o.on("click",".download-btn",function(e){a.trigger("dys",{key:"dys.room.olyw.download.click"})}),s.on("click",".may-btn",function(s){t(s),a.trigger("dys",{key:"dys.room.olyw.could.click"});var n=e(this).index(".yw-collect-box li a");i.handleSubmit(n)}),s.find(".get-box").on("click",function(e){t(e);var s=i.config.islog;s?i.observer.trigger("toggle"):n.show(),a.trigger("dys",{key:"dys.room.olyw.btn.click"})}),o.on("click",".moretask",function(){a.trigger("mod.task.toggleWindowAndInit")}),r.on("mouseover",function(t){e(this).find(".get-box").addClass("highlight"),l.data("isshowtit")===!0?e(this).find(".tip").show():e(this).find(".tip").hide()}),r.on("mouseout",function(t){e(this).find(".get-box").removeClass("highlight"),e(this).find(".tip").hide()})}});var h=function(){var t=n.check();m||(m=new g,t?(e(".get-yw").show(),m.observer.trigger("login"),v()):e(".get-yw").hide())},v=function(){var t="olywGetGuide",a=e("#js-stats-and-actions .ywtipbox"),i=d.get(t)||0;if(a.is(":visible")&&0===i){var s=e('<div class="yw-user-guide"></div>');a.after(s),s.show(),setTimeout(function(){s.remove()},5e3),d.set(t,1)}};return{init:function(){h()},onToggle:function(){m&&m.observer.trigger("toggle")}}}),define("douyu/page/room/normal/mod/framebus",[],function(){var e;return function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t("undefined"==typeof global?e:global):"function"==typeof define&&define.amd?define([],function(){return t(e)}):e.framebus=t(e)}(this,function(t){function a(e){return null==e?!1:null==e.Window?!1:e.constructor!==e.Window?!1:(w.push(e),!0)}function i(t){var a,i={};for(a in e)e.hasOwnProperty(a)&&(i[a]=e[a]);return i._origin=t||"*",i}function s(e){var t,a,i=r(this);return l(e)?!1:l(i)?!1:(a=Array.prototype.slice.call(arguments,1),t=d(e,a,i),t===!1?!1:(h(k.top,t,i),!0))}function n(e,t,a){var i=r(this);return y(e,t,i)?!1:(_[i]=_[i]||{},_[i][e]=_[i][e]||[],_[i][e].push({id:a?a:(new Date).getTime()+"_"+x++,fn:t}),!0)}function o(e,t){var a,i,s=r(this);if(i=_[s]&&_[s][e],!i)return!1;if(t){for(a=0;a<i.length;a++)if(i[a].id===t)return i.splice(a,1),!0}else delete _[s][e];return!1}function r(e){return e&&e._origin||"*"}function l(e){return"string"!=typeof e}function d(e,t,a){var i=!1,s={event:e,origin:a},n=t[t.length-1];"function"==typeof n&&(s.reply=b(n,a),t=t.slice(0,-1)),s.args=t;try{i=T+JSON.stringify(s)}catch(o){throw new Error("Could not stringify event: "+o.message)}return i}function c(e){var t,a,i,s;if(e.data.slice(0,T.length)!==T)return!1;try{t=JSON.parse(e.data.slice(T.length))}catch(n){return!1}return null!=t.reply&&(a=e.origin,i=e.source,s=t.reply,t.reply=function(e){var t=d(s,[e],a);return t===!1?!1:void i.postMessage(t,a)},t.args.push(t.reply)),t}function u(e){k||(k=e||t,k.addEventListener?k.addEventListener("message",m,!1):k.attachEvent?k.attachEvent("onmessage",m):null===k.onmessage?k.onmessage=m:k=null)}function g(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,a="x"===e?t:3&t|8;return a.toString(16)})}function m(e){var t;l(e.data)||(t=c(e),t&&(p("*",t.event,t.args,e),p(e.origin,t.event,t.args,e),v(e.data,t.origin,e.source)))}function p(e,t,a,i){var s;if(_[e]&&_[e][t])for(s=0;s<_[e][t].length;s++)_[e][t][s].fn.apply(i,a)}function f(e){return!1}function h(e,t,a){var i;try{for(e.postMessage(t,a),f(e)&&h(e.opener.top,t,a),i=0;i<e.frames.length;i++)e.frames[i]!==e&&h(e.frames[i],t,a)}catch(s){}}function v(e,t,a){var i,s;for(i=w.length-1;i>=0;i--)s=w[i],s.closed===!0?w=w.slice(i,1):a!==s&&h(s.top,e,t)}function b(t,a){function i(n,o){t(n,o),e.target(a).unsubscribe(s,i)}var s=g();return e.target(a).subscribe(s,i),s}function y(e,t,a){return l(e)?!0:"function"!=typeof t?!0:!!l(a)}var k,w=[],_={},x=0,T="/*framebus*/";u(),e={target:i,include:a,publish:s,pub:s,trigger:s,emit:s,subscribe:n,sub:n,on:n,unsubscribe:o,unsub:o,off:o}}),e}),define("douyu/page/room/normal/mod/guess",["jquery","shark/observer","shark/util/storage/1.0","douyu/com/user","douyu/context","douyu/page/room/normal/mod/framebus"],function(e,t,a,i,s,n){var o=(window.DYS,{storage:{state:"guessstate",token:"guesstoken",allow:"guessallow",notAllow:"guessnotallow"},view:{$trigger:e("#js-guess"),$iframe:e("#js-guess-iframe"),$target:e('#js-guess-iframe iframe[data-type="iframe"]'),$relative:e("#js-stats-and-actions"),$tx_iframe:e('#js-guess-iframe iframe[data-type="tx_iframe"]')},state:{show:"show",hide:"hide",closure:!1,checked:!1},url:{ipCheck:"/lapi/live/qqLottery/ipCheck",getToken:"/api/qq_lottery/get_token",iframe:"https://qs.888.qq.com/m_qq/es/es.douyu.html#es.douyuV2=init",txIframe:"https://qs.888.qq.com/m_qq/es/es.message.html?__channel=douyu",txDomainName:"https://qs.888.qq.com"}}),r={init:function(){var n,r,l=this;if(o.view.$trigger.length&&o.view.$iframe.length&&o.view.$relative.length)if(i.check()){if(r=10+Math.floor(5*Math.random()+1),l.timer=setTimeout(function(){l.isSendReq=!0,l.getToken()},1e3*r),l.getDoms(),t.trigger("mod.chat.action.view.add",{flag:"guess",dom:o.view.$trigger,lock:!0,tips:""}),o.view.$trigger.show(),1==a.get(o.storage.state)&&i.check()&&l.show(),l.bindEvent(),n=o.view.$trigger.closest(".task-Getyw"),t.on("mod.layout.guess",function(){n[e(window).width()<=1366?"addClass":"removeClass"]("min-task-ball-guess"),l.state===o.state.show&&l.layout();
}),t.trigger("mod.layout.guess"),t.on("mod.guess.destroy",function(e){o.state.closure=!e,l.hide()}),o.view.$trigger.is(":visible"))try{t.trigger("dys",{key:"dys.room.guess.init",ext:{rid:s.get("room.room_id"),cid:s.get("room.cate_id")}})}catch(d){}}else o.view.$trigger.hide()},layout:function(){var e=o.view.$relative.outerWidth(),t=o.view.$iframe.outerWidth();o.view.$iframe.css({left:t>=e?0:(e-t)/2})},show:function(){this.state=o.state.show,this.getToken(),this.layout(),o.view.$iframe.show(),a.remove(o.storage.state);try{t.trigger("dys",{key:"dys.room.guess.show_quiz",ext:{rid:s.get("room.room_id"),cid:s.get("room.cate_id")}})}catch(e){}},hide:function(){this.state=o.state.hide,o.view.$iframe.hide(),this.setRoute()},toggle:function(){return o.state.closure?this.hide():void(this.state===o.state.show?this.hide():this.show())},setRoute:function(){var e="about:blank";this.state===o.state.show&&(e=o.url.iframe+"&catename="+o.prevCate+"&login_key="+o.prevToken),o.view.$target.attr({src:e})},check:function(){return i.check()?!0:(this.login(),!1)},ipCheck:function(t){if(1!=a.get(o.storage.allow)&&!o.state.checked)return 1==a.get(o.storage.notAllow)||o.state.checked?void t():void e.ajax({url:o.url.ipCheck,type:"GET",dataType:"json",data:{_v:(new Date).getTime()},success:function(e){o.state.checked=!0,0===parseInt(e.error,10)&&(1===parseInt(e.data.ip_allow,10)?(t(),a.set(o.storage.notAllow,1,10800)):a.set(o.storage.allow,1,259200))}})},login:function(){i.show("login",{callback:function(e){e===!0&&a.set(o.storage.state,1)}})},getToken:function(){var t=this,i=t.doms;return 1==a.get(o.storage.token)&&void 0!==o.prevToken&&void 0!==o.prevCate?t.setRoute():(a.set(o.storage.token,1,3600),i.guessLoading.show(),void e.ajax({url:o.url.getToken,type:"GET",dataType:"json",data:{roomid:s.get("room.room_id"),_v:(new Date).getTime()},error:function(){e.dialog.tips_black("请稍候再试！")},complete:function(){i.guessLoading.hide()},success:function(a){var i=a.data;switch(clearTimeout(t.timer),parseInt(a.error,10)){case 0:o.prevCate=i.catename,o.prevToken=i.token,t.isSendReq&&t.txIframeInit(),t.setRoute();break;case 1:t.login();break;default:e.dialog.tips_black(a.msg)}}}))},bindEvent:function(){var a=this,i=function(e){e.preventDefault(),e.stopPropagation()},r=a.doms,l=!1;o.view.$trigger.on("click",function(i){e(this).width("60px"),r.guessGameHover.hasClass("guess_game_hover0")&&r.guessGameHover.removeClass("guess_game_hover0").addClass("guess_hover_mark"),r.guessCorner.is("hidden")||r.guessCorner.hide();try{t.trigger("dys",{key:"dys.room.guess.click_quizbutton",ext:{rid:s.get("room.room_id"),cid:s.get("room.cate_id")}})}catch(o){}a.check()&&(l?(a.hide(),a.guessHover(),l=!1):(a.show(),n.emit("message.start",{c:"es.douyu.message",m:"openWindow"}),l=!0))}),o.view.$iframe.on("click",'[data-type="close-guess"]',function(e){i(e),a.hide(),a.guessHover(),l=!1}),e("#container").on("click.guess",function(t){var i=e(t.target).closest("#js-guess-iframe,#js-guess");0===i.length&&(a.hide(),a.guessHover(),l=!1)}),r.guessClose.on("click",function(t){i(t),e(this).closest(".guess_close_parent").fadeOut()})},guessHover:function(){var e=this.doms;e.guessGameHover.hasClass("guess_hover_mark")&&e.guessGameHover.removeClass("guess_hover_mark").addClass("guess_game_hover0")},txIframeInit:function(){var e=this,t="about:blank",a=o.view.$iframe.data("open-roomid")?s.get("room.room_id"):"0";"http:"===location.protocol&&(o.url.txIframe+="&domainDebug=1"),t=o.url.txIframe+"&catename="+encodeURIComponent(o.prevCate)+"&login_key="+encodeURIComponent(o.prevToken)+"&liveId="+encodeURIComponent(a),o.view.$tx_iframe.attr({src:t}),e.getInitState()},getInitState:function(){var e=this,t=n.target(o.url.txDomainName);t.on("message.ready",function(){n.emit("message.start",{c:"es.douyu.message",m:"getIconData"},function(t){var a=JSON.parse(e.htmlEncode(JSON.stringify(t)))||{};0===parseInt(a.errCode,10)&&a.data&&a.data.config&&e.renderCorner(a.data.config)})})},htmlEncode:function(e){var t,a;return"undefined"==typeof e?"":(t=document.createElement("div"),a=document.createTextNode(e),t.appendChild(a),t.innerHTML)},getDoms:function(){this.doms={guessLoading:o.view.$iframe.find(".guess_loading"),guessPrize:o.view.$trigger.find(".guess_corner_prize"),guessPrizeTitle:o.view.$trigger.find(".guess_prize_title"),guessPrizeSubTitle:o.view.$trigger.find(".guess_prize_sub_title"),guessPrizeDesc:o.view.$trigger.find(".guess_prize_desc"),guessGameTips:o.view.$trigger.find(".guess_game_tips"),gameTipsTitle:o.view.$trigger.find(".game_tips_title"),gameTipsContent:o.view.$trigger.find(".game_tips_content"),guessGameHover:o.view.$trigger.find(".guess_game_hover"),guessGameImg:o.view.$trigger.find(".guess_game_img"),guessHoverTitle:o.view.$trigger.find(".guess_hover_title"),guessHoverFocus:o.view.$trigger.find(".guess_hover_focus"),guessHoverNews:o.view.$trigger.find(".guess_hover_news"),guessClose:o.view.$trigger.find(".guess_close"),guessCornerPoint:o.view.$trigger.find(".guess_corner_point"),guessCornerWenan:o.view.$trigger.find(".guess_corner_wenan"),guessCorner:o.view.$trigger.find(".guess_corner"),guessLoading:o.view.$iframe.find(".guess_loading")}},renderCorner:function(e){var t,a,i=this,s=i.doms,n=0,r=e.length;if(r>0)for(;r>n;n++)switch(a=e[n].data||{},e[n].code){case 0:s.guessPrizeTitle.text(a.title),s.guessPrizeSubTitle.text(a.subTitle),s.guessPrizeDesc.text(a.desc),s.guessPrizeTitle.attr("title",a.title),s.guessPrizeSubTitle.attr("title",a.subTitle),s.guessPrizeDesc.attr("title",a.desc),s.guessPrize.show();break;case 1:s.gameTipsTitle.text(a.title),s.gameTipsContent.text(a.subTitle),s.gameTipsTitle.attr("title",a.title),s.gameTipsContent.attr("title",a.subTitle),s.guessGameTips.show();break;case 2:s.guessGameImg.attr("src",a.img),s.guessHoverTitle.text(a.title),s.guessHoverFocus.text(a.subTitle),s.guessHoverNews.text(a.desc),s.guessHoverTitle.attr("title",a.title),s.guessHoverFocus.attr("title",a.subTitle),s.guessHoverNews.attr("title",a.desc),s.guessGameHover.addClass("guess_game_hover0");break;case 3:s.guessCornerPoint.show();break;case 4:t=a.type.toLowerCase(),o.view.$trigger.width("72px"),"new"===t?s.guessCornerWenan.addClass("guess_new"):"hot"===t?s.guessCornerWenan.addClass("guess_hot"):"free"===t&&s.guessCornerWenan.addClass("guess_free"),s.guessCornerWenan.show()}}};return{init:function(){r.init()}}}),define("douyu/page/room/normal/mod/anchor-guess",["jquery","shark/util/lang/1.0","shark/util/template/2.0","douyu/context","shark/observer","douyu/page/room/base/api","shark/util/flash/data/1.0","douyu/com/user"],function(e,t,a,i,s,n,o,r){var l={urls:{enter:"/lapi/interact/anchorGuess/isDisPlayGuess",token:"/member/guess/get_token"},htmlTemplate:{iframe:function(){var e=t.string.join("{{ if (isAnchor) }}",'<div class="anchor-guess anchor-side">',"{{ else }}",'<div class="anchor-guess user-side">',"{{ /if }}",'<iframe id="js-anchor-guess-iframe" class="anchor-guess-iframe" scrolling="no" src="about:blank" frameborder="0"></iframe>',"</div>");return a.compile(e)},enter:function(){var e=t.string.join('<div class="anchor-guess-wrap">','<div class="anchor-guess-btn"></div>',"<!-- 开启和获奖通知提醒 begin -->",'<div class="anchor-guess-invite" id="js-guess-start">',"</div>","<!-- 开启和获奖通知提醒 end -->","<!-- 获奖通知 begin -->",'<div class="anchor-guess-lottery" id="js-guess-luck">','<i class="arrow-icon"><i></i></i>','<div class="anchor-guess-lotterycon">','<a href="javascript:;" class="lotterycon-close-btn js-guess-luck-close">X</a>','<p class="lotterycon-p1">恭喜您，中奖了！</p>','<p class="lotterycon-p2">恭喜竞猜投注获胜，赢得豆子奖励</p>',"</div>","</div>","<!-- 获奖通知 end -->","</div>");return a.compile(e)},startDlg:function(){var e=t.string.join('<i class="arrow-icon"><i></i></i>','<div class="anchor-guess-invitecon">','<a href="javascript:;" class="invite-close-btn js-guess-start-close">X</a>','<div class="guess-invitecon-box">','<div class="guess-invitecon-head">','<div class="head-mask"></div>','<img src="{{ pic }}" alt="">',"</div>",'<div class="guess-invitecon-desc">','<h2 title="{{ nickname }}邀请您参与互动竞猜"><span>{{ nickname }}</span> 邀请您参与互动竞猜</h2>',"<p>赢豆子赢到手软！快上车！</p>","</div>","</div>",'<a href="javascript:;" class="click-guess-btn">点击竞猜></a>',"</div>");return a.compile(e)}}},d={showThirdguess:!1,firstOpenGuess:!0,render:{},init:function(){var e=this;e.dataCache(),e.getThirdLink()},showEnter:function(){var t=this,a=t.render.iframe({isAnchor:t.isAnchor});t.$iframe=e(a),t.$roomVideo.append(t.$iframe),t.$enter=e(t.render.enter({})),s.trigger("dys",{key:"dys.room.anchor.guess.third.showenter"}),s.trigger("mod.chat.action.view.add",{flag:"anchorGuess",dom:t.$enter,lock:!0,tips:""}),t.$enter.show(),t.cacheDoms(),t.bindEvent(),t.regApi(),t.initGuessStatus()},initGuessStatus:function(){var e=this.guessStatus;if(1==e.is_open){var t=e.nickname,a=e.pic;this.showStartNotice(t,a)}},showStartNotice:function(t,a){if(t&&a){var s=i.get("room.owner_uid"),n=i.get("sys.uid");if(s!=n){var o=this.render.start({pic:a,nickname:t});this.$luck.hide(),e(".js-new-guess-entertips").is(":visible")||e(".js-new-guess-entertips-special").is(":visible")||this.$start.empty().append(o).show()}}},cacheDoms:function(){var e=this;e.$start=e.$enter.find("#js-guess-start"),e.$luck=e.$enter.find("#js-guess-luck"),e.$third=e.$iframe.find(".anchor-guess-iframe")},enterClkEvent:function(e,t){e.stopPropagation();var a=this;return r.check()?(t&&s.trigger("dys",{key:"dys.room.anchor.guess.third.click"}),void(a.showThirdguess?t&&(a.$iframe.hide(),a.showThirdguess=!1):a.getToken(function(e){if(a.firstOpenGuess)a.$third.attr("src",e),a.thirdSrc=e,a.$acget=document.getElementById("js-anchor-guess-iframe").contentWindow,a.firstOpenGuess=!1,a.target=e.split("?")[0];else if(e!==a.thirdSrc){a.thirdSrc=e;try{var t=e.split("?")[1],i=JSON.stringify({guessToken:t.split("=")[1]});a.$acget.postMessage(i,a.target)}catch(s){}}a.$iframe.show(),a.showThirdguess=!0}))):void r.show("login")},bindEvent:function(){var e=this;e.$enter.on("click",function(t){e.$start.hide(),e.enterClkEvent(t,!0)}).on("click","#js-guess-luck",function(t){e.$start.hide(),e.enterClkEvent(t)}).on("click","#js-guess-start",function(t){e.$start.hide(),e.enterClkEvent(t)}).on("click",".js-guess-start-close",function(t){e.$start.hide(),t.stopPropagation()}).on("click",".js-guess-luck-close",function(t){e.$luck.hide(),t.stopPropagation()}),window.addEventListener?window.addEventListener("message",function(t){e.clFreamMsg(t.data)}):window.attachEvent("message",function(t){e.clFreamMsg(t.data)})},clFreamMsg:function(e){var t=this;try{var a=JSON.parse(e);1==a.closeGuess&&t.$iframe&&(t.$iframe.hide(),t.showThirdguess=!1)}catch(i){}},regApi:function(){var e=this;n.reg("room_data_handler",function(t){var a=o.decode(t).too();if("anchorguess"===a.type)if(1===+a.remark){var i=a.nickname,s=a.pic;e.showStartNotice(i,s)}else 2===+a.remark&&(e.$start.hide(),e.$luck.show())})},dataCache:function(){var t=this,a=t.render,s=+i.get("sys.uid"),n=+i.get("room.owner_uid");t.$roomVideo=e("#js-room-video"),t.isAnchor=s===n,t.roomId=i.get("room.room_id"),a.iframe=l.htmlTemplate.iframe(),a.enter=l.htmlTemplate.enter(),a.start=l.htmlTemplate.startDlg()},getThirdLink:function(){var e=this;e.getEnter(function(t){e.guessStatus=t,e.showEnter()})},getEnter:function(t){var a=this.roomId,s=i.get("room.cate_id");a&&s&&e.ajax({url:l.urls.enter,type:"GET",dataType:"json",data:{room_id:a,cate2_id:s},success:function(e){0===+e.error&&1===+e.data&&t(e.guessOpen)}})},getToken:function(t){e.ajax({url:l.urls.token,type:"GET",dataType:"json",data:{roomid:this.roomId},success:function(e){0===+e.error&&t(e.data)}})}};return{init:function(){setTimeout(function(){d.init()},1e3)}}}),define("douyu/page/room/normal/mod/game-tmp2",["jquery","shark/util/lang/1.0","shark/util/template/2.0"],function(e,t,a){var i={enterRender:function(){var e,i;return e=t.string.join('<div class="third-games-entry" data-tag="game-enter-btn">','<div class="third-games-guide" style="display: none;" data-tag="game-enter-tip">','<i class="third-games-guide-close"></i>','<div class="third-games-guide-content">',"<h2>直播新花样！</h2>","<p>水友互动新玩法！互动游戏走一走，粉丝、收益全部有！</p>",'<span class="third-games-guide-join">前往开启></span>',"</div>",'<i class="third-games-trans trans"></i>','<i class="third-games-trans trans-bg"></i>',"</div>"),i=a.compile(e)},gameEnterMsgRender:function(){var e,i;return e=t.string.join("{{ if data.curRoom }}",'<a href="javascript:;" class="third-games-tip clearfix cur-room" data-cid="{{ data.pubData.cateId }}" data-gid="{{ data.gameInfoData.gameid }}" data-rid="{{ data.pubData.roomId }}" data-tag="game-enter-msg">',"{{ /if }}","<!-- b. 直播间未发起游戏，但当前有其他主播发起游戏 (加上hot图标)-->","{{ if !data.curRoom }}",'<a target="_blank" href="/{{ data.pubData.roomId }}" class="third-games-tip clearfix" data-cid="{{ data.pubData.cateId }}" data-gid="{{ data.gameInfoData.gameid }}" data-rid="{{ data.pubData.roomId }}" data-tag="game-enter-msg">','<i class="third-games-tip-hot"></i>',"{{ /if }}","<!-- b. 直播间未发起游戏，但当前有其他主播发起游戏 end -->",'<i class="third-games-tip-close"></i>','<img class="third-games-tip-img" src="{{ data.gameInfoData.icon }}" alt="游戏图标">','<div class="third-games-tip-content">','<h2 title="{{ data.anchorInfo.name }}发起了{{ data.gameInfoData.name }}"><em>{{ data.anchorInfo.name }}</em>发起了{{ data.gameInfoData.name }}</h2>',"<p>{{ data.pubData.game_desc.remark }}</p>","</div>",'<span class="third-games-tip-join">点击加入></span>','<i class="third-games-trans trans"></i>','<i class="third-games-trans trans-bg"></i>',"</a>"),i=a.compile(e)},gameFrameRender:function(){var e,i;return e=t.string.join('<div class="third-games-container" style="display: none;" data-tag="interact-game-wrap">','<div class="third-games-header">',"<!-- 返回/选择游戏 -->",'<a href="javascript:;" class="third-games-leftop third-games-back" data-tag="game-back-btn" style="display: none;">','<i class="third-games-back-icon"></i>',"<span>返回/选择游戏</span>","</a>","<!-- 返回/选择游戏 end -->","<!-- 游戏记录 -->",'<a href="javascript:;" class="third-games-leftop" data-tag="game-record-btn" style="display: none;">','<i class="third-games-record-icon"></i>',"<span>游戏记录</span>","</a>","<!-- 游戏记录 end -->","<!-- 游戏进行中 -->",'<a class="third-games-leftop" data-tag="game-status-header" style="display: none;">','<span class="text-bold" data-tag="gameing-stauts" style="display: none;">等待开始游戏</span>','<span class="third-games-countdown" data-tag="game-wait-status">','<em data-tag="game-wait-time">--:--</em>','<span data-tag="header-status-text"> 未开始游戏将自动取消</span>',"</span>","</a>","<!-- 游戏进行中 end -->",'<span class="third-games-title" data-tag="game-page-title">互动游戏</span>','<a href="javascript:;" data-tag="game-view-close" class="third-games-close"></a>',"<!-- 头部右侧 -->",'<div class="third-games-rightops" data-tag="game-right-btn" style="display: none;">','<a href="javascript:;" class="third-games-bg-btn" style="display: none;" data-tag="game-cancel-btn">取消游戏</a>',"<!-- 收起按钮 -->",'<a href="javascript:;" class="third-games-bg-btn third-games-packup" style="display: none;" data-tag="game-view-close"><i></i>收起</a>',"<!-- 收起按钮 end -->","</div>","<!-- 头部右侧 end -->","</div>",'<div class="third-games-body" data-tag="game-content-warp">',"</div>","</div>"),i=a.compile(e)},gameListRender:function(){var e,i;return e=t.string.join('<div class="third-games-content">',"{{ if !userIdentity }}",'<div class="third-games-selectgame">',"{{ /if }}","{{ if userIdentity }}",'<div class="third-games-selectgame third-games-selectgame-user">',"{{ /if }}","{{ if userIdentity }}",'<div class="third-games-nogame">',"<i></i>","<span>","{{ if gamePlayed }}",'<p class="third-games-nogame-title">好遗憾！您与主播暂时错过~</p>',"{{ /if }}","{{ if !gamePlayed }}",'<p class="third-games-nogame-title">主播暂未发布游戏</p>',"{{ /if }}","<p>点击下方游戏，可向主播传达游戏请求哦~</p>","</span>","</div>","{{ /if }}","{{ each gameListData as item index }}","{{ if userIdentity }}","{{ if !sendStatusList[item.gameid] }}",'<dl data-gid="{{ item.gameid }}" data-tag="game-list-item">',"{{ /if }}","{{ if sendStatusList[item.gameid] }}",'<dl data-gid="{{ item.gameid }}" data-tag="game-list-item" class="has-sent">',"{{ /if }}","{{ /if }}","{{ if !userIdentity }}",'<dl data-gid="{{ item.gameid }}" data-tag="game-list-item">',"{{ /if }}","<dt>{{ item.name }}</dt>",'<dd data-gid="{{ item.gameid }}">','<img src="{{ item.icon }}" alt="游戏图标">',"<p>{{ item.desc }}</p>","{{ if !userIdentity }}",'<i class="third-games-item-icon"></i>',"{{ /if }}","{{ if userIdentity }}","{{ if !sendStatusList[item.gameid] }}",'<a href="javascript:;" data-gid="{{ item.gameid }}" data-tag="send-game-req" class="third-games-item-btn"><i>我要玩</i></a>',"{{ /if }}","{{ if sendStatusList[item.gameid] }}",'<a href="javascript:;" data-gid="{{ item.gameid }}" data-tag="send-game-req" class="third-games-item-btn"><i>已发送给主播</i></a>',"{{ /if }}","{{ /if }}","</dd>","</dl>","{{ /each }}","</div>","</div>"),i=a.compile(e)},gameSettingRender:function(){var e,i;return e=t.string.join('<div class="third-games-content">','<div class="third-games-setting">','<div class="third-games-setting-left">','<dl class="third-games-price">',"<dt>参与价格</dt>","<dd>",'<div class="third-games-select-price">',"{{ each priceList as item index }}","{{ if item.price == gameSetData.setPrice }}",'<a href="javascript:;" data-id="{{item.price}}" data-num="{{item.num}}" data-type="{{item.type}}" data-tag="set-game-price" class="third-games-select-btn active">{{item.show}}</a>',"{{ /if }}","{{ if item.price != gameSetData.setPrice }}",'<a href="javascript:;" data-id="{{item.price}}" data-num="{{item.num}}" data-type="{{item.type}}" data-tag="set-game-price" class="third-games-select-btn">{{item.show}}</a>',"{{ /if }}","{{ /each }}","</div>","<!-- is-expand 控制列表展开收起 -->","{{ if data.awards[gameSetData.setPrice].length > 0 }}",'<div class="third-games-reward-wrapper">','<div class="third-games-reward is-expand" data-tag="game-price-award">','<ul class="clearfix">',"{{ each data.awards[gameSetData.setPrice] as item index }}",'<li class="clearfix">',"<h4><em>第{{ awardRank[index] }}名</em>奖励</h4>","{{ each item as itemChild indexChild }}",'<div class="third-games-reward-item">','<img src="{{ itemChild.icon }}" alt="奖励图片">','<span class="third-games-reward-detail">','<span title="{{ itemChild.name }}">{{ itemChild.name }}</span> <em>x{{ itemChild.cnt }}</em>',"</span>","</div>","{{ /each }}","</li>","{{ /each }}","</ul>","<!-- 默认收起 -->","</div>",'<i class="third-games-expand-icon"></i>',"</div>","{{ /if }}","</dd>","</dl>","<dl>","<dt>参与人数</dt>","<dd>","{{ each data.limit as item index }}","{{ if item == gameSetData.setMember }}",'<a href="javascript:;" data-num="{{item}}" data-tag="set-game-member" class="third-games-select-btn active">{{item}}人</a>',"{{ /if }}","{{ if item != gameSetData.setMember }}",'<a href="javascript:;" data-num="{{item}}" data-tag="set-game-member" class="third-games-select-btn">{{item}}人</a>',"{{ /if }}","{{ /each }}","</dd>","</dl>","{{ if data.start_trigger == 1 }}","<dl>","<dt>自动开始</dt>","<dd>",'<div class="third-games-select-start">',"{{ if gameSetData.setAutoStart != 0 }}",'<a href="javascript:;" data-tag="game-start-auto" data-switch="1" class="third-games-select-btn active">开</a>','<a href="javascript:;" data-tag="game-start-auto" data-switch="0" class="third-games-select-btn">关</a>',"{{ /if }}","{{ if gameSetData.setAutoStart == 0 }}",'<a href="javascript:;" data-tag="game-start-auto" data-switch="1" class="third-games-select-btn">开</a>','<a href="javascript:;" data-tag="game-start-auto" data-switch="0" class="third-games-select-btn active">关</a>',"{{ /if }}","<span>（报名满后，游戏自动开始）</span>","</div>","</dd>","</dl>","{{ /if }}",'<dl class="third-games-explain">',"<dt>参与说明</dt>","<dd>",'<textarea maxlength="50" data-tag="game-remain-desc" placeholder="试着讲讲游戏规则和奖励来吸引水友吧"  cols="30" rows="10">',"{{ gameSetData.setDesc }}","</textarea>",'<span class="third-games-explain-count">',"{{ if (50 - gameSetData.setDesc.length) <= 0 }}",'<em class="status-active" data-tag="game-remain-num">{{ gameSetData.setDesc.length }}</em>/50',"{{ /if }}","{{ if (50 - gameSetData.setDesc.length) > 0 }}",'<em data-tag="game-remain-num">{{ gameSetData.setDesc.length }}</em>/50',"{{ /if }}","</span>","</dd>","</dl>","</div>",'<div class="third-games-setting-right">',"<h2>主播基本收益</h2>",'<span class="third-games-profile">','<em data-tag="game-profile-num">{{ winPrice }}</em>','<span data-tag="game-profile-cell">{{ (+winPrice && gameSetData.setPrice.split("-")[1] == 2) ? "鱼丸" : "鱼翅" }}</span>',"</span>",'<div class="third-games-profile-icon">','{{ if (priceType === "鱼丸") }}','<i class="js-game2-1-gift-icon game-fish-ball"></i>',"{{ else }}",'<i class="js-game2-1-gift-icon"></i>',"{{ /if }}","</div>",'<div class="third-games-profile-desc">',"<p>1. 主播获胜也可以获取道具奖励；</p>","<p>2. 15分钟内未报满，游戏将自动取消；</p>","<p>3. 取消游戏后，用户报名的费用将自动退还；</p>","<p>4. 游戏收益请以实际兑换时为准。</p>","</div>",'<a href="javascript:;" data-tag="game-publish-btn" class="third-games-publish">发布游戏</a>',"</div>","</div>","</div>"),i=a.compile(e)},gamePriceAwardRender:function(){var e,i;return e=t.string.join("{{ if data.length > 0 }}",'<div class="third-games-reward is-expand" data-tag="game-price-award">','<ul class="clearfix">',"{{ each data as item index }}",'<li class="clearfix">',"<h4><em>第{{ awardRank[index] }}名</em>奖励</h4>","{{ each item as childItem childIndex }}",'<div class="third-games-reward-item">','<img src="{{ childItem.icon }}" alt="奖励图片">','<span class="third-games-reward-detail">','<span title="{{ childItem.name }}">{{ childItem.name }}</span> <em>x{{ childItem.cnt }}</em>',"</span>","</div>","{{ /each }}","</li>","{{ /each }}","</ul>","</div>",'<i class="third-games-expand-icon"></i>',"{{ /if }}"),i=a.compile(e)},gameRecordRender:function(){var e,i;return e=t.string.join('<div class="third-games-content third-games-content-record">',"{{ if data.data.length > 0 }}","<!-- 有记录 -->",'<div class="third-games-record">',"<table>","<thead>","<tr>",'<th class="third-games-record-gamename">游戏名称</th>',"<th>冠军</th>","<th>报名费用</th>","<th>人数</th>","<th>游戏时间</th>","</tr>","</thead>","<tbody>","{{ each data.data as item index }}","<tr>","<th>",'<div class="third-games-record-game">','<img style="width:28px;height:28px;" src="{{ item.game_info.icon }}" alt="游戏图标">',"<span>{{ item.game_name }}</span>","</div>","</th>",'<td class="third-games-record-no1">{{ item.win_result[0] }}</td>','<td class="third-games-record-price">{{ item.price }}{{ item.currency == 2 ? "鱼丸" : "鱼翅"}}</td>','<td class="third-games-record-num">{{ item.total }}人</td>','<td class="third-games-record-time">',"<span>{{ item.commit_time }}</span>","</td>","</tr>","{{ /each }}","</tbody>","</table>","</div>","<!-- 有记录 end -->","{{ /if }}","{{ if data.data.length <= 0 }}","<!-- 无记录 -->",'<div class="third-games-record is-empty">','<span>暂无游戏记录，赶快去<a href="javascript:;" data-tag="game-list-goto">发布游戏</a>吧！</span>',"</div>","<!-- 无记录 end -->","{{ /if }}","</div>"),i=a.compile(e)},gameCancelRender:function(){var e,i;return e=t.string.join('<div class="third-games-republish">','{{ if data.cancelType == "closeUP" }}','<p class="third-games-notstart">主播已取消游戏！</p>',"<p>参与报名的费用将返还</p>","{{ /if }}",'{{ if data.cancelType == "gameError" }}','<p class="third-games-notstart">游戏连接异常，已自动取消</p>',"<p>参与报名的费用将返还</p>","{{ /if }}",'{{ if data.cancelType == "gamePlayError" }}','<p class="third-games-notstart">游戏加载失败，已自动取消！</p>',"<p>参与报名的费用将返还</p>","{{ /if }}",'{{ if data.cancelType == "timeOut" }}',"{{ if data.identity == 1 }}",'<p class="third-games-notstart">15分钟未开始，</p>',"<p>游戏已自动取消！</p>",'<a href="javascript:;" class="third-games-publish" data-tag="game-republish-btn">重新发布</a>',"{{ /if }}","{{ if data.identity != 1 }}",'<p class="third-games-notstart">主播15分钟内未开始游戏，游戏已自动取消</p>',"<p>您的报名费用将返还！</p>",'<a href="javascript:;" class="third-games-publish" data-tag="game-list-goto">知道了</a>',"{{ /if }}","{{ /if }}",'{{ if data.cancelType == "gamePlaying" }}','<p class="third-games-notstart">您发布的游戏正在进行中</p>',"<p>请等待游戏结束后再发起新游戏！</p>","{{ /if }}",'{{ if data.cancelType == "gameStop" }}','<p class="third-games-notstart">超管已为您切换分区，您发起的互动游戏已被取消</p>',"{{ /if }}","</div>"),i=a.compile(e)},gameCancelPopRender:function(){var e,i;return e=t.string.join('<div class="third-games-dialog" data-tag="game-cancel-warp">','<span class="third-games-dialog-vertical"></span>','<div class="third-games-dialog-content">','<p class="third-games-dialog-title">是否取消本次游戏发布？</p>',"<p>取消后，参与人支付的费用将返还</p>",'<div class="third-games-dialog-btns">','<a href="javascript:;" class="third-games-btn-primary" data-tag="game-cancel-confirm">是</a>','<a href="javascript:;" class="third-games-btn-default" data-tag="game-cancel-close">否</a>',"</div>","</div>","</div>"),i=a.compile(e)},gameJoinRender:function(){var e,i;return e=t.string.join('<div class="third-games-content">','<div class="third-games-userjoin">','<div class="third-games-userjoin-left" data-tag="game-join-scroll">','<div class="third-games-userjoin-anchor">','<div class="third-games-userjoin-info">','<img src="{{ anchorInfo.avatar }}" alt="主播头像">',"<span>{{ anchorInfo.name }}</span>","</div>",'<div class="third-games-userjoin-content">',"<i></i>",'<span class="textVertical"></span>','<span class="third-games-userjoin-text">{{ pushData.desc }}</span>',"</div>","</div>","<h3>参与游戏</h3>",'<div class="third-games-userjoin-game">',"<dl>","<dd>",'<img src="{{ gameInfoData.icon }}" alt="游戏图标">',"<h4>{{ gameInfoData.name }}</h4>","<p>{{ gameInfoData.desc }}</p>","</dd>","</dl>","</div>","<h3>获胜奖励</h3>",'<div class="third-games-reward-user">',"{{ if pushData.newAwards.length > 0 }}",'<ul class="clearfix">',"{{ each pushData.newAwards as item index }}",'<li class="clearfix">',"<h4><em>第{{ awardRand[index] }}名</em>奖励</h4>","{{ each item as childItem childIndex }}",'<div class="third-games-reward-item">','<img src="{{ childItem.icon }}" alt="奖励图片">','<span class="third-games-reward-detail">','<span title="{{ childItem.name }}">{{ childItem.name }}</span> <em>x{{ childItem.cnt }}</em>',"</span>","</div>","{{ /each }}","</li>","{{ /each }}","</ul>","{{ /if }}","</div>","</div>",'<div class="third-games-userjoin-right">',"<h2>报名费用</h2>",'<span class="third-games-profile"><em>{{ joinCost }}</em>{{ joinCell }}</span>','<div class="third-games-profile-desc">',"<h4>游戏说明</h4>","<p>1. 游戏获胜后可以获得道具奖励；</p>","<p>2. 15分钟内未报满，游戏将自动取消；</p>","<p>3. 取消游戏后，您的报名费用将自动退还；</p>","<p>4. 报名后请勿关闭、刷新、退出网页。</p>","</div>",'<a href="javascript:;" class="third-games-publish" data-tag="game-join-btn">立即报名</a>',"</div>","</div>","</div>"),i=a.compile(e)},gameEndResultRender:function(){var e,i;return e=t.string.join('<div class="third-games-content">','<div class="third-games-gameover">','<div class="third-games-gameover-left" data-tag="game-over-scroll">','<div class="third-games-gameover-award">',"<!-- third-games-gameover-no1 一二三名 -->","{{ if gamePubData.newAwards.length > 0 }}","{{ each gamePubData.newAwards as item index }}","{{ if index < pushData.winerUser.length }}",'<dl class="third-games-gameover-no{{ index + 1 }}">',"<dt>",'<div class="third-games-gameover-info">','<img src="{{ pushData.winerUser[index].icon }}" alt="玩家头像">',"<span>{{ pushData.winerUser[index].name }}</span>","<i></i>","</div>","</dt>","<dd>","<h4><em>第{{ gameAwardRank[index] }}名</em>获得：</h4>",'<div class="third-games-reward-user clearfix">',"{{ each item as childItem childIndex }}",'<div class="third-games-reward-item">','<img src="{{ childItem.icon }}" alt="奖励图片">','<span class="third-games-reward-detail">','<span title="{{ childItem.name }}">{{ childItem.name }}</span> <em>x{{ childItem.cnt }}</em>',"</span>","</div>","{{ /each }}","</div>","</dd>","</dl>","{{ /if }}","{{ /each }}","{{ /if }}","</div>","</div>","<!-- 有名次加上 has-award -->","{{ if pushData.winIndex > 0 }}",'<div class="third-games-gameover-right has-award">',"{{ /if }}","{{ if pushData.winIndex <= 0 }}",'<div class="third-games-gameover-right">',"{{ /if }}","{{ if pushData.winIndex > 0 }}","<!-- 获得名次 -->","<h2>恭喜，您获得第{{ gameAwardRank[pushData.winIndex - 1] }}名，</h2>","<p>奖励已发放到您的背包</p>","<!-- 获得名次 end -->","{{ /if }}","{{ if pushData.winIndex <= 0 }}","<!-- 未获得名次 -->","<h2>抱歉，您没有获得名次，</h2>","<p>下次努力哦！</p>","<!-- 未获得名次 end -->","{{ /if }}",'{{ if identity == "DY_anchorTag" }}','<div class="third-games-gameover-noplay">','<a href="javascript:;" data-tag="game-not-play">不玩了></a>',"</div>",'<a href="javascript:;" class="third-games-publish" data-tag="game-play-again">再来一局</a>',"{{ /if }}",'{{ if identity != "DY_anchorTag" }}','<a href="javascript:;" class="third-games-publish" data-tag="game-play-back">返回</a>',"{{ /if }}","</div>","</div>","</div>"),i=a.compile(e)},gameRemainPopRender:function(){var e,i;return e=t.string.join('<div class="third-games-dialog" data-tag="game-remain-warp">','<span class="third-games-dialog-vertical"></span>','<div class="third-games-dialog-content">','{{ if data == "joinError" }}','<p class="third-games-dialog-title">报名太火爆了！请稍候再试~</p>',"{{ /if }}",'{{ if data == "gameRecharge" }}','<p class="third-games-dialog-title">您的鱼翅不足，快去充值吧！</p>',"{{ /if }}",'{{ if data == "memberFull" }}','<p class="third-games-dialog-title">报名已经满了！下次快点哦~</p>',"{{ /if }}",'<div class="third-games-dialog-btns">','{{ if data != "gameRecharge" }}','<a href="javascript:;" class="third-games-btn-primary" data-tag="game-remain-btn">知道了</a>',"{{ /if }}",'{{ if data == "gameRecharge" }}','<a href="/web_game/welcome/18" target="_blank" class="third-games-btn-primary">充值</a>','<a href="javascript:;" class="third-games-btn-default" data-tag="game-remain-btn">取消</a>',"{{ /if }}","</div>","</div>","</div>"),i=a.compile(e)},gameLoadingRender:function(){var e,i;return e=t.string.join('<div class="third-games-dialog" data-tag="loading-warp">','<span class="third-games-dialog-vertical"></span>','<div class="third-games-dialog-content third-games-loading">','<span class="third-games-loading-icon"><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i></span>',"<span>{{ data.title }}</span>","</div>","</div>"),i=a.compile(e)},gameErrorTipRender:function(){var e,i;return e=t.string.join('<div class="third-games-dialog" data-tag="game-error-dialog">','<span class="third-games-dialog-vertical"></span>','<div class="third-games-dialog-content third-games-loading">','<span>{{ data.title || "请稍后再试" }}</span>',"</div>","</div>"),i=a.compile(e)},gamePlayingRender:function(){var e,i;return e=t.string.join('<div data-tag="game-playing-warp" class="third-games-content third-games-content-iframe">','<div data-tag="game-view-container" class="third-games-iframe-bg">',"{{ if gameInfoData && gameInfoData.pic }}",'<img class="third-games-iframe-bgimg" src="{{ gameInfoData.pic }}" />',"{{ /if }}",'<iframe scrolling="no" data-tag="game-view-container" src="{{ pushData.gameUrl }}" frameborder="0"></iframe>',"</div>","</div>"),i=a.compile(e)},gamePushMsgRender:function(){var e,i;return e=t.string.join('{{ if type == "sendPlayMsg" }}','<li class="jschartli chartli normal-notice">','<i class="icon-heart"></i>','<p class="text-cont">','<a class="third-games-request"><em>{{ pushData.userInfo.name }}</em>请求主播发起<span>{{ gameInfoData.name }}</span>互动游戏</a>',"</p>","</li>","{{ /if }}",'{{ if type == "joinMsg" }}','<li class="jschartli chartli normal-notice">','<i class="icon-heart"></i>','<p class="text-cont">','<a data-tag="game-publish-msg" style="cursor: pointer">','恭喜 <em class="hy-name">{{ userName }}</em>','成功报名<span class="game-signup-notice">{{ gameName }}</span>',"</a>","</p>","</li>","{{ /if }}",'{{ if type == "winMsg" }}','<li class="jschartli gamewinner-tipswrap" data-type="list">','<div class="gamewinner-tipsbox">','<span class="gamewinner-headimg">','<img src="{{ winUserInfo.icon }}" alt="">',"</span>",'<div class="gamewinner-info">',"恭喜 ",'<a title="{{ winUserInfo.name }}" data-tag="game-winer">',"{{ winUserInfo.name }}","</a>"," 在本轮游戏中获胜，获得道具大礼包奖励！","</div>","</div>","</li>","{{ /if }}"),i=a.compile(e)},browserWarningRender:function(){var e,i;return e=t.string.join('<div class="interactgame-updatedialog">','<div class="update-info">',"<h4>您当前浏览器不支持游戏功能</h4>","<p>建议您更换以下浏览器使用</p>","</div>",'<div class="update-browser">','<a class="chrome" href="https://www.google.cn/intl/zh-CN/chrome/browser/desktop/" target="_blank" title="下载谷歌浏览器">',"<i></i>","<dl>","<dt></dt>","<dd>下载谷歌浏览器</dd>","</dl>","</a>",'<a class="firefox" href="https://www.mozilla.org/zh-CN/firefox/new/" target="_blank" title="下载火狐浏览器">',"<i></i>","<dl>","<dt></dt>","<dd>下载火狐浏览器</dd>","</dl>","</a>","</div>","</div>"),
i=a.compile(e)},gameEndTimer:function(){var e,i;return e=t.string.join('<div data-tag="game-end-timer-warp" style="z-index: 502" class="interactgame-mask--half">','<div class="countdown-box" data-tag="game-end-goto" style="cursor: pointer">','<h2 data-tag="game-end-timer">05</h2>','<p>游戏结束，<a href="javascript:;">查看奖励及排名&gt;</a></p>',"</div>","</div>"),i=a.compile(e)}};return{enterRender:i.enterRender(),gameEnterMsgRender:i.gameEnterMsgRender(),gameFrameRender:i.gameFrameRender(),gameListRender:i.gameListRender(),gameSettingRender:i.gameSettingRender(),gamePriceAwardRender:i.gamePriceAwardRender(),gameRecordRender:i.gameRecordRender(),gameCancelRender:i.gameCancelRender(),gameCancelPopRender:i.gameCancelPopRender(),gameJoinRender:i.gameJoinRender(),gameEndResultRender:i.gameEndResultRender(),gameRemainPopRender:i.gameRemainPopRender(),gameLoadingRender:i.gameLoadingRender(),gameErrorTipRender:i.gameErrorTipRender(),gamePlayingRender:i.gamePlayingRender(),gamePushMsgRender:i.gamePushMsgRender(),browserWarningRender:i.browserWarningRender(),gameEndTimer:i.gameEndTimer()}}),define("douyu/page/room/normal/mod/game2",["jquery","shark/class","shark/observer","shark/util/lang/1.0","shark/util/cookie/1.0","shark/util/storage/1.0","shark/util/flash/data/1.0","shark/util/template/2.0","douyu/context","douyu/com/user","douyu/com/exjsonp","douyu/com/config-user-info","douyu/page/room/base/api","douyu/page/room/normal/mod/game-tmp2"],function(e,t,a,i,s,n,o,r,l,d,c,u,g,m){var p={webconfUrl:l.get("sys.webconfUrl")},f={doms:{$body:e("body")},levelExp:u.levelExp,urls:{enterSwitch:p.webconfUrl+"/resource/common/tongzhuo/tongzhuo.json",gameInfo:p.webconfUrl+"resource/common/tongzhuo/game_info.json",gameList:"/member/tongzhuo/GameList",sendStatus:"/member/tongzhuo/game_list",sendPlay:"/member/tongzhuo/anchorNotify",gamePublish:"/member/tongzhuo/PubGame",gameJoin:"/member/tongzhuo/CheckIn",gameStart:"/member/tongzhuo/StartGame",gameCancel:"/member/tongzhuo/CancelGame",gameResult:"/member/tongzhuo/GetMatchResult",gameRecord:"/member/tongzhuo/PubHistory",anchorStatus:"/member/tongzhuo/AnchorStatus",severTimeTick:"/member/tongzhuo/tick",searchGamePub:" /member/tongzhuo/latestGame"},priceMap:{0:"0",1:"鱼翅",2:"鱼丸"},gameStep:{gameList:{title:{anchor:"选择需要发布的游戏",user:"互动游戏"},state:"gameSet",step:0,backBtn:!1,leftBtn:!1,recordBtn:!0,closeBtn:!0,rightBtn:!1},gameSet:{title:{anchor:"gameName",user:"互动游戏"},state:"gameWaiting",step:1,backBtn:"选择游戏",leftBtn:!1,closeBtn:!0,rightBtn:!1},gameWaiting:{title:!1,state:"gamePlaying",step:2,headStatus:!0,backBtn:!1,closeBtn:!1,rightBtn:["game-cancel-btn","game-view-close"]},gameRestart:{state:"gameRestartPlay",step:2,backBtn:"返回",closeBtn:!1,rightBtn:["game-view-close"]},gameRestartPlay:{state:"gameWaiting",btn:"发布游戏",step:1,backBtn:!0,closeBtn:!0,rightBtn:!1},gameJoin:{title:"互动游戏",state:"gameJoinSuccess",backBtn:!1,rightBtn:!1},gameJoinSuccess:{state:"gameJoinSuccess",btn:!1,backBtn:!1,closeBtn:!0,rightBtn:!1,cancelBtn:!0},gamePlaying:{title:!1,state:"gamePlaying",step:2,headStatus:!0,backBtn:!1,closeBtn:!1,rightBtn:["game-cancel-btn","game-view-close"]},gamePlayed:{title:!1,state:"gamePlayed",step:2,headStatus:!0,backBtn:!1,closeBtn:!1,rightBtn:["game-cancel-btn","game-view-close"]},gameEndResultAnchor:{title:"游戏结束",state:"gameContinue",recordBtn:!0,backBtn:!1,closeBtn:!0},gameContinue:{state:"gameWaiting",step:1,backBtn:"返回",closeBtn:!0,rightBtn:!1},gameEndResultUser:{title:"游戏结束",state:"gameClose",backBtn:!1,closeBtn:!0},gameCancel:{title:"游戏取消",state:"gameCancel",backBtn:"返回",closeBtn:!1,rightBtn:["game-view-close"]},gameRecord:{title:"游戏记录",state:"gameRecord",backBtn:"返回",closeBtn:!0,rightBtn:!1},gameClose:{state:"gameClose",backBtn:!1,closeBtn:!0,rightBtn:!1}},instId:"",gameId:"",defaultData:{game2Flag:"interactiveGame",game2EnterUserTip:"参与游戏拿大奖，得名次稳赚不赔！",game2EnterAnchorTip:"游戏走一走，粉丝、收益全都有~",varTag:"DY_"+l.get("room.room_id")+"_",userTag:"DY_user",anchorTag:"DY_anchorTag",noPlayerName:"虚位以待",noPlayerAvatar:l.get("sys.web_url")+"/app/douyu/res/page/room-normal/game/noplayer_icon.png?20170224",expiredTime:120,gameOverTime:4800,gameJoinPrice:10,gameJoinPlayer:4,gameJoinDesc:"参与游戏拿大奖，得名次稳赚不赔！",gameAwardRank:["一","二","三","四","五","六","七","八","九","十"]},notRecordList:["backBtn","enterBtn","userEnterBtn","gameCancel"],types:{userConnected:"loginres",gameStart:"3rd_gmrl",gameJoin:"3rd_gmrg",gameReady:"3rd_gmrdy",gamePlay:"3rd_gmst",gameEnd:"3rd_gmend",gameCancel:"3rd_gmcan",gameSend:"3rd_toan"},gameResultD:"",gameCloseSetTime:"",game2ListData:"",game2ListAll:"",otherAnchorGame:"",gameInfoData:"",lastGameInfoData:"",searchGameStatus:"",gameSetData:{},userConnectStatus:!1,game2IDList:[],game2WaitTimer:"",gameGuideTip:n.get("gameGuideTip")||0,cate_id:l.get("room.cate_id"),room_id:l.get("room.room_id"),owner_uid:l.get("room.owner_uid"),owner_name:l.get("room.owner_name"),anchorInfo:{name:l.get("room.owner_name"),avatar:l.get("room.avatar.middle")}},h={browserCheck:function(){function e(e){e=e.toLowerCase();var n=t.exec(e)||a.exec(e)||i.exec(e)||e.indexOf("compatible")<0&&s.exec(e)||[];return{browser:n[1]||"",version:n[2]||"0"}}var t=/(webkit)[ \/]([\w.]+)/,a=/(opera)(?:.*version)?[ \/]([\w.]+)/,i=/(msie) ([\w.]+)/,s=/(mozilla)(?:.*? rv:([\w.]+))?/,n={mozilla:!1,webkit:!1,opera:!1,msie:!1},o=e(navigator.userAgent);return n[o.browser]=!0,n.version=o.version,n.safari=!!n.webkit,n},eventDefault:function(e){return e.stopPropagation(),e.preventDefault(),!1},returnType:function(e){for(var t=[null,void 0],a=0;a<t.length;a++)if(e==t[a])return e;return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},requestData:function(t,a){var i={url:t.url||"",type:t.type||"GET",data:t.data||{},dataType:t.dataType||"json",cache:t.cache||!1,success:function(e){a&&a(e)},error:function(e){a&&a(e)}};t.jsonp&&(i.jsonp=t.jsonp,i.callback=t.jsonCallBack),e.ajax(i)},localStorageSet:function(e){var t,a=e.name;t="object"===h.returnType(e.params)?JSON.stringify(e.params):e.params,"number"===h.returnType(e.expired)?-1===e.expired?n.set(f.defaultData.varTag+a,t,86400):n.set(f.defaultData.varTag+a,t,e.expired):n.set(f.defaultData.varTag+a,t,f.defaultData.gameOverTime)},localStorageGet:function(e){var t=n.get(f.defaultData.varTag+e);return"object"===h.returnType(JSON.parse(t))?JSON.parse(t):t},localStorageRemove:function(e){n.remove(f.defaultData.varTag+e)},returnGameInfoData:function(){return"object"===h.returnType(h.localStorageGet("gameInfoData"))?h.localStorageGet("gameInfoData"):f.gameInfoData},countTimer:function(e){var t,a,i=e.time,s=e.ele,n=function(e){return 0==e?"00":10>e?"0"+e:e};if(0>=i)return void s.text("00 : 00");switch(e.type){case"second":default:a=function(e){s.text(n(e.time))};break;case"minute":a=function(e){var t=parseInt(e.time/60,10),a=e.time%60;s.text(n(t)+" : "+n(a))};break;case"hour":a=function(e){var t=parseInt(e.time/3600,10),a=parseInt(e.time%3600/60,10),i=e.time-60*t*60-60*a;s.text(n(t)+" : "+n(a)+" : "+n(i))}}return t=function(){i>0?(i--,a({time:i})):(clearInterval(f.game2WaitTimer),"function"===h.returnType(e.callback)&&e.callback())},clearInterval(f.game2WaitTimer),f.game2WaitTimer=setInterval(t,1e3),f.game2WaitTimer},getRestTime:function(e){var t,a;return e=e?parseInt(e,10):0,t=new Date,t.setDate(t.getDate()+e),t.setHours(24),t.setMinutes(0),t.setSeconds(0),a=t.getTime()-(new Date).getTime()},anchorCheck:function(){return parseInt(f.owner_uid,10)===parseInt(l.get("sys.uid"),10)},getCSRFCookie:function(t,a){var i,n=this,o=s.get(l.get("sys.tvk"));return o?(i=l.get("sys.tn"),void(a&&a({name:i,val:o}))):void e.ajax({url:"/curl/csrfApi/getCsrfCookie",type:"GET",dataType:"json",success:function(e){0===e.error&&n.getCSRFCookie(t,a)}})},_giveUpLastZero:function(e){if(-1===e.indexOf("."))return e;var t=e.split(""),a=t.splice(-1,1)[0];return"0"!==a&&"."!==a?e:this._giveUpLastZero(t.join(""))},formateNumber:function(e,t){var a=+e,i=void 0===t?1:t,s=a.toFixed(i);return this._giveUpLastZero(s)}},v={init:function(){this.doms={},this.anchorCheck=h.anchorCheck(),this.flashPushTrigger(),this.enterCheck()},enterCheck:function(t){var a=this,i=function(){c.load(f.urls.gameInfo,"getGameInfo",function(e){var i;if(f.game2ListAll=e,t&&"update"==t.type){i=f.game2IDList,f.game2ListData=[];for(var s=0;s<i.length;s++)"object"===h.returnType(e[i[s]])&&f.game2ListData.push(e[i[s]])}a.enterAppend()},function(){},"",!0)},s=function(t){var a,s=t,n=[];for(a in s)if(a==f.cate_id){if(n=s[a],!n)return;if(e.isArray(n)&&n.length>0){f.game2IDList=n,i();break}}};c.load(f.urls.enterSwitch,"setTzyxSwitch",function(e){s(e)},function(){},"",!0)},gameProgressCheck:function(){var e="",t=h.localStorageGet("gameProgress");return"object"===h.returnType(t)&&(e="gamePlaying"==t.nowProgress||"gamePlayed"==t.nowProgress||"gameCancel"==t.nowProgress?"gameList":""),e},game2EnterAgent:function(t){var a=this,i=function(i){var s=f.game2IDList;if(!f.game2ListData||!e.isArray(f.game2ListData)){f.game2ListData=[];for(var n=0;n<s.length;n++)"object"===h.returnType(i[s[n]])&&f.game2ListData.push(i[s[n]])}if("eHover"===t.type){if(f.otherAnchorGame)return;if(1===h.localStorageGet("gameOwnerJoined"))return;a.game2SearchPubed()}else"eClick"===t.type&&a.game2StatusSearch()};c.load(f.urls.gameInfo,"getGameInfo",function(e){f.game2ListAll=e,i(f.game2ListAll)},function(){},"",!0)},game2StatusSearch:function(){var t=this,a=function(a){if(0==a.error){var i,s,n,o=a.data;if("object"===h.returnType(o)){if(n=f.game2ListAll[o.game_id],"object"!==h.returnType(n))return void t.enterGameStatus({status:parseInt(o.status,10),data:o});f.lastGameInfoData=n,i=o.status,s=o.anchor_info,o.gameid=o.flow,f.instId=o.flow,o.desc=o.remark,o.limit=o.total,o.st=o.commit_time,o.timestamp=o.commit_time,o.owner_uid=l.get("sys.uid"),o.gamecfgid=o.game_id,"object"===h.returnType(o.game_info)?o.autoStart=o.game_info.auto_start:o.autoStart=1;var r=[h.formateNumber(o.price,1),o.currency].join("-"),d=n.awards[r];o.newAwards=d||{},"array"===h.returnType(o.players)&&(o.user=o.players,o.user.unshift({icon:s.avatar,name:s.nick,identity:s.role,uid:f.owner_uid})),f.searchGameStatus=o,t.enterGameStatus({status:parseInt(i,10),data:o})}else t.gameEnterOpen()}else e.dialog.tips_black(a.msg||"稍后重试")};h.requestData({url:f.urls.anchorStatus,data:{roomId:f.room_id,type:2}},a)},enterGameStatus:function(e){var t=this,i=this.doms,s=e.data,n=!1,o=0,r=h.localStorageGet("gameProgress"),d=function(e,t){var a=0;if("array"!==h.returnType(e))return[];for(this.newObj={};a<e.length;a++)this.newObj[e[a]]=s[e[a]];return this.newObj.type=t,this.newObj},c=function(e){var t;return"object"!==h.returnType(e)?{}:("object"!==h.returnType(h.localStorageGet(e.name)),t=new d(e.gameStatus,e.type),h.localStorageSet({name:e.name,params:t}),void 0)},u=function(){c({type:f.types.gameStart,name:"gamePublishPush",gameStatus:["desc","gameid","limit","newAwards","owner_uid","price","st","gamecfgid","currency"]}),h.localStorageSet({name:"gameSetData",params:{setPrice:s.price,setMember:s.limit,setAutoStart:s.autoStart,setDesc:s.desc}}),c({type:f.types.gameJoin,name:"gameJoinListPush",gameStatus:["gameid","user","gamecfgid"]})},g=function(e){h.localStorageSet({name:"gamePlayingPush",params:e})};switch(e.status){case 1:if(t.clearGamePush(),f.gameInfoData=f.game2ListAll[s.game_id],u(),t.anchorCheck)h.localStorageSet({name:"gameOwnerJoined",params:1}),h.localStorageSet({name:"gamePublishID",params:s.gameid}),g({gamecfgid:s.gamecfgid,gameUrl:s.gameUrl,instId:s.flow,owner_uid:s.uid,timestamp:s.commit_time}),i.enterBtn.data({triggerType:"enterGoTo",state:"gamePlaying"});else{for(;o<s.user.length;o++)if(s.user[o].uid==l.get("sys.uid")){n=!0;break}n?(h.localStorageSet({name:"gameOwnerJoined",params:1}),g({gamecfgid:s.gamecfgid,gameUrl:s.gameUrl,instId:s.flow,owner_uid:s.uid,timestamp:s.commit_time}),i.enterBtn.data({triggerType:"enterGoTo",state:"gamePlaying"})):i.enterBtn.data({triggerType:"enterGoTo",state:"gameJoin"}),a.trigger("dys",{key:"dys.room.normal.show.viewer.inavgame"})}break;case 2:if(t.clearGamePush(),f.gameInfoData=f.game2ListAll[s.game_id],u(),c({type:f.types.gameReady,name:"gameReadyPush",gameStatus:["gameid"]}),t.anchorCheck)h.localStorageSet({name:"gameOwnerJoined",params:1}),h.localStorageSet({name:"gamePublishID",params:s.gameid}),g({gamecfgid:s.gamecfgid,gameUrl:s.gameUrl,instId:s.flow,owner_uid:s.uid,timestamp:s.commit_time}),i.enterBtn.data({triggerType:"enterGoTo",state:"gamePlaying"});else{for(;o<s.user.length;o++)if(s.user[o].uid==l.get("sys.uid")){n=!0;break}n?(h.localStorageSet({name:"gameOwnerJoined",params:1}),g({gamecfgid:s.gamecfgid,gameUrl:s.gameUrl,instId:s.flow,owner_uid:s.uid,timestamp:s.commit_time}),i.enterBtn.data({triggerType:"enterGoTo",state:"gamePlaying"})):t.clearGamePush()}break;case 4:t.clearGamePush(),i.enterBtn.data({triggerType:"enterBtn",state:t.gameProgressCheck()});break;case 5:t.clearGamePush(),r?"gameRestart"==r.nowProgress||"gameCancel"==r.nowProgress?i.enterBtn.data({triggerType:"enterGoTo",state:"gameRestart"}):i.enterBtn.data({triggerType:"enterGoTo",state:"gameList"}):i.enterBtn.data({triggerType:"enterBtn",state:t.gameProgressCheck()});break;case 7:"object"===h.returnType(h.localStorageGet("gameEndPush"))?(t.clearGamePush(),i.gameWarp.find('[data-tag="game-end-timer"]')&&i.gameWarp.find('[data-tag="game-end-timer"]').length>0&&(clearInterval(f.game2WaitTimer),i.gameWarp.find('[data-tag="game-end-timer-warp"]').remove()),i.enterBtn.data({triggerType:"enterGoTo",state:t.anchorCheck?"gameEndResultAnchor":"gameEndResultUser"})):(t.clearGamePush(),i.enterBtn.data({triggerType:"enterBtn",state:t.gameProgressCheck()}));break;case 3:case 6:if(t.clearGamePush(),f.gameInfoData=f.game2ListAll[s.game_id],u(),c({type:f.types.gameReady,name:"gameReadyPush",gameStatus:["gameid","gamecfgid"]}),t.anchorCheck)h.localStorageSet({name:"gameOwnerJoined",params:1}),h.localStorageSet({name:"gamePublishID",params:s.gameid}),g({gamecfgid:s.gamecfgid,gameUrl:s.gameUrl,instId:s.flow,owner_uid:s.uid,timestamp:s.commit_time}),h.localStorageSet({name:"gameStartPush",params:{type:f.types.gameStart,gamecfgid:s.game_id,gameid:s.flow,rid:f.room_id}}),i.enterBtn.data({triggerType:"enterGoTo",state:"gamePlayed"});else{for(;o<s.user.length;o++)if(s.user[o].uid==l.get("sys.uid")){n=!0;break}n?(h.localStorageSet({name:"gameOwnerJoined",params:1}),g({gamecfgid:s.gamecfgid,gameUrl:s.gameUrl,instId:s.flow,owner_uid:s.uid,timestamp:s.commit_time}),h.localStorageSet({name:"gameStartPush",params:{type:f.types.gameStart,gamecfgid:s.game_id,gameid:s.flow,rid:f.room_id}}),i.enterBtn.data({triggerType:"enterGoTo",state:"gamePlayed"})):(t.clearGamePush(),i.enterBtn.data({triggerType:"enterBtn",state:"gameList"}))}break;case 8:case 9:case 10:case 11:default:t.clearGamePush(),i.enterBtn.data({triggerType:"enterGoTo",state:"gameList"})}t.gameEnterOpen()},enterAppend:function(){var t=this,i=this.doms;a.trigger("mod.chat.action.view.add",{tips:t.anchorCheck?f.defaultData.game2EnterAnchorTip:f.defaultData.game2EnterUserTip,flag:f.defaultData.game2Flag,dom:m.enterRender({gameGuideTip:n.get("gameGuideTip")})}),h.localStorageRemove("gameEndPush"),"object"===h.returnType(h.localStorageGet("gameEndPush"))?t.resetGameState({type:"gameEnd"}):1!=h.localStorageGet("gameOwnerJoined")&&t.clearGamePush(),i.enterBtnWarp=e('[data-flag="'+f.defaultData.game2Flag+'"]'),i.enterBtn=e('[data-tag="game-enter-btn"]'),t.eventBind(),t.anchorCheck?i.enterBtn.data({Identity:f.defaultData.userTag,triggerType:"enterBtn",state:""}):i.enterBtn.data({Identity:f.defaultData.anchorTag,triggerType:"userEnterBtn",state:"gameJoin"}),t.anchorCheck&&(n.get("gameGuideTip")||(i.enterTip=i.enterBtn.find('[data-tag="game-enter-tip"]'),i.enterTip.show(),n.set("gameGuideTip",1,31536e3)))},game2SearchPubed:function(){var e=this,t=function(t){if(t&&0==t.error&&t.data&&"object"===h.returnType(t.data)){if(f.otherAnchorGame=t,!f.game2ListAll[t.data.gameId])return;e.gameEnterMsgAppend({gameInfoData:f.game2ListAll[t.data.gameId],pubData:t.data,anchorInfo:{name:t.data.anchorName},curRoom:t.data.roomId==f.room_id?1:0}),setTimeout(function(){f.otherAnchorGame=null},1e4)}};h.requestData({url:f.urls.searchGamePub,data:{roomId:f.room_id}},t)},errorDialog:function(t){var a=this.doms,i=a.gameWarp.find('[data-tag="game-error-dialog"]');i.length>0&&i.remove(),a.gameWarp.append(m.gameErrorTipRender({data:t})),setTimeout(function(){a.gameWarp.find('[data-tag="game-error-dialog"]').fadeOut(500,function(){e(this).remove()})},2e3)},gameFrameAppend:function(){var t,a=this,i=this.doms;f.doms.$body.find('[data-tag="interact-game-wrap"]').remove(),e("#js-stats-and-actions").append(m.gameFrameRender({})),i.gameWarp=e('[data-tag="interact-game-wrap"]'),t=i.gameWarp,i.gameContent=t.find('[data-tag="game-content-warp"]'),i.gameBoxSwitch=t.find('[data-tag="game-view-close"]'),i.gameBackBtn=t.find('[data-tag="game-back-btn"]'),i.gameRightBtn=t.find('[data-tag="game-right-btn"]'),a.eventBindAfter()},gameFrameCheck:function(){var e=this,t=this.doms;"object"!==h.returnType(t.gameWarp)&&e.gameFrameAppend()},gameEnterMsgAppend:function(e){var t=this.doms;t.gameEnterMsg&&t.gameEnterMsg.length>0&&t.gameEnterMsg.remove(),t.enterBtnWarp.append(m.gameEnterMsgRender({data:e})),t.gameEnterMsg=t.enterBtnWarp.find('[data-tag="game-enter-msg"]')},gameListAppend:function(e){var t=this,a=this.doms,i=0,s=function(s){var n;if(!h.anchorCheck()){if(!s||0!=s.error)return;n=s.data}f.game2ListData&&(f.searchGameStatus&&(2!=f.searchGameStatus.status&&3!=f.searchGameStatus.status&&6!=f.searchGameStatus.status||(i=1)),a.gameContent.html(m.gameListRender({gameListData:f.game2ListData,userIdentity:!t.anchorCheck,sendStatusList:n,gamePlayed:i})),t.gameStepState(e),a.gameListBox=a.gameWarp.find(".third-games-selectgame"),t.gameBoxSwitch({state:"open"}))};t.anchorCheck?s():h.requestData({url:f.urls.sendStatus,data:{roomId:f.room_id,cateId:f.cate_id}},s)},changePriceType:function(e){var t=(""+e).split("-");1===t.length&&(t[1]="1");var a={0:"免费",1:"鱼翅",2:"鱼丸"},i=h.formateNumber(t[0],1),s=0===+t[0]?"0":t[1];return[i,a[s]||"",s]},gameSettingAppend:function(e){var t=this,a=this.doms,i=h.returnGameInfoData(),s=h.localStorageGet("gameSetData"),n={},o=function(o){var r,l=o,d=[],c=0,u=0,g=!1,p=!1;for(r in l.awards){var v=t.changePriceType(r);d.push({price:r,show:+v[0]?v[0]+v[1]:v[1],num:v[0],type:v[2],pack:l.awards[r]})}if(d.length<1&&(d.unshift({price:f.defaultData.gameJoinPrice,show:"免费",num:0,type:0,pack:[]}),l.awards[f.defaultData.gameJoinPrice]=[]),"array"===h.returnType(l.limit)?l.limit.length<1&&(l.limit=[],l.limit.push(l.limit[0])):(l.limit=[],l.limit.push(f.defaultData.gameJoinPlayer)),"object"===h.returnType(s)){for(;c<d.length;c++)if(d[c].price==s.setPrice){g=!0;break}for(;u<l.limit.length;u++)if(l.limit[u]==s.setMember){p=!0;break}}else s={setPrice:d[0].price,setMember:l.limit[0],setAutoStart:i.start_trigger,setDesc:""};g||(s.setPrice=d[0].price),p||(s.setMember=l.limit[0]),"object"===h.returnType(s)?(s.setDesc==f.defaultData.gameJoinDesc&&(s.setDesc=""),n={data:l,priceList:d,winPrice:h.formateNumber((s.setMember-1)*s.setPrice.split("-")[0]*.3,2),awardRank:f.defaultData.gameAwardRank,gameSetData:{setPrice:s.setPrice||d[0].price,setMember:s.setMember||l.limit[0],setAutoStart:s.setAutoStart,setDesc:s.setDesc}}):n={data:l,priceList:d,winPrice:h.formateNumber((s.setMember-1)*s.setPrice.split("-")[0]*.3,2),priceType:s.priceType||"鱼翅",gameSetData:{setPrice:d[0].price,setMember:l.limit[0],setAutoStart:i.start_trigger,setDesc:""}},a.gameContent.html(m.gameSettingRender(n)),a.gameWarp.find('[data-tag="game-price-award"]').mCustomScrollbar("destroy").mCustomScrollbar(),t.gameStepState(e),a.gameSetPrice=a.gameWarp.find('[data-tag="set-game-price"]'),a.gameSetMember=a.gameWarp.find('[data-tag="set-game-member"]'),a.gameRemainNum=a.gameWarp.find('[data-tag="remaining-num"]'),a.gamePriceAward=a.gameWarp.find('[data-tag="game-price-award"]')};"object"===h.returnType(i)&&"object"===h.returnType(f.game2ListAll[i.gameid])?(t.gameInfoDataInit(f.game2ListAll[i.gameid]),o(h.returnGameInfoData())):t.gameContentAgent({triggerType:"stepBtn",gameState:"gameList"})},gamePriceAwardAppend:function(e){var t=this.doms,a=h.returnGameInfoData().awards[e];"array"!==h.returnType(a)&&(a=[]),t.gameWarp.find(".third-games-reward-wrapper").html(m.gamePriceAwardRender({data:a,awardRank:f.defaultData.gameAwardRank})),t.gameWarp.find('[data-tag="game-price-award"]').mCustomScrollbar("destroy").mCustomScrollbar()},gameRecordAppend:function(e){var t=this,a=this.doms,i=function(i){return a.gameWarp.find('[data-tag="loading-warp"]').remove(),0!=i.error?void t.errorDialog({title:i.msg}):(i.data.forEach(function(e,t){var a=i.data[t]||{};"object"!==h.returnType(e)&&(e={}),"array"!==h.returnType(e.win_result)&&(a.win_result=[]),"object"!==h.returnType(e.game_info)&&(a.game_info={})}),a.gameContent.html(m.gameRecordRender({data:i})),i.data.length<=0&&a.gameWarp.find('[data-tag="game-goto-set"]').data({state:"gameSet"}),t.gameStepState(e),void("object"!==h.returnType(h.localStorageGet("gameRecordList"))&&h.localStorageSet({name:"gameRecordList",params:i,expired:f.defaultData.expiredTime})))};a.gameWarp.append(m.gameLoadingRender({data:{title:"加载中..."}})),"object"===h.returnType(h.localStorageGet("gameRecordList"))?i(h.localStorageGet("gameRecordList")):h.requestData({url:f.urls.gameRecord,data:{uid:l.get("sys.uid")}},i)},gamePublishReq:function(){var e,t=this,a=this.doms;t.localGameSetData({type:f.defaultData.anchorTag}),e=h.localStorageGet("gameSetData");var i=function(e){a.gameWarp.find('[data-tag="loading-warp"]').remove(),0==e.error?(f.instId=e.data.instId,h.localStorageSet({name:"gamePublishID",params:e.data.instId}),t.anchorCheck&&(t.game2DpConfig({dpType:"dys.room.normal.click.anchor.inavgame.publish"}),t.gamePlayingAppend({stateData:{gameState:"gamePlaying",triggerType:"stepBtn"},pushData:e.data}))):t.errorDialog({title:e.msg})};a.gameWarp.append(m.gameLoadingRender({data:{title:"发布中..."}})),h.getCSRFCookie(s,function(t){var a={gameId:h.returnGameInfoData().gameid,roomId:f.room_id,cateId:f.cate_id,price:e.setPrice,total:e.setMember,remark:e.setDesc,autoStart:e.setAutoStart};a[t.name]=t.val,h.requestData({url:f.urls.gamePublish,type:"POST",data:a},i)})},gamePlayingAppend:function(e){var t,a,i=this,s=this.doms,n=e,o=e.stateData,r=h.returnGameInfoData(),d=h.localStorageGet("gameJoinListPush"),c=h.localStorageGet("gameSetData"),u=h.localStorageGet("gameStartPush"),g=function(){s.gameWarp.find('[data-tag="game-wait-time"]').hide(),s.gameWarp.find('[data-tag="header-status-text"]').text("游戏取消中…")},p=function(){var e;clearInterval(f.game2WaitTimer),s.gameWarp.find('[data-tag="game-wait-time"]').text("-- : --"),"object"===h.returnType(u)?i.gameHeadStatus({status:"played"}):(e="object"===h.returnType(d)?c.setMember-d.user.length:c.setMember-1,i.gameHeadStatus({member:e})),a=function(e){0==e.error&&(t=900-(e.msg-parseInt(n.timestamp,10)),t>900&&(t=900),s.gameWarp.find('[data-tag="game-wait-time"]').show(),s.gameWarp.find('[data-tag="header-status-text"]').text(" 未开始游戏将自动取消"),h.countTimer({type:"minute",time:t,ele:s.gameWarp.find('[data-tag="game-wait-time"]'),callback:g}))},h.requestData({url:f.urls.severTimeTick},a)};return e.pushData?(n=e.pushData,n.owner_uid=l.get("sys.uid"),s.gameContent.html(m.gamePlayingRender({pushData:n,gameInfoData:r})),s.gameWarp.find('[data-tag="loading-warp"]').remove(),s.gameWaitTime=s.gameWarp.find('[data-tag="game-wait-time"]'),s.gameWarp.find('[data-tag="game-view-container"]').css({width:r.w,height:r.h}),h.localStorageSet({name:"gamePlayingPush",params:n}),i.gameStepState(o),"object"===h.returnType(h.localStorageGet("gameReadyPush"))&&(s.gameWarp.find('[data-tag="game-step-btn"]').removeClass("status-disable"),s.gameWarp.find('[data-tag="game-user-status"]').addClass("status-active status-long").text("人数已满请开始游戏")),void p()):(i.clearGamePush(),void i.gameContentAgent({triggerType:"stepBtn",gameState:"gameList"}))},gameCancelAppend:function(e){var t=this,a=this.doms,i=e.stateData,n=h.localStorageGet("gamePublishPush")||{};if(t.anchorCheck)if("timeOut"==e.cancelType||"gameError"==e.cancelType||"gamePlayError"==e.cancelType||"gameStop"==e.cancelType)e.identity=1,t.resetGameState({type:"cancel"}),a.gameWarp.find('[data-tag="game-cancel-warp"]').fadeOut().remove(),a.gameContent.html(m.gameCancelRender({data:e})),t.gameStepState(i);else{var o=function(e){a.gameWarp.find('[data-tag="loading-warp"]').remove(),0==e.error?t.anchorCheck&&(t.resetGameState({type:"cancel"}),a.gameWarp.find('[data-tag="game-cancel-warp"]').remove(),t.gameContentAgent({triggerType:"stepBtn",gameState:"gameSet"}),clearInterval(f.game2WaitTimer),a.gameWarp.find('[data-tag="game-wait-time"]').text("-- : --")):t.errorDialog({title:e.msg})};a.gameWarp.append(m.gameLoadingRender({data:{title:"取消中..."}})),h.getCSRFCookie(s,function(e){var t={instId:f.instId||h.localStorageGet("gamePublishID")};t[e.name]=e.val,h.requestData({url:f.urls.gameCancel,type:"POST",data:t},o)})}else e.identity=2,e.gameid=n.gameid,t.resetGameState({type:"cancel"}),a.gameWarp.find('[data-tag="game-cancel-warp"]').fadeOut().remove(),a.gameContent.html(m.gameCancelRender({data:e})),t.gameStepState(i)},gameCancelPopAppend:function(e){var t=this.doms;t.gameWarp.append(m.gameCancelPopRender({data:e}))},gameJoinAppend:function(e){var t=this,a=this.doms,i=h.localStorageGet("gamePublishPush"),s=function(){var s=[(+i.price).toFixed(1),i.currency].join("-"),n=t.changePriceType(s);t.nowGameCostType=n[2];var o=0===+n[2]?n[1]:n[0],r={0:"",1:"鱼翅",2:"鱼丸"};a.gameContent.html(m.gameJoinRender({anchorInfo:f.anchorInfo,awardRand:f.defaultData.gameAwardRank,pushData:i,joinCost:o,joinCell:r[n[2]],gameInfoData:h.returnGameInfoData()})),t.gameStepState(e),a.gameWarp.find('[data-tag="game-join-scroll"]').mCustomScrollbar("destroy").mCustomScrollbar()};c.load(f.urls.gameInfo,"getGameInfo",function(e){f.game2ListAll=e,t.gameInfoDataInit(f.game2ListAll[i.gamecfgid]),s()},function(){},"",!0)},gameJoinReq:function(){var e=this,t=this.doms,i=h.localStorageGet("gamePublishPush"),n=function(i){var s;switch(t.gameWarp.find('[data-tag="loading-warp"]').remove(),parseInt(i.error,10)){case 0:t.gameWarp.find('[data-tag="game-join-btn"]').addClass("third-games-btn-disabled").text("报名成功"),e.gamePlayingAppend({stateData:{gameState:"gamePlaying",triggerType:"stepBtn"},pushData:i.data});break;case 12:s="人数已满",e.gameRemainPopAppend({data:"memberFull"}),t.gameWarp.find('[data-tag="game-join-btn"]').addClass("third-games-btn-disabled").text(s);break;case 207:case 211:case 13:s="稍后再试",e.gameRemainPopAppend({data:"joinError"});break;case 283:s="鱼翅不足";var n=e.nowGameCostType;2===+n?a.trigger("mod.gift.draw.fish.dialog"):e.gameRemainPopAppend({data:"gameRecharge"});break;default:s="稍后再试",e.errorDialog({title:i.msg})}};t.gameWarp.append(m.gameLoadingRender({data:{title:"努力报名中..."}})),h.getCSRFCookie(s,function(e){var t={instId:i.gameid,roomId:f.room_id};t[e.name]=e.val,h.requestData({url:f.urls.gameJoin,type:"POST",data:t},n)})},gameEndResultAppend:function(e){var t=this,a=this.doms,i=e.stateData,s=e.pushData;return"object"!==h.returnType(s)?void t.gameContentAgent({triggerType:"stepBtn",gameState:"gameList"}):(a.gameWarp.find('[data-tag="game-playing-warp"]').remove(),t.anchorCheck&&t.game2DpConfig({dpType:"dys.room.normal.show.anchor.inavgame.continue"}),a.gameContent.html(m.gameEndResultRender(s)),clearInterval(f.game2WaitTimer),a.gameWarp.find('[data-tag="game-wait-time"]').text("-- : --"),t.gameStepState(i),a.gameWarp.find('[data-tag="game-over-scroll"]').mCustomScrollbar("destroy").mCustomScrollbar(),void(t.anchorCheck||h.localStorageRemove("gameProgress")))},gameRemainPopAppend:function(e){var t=this.doms;t.gameWarp.append(m.gameRemainPopRender(e))},gameHeadStatus:function(e){var t=this.doms,a=e;return a?"played"==e.status?void t.gameWarp.find('[data-tag="game-status-header"]').hide():void(a.member>0?(t.gameWarp.find('[data-tag="game-wait-status"]').show(),t.gameWarp.find('[data-tag="gameing-stauts"]').hide(),t.gameWarp.find('[data-tag="header-status-text"]').html(" 未开始游戏将自动取消")):(t.gameWarp.find('[data-tag="game-wait-status"]').hide(),t.gameWarp.find('[data-tag="gameing-stauts"]').show())):void 0},sendGameReq:function(e){var t=this,i=this.doms,n=function(s){i.gameWarp.find('[data-tag="loading-warp"]').remove(),0==s.error?(i.gameWarp.find('[data-tag="game-list-item"][data-gid="'+e.gameId+'"]').addClass("has-sent").find('[data-tag="send-game-req"]').text("已发送给主播"),a.trigger("mod.chat.msg.msg",m.gamePushMsgRender({type:"sendPlayMsg",pushData:{userInfo:{name:l.get("sys.nickname")}},gameInfoData:f.game2ListAll[e.gameId]}))):t.errorDialog({title:s.msg})};i.gameWarp.append(m.gameLoadingRender({data:{title:"发送中..."}})),h.getCSRFCookie(s,function(t){var a={gameId:e.gameId,roomId:f.room_id};a[t.name]=t.val,h.requestData({url:f.urls.sendPlay,type:"POST",data:a},n)})},clearGamePush:function(){for(var e=this.doms,t=this,a=["gamePublishPush","gamePlayingPush","gamePublishID","gameJoinListPush","gameOwnerJoined","gameReadyPush","gameStartPush"],i=0;i<a.length;i++)h.localStorageRemove(a[i]);e.enterBtn&&e.enterBtn.data({triggerType:"enterBtn",state:""}),t.anchorCheck||(h.localStorageRemove("gameInfoData"),h.localStorageRemove("gameProgress"),h.localStorageRemove("gameSetData"))},resetGameState:function(e){for(var t=this.doms,a=this,i=["gameProgress","gamePublishPush","gamePlayingPush","gamePublishID","gameJoinListPush","gameOwnerJoined","gameReadyPush","gameStartPush"],s=0;s<i.length;s++)h.localStorageRemove(i[s]);if(a.anchorCheck||h.localStorageRemove("gameSetData"),t.enterBtn&&t.enterBtn.data({triggerType:"enterBtn",state:""}),"object"===h.returnType(e))switch(e.type){case"close":h.localStorageRemove("gameSetData");break;case"cancel":}},gameBoxSwitch:function(e){var t=this.doms;"open"===e.state?t.gameWarp.show():"close"===e.state&&(t.gameWarp.hide(),t.gameContent.empty())},gameFrameState:function(e){var t=this,a=this.doms,i=e,s=h.returnGameInfoData(),n=a.gameWarp.find('[data-tag="game-page-title"]');if(i.title?("object"===h.returnType(i.title)?t.anchorCheck?"gameName"===i.title.anchor?n.text(s.name):n.text(i.title.anchor):n.text(i.title.user):n.text(i.title),a.gameWarp.find('[data-tag="game-page-title"]').show()):a.gameWarp.find('[data-tag="game-page-title"]').hide(),i.backBtn?a.gameWarp.find('[data-tag="game-back-btn"]').show().find("span").text(i.backBtn):a.gameWarp.find('[data-tag="game-back-btn"]').hide(),i.recordBtn&&t.anchorCheck?a.gameWarp.find('[data-tag="game-record-btn"]').show():a.gameWarp.find('[data-tag="game-record-btn"]').hide(),i.headStatus?a.gameWarp.find('[data-tag="game-status-header"]').show():a.gameWarp.find('[data-tag="game-status-header"]').hide(),i.rightBtn){if("array"===h.returnType(i.rightBtn)){a.gameWarp.find('[data-tag="game-cancel-btn"]').hide(),a.gameWarp.find('[data-tag="game-view-close"]').hide();for(var o=0;o<i.rightBtn.length;o++){if("game-cancel-btn"===i.rightBtn[o]){if(!t.anchorCheck)continue;if("gamePlayed"==i.state)continue}a.gameWarp.find('[data-tag="'+i.rightBtn[o]+'"]').show()}}a.gameRightBtn.show()}else a.gameRightBtn.hide();t.gameBoxSwitch({state:"open"}),a.gameContent.find(".third-games-content").mCustomScrollbar("destroy").mCustomScrollbar()},gameInfoDataInit:function(e){f.gameInfoData=e,h.localStorageSet({name:"gameInfoData",params:e,expired:-1})},localGameSetData:function(t){var a=this.doms,i=h.returnGameInfoData();if("object"===h.returnType(t.pushGameSetData))f.gameSetData.setPrice=t.pushGameSetData.price,f.gameSetData.setMember=parseInt(t.pushGameSetData.limit,10),f.gameSetData.setAutoStart=parseInt(t.pushGameSetData.autoStart,10),f.gameSetData.setDesc=t.pushGameSetData.desc;else{var s=a.gameWarp.find('.active[data-tag="set-game-price"]');f.gameSetData.setPrice=s.attr("data-id"),f.gameSetData.setMember=parseInt(a.gameWarp.find('.active[data-tag="set-game-member"]').attr("data-num"),10),"object"===h.returnType(i)&&parseInt(i.start_trigger,10)?f.gameSetData.setAutoStart=parseInt(a.gameWarp.find('.active[data-tag="game-start-auto"]').attr("data-switch"),10):f.gameSetData.setAutoStart=1,
""!=e.trim(a.gameWarp.find('[data-tag="game-remain-desc"]').val())?f.gameSetData.setDesc=a.gameWarp.find('[data-tag="game-remain-desc"]').val():f.gameSetData.setDesc=f.defaultData.gameJoinDesc}h.localStorageSet({name:"gameSetData",params:f.gameSetData,expired:-1})},gameStepState:function(e){var t,a=this,i=e.gameState,s=h.localStorageGet("gameProgress"),n=[];a.gameFrameState(f.gameStep[i]),"object"===h.returnType(s)&&(n=s.historyProgress),t=f.notRecordList.some(function(t,a){return t==e.triggerType}),t||n.push(i),h.localStorageSet({name:"gameProgress",params:{historyProgress:n,nowProgress:i}})},gameContentAgent:function(e){var t,a,i=this,s=this.doms,n=h.localStorageGet("gameProgress");switch(i.gameFrameCheck(),e.triggerType){case"stepBtn":t=e.gameState;break;case"enterGoTo":t=s.enterBtn.data("state"),s.enterBtn.data({triggerType:"enterBtn",state:""});break;case"enterGameEnd":t=s.enterBtn.data("state");break;case"enterBtn":t="object"===h.returnType(n)?n.nowProgress:"null";break;case"userEnterBtn":t="object"===h.returnType(n)?n.nowProgress:"gameList";break;case"backBtn":"object"===h.returnType(n)?(t=n.historyProgress[n.historyProgress.length-2],a=n.historyProgress.pop(),h.localStorageSet({name:"gameProgress",params:{historyProgress:n.historyProgress,nowProgress:a}})):t="null";break;case"recordBtn":case"cancelBtn":default:t=e.gameState}switch(t){case"gameList":i.gameListAppend({gameState:"gameList",triggerType:e.triggerType});break;case"gameSet":case"gameContinue":case"gameRestartPlay":i.gameSettingAppend({gameState:"gameSet",triggerType:e.triggerType});break;case"gamePlaying":i.gamePlayingAppend({stateData:{gameState:"gamePlaying",triggerType:e.triggerType},pushData:h.localStorageGet("gamePlayingPush")});break;case"gamePlayed":i.gamePlayingAppend({stateData:{gameState:"gamePlayed",triggerType:e.triggerType},pushData:h.localStorageGet("gamePlayingPush")});break;case"gameRestart":i.gameCancelAppend({cancelType:"timeOut",stateData:{gameState:"gameRestart",triggerType:"cancelBtn"}});break;case"gameJoin":i.gameJoinAppend({gameState:"gameJoin",triggerType:e.triggerType});break;case"gameEndResultAnchor":i.gameEndResultAppend({data:{Identity:f.defaultData.anchorTag},stateData:{gameState:"gameEndResultAnchor",triggerType:e.triggerType},pushData:h.localStorageGet("gameEndPush")});break;case"gameEndResultUser":i.gameEndResultAppend({data:{Identity:f.defaultData.userTag},stateData:{gameState:"gameEndResultUser",triggerType:e.triggerType},pushData:h.localStorageGet("gameEndPush")||f.gameResultD});break;case"gameCancel":i.gameFrameClose();break;case"gameRecord":i.gameRecordAppend({gameState:"gameRecord",triggerType:e.triggerType});break;case"gameClose":i.gameBoxSwitch({state:"close"}),"object"===h.returnType(h.localStorageGet("gamePublishPush"))?h.localStorageGet("gamePublishPush").gameid==f.instId?i.resetGameState({type:"close"}):(s.enterBtn.data({triggerType:"enterBtn",state:""}),h.localStorageRemove("gameProgress")):i.resetGameState({type:"close"});break;default:i.gameListAppend({gameState:"gameList",triggerType:e.triggerType})}},flashGamePublish:function(t){var a,i=this,s=this.doms,n=t;h.localStorageRemove("gameEndPush");var o=function(){if(f.gameId=n.gamecfgid,f.instId=n.gameid,a=f.game2ListAll[n.gamecfgid]){var t=[n.price,n.currency].join("-");if(n.newAwards=a.awards[t],"array"!==h.returnType(n.newAwards)&&(n.newAwards=[]),n.owner_uid=l.get("sys.uid"),n.autoStart=n.autostart,e('[data-tag="game-publish-msg"]').css("cursor","pointer"),h.localStorageSet({name:"gameInfoData",params:a}),"object"!==h.returnType(h.localStorageGet("gamePublishPush")))if(h.localStorageSet({name:"gamePublishPush",params:n}),i.anchorCheck)i.gameFrameCheck(),h.localStorageSet({name:"gameOwnerJoined",params:1}),i.localGameSetData({type:f.defaultData.anchorTag,pushGameSetData:n}),i.gameHeadStatus({member:n.limit-1});else{if(i.gameEnterMsgAppend({gameInfoData:a,pubData:{roomId:f.room_id,game_desc:{remark:n.desc}},anchorInfo:f.anchorInfo,curRoom:1}),i.localGameSetData({type:f.defaultData.userTag,pushGameSetData:n}),clearTimeout(f.gameCloseSetTime),"object"!==h.returnType(s.gameWarp)||s.gameWarp.is(":hidden"))return;if(s.gameWarp.find('[data-tag="game-end-timer"]')&&s.gameWarp.find('[data-tag="game-end-timer"]').length>0)return;i.gameJoinAppend({gameState:"gameJoin",triggerType:"enterStep"})}}};f.game2ListAll?o():c.load(f.urls.gameInfo,"getGameInfo",function(e){f.game2ListAll=e,o()},function(){},"",!0)},flashGameJoin:function(e){var t=this,i=this.doms,s=e,n=h.localStorageGet("gamePublishPush"),r=0,d=[],c=!1,u=null;if(s.type===f.types.gameJoin){if(s.user=o.decode(s.user),r=s.user.length,s.user.forEach(function(e){var t=o.decode(e.value).too();t.uid==l.get("sys.uid")&&(c=!0),s["new"]==t.uid&&(u=t.name),d.push(t)}),a.trigger("mod.chat.msg.msg",m.gamePushMsgRender({type:"joinMsg",userName:u,gameName:"互动游戏"})),s.total=r,h.browserCheck().msie)return!1;if(c&&t.gameHeadStatus({member:n.limit-r}),h.localStorageSet({name:"gameJoinListPush",params:s}),"object"!==h.returnType(i.gameWarp))return;t.anchorCheck||s["new"]==l.get("sys.uid")&&(f.instId=s.gameid,h.localStorageSet({name:"gameOwnerJoined",params:1}))}},flashGameCancel:function(e){var t,a=this,i=this.doms,s=e;if(a.gameFrameCheck(),i.gameWarp.find('[data-tag="loading-warp"]').remove(),a.anchorCheck)switch(i.gameWarp.find('[data-tag="game-cancel-warp"]').remove(),parseInt(s.cancelType,10)){case 5:a.game2DpConfig({dpType:"dys.room.normal.show.anchor.inavgame.overtime"}),a.gameCancelAppend({cancelType:"timeOut",stateData:{gameState:"gameRestart",triggerType:"cancelBtn"}}),a.gameEnterOpen(),i.enterBtn.data({triggerType:"enterStep",state:"",cancelType:"timeOut"}),a.resetGameState({type:"cancel"});break;case 8:case 11:a.gameCancelAppend({cancelType:"gameError",stateData:{gameState:"gameCancel",triggerType:"cancelBtn"}}),a.gameEnterOpen(),i.enterBtn.data({triggerType:"enterBtn",state:"gameList"});break;case 9:a.gameCancelAppend({cancelType:"gamePlayError",stateData:{gameState:"gameCancel",triggerType:"cancelBtn"}}),a.gameEnterOpen(),i.enterBtn.data({triggerType:"enterBtn",state:"gameList"});break;case 10:a.gameCancelAppend({cancelType:"gameStop",stateData:{gameState:"gameCancel",triggerType:"cancelBtn"}}),a.gameEnterOpen(),i.enterBtn.data({triggerType:"enterBtn",state:"gameList"})}else{switch(1==h.localStorageGet("gameOwnerJoined")?a.gameEnterOpen():setTimeout(function(){"object"!==h.returnType(h.localStorageGet("gamePublishPush"))&&a.gameFrameClose()},6e4),parseInt(s.cancelType,10)){case 10:case 4:t="closeUP";break;case 5:t="timeOut";break;case 9:t="gamePlayError";break;case 8:case 11:default:t="gameError"}if(i.enterBtn.data({triggerType:"enterStep",state:"gameCancel",cancelType:t}),1!=h.localStorageGet("gameOwnerJoined")&&("object"!==h.returnType(i.gameWarp)||i.gameWarp.is(":hidden")))return;a.gameCancelAppend({cancelType:t,stateData:{gameState:"gameCancel",triggerType:"cancelBtn"}}),a.resetGameState({type:"cancel"})}clearInterval(f.game2WaitTimer),i.gameWarp.find('[data-tag="game-wait-time"]').text("-- : --")},flashGameReady:function(e){var t=this,a=this.doms,i=e;g.exe("js_gmrdy",o.encode([{name:"rid",value:l.get("room.room_id")},{name:"uid",value:l.get("sys.uid")},{name:"gameid",value:i.gameid}])),"object"!==h.returnType(h.localStorageGet("gameReadyPush"))&&(t.gameHeadStatus({member:0}),h.localStorageSet({name:"gameReadyPush",params:i}),a.gameWarp&&!a.gameWarp.is(":hidden")||t.game2EnterAgent({type:"eClick"}))},flashGamePlay:function(e){var t=this,a=this.doms,i=e;g.exe("js_gmst",o.encode([{name:"rid",value:l.get("room.room_id")},{name:"uid",value:l.get("sys.uid")},{name:"gameid",value:i.gameid}])),"object"!==h.returnType(h.localStorageGet("gameStartPush"))&&(h.localStorageSet({name:"gameStartPush",params:i}),a.gameWarp&&!a.gameWarp.is(":hidden")?t.gameStepState({gameState:"gamePlayed",triggerType:"stepBtn"}):t.game2EnterAgent({type:"eClick"}),t.gameHeadStatus({status:"played"}),t.anchorCheck&&t.game2DpConfig({dpType:"dys.room.normal.show.anchor.inavgame.gamebegin"}))},flashGameEnd:function(t){var i,s,n=this,r=this.doms,d=t,c=[],u=[],g=[];e('[data-tag="game-publish-msg"]').css("cursor","inherit"),d.user=o.decode(d.user),d.user.forEach(function(e){var t=o.decode(e.value).too();l.get("sys.uid")==t.uid&&(s=!0),t.uid==d.win?d.winUser=t:c.push(t)}),d.user=c,d.owner_uid=l.get("sys.uid"),d.winIndex=0,d.wins=o.decode(d.wins),d.wins.forEach(function(e,t){g.push(e.value);for(var a=0;a<d.user.length;a++)e.value==d.user[a].uid&&u.push(d.user[a]);e.value==l.get("sys.uid")&&(d.winIndex=t+1)}),d.wins=g,d.winerUser=u,a.trigger("mod.chat.msg.msg",m.gamePushMsgRender({type:"winMsg",winUserInfo:d.winerUser[0]})),i={identity:n.anchorCheck?f.defaultData.anchorTag:f.defaultData.userTag,pushData:d,gameAwardRank:f.defaultData.gameAwardRank,gameInfoData:h.returnGameInfoData(),gamePubData:h.localStorageGet("gamePublishPush")},h.localStorageSet({name:"gameEndPush",params:i}),f.gameResultD=i,n.gameFrameCheck();var p=function(){if(r.gameWarp.find('[data-tag="game-end-timer-warp"]').remove(),"object"!==h.returnType(h.localStorageGet("gameEndPush"))){if(n.anchorCheck)return;d=f.gameResultD}n.anchorCheck?n.gameContentAgent({triggerType:"stepBtn",gameState:"gameEndResultAnchor"}):s&&(n.gameContentAgent({triggerType:"stepBtn",gameState:"gameEndResultUser"}),r.enterBtn.data({triggerType:"enterGameEnd",state:"gameEndResultUser"}),f.gameCloseSetTime=setTimeout(function(){if(("object"===h.returnType(h.localStorageGet("gameEndPush"))||"object"===h.returnType(f.gameResultD))&&"object"===h.returnType(h.localStorageGet("gamePublishPush"))){if(f.gameResultD="",h.localStorageGet("gamePublishPush").gameid!=f.instId)return;n.gameFrameClose()}f.gameResultD=""},6e4))};s?(r.gameWarp.append(m.gameEndTimer()),h.countTimer({type:"second",time:5,ele:r.gameWarp.find('[data-tag="game-end-timer"]'),callback:p})):p()},flashPushTrigger:function(){var t=this;g.reg("room_data_login",function(e){var t=o.decode(e).too();t.type==f.types.userConnected&&(f.userConnectStatus=!0)}),g.reg("room_data_handler",function(i){var s=o.decode(i).too(),n=h.localStorageGet("gamePublishPush");switch(s.type){case f.types.gameStart:"object"===h.returnType(n)?n.instId!=s.gameid&&("object"===h.returnType(h.localStorageGet("gameEndPush"))&&(f.gameResultD=h.localStorageGet("gameEndPush")),t.resetGameState(),t.flashGamePublish(s)):t.flashGamePublish(s);break;case f.types.gameJoin:"object"===h.returnType(n)&&n.gameid==s.gameid?t.flashGameJoin(s):t.resetGameState();break;case f.types.gameCancel:"object"===h.returnType(n)&&n.gameid==s.gameid&&(e('[data-tag="game-publish-msg"]').css("cursor","inherit"),t.flashGameCancel(s));break;case f.types.gameReady:"object"===h.returnType(n)&&n.gameid==s.gameid&&t.flashGameReady(s);break;case f.types.gamePlay:"object"===h.returnType(n)&&n.gameid==s.gameid&&t.flashGamePlay(s);break;case f.types.gameEnd:"object"===h.returnType(n)&&n.gameid==s.gameid&&t.flashGameEnd(s),s.gameid==f.instId&&h.localStorageRemove("gameProgress");break;case f.types.gameSend:s.userInfo=o.decode(s.user).too(),a.trigger("mod.chat.msg.msg",m.gamePushMsgRender({type:"sendPlayMsg",pushData:s,gameInfoData:f.game2ListAll[s.gamecfgid]}))}})},game2DpConfig:function(e){var t=h.localStorageGet("gameSetData");e&&e.dpType&&"object"===h.returnType(t)&&a.trigger("dys",{key:e.dpType,prc_type:t.setPrice,join_num:t.setMember,a_on:t.setAutoStart,is_fill:t.setDesc==f.defaultData.gameJoinDesc?0:1,game_id:h.returnGameInfoData().gameid,game_name:h.returnGameInfoData().name})},gameEnterOpen:function(){var e=this,t=this.doms;t.gameWarp&&!t.gameWarp.is(":hidden")||e.gameContentAgent({triggerType:t.enterBtn.data("triggerType"),gameState:t.enterBtn.data("state")})},gameFrameClose:function(){var e=this,t=this.doms;t.gameWarp.find('[data-tag="game-end-timer"]')&&t.gameWarp.find('[data-tag="game-end-timer"]').length>0&&(clearInterval(f.game2WaitTimer),t.gameWarp.find('[data-tag="game-end-timer-warp"]').remove()),h.localStorageRemove("gameEndPush"),e.gameBoxSwitch({state:"close"})},alertMsg:function(t,a,i,s){var n=this,o="";a=e.isFunction(a)?a:function(){},i=e.isFunction(i)?i:function(){};try{switch(s){case 4:case"succeed":o="succeed";break;case 3:o="error";break;case 2:o="question";break;default:o="warning"}e.dialog({lock:!0,content:t,icon:o,ok:function(){return a.call(n),!0},cancel:function(){i.call(n)}})}catch(r){e.dialog.tips_black(t)}},eventBind:function(){var t=this,i=this.doms;i.enterBtn.on("click",function(s){return h.eventDefault(s),i.enterTip&&i.enterTip.fadeOut().remove(),h.browserCheck().msie?void e.dy_dialog(m.browserWarningRender(),{mask:1,width:"550px",className:"interactgame-updatedialog-wrap"}):d.check()?i.gameWarp&&!i.gameWarp.is(":hidden")?void t.gameBoxSwitch({state:"close"}):void(t.anchorCheck?(a.trigger("dys",{key:"dys.room.normal.click.anchor.inavgame",rid:f.room_id,tid:f.cate_id}),t.game2EnterAgent({type:"eClick"})):(a.trigger("dys",{key:"dys.room.normal.click.viewer.inavgame"}),t.game2EnterAgent({type:"eClick"}))):void d.show("login")}).on("click",".third-games-guide-close",function(){return i.enterBtn.find('[data-tag="game-enter-tip"]').remove(),i.enterBtnWarp.trigger("mouseleave"),!1}).on("mouseenter",function(){t.anchorCheck||t.game2EnterAgent({type:"eHover"})}),i.enterBtnWarp.on("click",".third-games-tip-close",function(){return i.enterBtnWarp.find('[data-tag="game-enter-msg"]').remove(),i.enterBtnWarp.trigger("mouseleave"),!1}).on("click",'[data-tag="game-enter-msg"]',function(){var s=e(this),n=s.data("rid"),o=s.data("gid"),r=s.data("cid");return s.remove(),h.browserCheck().msie?void e.dy_dialog(m.browserWarningRender(),{mask:1,width:"550px",className:"interactgame-updatedialog-wrap"}):d.check()?n==f.room_id?(a.trigger("dys",{key:"dys.room.normal.click.viewer.remind_game",game_id:o,game_name:f.game2ListAll[o].name}),t.game2EnterAgent({type:"eClick"}),i.enterBtnWarp.trigger("mouseleave"),!1):(a.trigger("dys",{key:"dys.room.normal.click.viewer.remind_room",game_id:o,game_name:f.game2ListAll[o].name,rid:n,tid:r}),void i.enterBtnWarp.trigger("mouseleave")):void d.show("login")}),e('[data-type="chat-list"]').on("click",'[data-tag="game-publish-msg"]',function(a){return"object"===h.returnType(h.localStorageGet("gamePublishPush"))&&"pointer"==e(this).css("cursor")&&t.gameEnterOpen(),!1})},eventBindAfter:function(){var t=this,i=this.doms;i.gameBoxSwitch.off("click"),i.gameBoxSwitch.on("click",function(){return a.trigger("dys",{key:"dys.room.normal.click.anchor.inavgame.close"}),t.gameFrameClose(),!1}),i.gameBackBtn.on("click",function(e){h.eventDefault(e),t.gameContentAgent({triggerType:"backBtn"})}),i.gameWarp.off("click").on("click",".third-games-selectgame dd",function(){var i=e(this).data("gid");if(t.anchorCheck){if(h.localStorageRemove("gameSetData"),"object"!==h.returnType(f.game2ListAll[i]))return t.errorDialog({title:"未查到当前游戏"}),void t.enterCheck({type:"update"});t.gameInfoDataInit(f.game2ListAll[i]),a.trigger("dys",{key:"dys.room.normal.click.anchor.inavgame.sel",pos:e(this).index(),game_name:f.game2ListAll[i].name,game_id:i}),t.gameContentAgent({triggerType:"stepBtn",gameState:"gameSet"})}return!1}).on("click",'[data-tag="send-game-req"]',function(i){h.eventDefault(i);var s=e(this).data("gid");e(this).closest('[data-tag="game-list-item"]').hasClass("has-sent")||(a.trigger("dys",{key:"dys.room.normal.click.viewer.send_play",game_name:f.game2ListAll[s].name,game_id:s}),t.sendGameReq({gameId:s}))}).on("click",'[data-tag="set-game-price"]',function(){var a,s;if(!e(this).hasClass("active")){i.gameWarp.find('[data-tag="set-game-price"]').removeClass("active"),e(this).addClass("active"),s=i.gameWarp.find('[data-tag="set-game-member"].active').attr("data-num");var n=e(this).attr("data-num"),o=e(this).attr("data-type"),r=f.priceMap[o];return+o?(a=h.formateNumber((s-1)*n*.3,2),i.gameWarp.find('[data-tag="game-profile-num"]').text(a),i.gameWarp.find('[data-tag="game-profile-cell"]').text(r)):(i.gameWarp.find('[data-tag="game-profile-num"]').text(r),i.gameWarp.find('[data-tag="game-profile-cell"]').text("鱼翅")),2===+o?i.gameWarp.find(".js-game2-1-gift-icon").addClass("game-fish-ball"):i.gameWarp.find(".js-game2-1-gift-icon").removeClass("game-fish-ball"),t.gamePriceAwardAppend(e(this).attr("data-id")),!1}}).on("click",'[data-tag="game-start-auto"]',function(){return i.gameWarp.find('[data-tag="game-start-auto"]').removeClass("active"),e(this).addClass("active"),!1}).on("click",'[data-tag="set-game-member"]',function(t){var a,s;return i.gameWarp.find('[data-tag="set-game-member"]').removeClass("active"),e(this).addClass("active"),s=i.gameWarp.find('[data-tag="set-game-price"].active').attr("data-num"),a=h.formateNumber((e(this).attr("data-num")-1)*s*.3,2),i.gameWarp.find('[data-tag="game-profile-num"]').text(a),!1}).on("keyup",'[data-tag="game-remain-desc"]',function(t){h.eventDefault(t);var a=e(this).val();a=a.replace(/(^\s*)/g,""),a.length<1&&e(this).val(a),i.gameWarp.find('[data-tag="game-remain-num"]').text(a.length>=50?50:a.length),a.length>=50?i.gameWarp.find('[data-tag="game-remain-num"]').addClass("active"):i.gameWarp.find('[data-tag="game-remain-num"]').removeClass("active")}).on("click",".third-games-expand-icon",function(){var e=i.gameWarp.find('[data-tag="game-price-award"]');return e.hasClass("is-expand")?e.removeClass("is-expand"):e.addClass("is-expand"),!1}).on("click",'[data-tag="game-publish-btn"]',function(){return t.gamePublishReq(),!1}).on("click",'[data-tag="game-cancel-btn"]',function(){return t.gameCancelPopAppend(),!1}).on("click",'[data-tag="game-join-btn"]',function(){return e(this).hasClass("third-games-btn-disabled")?void 0:(t.game2DpConfig({dpType:"dys.room.normal.click.viewer.inavgame.join"}),t.gameJoinReq(),!1)}).on("click",'[data-tag="game-list-goto"]',function(){return t.gameContentAgent({triggerType:"stepBtn",gameState:"gameList"}),!1}).on("click",'[data-tag="game-play-back"]',function(){return t.resetGameState({type:"close"}),t.gameContentAgent({triggerType:"stepBtn",gameState:"gameList"}),!1}).on("click",'[data-tag="game-record-btn"]',function(){return a.trigger("dys",{key:"dys.room.normal.click.anchor.inavgame.record"}),t.gameRecordAppend({gameState:"gameRecord",triggerType:"recordBtn"}),!1}).on("click",'[data-tag="game-republish-btn"]',function(){return t.gameContentAgent({triggerType:"stepBtn",gameState:"gameRestartPlay"}),a.trigger("dys",{key:"dys.room.normal.click.anchor.inavgame.republish"}),!1}).on("click",'[data-tag="game-cancel-confirm"]',function(e){return t.game2DpConfig({dpType:"dys.room.normal.click.anchor.inavgame.cancle"}),t.gameCancelAppend({cancelType:"closeUP",stateData:{gameState:"gameCancel",triggerType:"cancelBtn"}}),!1}).on("click",'[data-tag="game-cancel-close"]',function(){return i.gameWarp.find('[data-tag="game-cancel-warp"]').fadeOut().remove(),!1}).on("click",'[data-tag="game-remain-btn"]',function(){return i.gameWarp.find('[data-tag="game-remain-warp"]').fadeOut().remove(),!1}).on("click",'[data-tag="game-play-again"]',function(){return t.resetGameState(),t.gameContentAgent({triggerType:"stepBtn",gameState:"gameSet"}),a.trigger("dys",{key:"dys.room.normal.click.anchor.inavgame.continue"}),!1}).on("click",'[data-tag="game-not-play"]',function(){return a.trigger("dys",{key:"dys.room.normal.click.anchor.inavgame.quit"}),h.localStorageRemove("gameEndPush"),t.resetGameState({type:"close"}),t.gameBoxSwitch({state:"close"}),!1}).on("click",'[data-tag="game-end-goto"]',function(e){h.eventDefault(e),clearInterval(f.game2WaitTimer),i.gameWarp.find('[data-tag="game-end-timer-warp"]').remove(),t.anchorCheck?t.gameEndResultAppend({data:{Identity:f.defaultData.anchorTag},stateData:{triggerType:"stepBtn",gameState:"gameEndResultAnchor"},pushData:h.localStorageGet("gameEndPush")}):(i.enterBtn.data({triggerType:"enterBtn",state:""}),t.gameEndResultAppend({data:{Identity:f.defaultData.userTag},stateData:{triggerType:"stepBtn",gameState:"gameEndResultUser"},pushData:h.localStorageGet("gameEndPush")||f.gameResultD}),f.gameResultD="")})}};return v}),define("douyu/page/room/normal/mod/yz-gift-rank",["jquery","shark/observer","shark/util/lang/1.0","shark/util/template/2.0","douyu/context","douyu/com/user","douyu/com/exjsonp","douyu/com/room-gift-tmp"],function(e,t,a,i,s,n,o,r){var l=s.get("sys.web_url"),d=s.get("room.room_id"),c=s.get("sys.webconfUrl"),u=s.get("room.rankActivity.giftWeekListType"),g=s.get("room.rankActivity."+u+".aid"),m={ajaxUrls:{totalList:"/ztCache/ZtCacheList/getYanZhiZhouXingRankList",taGiftList:"/ztCache/ZtCacheList/getRankPlace",rule:c+"/resource/common/rank/h5.json"},defaultImg:{anchor:l+"app/douyu/res/com/defaultAvatar.png?v=20170726",user:l+"app/douyu/res/com/defaultAvatar.png?v=20170726",gift:l+"app/douyu/res/page/room-normal/giftmodal/gift_default.png?v=20170711",stealth:l+"app/douyu/res/page/room-normal/vip/invisible_list.png?v=20170711"},status:{show:!1,lock:!1,timeFlag:!0,firstReq:!1},data:{room_id:d,uid:s.get("room.owner_uid"),aid:g},ruleCB:"topBannerRender",activeClass:"gift-title-active",timer:null,maxLen:5},p={countDown:function(t,a,i){var s=e(t);a>=0?(s.addClass(i).attr("disabled",!0).val(a+"s"),a--,m.status.timeFlag=!1,clearTimeout(m.timer),m.timer=setTimeout(function(){p.countDown(t,a,i)},1e3)):s.removeClass(i).attr("disabled",!1).val("刷新")},formatDotZero:function(e){var t=/(\.\d+)0+$/,a=e.replace(t,"$1");return parseInt(a,10)==a&&(a=parseInt(a,10)),a},toSimpleNum:function(e,t,a){var i=Math.pow(10,t),s=0;return isNaN(Number(e))?e:(s=parseFloat(Number(e)/i),p.formatDotZero(s.toFixed(a)))},toChineseNumber:function(e,t,a){var i,s=Number(e);return isNaN(s)?e:i=p.toSimpleNum(e,4,a)+t},formatContribute:function(e,t){return e>=1e4&&(e=p.toChineseNumber(e,"万",t)),e},hasWeekGift:function(){var t=e("#gift-content");return!!t.find("[data-noble=2]").length}},f={init:function(){var e=this;e.doms={},e.renderBtn(),e.renderWrap(),e.getDoms(),e.bindEvent(),e.doms.container.mCustomScrollbar()},renderBtn:function(){var a,i,s,n,o=this;a=e('<div class="gift-week-pic"></div>'),t.trigger("mod.chat.action.view.add",{flag:"weekList1",dom:a,lock:!0,tips:""}),i=e('<div class="gift-week-pic"></div>'),t.trigger("mod.chat.action.view.add",{flag:"weekList2",dom:i,lock:!0,tips:""}),s=e('<div class="gift-week-pic"></div>'),t.trigger("mod.chat.action.view.add",{flag:"weekList3",dom:s,lock:!0,tips:""}),n=e('<div class="gift-week-pic"></div>'),t.trigger("mod.chat.action.view.add",{flag:"giftweek201711",dom:n,lock:!0,tips:""}),o.doms.btns=[a,i,s,n]},renderWrap:function(){var t=e("#container"),s=a.string.join('<div class="gift-rank-week-mask {{ type }}" id="yz-gift-rank-mask" style="display: none">','<div class="gift-rank-week-wrap">','<a class="gift-rank-close" href="javascript:;" data-yz-gift-rank="close"></a>','<div class="gift-rank-week">','<div class="gift-title">','<span class="gift-title-active" data-yz-gift-rank="gift-total-rank-btn">礼物榜总榜</span>','<span data-yz-gift-rank="gift-ta-rank-btn">Ta的礼物榜</span>',"</div>",'<div class="gift-tab-content" data-yz-gift-rank="container">','<div class="gift-self" data-yz-gift-rank="ta-gift-rank-wrap">','<input class="gift-reload gift-daoshu" type="button" disabled="disabled" name="" value="60s" data-yz-gift-rank="time-refresh-btn">',"<h4>榜单数据每隔1分钟更新一次</h4>",'<div class="gift-table-wrap">','<table class="gift-table" data-yz-gift-rank="ta-gift-rank"></table>',"</div>","</div>",'<div class="gift-rank" data-yz-gift-rank="gift-total-rank-wrap">','<a class="gift-rule" href="javascript:;" data-yz-gift-rank="rule-btn">榜单规则</a>','<div data-yz-gift-rank="last-week-rank"></div>','<div class="gift-current" data-yz-gift-rank="curr-week-rank"></div>','<div class="gift-rank-rule" data-yz-gift-rank="rule-wrap" style="display: none">',"<h4>榜单规则</h4>",'<ul class="gift-rank-rule-wrap gift-plr20" data-yz-gift-rank="rule-box"></ul>',"</div>","</div>","</div>","</div>","</div>",'<div class="gift-rank-week-holder"></div>',"</div>"),n=i.compile(s),o=n({type:u});t.append(o)},renderLastWeek:function(e){var t=this.doms.lastWeekWrap,s=a.string.join("<h4>上期周星 <span>（统计数据为 <em>{{ data.start }}</em> 到 <em>{{ data.end }}</em>）</span></h4>",'<div class="gift-plr20 clearfix">',"{{ each list as item index }}",'<div class="gift-last-week-wrap {{ if index % 2 == 1 }}gift-ml10{{ /if }}">','<div class="gift-last-week">','<div class="gift-left">','<div class="gift-zhubo-wrap">','<a class="gift-zhubo" title="{{ item.anchorTitle }}" href="{{ item.anchorHref }}" {{ if item.isAnchor }} style="cursor: default;"{{ else }} target="_blank"{{ /if }} data-yz-gift-rank="lastWeek-anchor">','<img src="{{ item.anchorImg }}" />','<em class="gift-zhubo-icon"></em>',"{{ if item.anchorLive != 0 }}",'<span class="gift-status">直播中</span>',"{{ /if }}","</a>","</div>",'<div class="gift-zhubo-name">','<h6 title={{ item.anchorName }}><a href="{{ item.anchorHref }}" {{ if !item.isAnchor }}target="_blank"{{ /if }}>{{ item.anchorName }}</a></h6>',"<span>收到：<em>{{ item.anchorGiftNum }}</em></span>","</div>","</div>",'<div class="gift-right">','<div class="gift-zhubo-wrap">','<a class="gift-zhubo" href="javascript:;" style="cursor: default;">','<img src="{{ item.userImg }}" />','<em class="gift-zhubo-icon"></em>',"{{ if item.isStealth != 0 }}",'<span class="gift-status">隐身中</span>',"{{ /if }}","</a>","</div>",'<div class="gift-zhubo-name">','<h6 title={{ item.userName }}><a href="javascript:;">{{ item.userName }}</a></h6>',"<span>助力：<em>{{ item.userSendNum }}</em></span>","</div>","</div>",'<div class="gift-icon">',"<span></span>",'<img src="{{item.giftImg }}" title="{{item.giftName }}" class="gift-icon-img"/>',"<span></span>","</div>","</div>","</div>","{{ /each }}","</div>"),n=i.compile(s),o=n({data:e,list:e.list});t.html(o)},renderList:function(e){var t=this.doms.currWeekWrap,s=a.string.join("<h4>本期争夺中</h4>",'<div class="gift-plr20 clearfix">',"{{ each list as items index }}",'<ul class="gift-current-list {{ if index % 2 == 1 }}gift-ml10{{ /if }}">','<h6><img src="{{ items.giftImg }}" title="{{ items.giftName }}">{{ items.giftName }}</h6>',"{{ each items.list as item index }}","{{ if index == 0 }}",'<li class="gift-current-first">','<span class="gift-current-index-bg"></span><em class="gift-current-index">{{ item.anchorIdx }}</em>','<a class="gift-current-link" title="{{ item.anchorTitle }}" href="{{ item.anchorHref }}" target="{{ item.anchorTarget }}" {{ if item.isAnchor }}style="cursor: default;"{{ /if }} data-yz-gift-rank="current-anchor">','<div class="gift-zhubo">','<img src="{{ item.anchorImg }}">','<em class="gift-zhubo-icon"></em>',"{{ if item.anchorLive != 0 }}",'<span class="gift-status">直播中</span>',"{{ /if }}","</div>",'<div class="gift-current-zhubo">',"<h5 title={{ item.anchorName }}>{{ item.anchorName }}</h5>","<span>收到：</span><em>{{ item.anchorGiftNum }}</em>","</div>",'<span class="gift-current-status {{ item.anchorIdxStatu }}"></span>',"</a> ","</li>","{{ else }}","<li>",'<span class="gift-current-index-bg"></span><em class="gift-current-index">{{ item.anchorIdx }}</em>','<a class="gift-current-link" title="{{ item.anchorTitle }}" href="{{ item.anchorHref }}" target="{{ item.anchorTarget }}" {{ if item.isAnchor }}style="cursor: default;"{{ /if }} data-yz-gift-rank="anchor">','<div class="gift-current-zhubo">',"<h5 title={{ item.anchorName }}>{{ item.anchorName }}</h5>","<span>收到：</span><em>{{ item.anchorGiftNum }}</em>","</div>",'<span class="gift-current-status {{ item.anchorIdxStatu }}"></span>',"</a>","</li>","{{ /if }}","{{ /each }}","</ul>","{{ /each }}","</div> ","</div>"),n=i.compile(s),o=n({list:e});t.html(o)},renderRule:function(e){var t=this.doms,s=t.wrap.find('[data-yz-gift-rank="rule-box"]'),n=a.string.join("{{ each list as item }}","<li><em></em>","<p>{{ item }}</p>","</li>","{{ /each }}"),o=i.compile(n),r=o({list:e});s.html(r)},renderTaList:function(e){var t=a.string.join('<tr class="gift-table-th">',"<th>礼物</th>","<th>当前排名</th>","<th>收到个数</th>","</tr>","{{ each list as item }}","<tr>","<td>",'<div class="gift-pic">','<img src="{{ item.giftImg }}">',"</div>","<span>{{ item.giftName }}</span>","</td>","<td>{{ item.idx }}</td>","<td>{{ item.getNum }}</td>","</tr>","{{ /each }}"),s=i.compile(t),n=s({list:e});this.doms.taGiftRank.html(n)},getDoms:function(){var t=this,a=e("#yz-gift-rank-mask");t.doms=e.extend(!0,t.doms,{wrap:a,container:a.find('[data-yz-gift-rank="container"]'),giftTotalRankBtn:a.find('[data-yz-gift-rank="gift-total-rank-btn"]'),taGiftRankBtn:a.find('[data-yz-gift-rank="gift-ta-rank-btn"]'),lastWeekWrap:a.find('[data-yz-gift-rank="last-week-rank"]'),currWeekWrap:a.find('[data-yz-gift-rank="curr-week-rank"]'),giftTotalRank:a.find('[data-yz-gift-rank="gift-total-rank-wrap"]'),taGiftRankWrap:a.find('[data-yz-gift-rank="ta-gift-rank-wrap"]'),taGiftRank:a.find('[data-yz-gift-rank="ta-gift-rank"]'),refresh:a.find('[data-yz-gift-rank="time-refresh-btn"]')})},sendAjax:function(t,a){var i=t.url,s=t.type||"GET",n=t.data||{},o=a||{},r=o.success||e.noop,l=o.error||e.noop;i&&e.ajax({url:i,type:s,data:n,dataType:"json",success:r,error:l})},getRule:function(){var t=this,a=t.doms,i="",s=[];o.load(m.ajaxUrls.rule,m.ruleCB,function(n){if(n&&!e.isEmptyObject(n))for(var o in n)if(o==g){i=n[o]&&n[o].content,s=i.split("\n");break}t.renderRule(s),a.wrap.find('[data-yz-gift-rank="rule-wrap"]').show()})},handleData:{lastWeek:function(t){var a={},i=[],o=t,r=0,l=o.length,c=n.check();if(!t||!l)return!1;for(;l>r;r++){var u=o[r],g=u.data||{},f=5==s.get("sys.groupid"),h=s.get("sys.nickname")==g.user_name,v=g.room_id==d,b=u.range?u.range:"------_------",y={};b=b.split("_"),a.start=b[0],a.end=b[1],y={anchorName:g.owner_name||"",anchorHref:g.room_id?v?"javascript:void(0);":"/"+g.room_id:"javascript:void(0);",anchorTitle:0==g.is_live?"在赶来路上":"进入直播间",anchorImg:g.avatar||m.defaultImg.anchor,anchorLive:g.is_live||"0",anchorGiftNum:g.num?p.formatContribute(g.num,1):"0",isStealth:g.is_stealth||0,userName:g.user_name||"",userImg:g.user_icon||m.defaultImg.user,userSendNum:g.user_num?p.formatContribute(g.user_num,1):"0",giftName:g.gift_name||"礼物",giftImg:g.gift_icon?g.gift_icon:m.defaultImg.gift,isAnchor:v},0!=g.is_stealth&&(c&&(v||f||h)?e.extend(!0,y,{isStealth:g.is_stealth,userName:g.user_name||"",userImg:g.user_icon||m.defaultImg.user}):e.extend(!0,y,{isStealth:0,userName:"神秘人",userImg:m.defaultImg.stealth})),i[r]=y}return a.list=i,a},currWeek:function(t){var a=[],i=t.length?t:Array(2);return t?(e.each(i,function(e,t){var i={},s=t||{},n=s.list||{},o=n.length||0,r=0;for(i.giftName=s.gift_name||"礼物",i.giftImg=s.gift_icon?s.gift_icon:m.defaultImg.gift,i.list=[],o>m.maxLen&&(n.length=o=m.maxLen);o>r;r++){var l=n[r].rid==d,c=n[r];i.list.push({anchorName:c.owner_name||"",anchorHref:c.rid?l?"javascript:void(0);":"/"+c.rid:"javascript:void(0);",anchorTitle:l?"":0==c.is_live?"在赶来路上":"进入直播间",anchorImg:c.src||m.defaultImg.anchor,anchorTarget:"_blank",anchorIdx:c.idx||r+1,anchorLive:c.is_live||"0",anchorGiftNum:c.sc?p.formatContribute(c.sc,1):"0",anchorIdxStatu:"0"==c.statu?"keep":"1"==c.statu?"down":"up",isAnchor:l})}for(;o<m.maxLen;)i.list.push({anchorName:"虚位以待",anchorHref:"javascript:void(0);",anchorTitle:"",anchorImg:m.defaultImg.anchor,anchorTarget:"",anchorIdx:++o,anchorLive:"0",anchorGiftNum:"0",anchorIdxStatu:"keep",isAnchor:!0});a.push(i)}),a):!1},taRankList:function(e){var t,a=[],i=0;for(t=e.length;t>i;i++){var s=e[i]||{};a[i]={giftName:s.gift_name||"",giftImg:s.gift_icon?s.gift_icon:m.defaultImg.gift,idx:s.idx>0?"第"+s.idx+"名":0==s.idx?"暂无排名":"第"+s.idx,getNum:s.receive_num>0?s.receive_num:"本周还未收到"}}return a}},listAjaxCb:{success:function(t){if(0===parseInt(t.code,10)){var a=t.data;a&&a.lastWeek&&!e.isEmptyObject(a.lastWeek)&&f.renderLastWeek(f.handleData.lastWeek(a.lastWeek)),a&&a.currWeek?f.renderList(f.handleData.currWeek(a.currWeek)):f.emptyRender()}else f.emptyRender()},error:function(){f.emptyRender()}},taAjaxCb:{success:function(e){0===parseInt(e.code,10)&&e.data?f.renderTaList(f.handleData.taRankList(e.data)):f.doms.taGiftRank.html('<tr class="gift-table-th"><th>暂无数据</th></tr>')},error:function(){f.doms.taGiftRank.html('<tr class="gift-table-th"><th>暂无数据</th></tr>');
}},emptyRender:function(){var e=[];f.renderList(f.handleData.currWeek(e))},bindEvent:function(){var a=this,i=a.doms,s=i.wrap;a.timer=null,e.each(i.btns,function(){this.on("click",function(){m.status.show?(s.fadeOut(300),m.status.show=!1):(m.status.lock||(a.sendAjax({url:m.ajaxUrls.totalList,data:{aid:g}},a.listAjaxCb),a.sendAjax({url:m.ajaxUrls.taGiftList,data:m.data},a.taAjaxCb),a.getRule(),m.status.lock=!0,clearTimeout(a.timer),a.timer=setTimeout(function(){m.status.lock=!1},6e4)),s.fadeIn(300),m.status.timeFlag&&p.countDown(i.refresh,60,"gift-daoshu"),m.status.show=!0),t.trigger("dys",{key:"dys.room.giftWeekRank.enterBtn.click"})})}),s.on("click",'[data-yz-gift-rank="gift-total-rank-btn"]',function(){i.giftTotalRank.show(),i.taGiftRankWrap.hide(),e(this).addClass(m.activeClass),i.taGiftRankBtn.removeClass(m.activeClass),i.container.mCustomScrollbar("update")}).on("click",'[data-yz-gift-rank="gift-ta-rank-btn"]',function(){i.giftTotalRank.hide(),i.taGiftRankWrap.show(),e(this).addClass(m.activeClass),i.giftTotalRankBtn.removeClass(m.activeClass),m.status.firstReq=!0,i.container.mCustomScrollbar("update"),t.trigger("dys",{key:"dys.room.giftWeekRank.taGiftRank.click"})}).on("click",'[data-yz-gift-rank="lastWeek-anchor"]',function(){"javascript:void(0)"!==e(this).attr("href")&&t.trigger("dys",{key:"dys.room.giftWeekRank.totalList.lastWeek.anchor.click"})}).on("click",'[data-yz-gift-rank="current-anchor"]',function(){"javascript:void(0)"!==e(this).attr("href")&&t.trigger("dys",{key:"dys.room.giftWeekRank.totalList.currWeek.anchor.click"})}).on("click",'[data-yz-gift-rank="rule-btn"]',function(){i.container.mCustomScrollbar("scrollTo","bottom",{scrollInertia:1e3,timeout:60})}).on("click",'[data-yz-gift-rank="time-refresh-btn"]',function(){p.countDown(i.refresh,60,"gift-daoshu"),m.status.timeFlag=!0,a.sendAjax({url:m.ajaxUrls.taGiftList,data:m.data},a.taAjaxCb)}).on("click",'[data-yz-gift-rank="close"]',function(){s.fadeOut(300),m.status.show=!1})}};return{init:function(){r.render().done(function(){s.get("room.rankActivity."+u+".activeRoomOPen")&&s.get("room.rankActivity."+u+".activeTimeOnline")&&p.hasWeekGift()&&f.init()})}}}),define("douyu/page/room/normal/mod/taobao-goods",["jquery","shark/class","shark/observer","shark/util/template/2.0","shark/util/flash/data/1.0","shark/util/lang/1.0","shark/util/storage/1.0","shark/util/cookie/1.0","douyu/context","douyu/com/user","douyu/page/room/base/api"],function(e,t,a,i,s,n,o,r,l,d,c){var u={JSLOADING:"JS-loading",JSDISABLED:"JS-disabled",pushedClass:"JS-pushed",active:"active"},g={pushurl:"/room/wab/set_push_item",showbtnurl:"/room/wab/set_show_float_entry",getList:"/room/wabu/get_data"},m={pusheditemclosed:"pusheditemclosed",entryClosed:"entryClosed"},p={getRestTime:function(e){var t,a;return e=e?parseInt(e,10):0,t=new Date,t.setDate(t.getDate()+e),t.setHours(24),t.setMinutes(0),t.setSeconds(0),a=t.getTime()-(new Date).getTime()}},f={flags:{isListShow:0,imgAdded:0},init:function(t){var a,i=this;this.doms={roomVideo:e("#js-room-video"),statsNactions:e("#js-stats-and-actions")},this.keyPre="trans",this.config=t,this.currentIndex=0,this.listObj={},a=this.config.shop,this.listRender=this.listRenderFn(),this.recomandRender=this.recomandRenderFn(),this.pushedGoodsRender=this.pushedGoodsRenderFn(),this.showIsLive=1==l.get("room.show_status"),this.config.customerServiceUrl="/member/customer_service",this.config.hasAnchorOwnGoods=!1,this.config.scriptLoaded=!1,a&&a.items&&a.items.length&&(this.listData=a.items,e.each(this.listData,function(){return this.is_showcase?void 0:(i.config.hasAnchorOwnGoods=!0,!1)}),this.renderBtn(),this.renderList(),this.showIsLive&&(a.push&&a.push.item_id&&a.push.item_id!=o.get(m.pusheditemclosed)&&this.showPushed(this.listObj[this.keyPre+a.push.item_id]),!o.get(m.entryClosed)&&a.showFloatEntry&&this.showEntryToViewers())),this.bindEvents()},renderBtn:function(){var e=(this.config.shop,this.config.hasAnchorOwnGoods),t='<div selector="shopbuybtn" class="shopbuybtn'+(e?"":" douyushopbuybtn")+' "></div>';this.doms.statsNactions.append(t),a.trigger("mod.chat.action.view.add",{flag:"taobaogoods",dom:this.doms.statsNactions.find('[selector="shopbuybtn"]'),lock:!0,tips:e?"主播推荐的优质商品":"鱼购精选商品"})},renderList:function(e,t){var a,i,s,n,o=this,r=o.config,l=this.doms.roomVideo,d=r.shop,c=e||o.listData,u=c.length,g=c[0],m=4,p=[];for(u&&g&&!g.ad_id&&d.ad&&(c.unshift(d.ad),u=c.length),s=0;u>s;s++)i=p[parseInt(s/m,10)],"undefined"==typeof i&&(i=[],p.push(i)),a=c[s],i.push(a),o.listObj[o.keyPre+a.item_id]=a;o.listLength=p.length,n=o.listRender({isCurrentAnchor:o.config.isCurrentAnchor,pushedItemId:o.showIsLive&&(t||d&&d.push&&d.push.item_id),shoplink:d&&d.shopUrl,showEntry:d&&o.listLength&&d.showFloatEntry,hasAnchorOwnGoods:o.config.hasAnchorOwnGoods,list:p,customerServiceUrl:o.config.customerServiceUrl}),l.find('[selector="pushlist"]').remove(),l.append(n),l.find('[selector="pushlist"]').show(),o.listLength<2&&l.find('[selector="pushlist"]').find('[selector="prevgoodspage"], [selector="nextgoodspage"]').addClass("hide")},pushedGoodsRenderFn:function(){var e=n.string.join('<div selector="pushedgoodsitemwrap" class="fishop-anchor-push-box">','<div class="fishop-anchor-push-main">','<div class="fishop-anchor-push-main-bg"></div>','<div class="fishop-anchor-push-main-content">',"<h4>主播力推</h4>",'<a selector="closebkbmpushed" tabindex="-1" class="close" href="javascript:;">×</a>','<a selector="pushedgoodsitem" tabindex="-1" data-id="{{item_id}}" data-piid="{{ piid }}" data-sourceid="{{source_id}}" data-type="{{item_scope.type}}" target="_blank" href="{{ url }}" class="push-cover">','<img src="{{ pict_url }}">','<span class="push-cover-des">','<span class="push-cover-des-bg"></span>','<span class="push-cover-des-main">','<span class="ibm" title="{{ title }}">{{ title }}</span>','<span class="holder"></span>',"</span>","</span>","</a>","</div>",'<a tabindex="-1" href="handler"></a>',"</div>","</div>"),t=i.compile(e);return t},recomandRenderFn:function(){var e=n.string.join('<div selector="recomandbtnwrap" class="fishop-anchor-recommands-box">','<a tabindex="-1" selector="closerecomandbtn" class="close" href="javascript:;">×</a>','<div class="fishop-anchor-recommands-main">','<div class="fishop-anchor-recommands-main-bg"></div>','<a tabindex="-1" href="javascript:;" class="fishop-anchor-recommands-main-content">','<i class="widget"></i>',"</a>",'<a tabindex="-1" href="javascript:;" class="handler"></a>',"</div>","</div>"),t=i.compile(e);return t},listRenderFn:function(){var t=e.param({ty:"0",a:"0",uin:800190050,from:5}),a=n.string.join('<div selector="pushlist" tabindex="-1" class="fishop-anchor-recommands-sub',"{{ if shoplink }}"," status-anchor","{{ /if }}","{{ if isCurrentAnchor }}"," status--showswitch","{{ /if }}",'">','<div class="fishop-anchor-recommands-sub-bg"></div>','<a tabindex="-1" selector="closebkbmlist" class="close" href="javascript:;">×</a>','<div class="fishop-anchor-recommands-sub-content">','<div class="rshop-part">','<a tabindex="-1" selector="anchorshop" href="{{ shoplink }}" target="_blank" class="tshop-name">','<i class="icon-tshop"></i>',"<strong> 主播鱼塘 </strong>","</a>","</div>",'<div class="fishop-anchor-recommands-list-box">','<a tabindex="-1" selector="prevgoodspage" class="handler handler-prev hide" href="javascript:;"></a>','<a tabindex="-1" selector="nextgoodspage" class="handler handler-next" href="javascript:;"></a>','<div selector="goodslist" class="fishop-anchor-recommands-list-main">',"{{ each list as items }}","<ul>","{{ each items as item }}",'<li {{if !item.ad_id}} selector="productitem"{{/if}} data-id="{{ item.item_id || item.ad_id }}" data-piid="{{ item.piid }}" data-sourceid="{{item.source_id}}" data-type="{{item.item_scope.type}}">',"{{ if item.ad_id }}",'<a tabindex="-1" selector="adlink" class="fishop-anchor-recommands-link" target="_blank" href="{{ item.url }}">','<span class="cover-box" selector="goodsimg" data-img="{{ item.pict_url }}">',"</span>",'<em class="price">　</em>',"</a>","{{ else }}","{{ if isCurrentAnchor }}",'<a tabindex="-1" {{ if !item.is_showcase }}selector="changepushed"{{ /if }} class="fishop-anchor-recommands-link {{ if item.item_id == pushedItemId }} active{{ /if }}{{ if item.is_showcase }}status--show-push-btn{{ /if }}" target="_blank" href="{{ item.url }}">',"{{ else }}",'<a selector="itemlink" tabindex="-1" target="_blank" href="{{ item.url }}">',"{{ /if }}",'<span class="cover-box" selector="goodsimg" data-img="{{ item.pict_url }}">','<b class="cover-des">',"{{ if isCurrentAnchor && !item.is_showcase }}",'<span selector="pushtext" class="cover-main">',"{{ if item.item_id != pushedItemId }}","实时推送","{{ else }}","取消推送","{{ /if }}","</span>","{{ else }}",'<span class="cover-des-main"> {{ item.title }} </span>',"{{ /if }}","<i></i>","</b>","</span>",'<em class="price">',"￥{{ item.price }}","</em>","</a>","{{ /if }}","</li> ","{{ /each }}","</ul> ","{{ /each }}","</div>","</div>","</div>","{{ if isCurrentAnchor }}",'<div class="fishop--anchor--enter">',"{{ if shoplink }}",'<div class="anchor--enter--wrap clearfix">','<span class="enter--icon"></span>','<dl class="enter--content">',"<dt>推荐入口状态</dt>",'<dd><span selector="showbtntoviewerchecker" class="enterbtn ',"{{ if !showEntry }}","status--close","{{ /if }}",'"></span></dd>',"</dl>","</div>","{{ /if }}",'<div id="J_customerservice" class="customer--service--wrap">','<a tabindex="-1" class="customer--service--btn" target="_blank" href="http://crm2.qq.com/page/portalpage/wpa.php?'+t+'">','<i class="customer--service--icon"></i>鱼商客服',"</a>","</div>","</div>","{{ /if }}","</div>"),s=i.compile(a);return s},bindEvents:function(){var t=this,a=this.doms.roomVideo;a.on("click.carousel",'[selector="prevgoodspage"]',function(){DYS.sub({action_code:"click_mdse_recom_mdse_cpage",ext:{type:"up"}}),t.once(-1)}).on("click.carousel",'[selector="nextgoodspage"]',function(){DYS.sub({action_code:"click_mdse_recom_mdse_cpage",ext:{type:"down"}}),t.once(1)}).on("click",'[selector="closebkbmlist"]',function(){DYS.sub({action_code:"click_mdse_recom_mdse_close"}),t.hideList()}),a.on("click",'[selector="anchorshop"]',function(){"javascript:;"!=this.href&&DYS.sub({action_code:"click_mdse_recom_shop"})}),this.doms.statsNactions.on("click",'[selector="shopbuybtn"]',function(e){t.config.shop.wab_enter_url?window.open(t.config.shop.wab_enter_url,"_blank"):(t.flags.isListShow||DYS.sub({action_code:"click_giftbar_ahrecom"}),t.toggleList())}),e("#container").on("click",function(a){var i=e(a.target).closest('[selector="pushlist"], [selector="shopbuybtn"], [selector="recomandbtnwrap"]');0===i.length&&t.hideList()}),a.on("click",'[selector="showbtntoviewerchecker"]',function(){var a=e(this),i=a.hasClass("status--close")?1:0;t.getCSRFCookie(function(e){var s={flag:i};s[e.name]=e.value,t.ajax(a,g.showbtnurl,s,function(e,s){a[i?"removeClass":"addClass"]("status--close"),t[i?"showEntryToViewers":"hideEntryToViewers"]()})})}),a.on("click",'[selector="closerecomandbtn"]',function(e){e.stopPropagation(),DYS.sub({action_code:"click_mdse_recom_close"}),t.hideEntryToViewers(),o.set(m.entryClosed,1,p.getRestTime())}),a.on("click",'[selector="recomandbtnwrap"]',function(e){t.config.shop.wab_enter_url?window.open(t.config.shop.wab_enter_url,"_blank"):(DYS.sub({action_code:"click_mdse_recom"}),t.showList()),t.hideEntryToViewers()}),a.on("click",'[selector="closebkbmpushed"]',function(){DYS.sub({action_code:"click_mdse_hrecom_close"}),t.hidePushed(),o.set(m.pusheditemclosed,t.config.shop.push.item_id)}),a.on("click",'[selector="changepushed"]',function(a){var i=e(this);a.preventDefault(),i.hasClass(u.active)?(t.setPush(i,0),t.hidePushed()):e.dy_dialog("确定实时推送该商品？<br>5分钟后允许更换其他商品",{title:"确认框",mask:!0,buttons:[{content:"确定",callback:function(e){t.setPush(i,1),this.hide()}},{content:"取消",callback:function(){this.hide()}}]})}),a.on("click",'[selector="pushedgoodsitem"]',function(){var t=e(this);DYS.sub({action_code:"click_mdse_hrecom",ext:{id:t.data("piid"),item_id:t.data("id"),source_id:t.data("sourceid"),it_att:t.data("type")}})}),a.on("click",'[selector="itemlink"]',function(){var t=e(this).closest('[selector="productitem"]'),a=t.index();DYS.sub({action_code:"click_mdse_recom_mdse",ext:{pos:a,id:t.data("piid"),item_id:t.data("id"),source_id:t.data("sourceid"),it_att:t.data("type")}})}),a.on("click",'[selector="adlink"]',function(){var t=e(this).closest('[selector="productitem"]');DYS.sub({action_code:"click_mdse_recom_ad",ext:{ad_id:t.data("id")}})})},hideList:function(){this.flags.isListShow=0,this.doms.roomVideo.find('[selector="pushlist"]').removeClass("expanded")},showList:function(){var t=this.flags,a=this.doms.roomVideo.find('[selector="pushlist"]').addClass("expanded").find('[selector="goodslist"]');t.isListShow=1,t.imgAdded||a.find('[selector="goodsimg"]').each(function(){e(this).prepend('<img src="'+e(this).data("img")+'" />')}),t.imgAdded=1,this.config.shop.ad&&this.config.shop.ad.ad_id&&DYS.sub({action_code:"show_mdse_recom_ad",ext:{ad_id:this.config.shop.ad.ad_id}})},toggleList:function(){this.flags.isListShow?this.hideList():this.showList()},showEntryToViewers:function(){var e=this.doms.roomVideo;e.find('[selector="recomandbtnwrap"]').remove(),e.append(this.recomandRender()),setTimeout(function(){e.find('[selector="recomandbtnwrap"]').addClass("expanded")},10)},hideEntryToViewers:function(){this.doms.roomVideo.find('[selector="recomandbtnwrap"]').removeClass("expanded")},showPushed:function(e){var t=this.doms.roomVideo,a=t.find('[selector="pushedgoodsitemwrap"]');a.remove(),t.append(this.pushedGoodsRender(e)),setTimeout(function(){t.find('[selector="pushedgoodsitemwrap"]').addClass("expanded")},10)},showFlashPushed:function(t){var a=this,i=a.listObj[a.keyPre+t];i?a.showPushed(i):e.get(g.getList,{room_id:l.get("room.room_id")},function(e){!e.error&&e.data&&e.data.items&&(a.flags.imgAdded=0,a.renderList(e.data.items,t),a.showPushed(a.listObj[a.keyPre+t]),a.config.shop.push.item_id=t)},"json"),o.remove(m.entryClosed)},hidePushed:function(){this.doms.roomVideo.find('[selector="pushedgoodsitemwrap"]').removeClass("expanded")},setPush:function(t,a){var i=this,s=t.closest('[selector="productitem"]');i.getCSRFCookie(function(n){var o={item_id:s.data("id"),flag:a};o[n.name]=n.value,i.ajax(i.doms.roomVideo,g.pushurl,o,function(n,o){e.dialog.tips_black(a?"推送成功":"取消成功"),i.setPushStatus(t,s,a)})})},setPushStatus:function(e,t,a){this.doms.roomVideo.find('[selector="changepushed"]').removeClass(u.active).find('[selector="pushtext"]').text("实时推送"),a&&e.addClass(u.active).find('[selector="pushtext"]').text("取消推送")},disablePush:function(){this.doms.roomVideo.find('[selector="changepushed"]').addClass(u.JSDISABLED)},enablePush:function(){this.doms.roomVideo.find('[selector="changepushed"]').removeClass(u.JSDISABLED)},once:function(e){e>0?this.currentIndex++:this.currentIndex--,this.currentIndex>this.listLength-1&&(this.currentIndex=this.listLength-1,next.addClass("hide")),this.currentIndex<0&&(this.currentIndex=0,prev.addClass("hide")),this.go(this.currentIndex)},go:function(e){var t=this.doms.roomVideo,a=t.find('[selector="prevgoodspage"]').removeClass("hide"),i=t.find('[selector="nextgoodspage"]').removeClass("hide"),s=t.find('[selector="goodslist"]');0==this.currentIndex?a.addClass("hide"):this.currentIndex==this.listLength-1&&i.addClass("hide"),s.stop().animate({scrollLeft:e*s.outerWidth()})},ajax:function(t,a,i,s,n){var o={type:n||"post",dataType:"json",context:t,url:a,data:i,beforeSend:function(){this.addClass(u.JSLOADING)},complete:function(){this.removeClass(u.JSLOADING)},error:function(){e.dialog.tips_black("操作失败，请稍候重试！")},success:function(a){a.error?1==a.error&&e.dialog.tips_black(a.msg):s(t,a)}};t.hasClass(u.JSLOADING)||e.ajax(o)},getCSRFCookie:function(t){var a=this,i=l.get("sys.tn"),s=r.get(l.get("sys.tvk"));return s?void(t&&t({name:i,value:s})):void e.ajax({url:"/curl/csrfApi/getCsrfCookie",type:"GET",dataType:"json",success:function(e){0===e.error&&a.getCSRFCookie(t)}})}};return{init:function(){var e=l.get("sys.uid"),t=l.get("room.owner_uid"),i=Number(e)===Number(t),n=l.get("room.wab");f.init({isCurrentAnchor:i,shop:n}),a.on("mod.video.state.flashlivestate",function(e){e=s.decode(e).too(),1==e.code&&i&&f.disablePush()}),c.reg("room_data_hideshopbtn",function(){f.hideEntryToViewers()}),c.reg("room_data_handler",function(e){var t=s.decode(e).too();"wab"==t.type&&("1"==t.a?f.hidePushed():t.item_id&&"0"==t.a&&f.showFlashPushed(t.item_id),o.remove(m.pusheditemclosed))})}}}),define("douyu/page/room/normal/mod/backpack",["jquery","shark/observer","shark/util/lang/1.0","shark/util/template/1.0","douyu/context","douyu/page/room/normal/mod/gift","douyu/com/user","shark/util/flash/data/1.0","douyu/page/room/base/api","shark/util/cookie/1.0","shark/util/storage/1.0","douyu/com/get-gift-configs","douyu/page/room/normal/mod/account-security"],function(e,t,a,i,s,n,o,r,l,d,c,u,g){var m={},p={},f=!1,h="",v=function(e){var t=e||0,a=1e4,i=1e8,s=Math.pow(10,2);return t>=i?Math.floor(t/i*s)/s+"亿":t>=a?Math.floor(t/a*s)/s+"万":t>0?Math.floor(t*s)/s:t};t.on("room.final.year.prop.data",function(e){p=e,f=!0}),t.on("room.final.year.vote.data",function(e){e&&(h=e)});var b,y={},k={area:"#js-stats-and-actions"};return y.item=['<li class="','<% if ( prop.classType == "prop" ){%>'," prop",'<%} else if( prop.classType == "lock" ){%>'," lock",'<%} else if( prop.classType == "blank" ){%>'," blank","<%}%>","<% if(prop.is_click === 1 ){%>"," effect","<%} else{%>"," disabled",'<%}%>" ',"<% if(prop.prop_type == 5){%>"," package","<%}%>",' data-proptype="<%= prop.prop_type %>"',' data-propid="<%= prop.prop_id%>"',' data-giftid="<%= prop.rel_id%>"',' data-index="<%= prop.index%>"',' data-offensive="<%= prop.attack%>"'," >",'   <img src="<%= prop.icon %> ">','   <span class="prop-count"><%= prop.count %></span>','   <div class="prop-cover">','       <div class="bg"></div>',"       <% if(prop.active_type == 1){%>",'           <div class="text">设置</div>','           <div class="text">节奏</div>',"       <%} else{%>",'           <div class="text">点击</div>','           <div class="text"><% if(prop.prop_type == 5){ %>领取<% }else{ %>使用<% } %></div>',"       <%}%>","   </div>","</li>"].join(""),y.all=['<div class="btn close" ><span class="icon"></span></div>','<div class="title">','    <span class="name">我的背包</span>','    <span class="space">剩余空间数：<span  data-query="space-num"><%= blankSpace %></span>',"    </span>","</div>",'<div class="prop-wrap">','    <div class="prop-cont clearfix">',"        <% for(var m = 0; m<pages.length ; m++) { %>","        <% var props = pages[m] %>",'        <ul class="prop-page">',"           <% for (var j=0 ;j< props.length ; j++ ) {%>","               <% var prop = props[j] %>",y.item,"           <% } %>","        </ul>","        <% } %>","    </div>",'<div class="pagination">',"       <% for (var i=0; i<pages.length ; i++ ){ %>",'           <a href="javascript:;" class="btn dot <%= (i == pageIndex ? "current" : "" ) %>" >','           <span    class="icon"></span></a>',"       <% }%>","</div>","</div>",'<div class="clearfix">',"<% if(unlock_num <= 10){%>",'<div class="tips"><span class="yellow">达到10级</span>将开放更多背包空间</div>',"<%}%>",'   <a class="get-tips" target="_blank" href="/cms/gong/201609/26/4203.shtml">如何获得更多道具？</a></div>','<div class="btn prev"><span class="icon"></span></div>','<div class="btn next"><span class="icon"></span></div>','<div class="arrow"></div>','<div class="arrow2"></div>','<div class="gift-cover"></div>','<div class="backpack-tips disabled-tips"></div>','<div class="prop-info-panel" ></div>'].join(""),y.propInfo=['<div class="prop-info-panel-cont clearfix" >','   <div class="prop-not-batch">','       <div class="prop-info-panel-brief">','           <div class="prop-info-panel-img">','              <img src="<%= prop.gif %>">','              <div class="prop-count"><%= prop.count %></div>',"           </div>",'           <h4 class="name"><%= prop.name %>',"           <% if (isShowYwReturn) { %>","           <em>(可返<%= prop.rel_giftdata.ry %>鱼丸)</em>","           <% } %>","           </h4>",'           <p class="exp">',"               <% if(devote >0){%>",'                   <b>贡献+<span title="<%= devote %>"><%= devote4Short %></span> </b>',"               <% } %>","               <% if(exp >0){%>",'                   <b>经验+<span title="<%= exp %>"><%= exp4Short %></span> </b>',"               <% } %>","               <% if(intimate >0 ){%>",'                   <b>亲密度+<span title="<%= intimate %>"><%= intimate4Short %></span> </b>',"               <% } %>","           </p>",'           <p class="desc gift-info-intro"><%= prop.description %></p>','           <p class="intro" title="<%= prop.intro %>"><%= prop.intro %></p>','           <p class="expiry"><%if(prop.expiry==-1){%>永久有效<%}else{%>有效期剩余<%= prop.expiry %>天<%}%></p>',"       </div>",'       <span class="gift-countdown" style="display:block;"><em>--:--</em>内可连击</span>',"    </div>","</div>",'<i class="prop-info-panel-fill"></i>','<i class="prop-info-panel-arrow1"></i>','<i class="prop-info-panel-arrow2"></i>'].join(""),y.rhythm=['<div class="rhythm-box">','<div class="rhythm-holder"></div>','<div class="rhythm-container">','<div class="rhythm-content">','<div class="rhythm-close-btn"></div>','<div class="rhythm-title">','<div class="rhythm-icon"><img src="<%= data.prop.icon %>"></div>','<div class="rhythm-title-txt">',"<h4><%= data.prop.name %></h4>","<p>","<% if(devote >0){%>",'<b>贡献+<span title="<%= devote %>"><%= devote4Short %></span> </b>',"<% } %>","<% if(exp >0){%>",'<b>经验+<span title="<%= exp %>"><%= exp4Short %></span> </b>',"<% } %>","<% if(intimate >0 ){%>",'<b>亲密度+<span title="<%= intimate %>"><%= intimate4Short %></span> </b>',"<% } %>","</p>","</div>","</div>",'<dl class="rhythm-chat">',"<dt>",'<h4 class="rhythm-sub-title">选择节奏弹幕</h4>',"<p>其他水友抢此火箭宝箱时，会自动发送以下选中弹幕</p>","</dt>","<% for (var j=0 ;j< data.list.length ; j++ ) {%>","   <% var item = data.list[j] %>",'   <dd class="rhythm-chat-list" data-id="<%= item.id %>"><i></i><span><%= item.title %></dd>',"<% } %>",'<dd class="rhythm-chat-list rhythm-chat-list2" data-id="0">',"<i></i><span>自定义</span>",'<span class="rhythm-chat-attention">请输入节奏弹幕！</span>','<div class="rhythm-chat-setting-box">','<input type="text" class="rhythm-chat-setting">','<span class="rhythm-chat-placeholder">自定义节奏弹幕（最多15个中文字符）</span>',"</div>","</dd> ","</dl>",'<div class="rhythm-color">','<h4 class="rhythm-sub-title">选择弹幕颜色</h4>','<div class="rhythm-color-boxes">',"<!-- 增加cur为选中 -->",'<span class="rhythm-color2 cur" data-color-id="6"></span>','<span class="rhythm-color3" data-color-id="2"></span>','<span class="rhythm-color4" data-color-id="3"></span>','<span class="rhythm-color5" data-color-id="4"></span>','<span class="rhythm-color6" data-color-id="5"></span>','<span class="rhythm-color7" data-color-id="1"></span>',"</div>","</div>",'<div class="rhythm-start-btn">开始节奏风暴<span class="rhythm-start-arrow"></span></div>','<span class="rhythm-start-attention">请先选择节奏弹幕！</span>',"</div>","</div>","</div>"].join(""),b={props:[],pageIndex:0,pageSize:0,maxSpace:25,blankSpace:0,pageLenth:10,timer:0,cssTimer:0,delay:200,duration:500,listWidth:380,doms:{},sending:!1,lockText:"",flag:0,init:function(){var t;b.doms={},t=b.doms,t.$area=e(k.area),t.$wrap=t.$area.find(".backpack"),b.bindEvent(),u.loadYwReturnSwitch().then(function(e){var t=e||{};1===t.show_switch&&(m.ywReturnSwitch=1)})},addRhythm:function(){var t,a;a=b.sendingData.prop,e.ajax({type:"get",url:"/ztCache/JzStrom/getJzDanMuByEid",dataType:"json",data:{eid:a.effect}}).done(function(s){var n=(s.data||[]).slice(0,4),o={list:n,prop:a};0===s.code?(t=b.doms.rhythm,t&&t.remove(),t=e(i.compile(y.rhythm)({data:o,devote:a.devote,exp:a.exp,intimate:a.intimate,devote4Short:v(a.devote),exp4Short:v(a.exp),intimate4Short:v(a.intimate)})),e("body").append(t),b.doms.rhythm=t,b.addRhythmEvt()):e.dialog.tips_black(s.msg)}).fail(function(){e.dialog.tips_black("网络不稳定！")})},addRhythmEvt:function(){var t=b.doms,a=t.rhythm.find(".rhythm-chat-list").length;b.ryh_id=0,b.ryh_col=6,b.ryh_txt="",e("body").on("click",function(a){e(a.target).closest(".rhythm-container").length||t.rhythm.hide()}),t.rhythm.on("click",".rhythm-chat-list",function(i){var s=e(this).index();i.stopPropagation(),s===a?t.rhythm.find(".rhythm-chat-setting-box").show():(t.rhythm.find(".rhythm-chat-attention").hide(),t.rhythm.find(".rhythm-chat-setting-box").hide()),e(this).addClass("cur").siblings().removeClass("cur"),t.rhythm.find(".rhythm-start-attention").hide(),b.ryh_id=e(this).data("id")}).on("click",".rhythm-color-boxes span",function(t){t.stopPropagation(),e(this).addClass("cur").siblings().removeClass("cur"),b.ryh_col=e(this).data("colorId")}).on("click",".rhythm-close-btn",function(e){e.stopPropagation(),t.rhythm.hide()}).on("click",".rhythm-start-btn",function(e){var i,s=0,n="",o=t.rhythm.find(".rhythm-chat-list.cur"),r=/^\s+$/;return e.stopPropagation(),s=o.index(),n=s===a?o.find("input").val():o.find("span").html(),n||s!==a?n||-1!==s?r.test(n)?void t.rhythm.find(".rhythm-chat-attention").html("不能输入纯空格").show():(i=n.replace(/[^\x00-\xff]/g,"**").length,i>30?void t.rhythm.find(".rhythm-chat-attention").html("最多输入15个中文字符").show():(b.ryh_txt=n,t.rhythm.hide(),void b.sendProp())):void t.rhythm.find(".rhythm-start-attention").show():void t.rhythm.find(".rhythm-chat-attention").html("请输入节奏弹幕！").show()}),t.rhythm.find(".rhythm-chat-setting").on("focus",function(e){e.stopPropagation(),t.rhythm.find(".rhythm-chat-placeholder").hide(),t.rhythm.find(".rhythm-chat-attention").hide()}).on("blur",function(e){e.stopPropagation(),t.rhythm.find(".rhythm-chat-list2 input").val()||t.rhythm.find(".rhythm-chat-placeholder").show()})},getData:function(a){e.ajax({type:"post",url:"/member/prop/query",dataType:"json",data:{rid:$ROOM.room_id},success:function(i){0===i.result?(t.trigger("backpack.props.check.vote",i.data),a(i.data)):e.dialog.tips_black(i.msg)}})},processData:function(e){var t,a,i,s=[],n=[],o=0,r=0;for(i=e,b.props=[],b.maxSpace=e.total_num,b.blankSpace=e.unlock_num-e.list.length,t=b.blankSpace||0;o<b.maxSpace;o++,r++)r%b.pageLenth===0&&(n=[],s.push(n)),a=e.list[o],a?a.classType="prop":(t>0?(t--,a={classType:"blank"}):a={classType:"lock",disabled:!0},i.list[o]=a),a.index=o,b.props.push(a),n.push(a);return i.pageIndex=b.pageIndex,i.pages=s,b.pageSize=s.length,i.blankSpace=b.blankSpace,i},render:function(e,t){var a,s=0,n=i.compile(y.all);u.load().done(function(i){var o,r=e.list;if(i&&r){for(o=r.length;o>s;s++){var l,d,c=r[s];l=c.rel_id,l&&(d=i[l],d&&(c.effect=d.effect,c.active_type=d.active_type,c.rel_giftdata=d))}a=n(e),b.doms.$wrap.html(a),t&&t()}})},reload:function(e){b.processData(e),b.render(e,function(){b.getDoms(),b.changePage(0)})},getDoms:function(){var e=b.doms,t=b.doms.$wrap;e.$panel=t.find(".prop-info-panel"),e.$dots=t.find(".dot"),e.$propCont=t.find(".prop-cont"),e.$propCont.css({width:b.pageSize*b.listWidth}),e.$tips=t.find(".disabled-tips"),e.$next=t.find(".next"),e.$prev=t.find(".prev")},bindEvent:function(){var a=b.doms;a.$wrap.on("mouseenter",".prop",function(i){var s,n,o,r,l=e(this).data("index"),d=b.props[l],c=e(this).data("giftid"),u=e(this).index();clearTimeout(b.timer),clearTimeout(b.cssTimer),b.updatePanel(d),b.cssTimer=setTimeout(function(){s=a.$panel.outerWidth()<280?280:a.$panel.outerWidth(),n=a.$panel.outerHeight(),o=(s-280)/2,r=n-132,a.$panel.css({left:-47-o+u%5*68,top:-62-r+68*Math.floor(u/5)}).fadeIn("fast")},10),t.trigger("mod.prop.hover.batter.search",c,l)}).on("mouseleave",".prop",function(e){clearTimeout(b.timer),b.timer=setTimeout(function(){a.$panel.fadeOut("fast")},b.delay)}).on("click",".effect",b.useProp).on("mouseenter",".prop-info-panel",function(){clearTimeout(b.timer)}).on("mouseleave",".prop-info-panel",function(){e(this).fadeOut("fast")}).on("click",".next",b.next).on("click",".prev",b.prev).on("click",".dot",function(){b.changePage(e(this).index())}).on("click",".close",b.close).on("click",".prop.disabled",b.disabledTips),b.doms.$area.find(".backpack-btn").on("click",b.show),e("#container").on("click.backpack",function(){a.$wrap.is(":visible")&&b.close()}),a.$wrap.on("click",function(e){e.stopPropagation()}).on("click",".backpack-prompt-btn",function(){e(".backpack-prompt-box").remove()}),t.on("mod.room.user.fansMedal.setcurrroom",function(e){b.badge_id=e&&e.bdg_id}),t.on("mod.crazyfansday.state.change",function(e){3==e?b.isFansInjulyActive=1:b.isFansInjulyActive=0}),t.on("mod.roompoint.low",function(e){e===!0?b.lockText="因主播积分过低，暂时无法使用！":b.lockText=""}),t.on("mod.center.onekey.closure",function(e){56!=e.code&&57!=e.code||(b.lockText="你已被封号不能使用道具！")}),t.on("mod.backpack.noble.info",function(e){if("memberinfores"===e.type){var t={nl:parseInt(e.nl,10)||0,npl:parseInt(e.npl,10)||0,nets:e.nets||0,trial:parseInt(e["try"],10)||0};m.nobleInfo=t,m.nobleConfig=$ROOM.nobleConfig}}),l.reg("room_data_handler",function(e){var a=r.decode(e).too();"gpbc"===a.type?t.trigger("mod.chat.msg.peckprop",e):"cdcp"===a.type||"npwarn"===a.type&&a.nc>0&&b.showNewPropTips()})},searchById:function(e){for(var t=b.props,a=t.length,i=0;a>i;i++)if(e===t[i].prop_id)return i;return-1},getPropById:function(e){var t=b.searchById(e);return-1!==t?b.props[t]:null},removePropById:function(e){var t=b.searchById(e);return-1!==t?b.props.splice(t,1):null},updatePanel:function(e){var t=b.getPropPanelHTML(e);b.doms.$panel.html(t)},getPropPanelHTML:function(e){var t=i.compile(y.propInfo),a=e.rel_giftdata||{};e.isDoubleIntimacy=c.get("doubleIntimacy");var s=t({prop:e,devote:e.devote,exp:e.exp,intimate:e.intimate,devote4Short:v(e.devote),exp4Short:v(e.exp),intimate4Short:v(e.intimate),isShowYwReturn:m.ywReturnSwitch&&(3===+e.prop_type||4===+e.prop_type)&&a.ry>0});return s},disabledTips:function(){var t=e(this).data("index"),a=b.props[t],i=0;b.doms.$tips.text(a.description),i=-b.doms.$tips.outerHeight(),b.doms.$tips.stop(!0).css({display:"block",marginTop:i/2}).delay(1e3).fadeOut(function(){e(this).hide()})},updateProp:function(e){var t=b.doms.$wrap.find("[data-index="+e.index+"]");t.find(".prop-count").text(e.count)},prev:function(){b.changePage("prev")},next:function(){b.changePage("next")},changePage:function(e){var t=b.pageIndex,a=b.doms;if("prev"===e){if(0>t-1)return;t--}else if("next"===e){if(t+1>=b.pageSize)return;t++}else t=e;a.$wrap.find(".prop-page").hide(),a.$prev.show(),a.$next.show(),0===t&&a.$prev.hide(),t>=b.pageSize-1&&a.$next.hide(),b.pageIndex=t,a.$wrap.find(".prop-page").eq(t).fadeIn(),a.$dots.removeClass("current").eq(t).addClass("current")},useProp:function(t){if(!b.sending){var a=e(this),i=a.data("index"),n=b.props[i],o=a.data("giftid");a.data("offensive");if(5===n.prop_type||!b.showLockTips()){var r=1,l=[5,7,8,9,10,11];return n.prop_type=parseInt(n.prop_type,10),-1===e.inArray(n.prop_type,l)&&s.get("sys.uid")==s.get("room.owner_uid")?void e.dialog.tips_black("主播不能给自己赠送道具"):0===n.count?void e.dialog.tips_black("道具已使用完"):(b.sendingData={propGiftId:o,prop:n,num:r,index:i,is_jz:0},n.count>0?1===n.active_type?(b.sendingData.is_jz=1,b.addRhythm()):b.sendProp():e.dialog.tips_black("您还没有该道具！"),!1)}}},sendProp:function(){var a=b.sendingData,i=a.propGiftId,n=a.prop,o=a.num,r=a.index,l=a.is_jz,d=b.ryh_id,c=b.ryh_txt,u=b.ryh_col,g={dy:s.get("room.device_id"),prop_id:n.prop_id,num:o,sid:window.$SYS.uid,did:window.$ROOM.owner_uid,rid:window.$ROOM.room_id,is_jz:l,ryh_id:d,ryh_txt:c,ryh_col:u},v={prop:n,propGiftId:i,index:r,num:o,postData:g},y=!1,k=1;if(f&&p[1][n.prop_id]&&(y=t.fire("room.gift.send.vote.status")))return t.trigger("room.gift.send.vote.show"),void b.close();if(f&&p[2][n.prop_id]){if(k=t.fire("room.year.activity.attack.prop"),1===k)return void e.dialog.tips_black("主播不是当前参赛主播，不在毒奶射程哦~");if(2===k)return void e.dialog.tips_black("不能毒奶友军主播哦~")}if(h&&(g.vrid=h),n&&m.nobleInfo&&13===n.prop_type&&n.level){var w=m.nobleInfo.nl,_=m.nobleInfo.npl,x=m.nobleInfo.nets,T=m.nobleInfo.trial,C=m.nobleConfig,S="",$=n.level_time/3600/24,I=['<em class="noble-rule-em">使用细则 <span class="noble-rule-icon"></span></em>','<p style="text-align: center;">提示</p>','<div class="noble-rule-info">','<span class="noble-rule-arrow"></span>','<span class="noble-rule-arrow2"></span>',"<p>1、使用贵族体验卡后可享受对应等级的特权，无贵族鱼翅返还；</p>","<p>2、贵族用户在贵族特权期间及贵族续费保护期时无法使用贵族体验卡；</p>","<p>3、普通用户使用贵族体验卡后，不能通过续费价格开通贵族；</p>","<p>4、普通用户使用贵族体验卡期间，可以开通任意等级的贵族；</p>","<p>5、普通用户使用一张贵族体验卡期间，可以继续使用其他贵族体验卡；</p>",'<p class="txt-ind">5-1：使用同等级的贵族体验卡时，贵族体验期延长；</p>','<p class="txt-ind">5-2：使用不同等级的贵族体验卡时，当前贵族体验特权立即消失，</p>','<p class="txt-ind">生效新的贵族体验特权；</p>',"<p>6、体验卡的特权过期时间指北京时间过期日期当天凌晨4点整；</p>","<p>7、以上规则斗鱼拥有最终解释权；</p>","</div>"].join("");
if(w&&1!=T)return void e.dy_dialog('<div class="noble-rule-content">您已经是贵族啦，无法使用体验卡~</div>',{mask:!0,title:I,buttons:[{content:"好的",callback:function(){DYS.sub({action_code:"click_bag_nobexp_remd",ext:{type:1}}),this.hide()}}]});if(!w&&_&&1!=T)return void e.dy_dialog('<div class="noble-rule-content">您正处于贵族续费保护期，无法使用体验卡~</div>',{mask:!0,title:I,buttons:[{content:"好的",callback:function(){DYS.sub({action_code:"click_bag_nobexp_remd",ext:{type:0}}),this.hide()}}]});if(w&&1==T){C&&C[n.level]&&(S=C[n.level].noble_name);var j=C[w].noble_name,D=Math.ceil((x-(new Date).getTime()/1e3)/3600/24);0>D&&(D=0);var R=parseInt($)+D,P='<div class="noble-rule-content"><span>是否立即体验<em class="dy-special">'+$+'</em>天的<em class="dy-special">'+S+'贵族</em>？</span><span class="living-backpack-txt">您当前的'+j+'体验贵族<em class="dy-special">（剩'+D+"天）</em>",L=0;return n.level==w?(P=P+'将延长至<em class="dy-special">'+R+"</em>天",L=1):(P+="将自动消失",L=0),P+="</span></div>",void e.dy_dialog(P,{mask:!0,title:I,buttons:[{content:"立即体验",callback:function(){this.hide(),DYS.sub({action_code:"click_bag_nobexp_sel_toexp",ext:{type:1,stat:L}}),b.sendPropAjax(v)}},{content:"取消",callback:function(){DYS.sub({action_code:"click_bag_nobexp_sel_canc",ext:{type:1,stat:L}}),this.hide()}}]})}if(!w&&!_&&1!=T)return C&&C[n.level]&&(S=C[n.level].noble_name),void e.dy_dialog('<div class="noble-rule-content">是否立即体验<em class="dy-special">'+$+'</em>天的<em class="dy-special">'+S+"贵族</em>？</div>",{mask:!0,title:I,buttons:[{content:"立即体验",callback:function(){this.hide(),DYS.sub({action_code:"click_bag_nobexp_sel_toexp",ext:{type:0,stat:0}}),b.sendPropAjax(v)}},{content:"取消",callback:function(){DYS.sub({action_code:"click_bag_nobexp_sel_canc",ext:{type:0,stat:0}}),this.hide()}}]})}b.sendPropAjax(v)},sendPropAjax:function(a){var i=a.prop,s=a.propGiftId,n=a.index,o=a.num,r=a.postData;b.sending=!0,e.ajax({type:"post",url:"/member/prop/send",dataType:"json",data:r,success:function(a){if(0===a.result){if(t.trigger("backpack.props.check.vote",a.data),5===i.prop_type)return b.reload(a.data),void b.rendertip(a);i.count-=o,b.fxPopExp(i,a),0===i.count?b.reload(a.data):(b.updatePanel(i),b.updateProp(i)),t.trigger("room.giftprop.send.success.backland",s),t.trigger("mod.prop.hover.batter.search",s,n),t.trigger("room.gift.send.success.finalyear",{val:{id:i.prop_id,devote:i.intimate},isProp:!0}),t.trigger("room.giftprop.send.success.valentine2018",s)}else 170001===a.result?g.init({dys_type:2}):e.dialog.tips_black(a.msg)},error:function(){e.dialog.tips_black("网络错误！")},complete:function(){b.sending=!1}})},rendertip:function(t){for(var a="",i=t.data.used_prop,s=i.child_prop_list,n=0;n<s.length;n++)a+=0===n?"<li>获得了："+s[n].prop_name+" × "+s[n].prop_count+"</li>":"<li>"+s[n].prop_name+" × "+s[n].prop_count+"</li>";var o=b.doms.$wrap,r=e(".backpack-prompt");r.length&&r.remove(),o.append('<div class="backpack-prompt-box"><span class="backpack-prompt-placeholder"></span><div class="backpack-prompt"><img class="backpack-favicon" src="'+$SYS.web_url+'app/douyu/res/page/room-normal/backpack/favicon.png" alt=""><ul class="backpack-info"><li class="prompt-title">您打开了'+i.prop_name+"</li>"+a+'</ul><a class="backpack-prompt-btn" href="javascript:void(0)">确定</a></div></div>')},close:function(){b.doms.$wrap.hide(),t.trigger("dys",{key:"dys.room.backpack.hide"})},show:function(){var a,i=c.get("fansGiftPush_"+s.get("sys.uid"));return o.check()?(b.doms.$wrap.is(":visible")?b.close():(b.getData(function(s){if(i&&(a=s.list,a&&a.length))for(var n=0;n<a.length;n++)if(i.gpid==a[n].prop_id)return i.gname=a[n].name,i.gicon=a[n].icon,void t.trigger("fans.gift.backpack.show",i);e("#js-stats-and-actions").find(".fans-barrage-gift").remove(),b.openTime=new Date,b.pageIndex=0,b.reload(s),b.doms.$wrap.fadeIn(),t.trigger("mod.prop.open.batter.update"),t.trigger("dys",{key:"dys.room.backpack.show"})}),b.hideNewPropTips()),!1):void o.show()},unlock:function(e){var t=0,a="";for(b.blankSpace+=e,a=b.doms.$wrap.find(".lock");e>t;t++)a.eq(t).removeClass("lock").addClass("blank")},addProp:function(t){var a,s,n,o=t;return o.classType="prop",b.props.push(o),n=b.doms.$wrap.find(".blank"),0===n.length?void e.dialog.tips_black("没有更多空间！",1.5):(s=i.compile(y.item),a=s({prop:o}),void n.eq(0).after(a).remove())},fxPopExp:function(a,i){var s,n,o=b.doms.$wrap.find("li[data-index="+a.index+"]"),r=o.offset(),l="",d=i.data.used_prop,c=d.prop_type,u=!1;switch(parseInt(c,10)){case 2:case 3:case 4:u=i.data&&i.data.ry>0&&(3===+a.prop_type||4===+a.prop_type),l=a.active_type&&1==a.active_type?"您的节奏已经起飞！":"赠送成功";break;case 7:l="鱼翅 +"+d.include_yuchi;break;case 8:l="鱼翅 +"+d.include_yuchi;break;case 9:l="鱼丸 +"+d.include_yuwan;break;case 10:l="鱼丸 +"+d.include_yuwan;break;case 11:l="获得了【"+d.prop_name+"】！";break;case 13:return e.dialog.tips_black("使用成功"),void setTimeout(function(){window.location.reload(!0)},2e3);default:if(0==a.exp)return;l=a.active_type&&1==a.active_type?"您的节奏已经起飞！":"赠送成功"}var g,m,p,f={};i.data.yuchi&&(f.gold=i.data.yuchi),u?(f.silver=(parseInt(e("#js-stats-and-actions").find('[data-login-user="silver"]').text(),10)||0)+(parseInt(i.data.ry,10)||0),s=e('<span class="gift-success-tip-num">+'+(i.data.ry||0)+"鱼丸</span>"),e("body").append(s),n=r.top-s.height(),g=r.left+(o.width()-s.width())/2,m="-=10px",p=500):(i.data.yuwan&&(f.silver=i.data.yuwan),s=e('<span class="gift-success-tip">'+l+"</span>"),e("body").append(s),n=r.top+o.height()-s.height(),g=r.left-s.outerWidth(!0),m="-=50px",p="slow"),t.trigger("mod.userinfo.change",{current:f}),s.show(),s.css({top:n,left:g}).animate({top:m},p).fadeOut("slow",function(){e(this).remove()})},getCSRFCookie:function(t){var a=d.get(s.get("sys.tvk")),i=s.get("sys.tn"),n=e.isFunction(t)?t:function(){};return a?void n({name:i,val:a}):void e.ajax({url:"/curl/csrfApi/getCsrfCookie",type:"GET",dataType:"json",success:function(e){0===e.error&&b.getCSRFCookie(n)}})},showLockTips:function(){return""!==b.lockText?(e.dialog.tips_black(b.lockText,3),!0):!1},showNewPropTips:function(){e(".backpack-btn").append('<i class="icon prop-new"></i>')},hideNewPropTips:function(){e(".backpack-btn .prop-new").remove()}}}),define("douyu/page/room/normal/mod/chouqin",["jquery","shark/class","douyu/context","douyu/com/user","shark/observer","shark/util/template/1.0","shark/util/storage/1.0","douyu/com/room-gift-tmp"],function(e,t,a,i,s,n,o,r){var l,d=!1,c=window.DYS,u=10,g=a.get("sys.res_url"),m={auto_send:!0,tipsTimer:0,cq:{state:{open:"open",close:"close"}}};l=t({init:function(){var t=this;if(1==e("body").data("cq")){var a=i.check();t.config={target:".cq_layer",personal_yc:".personal-info .w-yc .gold",state:m.cq.state.close,islog:a,type:-1},s.on("mod.gift.openCQWindowAndInit",function(){r.render().done(function(){t.toggle()})})}},render:function(){var t=['<div class="cq_layer js_cq_zs hide" id="cq-box">','<div class="title clearfix">','<a href="#" class="close"></a>','<div class="pic fl">',"<img />",'<p class="bg"></p>',"</div>",'<div class="text fl">','<div class="tit clearfix">','<span class="tmd fr" id="cq-lastcq">距离初级酬勤还有30小时</span>','<span class="nn fl"><%=anchorName%></span>',"</div>",'<div class="cnt">','<div class="progressbar fl" data-perc="60">','<div class="bar2" id="cq-cqbar" style="width: 0px;"><span></span></div>','<p class="sc sc0 jssc">0</p>','<p class="sc sc1 jssc"><i title="主播直播未满30小时，无法获得任何酬勤奖励"></i><span>30小时</span></p>','<p class="sc sc2 jssc"><i title="主播直播未满40小时，无法获得中级、高级酬勤奖励"></i>40小时</p>','<p class="sc sc3 jssc"><i title="主播直播未满60小时，无法获得高级酬勤奖励"></i>60小时</p>',"</div>",'<p class="hbro fl" id="cq-showtime"></p>',"</div>","</div>",'<ul class="flow clearfix">','<li><span class="flow1">赠送酬勤给主播</span></li>','<li><span class="flow2">主播直播满对应时长</span></li>','<li><span class="flow3">主播获得相应酬勤</span></li>','<li><span class="flow4">主播获得酬勤结算鱼翅</span></li>',"</ul>","</div>",'<div class="cont">','<div class="cq_list">','<ul id="cq-jumpic clearfix">','<li class="li_01">','<div class="cq_level">','<span class="pic"><img src="<%=oldUrl%>douyu/images/cq/cq_lv01.png"></span>','<p class="primary">初级酬勤<span class="intimacy-label">(亲密度X2)</span></p>','<p class="text"> 价值<em>15</em>鱼翅 </p>',"</div>",'<dl class="cq_hour">','<dt class="tt">赠送给主播后，您将获得:</dt>','<dd class="yw">',"<p>1000个鱼丸<span>（可赠送给主播）</span></p>","</dd>",'<dd class="cqtitle1">',"<p>初级酬勤头衔30天<span>（赠送房间显示）</span></p>","</dd>",'<dd class="wtitle">',"<p>全站酬勤头衔30天<span>（其他房间显示）</span></p>","</dd>",'<dd class="gx">',"<p>贡献值+150<span>（可提升贡献榜排名）</span></p>","</dd>",'<dd class="exp">',"<p>经验值+<%=15*YCTOEXP%><span>（酬勤结算后获得）</span></p>","</dd>","</dl>",'<div class="cq_btn"><a href="javascript:;" class="zs_btn cqgm" data-lv="1" data-price="15">立即赠送</a><span class="cq_contribution">贡献值+150</span></div>',"</li>",'<li class="li_02">','<div class="cq_level">','<span class="pic"><img src="<%=oldUrl%>douyu/images/cq/cq_lv02.png"></span>','<p class="primary">中级酬勤<span class="intimacy-label">(亲密度X2)</span></p>','<p class="text"> 价值<em>30</em>鱼翅 </p>',"</div>",'<dl class="cq_hour">','<dt class="tt">赠送给主播后，您将获得:</dt>','<dd class="yw">',"<p>2000个鱼丸<span>（可赠送给主播）</span></p>","</dd>",'<dd class="cqtitle2">',"<p>中级酬勤头衔30天<span>（赠送房间显示）</span></p>","</dd>",'<dd class="wtitle">',"<p>全站酬勤头衔30天<span>（其他房间显示）</span></p>","</dd>",'<dd class="gx">',"<p>贡献值+300<span>（可提升贡献榜排名）</span></p>","</dd>",'<dd class="exp">',"<p>经验值+<%=30*YCTOEXP%><span>（酬勤结算后获得）</span></p>","</dd>","</dl>",'<div class="cq_btn"><a href="javascript:;" class="zs_btn cqgm" data-lv="2" data-price="30">立即赠送</a><span class="cq_contribution">贡献值+300</span></div>',"</li>",'<li class="li_03">','<div class="cq_level">','<span class="pic"><img src="<%=oldUrl%>douyu/images/cq/cq_lv03.png"></span>','<p class="primary">高级酬勤<span class="intimacy-label">(亲密度X2)</span></p>','<p class="text"> 价值<em>50</em>鱼翅 </p>',"</div>",'<dl class="cq_hour">','<dt class="tt">赠送给主播后，您将获得:</dt>','<dd class="yw">',"<p>4000个鱼丸<span>（可赠送给主播）</span></p>","</dd>",'<dd class="cqtitle3">',"<p>高级酬勤头衔30天<span>（赠送房间显示）</span></p>","</dd>",'<dd class="wtitle">',"<p>全站酬勤头衔30天<span>（其他房间显示）</span></p>","</dd>",'<dd class="gx">',"<p>贡献值+500<span>（可提升贡献榜排名）</span></p>","</dd>",'<dd class="exp">',"<p>经验值+<%=50*YCTOEXP%><span>（酬勤结算后获得）</span></p>","</dd>","</dl>",'<div class="cq_btn"><a href="javascript:;" class="zs_btn cqgm" data-lv="3" data-price="50">立即赠送</a><span class="cq_contribution">贡献值+500</span></div>',"</li>","</ul>","</div>",'<div class="cq_foot clearfix">','<div class="tbg clearfix fl">','<p class="fl">小提示：</p>','<div id="cq-tscroll" class="cq_tip fl">','<ul id="uls">','<li><a href="/cms/gong/201508/21/2000.shtml" target="_blank">若酬勤成功，酬勤成功主播将获得您投入的鱼翅</a></li>','<li><a href="/cms/gong/201508/21/2000.shtml" target="_blank">累计赠送可获得鱼丸奖励可叠加</a></li>','<li><a href="/cms/gong/201508/21/2000.shtml" target="_blank">若酬勤成功，酬勤成功主播将获得您投入的鱼翅</a></li>','<li><a href="/cms/gong/201508/21/2000.shtml" target="_blank">每次赠送酬勤都会刷新头衔的持续时间</a></li>','<li><a href="/cms/gong/201508/21/2000.shtml" target="_blank">若酬勤失败，鱼丸会被会追回的哦！</a></li>','<li><a href="/cms/gong/201508/21/2000.shtml" target="_blank">每月21日起可赠送次月的酬勤</a></li>',"</ul>","</div>","</div>",'<div class="cq_meta clearfix fr">','<div class="fr cq_get_yc_btn">','<a class="get_yc fr" href="/web_game/welcome/18" target="_blank">充值</a>','<p class="cq_yc fl"><i class="icon"></i><em id="cq-usergold" class="jsroomcq"><img src="<%=oldUrl%>douyu/images/loading.gif"  /></em> 鱼翅</p>',"</div>",'<div class="fr">','<p class="cq_record"><i class="icon"></i><a href="/member/cp/get_yc_consume" target="_blank">赠送记录</a></p>','<p class="cq_rank"><i class="icon"></i><a href="/member/cp/cqTitle" target="_blank">我的头衔</a></p>','<p class="cq_del"><i class="icon"></i><a href="/cms/gong/201508/21/2000.shtml" target="_blank">活动详情</a></p>',"</div>","</div>","</div>","</div>","</div>"].join(""),i=n.compile(t),s=i({YCTOEXP:u,oldUrl:g,anchorName:a.get("room.owner_name")});e("body").append(s);var o=this;o.config.$el=e(o.config.target),o.config.$personal_yc=e(o.config.personal_yc)},open:function(){if(i.check()){var t=this.config.$el,a=e(".personal-info .w-yc span").text(),n=o.get("doubleIntimacy");1===parseInt(n,10)&&d&&t.find(".intimacy-label").addClass("intimacy-label-show"),e("#cq-usergold").html(a),this.config.state=m.cq.state.open,this.renderProgress(),t.removeClass("hide"),t.show(),this.tipScroll(),s.trigger("dys",{key:"dys.room.giftSend.chouqin.show"})}},close:function(){var e=this.config.$el;this.config.state=m.cq.state.close,e.hide(),clearTimeout(m.tipsTimer)},toggle:function(){0===e("#cq-box").size()&&(this.render(),this.bindEvt()),this.config.state===m.cq.state.open?this.close():this.open()},number_format:function(t){if(!e.isNumeric(t))return t;if(t=String(t),t.indexOf(".")<=0)return t;var a=t.split(".");return a[1]=a[1].substr(0,2),a.join(".")},tipScroll:function(){clearTimeout(m.tipsTimer);var e=document.getElementById("cq-tscroll"),t=!0;e&&(e.innerHTML+=e.innerHTML,e.onmouseover=function(){t=!1},e.onmouseout=function(){t=!0},new function(){var a=e.scrollTop%20==0&&!t;a||(e.scrollTop==parseInt(e.scrollHeight/2)?e.scrollTop=0:e.scrollTop++),m.tipsTimer=setTimeout(arguments.callee,e.scrollTop%20?10:2500)})},rechargeDialog:function(){e.dialog({content:"鱼翅余额不足，点击获取！",title:"提示",icon:"warning",cancelVal:"取消",okVal:"充值",lock:!0,ok:function(){try{c.storage.save("_dypay_fp",6.2)}catch(e){}window.open("/web_game/welcome/18"),s.trigger("dys",{key:"dys.room.giftSend.chouqin.send.charge.action"})},cancel:function(){}})},renderProgress:function(){s.trigger("douyu.avatar.get",$ROOM.owner_uid,"middle",function(t){e(".cq_layer .title .pic img").attr("src",t)}),e(".cq_layer").show(),e("#cq-showtime").html(""),e(".jsroomcq").html('<img src="'+$SYS.res_url+'douyu/images/loading.gif?v=20160322"  />'),e("#cq-cqbar").width(0),e.ajax({type:"POST",url:"/member/cq/get_cq_show",data:{owner_uid:$ROOM.owner_uid,room_id:$ROOM.room_id},dataType:"json",success:function(t){e("#cq-usergold").html(t.user_gold);var a=0;a=0==t.show_time?0:t.show_time<=1?1:Math.floor(t.show_time),e("#cq-showtime").html("已直播"+a+"小时"),e("#cq-cqbar").width(0),a>=60?(e("#cq-cqbar").animate({width:"592px"},1e3,function(){e(this).css({"border-top-right-radius":"5px","border-bottom-right-radius":"6px"})}),e("#cq-lastcq").html("酬勤时长已足够，主播可获得观众送的所有酬勤了"),e(".cq_layer .sc1 i").css({"background-position":"0 -422px"}).attr("title","主播已直播满30小时，可获得初级酬勤奖励"),e(".cq_layer .sc2 i").css({"background-position":"-155px -422px"}).attr("title","主播已直播满40小时，可获得初级、中级酬勤奖励"),e(".cq_layer .sc3 i").css({"background-position":"-326px -422px"}).attr("title","主播已直播满60小时，可获得所有酬勤奖励")):a>=40?(e("#cq-cqbar").animate({width:parseInt(592*a/60)+"px"},1e3),e("#cq-lastcq").html("再直播"+(60-a)+"小时，主播就可获得观众送的高级酬勤了"),e(".cq_layer .sc1 i").css({"background-position":"0 -422px"}).attr("title","主播已直播满30小时，可获得初级酬勤奖励"),e(".cq_layer .sc2 i").css({"background-position":"-155px -422px"}).attr("title","主播已直播满40小时，可获得初级、中级酬勤奖励")):a>=30?(e("#cq-cqbar").animate({width:parseInt(592*a/60)+"px"},1e3),e("#cq-lastcq").html("再直播"+(40-a)+"小时，主播就可获得观众送的中级酬勤了"),e(".cq_layer .sc1 i").css({"background-position":"0 -422px"}).attr("title","主播已直播满30小时，可获得初级酬勤奖励")):a>=0&&(e("#cq-cqbar").animate({width:parseInt(592*a/60)+"px"},1e3),e("#cq-lastcq").html("再直播"+(30-a)+"小时，主播就可获得观众送的初级酬勤了"))}})},present:function(){if(m.auto_send){var t=this,i=this.config.type,n=a.get("room.device_id"),o=[{type:1,yw:1e3,gold:15,value:"初级"},{type:2,yw:2e3,gold:30,value:"中级"},{type:3,yw:4e3,gold:50,value:"高级"}];if($SYS.uid==$ROOM.owner_uid)return e.dialog.tips_black("不能给自己送酬勤",2),!1;s.trigger("dys",{key:"dys.room.gift.chouqin.send",type:i}),e("#cq-box").hasClass("JS-loading")||(e("#cq-box").addClass("JS-loading"),e.ajax({type:"POST",url:"/member/cq/buy",data:{owner_uid:$ROOM.owner_uid,lv:i,dy:n,rid:$ROOM.room_id},dataType:"json",complete:function(){e("#cq-box").removeClass("JS-loading")},error:function(){e.dialog.tips_black("酬勤赠送失败",2),s.trigger("dys",{key:"dys.room.giftSend.chouqin.fail",em:"酬勤赠送失败",type:i})},success:function(n){if(n&&n.ret&&n.ret.result)switch(parseInt(n.ret.result,10)){case 0:var r=(parseInt(t.config.$personal_yc),e(".cq_btn").eq(i-1)),l=document.createElement("div");e(l).addClass("cq_contribute"),e(l).html('<span class="gift-success-tip">赠送成功</span>'),r.append(l),e(l).animate({top:"-93px"},1e3).fadeOut(400,function(){e(this).remove()}),s.trigger("mod.userinfo.change",{current:{gold:n.gold/100,ngold:n.noble_gold/100},change:{silver:o[i-1].yw}}),parseInt(n.noble_gold_ban)&&e('[data-login-content="yes"] .y3').hide(),a.set("room.user_best_cq",i),s.trigger("mod.chouqin.change",i),e("#cq-usergold").html(n.gold/100),s.trigger("dys",{key:"dys.room.giftSend.chouqin.success",type:i});break;case 283:t.rechargeDialog(),s.trigger("dys",{key:"dys.room.giftSend.chouqin.send.charge.show"});break;case 260014:var d=parseInt(n.gold,10),c=parseInt(n.noble_gold,10),u=(d-c)/100,g=parseInt(n.noble_gold_ban,10);!c||g?t.rechargeDialog():(t.recharge(o[i-1].value,o[i-1].gold,0>u?0:u),s.trigger("mod.gift.openCQWindowAndInit",{}));break;case 10001:e.dialog.tips_black(n.ret.msg);break;default:e.dialog.tips_black("酬勤赠送失败",2),s.trigger("dys",{key:"dys.room.giftSend.chouqin.fail",em:"酬勤赠送失败",type:i})}}}))}},recharge:function(t,a,i){var s=['<div class="room-charge-buyTip-panel spend--artdialog--fail">','<div class="room-charge-buyTip-headbg">','<a href="javascript:;" data-buyTip="cancel" class="room-charge-buyTip-close"></a>','<h2 class="spend--fail--title">购买失败</h2>',"</div>",'<div class="room-charge-buyTip-weal">',"<h4>酬勤价格: <%= price %>元</h4>",'<p><a href="#">贵族鱼翅不能用于购买酬勤！</a>除去贵族鱼翅后，您的账户剩余<%= balance %>鱼翅，不足以支付<%= value %>酬勤！</p>',"</div>",'<div class="room-charge-buyTip-footer">','<p class="spend--fail--btnbox">','<a href="javascript:;" data-buyTip="recharge" class="myvipbtn orangebtn">获取鱼翅</a>','<a href="javascript:;" data-buyTip="cancel" class="myvipbtn graybtn">取消</a> ',"</p>","</div>","</div>"].join(""),o=n.compile(s),r=o({price:a,balance:i,value:t}),l=e(r);e(".room-charge-buyTip-panel").remove(),e("body").append(l),l.on("click",'[data-buyTip="recharge"]',function(){window.open("/web_game/welcome/18"),l.remove()}),l.on("click",'[data-buyTip="cancel"]',function(){l.remove()})},bindEvt:function(){var t=this,a=this.config.$el;a.find(".close").on("click",function(e){e.stopPropagation(),e.preventDefault(),t.close()}),a.on("click",".cqgm",function(){return t.config.type=e(this).attr("data-lv"),t.present(),!1}),a.on("mousedown",".cq_foot .get_yc",function(){try{c.storage.save("_dypay_fp",6.2)}catch(e){}s.trigger("dys",{key:"dys.room.gift.chouqin.charge"})})}});var p={init:function(e){return s.on("mod.chouqin.auto.send.set",function(e){m.auto_send=e}),new l(e)}};return p}),define("douyu/page/room/normal/mod/anchor-dynamic",["jquery","shark/util/storage/1.0","douyu/context","douyu/com/user","douyu/com/insight"],function(e,t,a,i,s){var n={urls:{yuba:a.get("sys.yubaDomain").replace(/^http(s?):/,"").replace(/\/$/g,"")},storName:"anchordynamic50%",init:function(){var a=this,i=t.get(a.storName);this.doms={anchorDynamic:e("#js-room-anchor-dynamic")},!i&&this.doms.anchorDynamic.length&&s.build({selectors:this.doms.anchorDynamic,appear:function(){a.render(),a.bindEvents()}}),t.set(a.storName,!i)},getUrl:function(){return this.urls.yuba+"/api/dy/anchor/newgetAnchorpost?room_id="+a.get("room.room_id")+"&parent_url="+encodeURIComponent(location.protocol+"//"+location.host)},render:function(){this.doms.anchorDynamic.append('<iframe class="anchor-dynamic" src="'+this.getUrl()+'" frameborder="0"></iframe>')},bindEvents:function(){var e=this,t=e.doms.anchorDynamic.find("iframe"),a=function(e){var a=e||window.event;a.source===t[0].contentWindow&&("showanchorpost"===a.data?t.show():"showlogin"===a.data&&i.show("login"))};window.addEventListener?window.addEventListener("message",a):window.attachEvent?window.attachEvent("onmessage",a):window.onMessage=a}};return{init:function(){n.init()}}}),define("douyu/page/room/normal/mod/yz-rank-info",["jquery","shark/observer","shark/util/lang/1.0","shark/util/flash/data/1.0","shark/util/template/2.0","douyu/context","douyu/page/room/base/api","douyu/com/sign"],function(e,t,a,i,s,n,o,r){var l={webUrl:n.get("sys.web_url"),uploadUrl:n.get("sys.upload_url"),signUrl:n.get("sys.sign_url"),time:new Date,timeCha:0,serverRefresh:0,adImgSrc:"",currAnRankInfo:{},posid:40010,currAdInfo:{},getFlashMsg:!1},d={tools:{serverTime:function(){var e,t,a=new Date(l.time),i=a.getDay(),s=a.getHours()>1?1:0;i=0===i?7:i,e=0===s&&1===i?0:8-i-s,a.setDate(a.getDate()+e+s),a.setHours(1),a.setMinutes(0),a.setSeconds(0),t=a.getTime(),l.serverRefresh=t},timeAddZero:function(e){return 10>e?"0"+e:e},changeTime:function(e){var t=d.tools,a={day:864e5,hour:36e5,minute:6e4},i=e,s={},n={},o="",r={};return r.second=i/1e3,r.minute=r.second/60,r.hour=r.minute/60,r.day=r.hour/24,s.day=parseInt(r.day,10),s.hour=parseInt(r.hour,10)%24,s.minute=parseInt(r.minute,10)%60,s.second=parseInt(r.second,10)%60,i>=a.day?n.day=n.hour=n.minute=n.second=!0:i>=a.hour&&i<a.day?n.hour=n.minute=n.second=!0:i>=a.minute&&i<a.hour?n.minute=n.second=!0:n.second=!0,n.day&&(o+=s.day+"天"),n.hour&&(s.hour=n.day?t.timeAddZero(s.hour):s.hour,o+=s.hour+"小时"),n.minute&&(s.minute=n.hour?t.timeAddZero(s.minute):s.minute,o+=s.minute+"分"),n.second&&(s.second=n.minute?t.timeAddZero(s.second):s.second,o+=s.second+"秒"),o},timeStr:function(){var e=d.tools,t=l.serverRefresh-((new Date).getTime()+l.timeCha);t=0>t?t+6048e5:t;var a=e.changeTime(t);return a},showWan:function(e){var t=Number(e),a="约",i="";return t>1e4?(i="万",t=(t/1e4).toFixed(1),parseInt(t,10)==t&&(t=parseInt(t,10))):t=parseInt(t,10),a+t+i}},init:function(){l.getFlashMsg||(l.getFlashMsg=!0,d.listen())},listRender:function(e,t){var i=this.tools.changeTime(l.time),n=a.string.join('<div class="yz-week-mask" id="yz-week-mask">','<div class="yz-week-modal">','<div class="yz-week-modal-wrap">','<div class="yz-week-close" data-type-yz="close-btn">','<a href="javascript:;">×</a>',"</div>",'<div class="yz-week-content">','<div class="clearfix">','<div class="yz-week-title">',"<h2>颜值周星榜</h2>",'<div class="yz-week-text">','<p>每周重置榜单 <span>倒计时：<em data-type-yz="time">{{ time }}</em></span></p>',"</div>","</div>",'<a class="yz-link-more" href="/directory/rank_list/yz" target="_blank" data-type-yz="rank-more">更多榜单&gt;&gt;</a>',"</div>","{{ if adInfo }}",'<div class="yz-week-banner {{cTrackClass}}" id="yz-week-banner" data-dysign="40010" data-dysign-mid="{{adInfo.mid}}" data-dysign-gid="{{adInfo.gid}}">','<a class="yz-week-link" href="{{ if adInfo.link }}{{ adInfo.link }}{{ else }}javascript:void(0){{ /if }}" {{ if adInfo.link }}target="_blank"{{ /if }}>','<img src="{{ adInfo.src }}">',"</a>","</div>","{{ /if }}",'<div class="yz-wrap">','<div class="yz-rank-list">','<p class="yz-week-text">榜单数据每分钟更新一次</p>','<ul data-type-yz="main-rank">',"{{ each mainData as item index }}",'<li class="{{ if index % 2 === 1 }}yz-bg{{ /if }} {{ if item.isCurr == 1}}yz-current{{ /if }}">','<a class="yz-col-left" href="{{ item.href }}" {{ item.target }}  {{ if item.cursor }} style="cursor: default;" {{/if}}>','<span class="yz-contrib">{{ item.strGxz.strGxz1 }}<em class="yz-contrib-value">{{ item.strGxz.strGxz2 }}</em>{{ item.strGxz.strGxz3 }}</span>','<div class="yz-wp-left">','<span class="yz-index">{{ item.idx }}</span>','<span class="yz-zhubo">','<img src="{{ item.src }}" />','<em class="yz-zhubo-icon"></em>',"</span>","<p {{ item.title }}>{{ item.owner_name }}</p> ",'<div class="play-status {{ if item.isLive == 0 }}  yz-stop {{ /if }}">',"{{ if item.isLive == 1}}",'<span class="yz-play"></span> ',"{{ /if }}",'<span class="yz-fenqu">{{ item.zone }}</span> ',"</div>","</div>","</a>","</li>","{{ /each }}","</ul>","</div>","</div>","</div>","</div>","</div>",'<div class="yz-week-mask-holder"></div>',"</div>"),o=s.compile(n),r="";t.cTrackUrl&&t.cTrackUrl.length>0&&(r="js-monitor-sign");var d=o({mainData:e,adInfo:t,cTrackClass:r,time:i});return d},layout:function(t){var a=this,i=e("#container"),s=a.listRender(t.mainData,t.adInfo);i.append(e(s)),l.exposure||(l.exposure=!0,r.exposure()),a.bindEvent()},sendAjax:function(t,a){var i=t.url,s=t.type||"GET",n=t.data||{},o=a||{},r=o.success||e.noop,l=o.error||e.noop;i&&e.ajax({url:i,type:s,data:n,dataType:"json",success:r,error:l})},handleData:{hasCurrAn:!1,currAuIndex:-1,findCurrAn:function(e){for(var t=this,a=0,i=e||[],s=i.length,o=n.get("room.room_id");s>a;a++)o==i[a].rid?(i[a].isCurr=1,t.currAuIndex=a,t.hasCurrAn=!0):i[a].isCurr=0},gxzHandle:function(e){for(var t=e,a=d.handleData.currAuIndex,i=t[a].credit,s="",n="",o="",r=[],l=0,c=t.length,u=d.tools.showWan;c>l;l++)a>l?(s="落后",n=u(Math.abs(t[l].credit-i)),o="贡献值"):l===a?(s=o="",n="当前主播"):(s="领先",n=u(Math.abs(t[l].credit-i)),o="贡献值"),t[l].strGxz={strGxz1:s,strGxz2:n,strGxz3:o};return r},aHandle:function(e){for(var t=e||[],a=n.get("room.owner_name"),i=0;7>i;i++)t[i].rid&&t[i].owner_name!==a?(t[i].href="/"+t[i].rid,t[i].target="target=_blank"):(t[i].href="javascript:void(0)",t[i].title=""),t[i].title="title="+t[i].owner_name;return t},dataLess:function(e){var t=e||[],a=t.length,i=0,s=0;if(d.handleData.hasCurrAn)d.handleData.gxzHandle(t);else for(;a>s;s++)t[s].strGxz={strGxz1:"",strGxz2:"",strGxz3:""};for(;a++<7;)t.push({idx:a,rid:"",owner_name:"虚位以待",src:l.webUrl+"/app/douyu/res/page/room-normal/yzmodal/yz_zhubo_pic_default.png?20170317",isCurr:"0",isLive:"0",zone:"",strGxz:{strGxz1:"",strGxz2:"",strGxz3:""},cursor:!0});if(!d.handleData.hasCurrAn)if(l.currAnRankInfo.idx<=7){for(t.splice(l.currAnRankInfo.idx-1,0,l.currAnRankInfo),d.handleData.currAuIndex=l.currAnRankInfo.idx-1,t.length=7;7>i;i++)t[i].idx=i+1;d.handleData.gxzHandle(t)}else t[6]=l.currAnRankInfo;return t},returnData:function(e){var t=[];return d.handleData.findCurrAn(e),t=d.handleData.dataLess(e),d.handleData.aHandle(t)}},listAjaxCb:{success:function(t){var a,i={},s=[];t.data&&(i=t.data,s=d.handleData.returnData(i),a=l.currAdInfo&&e.isEmptyObject(l.currAdInfo)?!1:l.currAdInfo,d.layout({mainData:s,adInfo:a}))},error:function(){e.dialog.tips_black("网络故障，请稍后重试"),l.getFlashMsg=!1}},timeAjaxCb:{success:function(e){0===parseInt(e.error,10)&&(l.time=e.time,l.timeCha=e.time-new Date),d.tools.serverTime(),d.getRankDate()},error:function(){d.getRankDate()}},adAjaxCb:{success:function(e){var t=[];if(0===parseInt(e.error,10)){if(t=e.data[0]?e.data[0]:[],t.srcid&&t.link){var a=t.srcid,i=r.helper.innerPath(a);l.currAdInfo.src=i,l.currAdInfo.link=t.link,l.currAdInfo.gid=t.gid,l.currAdInfo.mid=t.mid,l.currAdInfo.cTrackUrl=t.c_track_url,l.currAdInfo.iTrackUrl=t.i_track_url;var s=new Image;s.src=l.currAdInfo.src}r.helper.pushPageAdvar(e.data)}else l.currAdInfo={}},error:function(){l.currAdInfo={}}},getRankDate:function(){var e={url:"/rank/weekRank/yanzhiRankList"};d.sendAjax(e,d.listAjaxCb)},getAdData:function(){for(var e=window._pageadvar||[],t=e.length,a=0,i=l.posid,s={};t>a;a++)if(i==e[a].posid){if(e[a].srcid&&e[a].link){var n=e[a].srcid,o=r.helper.innerPath(n);s={src:o,link:e[a].link,gid:e[a].gid,mid:e[a].mid,cTrackUrl:e[a].c_track_url,iTrackUrl:e[a].i_track_url};var d=new Image;d.src=s.src}break}return s},getAdDataInfo:function(){var e=this,t=r.helper.buildSignApi(l.posid),a="/lapi/sign/signapi/getinfo";$SYS&&$SYS.sign_newver&&(a="/lapi/sign/web/getinfo");var i={url:a,type:"POST",data:t};e.sendAjax(i,e.adAjaxCb)},getTimeStr:function(t){var a=this,i=d.tools.timeStr();e(t).text(i),setTimeout(function(){a.getTimeStr(t)},1e3)},bindEvent:function(){var a=this,i=e("#yz-week-mask");a.getTimeStr(i.find('[data-type-yz="time"]')),i.on("click",'[data-type-yz="close-btn"]',function(){i.fadeOut("500",function(){i.remove(),l.getFlashMsg=!1})}),i.on("click",'[data-type-yz="rank-more"]',function(){t.trigger("dys",{key:"dys.room.yzRank.rankMore.click"})}),i.on("click",'ul[data-type-yz="main-rank"] li',function(){"javascript:void(0)"!==e(this).find("a").attr("href")&&t.trigger("dys",{key:"dys.room.yzRank.mainAnthor.click"})})},listen:function(){var e=this;window._pageadvar?l.currAdInfo=d.getAdData():e.getAdDataInfo();var t={url:"/lapi/member/ticker"};e.sendAjax(t,e.timeAjaxCb)}};o.reg("data_rank_num",function(t){var a=i.decode(t).too();"rri"===a.type&&(a.ri=i.decode(a.ri).too(),(!a.ri.idx||parseInt(a.ri.idx,10)<=0)&&(a.ri.idx="暂无排名"),l.currAnRankInfo=e.extend(!0,{},a,a.ri),l.currAnRankInfo.strGxz={strGxz1:"",strGxz2:"当前主播",strGxz3:""},l.currAnRankInfo.isCurr=1,l.currAnRankInfo.isLive=1,l.currAnRankInfo.owner_name=n.get("room.owner_name"),l.currAnRankInfo.src=n.get("room.avatar.middle"),l.currAnRankInfo.zone=n.get("room.second_lvl_name"),l.currAnRankInfo.credit=l.currAnRankInfo.sc)}),o.reg("room_show_yz_rank",d.init)}),define("douyu/page/room/normal/mod/jifen",["jquery","shark/observer","shark/util/lang/1.0","shark/util/template/1.0","shark/util/storage/1.0","shark/util/cookie/1.0","shark/util/flash/data/1.0","shark/util/date/1.0/date","douyu/context","douyu/com/user","douyu/com/exjsonp","douyu/com/imgp","douyu/page/room/base/api"],function(e,t,a,i,s,n,o,r,l,d,c,u,g){var m=l.get("sys.webconfUrl"),p=l.get("sys.web_url"),f=l.get("room.levelInfo"),h={officalDef:p+"app/douyu/res/page/room-normal/room-jifen/official_gift_default.jpg?20171102",anchorDef:p+"app/douyu/res/page/room-normal/room-jifen/anchor_gift_default.jpg?20171102"},v={jifenConfig:null,siwtchStatus:null,url:m+"resource/common/points/config_web.json",init:function(){v.getConfig(function(e){v.siwtchStatus=v.getAnchorRights(e),v.initJifenView()})},initJifenView:function(){v.siwtchStatus&&(+$ROOM.owner_uid===+$SYS.uid?y.init():b.init())},getConfig:function(e){v.jifenConfig?e(v.jifenConfig):c.load(v.url,"jifenConfig",function(t){v.jifenConfig=t,e(t)})},crsf:"/curl/csrfApi/getCsrfCookie",getCSRFCookie:function(t){var a=n.get(l.get("sys.tvk"));return a?void(t&&t({name:$SYS.tn,value:a})):void e.ajax({url:v.crsf,type:"GET",dataType:"json",success:function(e){0===+e.error&&v.getCSRFCookie(t)}})},getAnchorRights:function(t){var a=!1;return 0===+t.main_switch?a:(e.each(t.room_whitelist||[],function(e,t){return t==$ROOM.room_id?(a=!0,!1):void 0}),a?a:(e.each(t.tag_whitelist||[],function(e,t){return t==$ROOM.cate_id?(a=!0,!1):void 0}),a&&+t.min_level>+f.level?a=!1:a))}},b={ajaxLoadDelay:1e4,marqueeTimer:0,ajaxLoadStatus:0,init:function(){b._inited||(b._inited=!0,b.cache={dynamic:null,tasks:null,online:null,activeTab:"goods",mineNum:0,followed:0},i.helper("secondFormat",function(e){return r.format(new Date(1e3*parseInt(e)),"yyyy-MM-dd hh:mm")}),b.$container=e("#container"),b.addTriggerBtn(),b.addEvent())},addTriggerBtn:function(){var a=this,i=e('<div class=" js-jifen-enter-wrap"><div class="jifen-enter-btn"></div></div>');t.trigger("mod.chat.action.view.add",{flag:"jifen",dom:i,tips:"礼品兑换中心"}),i.show(),a.userGuideShow()},addEvent:function(){var a=b.$container;g.reg("room_data_handler",function(e){var t=o.decode(e).too();"online_task_notify"===t.type&&(b.cache.online=t,b.userOnlineTaskRender())}),t.on("room.anchor.follow.change",b.userFollowUpdate),a.on("click",".jifen-enter-btn",function(){return t.trigger("dys",{key:"dys.room.jifen.giftbtn.click"}),d.check()?void(b.$dialog||(b.userCenterRender(),b.userDynamicResponse(),"goods"===b.cache.activeTab?(b.userGoodsResponse(),b.userGoodsShow()):(b.userTaskResponse(),b.userTaskShow()))):void d.show("login")}),a.on("click",".ujifen-goods-tab",function(){e(this).hasClass("active")||(b.cache.activeTab="goods",b.userGoodsResponse(),b.userGoodsShow(),b.$dialog.find(".ujifen-task-tab").removeClass("active"),e(this).addClass("active"))}),a.on("click",".ujifen-task-tab ",function(){e(this).hasClass("active")||(b.cache.activeTab="task",b.userTaskResponse(),b.userTaskShow(),b.$dialog.find(".ujifen-goods-tab").removeClass("active"),e(this).addClass("active"))}),a.on("click",".ujifen-dialog .close-btn",function(){b.userCenterDestroy()}),a.on("click",".ujifen-taball-content .prev-btn:not(.disabled)",function(){b.changePrevGoods()}),a.on("click",".ujifen-taball-content .next-btn:not(.disabled)",function(){b.changeNextGoods()}),a.on("click",".ujifen-record-content .prev-btn:not(.disabled)",function(){b.changePrevRecord()}),a.on("click",".ujifen-record-content .next-btn:not(.disabled)",function(){
b.changeNextRecord()}),a.on("click",".ujifen-goods-item .goods-btn:not(.disabled)",function(){var t=e(this).closest(".ujifen-goods-item").data();b.exchangeGoodsConfirm(t)}),a.on("click",".ujifen-dialog .ujifen-anchor-btn",function(){b.userRecordShow()}),a.on("click",".ujifen-dialog .ujifen-back",function(){b.userRecordHide()}),a.on("click",".ujifen-dialog .select-month",function(){b.$dialog.find(".selected-month").removeClass("selected-month"),e(this).addClass("selected-month");var t=e(this).text();b.$dialog.find(".ujifen-calender-current .current-text").html(t),b.userRecordReponse(1)}),a.on("click",".ujifen-byfollow .ujifen-task-btn:not(.no-follow,.complete)",function(){var t=e(this),a=t.data("taskid");b.getTaskJiFen(a,function(e){b.cache.tasks&&(b.cache.tasks.follow=[]),b.showGetPointTips(t,e.tp),t.addClass("complete"),t.text("已领取")})}),a.on("click",".ujifen-byfollow .no-follow",function(){b.response({url:"/room/follow/add/"+$ROOM.room_id,type:"post",dataType:"text",data:{room_id:$ROOM.room_id},success:function(e){"ok"===e&&(b.userFollowUpdate(1),t.trigger("room.anchor.follow.change",1))}})}),a.on("click",".ujifen-bywatch .ujifen-task-btn:not(.not-satisfy)",function(){var t=e(this).data("taskid");b.getOnlineJiFen(t)}),a.on("click",".ujifen-bydownload .js-task-download",function(){var t=e(this).data();b.showTaskDownload(t)}),a.on("click",".ujifen-bydownload .js-task-complete",function(){var t=e(this),a=t.data("taskid"),i=t.data("index");b.getTaskJiFen(a,function(e){t.text("已领取").removeClass("js-task-complete").addClass("complete"),b.cache.tasks.games[i].taskStatus=2,b.showGetPointTips(t,e.tp)})})},showGetPointTips:function(t,a){e.dialog.tips_black("恭喜您领取了"+a+"积分")},exchangeGoodsConfirm:function(t){var a='确定要使用<span class="dydialog-ujifen-cf70">'+t.point+"</span>积分兑换";4===+t.type&&(a+='<div class="ujifen-exchange-tips">积分勋章仅在兑换直播间展示，<br>发言时可见，有效期30天，可累计；</div>'),e.dy_dialog(a,{title:"兑换信息提示",mask:!0,buttons:[{content:"确定",callback:function(e){b.exchangeGoods(t),this.hide()}},{content:"取消",callback:function(e){this.hide()}}]})},exchangeGoods:function(a){b.response({url:"/member/point_user/exchangeGift",type:"post",data:{md5_id:a.mid,room_id:$ROOM.room_id},success:function(i){if(0===+i.error){var s='<span class="dydialog-ujifen-succ"></span>恭喜你兑换成功<br>';s+=1==a.otype?"可在“站内信”中查看信息详情":"主播已私信你，请快去填写收货地址吧~",e.dy_dialog(s,{title:"兑换成功",mask:!0,buttons:[{content:"我知道了",callback:function(e){this.hide()}}]}),i.data&&(b.userJiFenUpdate(i.data.point),"undefined"!=typeof i.data.silver&&t.trigger("mod.userinfo.change",{current:{silver:i.data.silver}})),b.userGoodsUpdate(a)}else e.dialog.tips_black(i.data||"兑换失败")},error:function(){e.dialog.tips_black("网络错误")}})},userGoodsUpdate:function(e){var t=b.$dialog.find(".ujifen-goods-item[data-mid="+e.mid+"]"),a=t.find(".goods-stock-num"),i=a.text()||0;i=i>0?i-1:i,a.text(i),0===i&&t.find(".goods-btn").addClass("disabled")},changePrevGoods:function(){var e=b.$dialog.find(".ujifen-taball-content .ujifen-pagebar"),t=e.data("page")||1;t>1&&(t-=1),b.userGoodsResponse(t)},changeNextGoods:function(){var e=b.$dialog.find(".ujifen-taball-content .ujifen-pagebar"),t=e.data("page")||1,a=e.data("size");a>t&&(t+=1),b.userGoodsResponse(t)},response:function(t){var a=e.extend({dataType:"json",type:"get",error:function(){}},t);"post"===a.type?v.getCSRFCookie(function(t){e.extend(a,t),e.ajax(a)}):e.ajax(a)},userGoodsResponse:function(e){var t=e||1;b.response({url:"/member/point_user/getAnchorStoreGiftList",type:"post",data:{room_id:$ROOM.room_id,page:t},success:function(e){0===+e.error&&(b.cache.pageIndex=t,b.userGoodsRender(e.data))}})},userGoodsShow:function(){b.$dialog.find(".js-ujifen-goods-box").show(),b.$dialog.find(".js-ujifen-task-box").hide()},userDynamicResponse:function(){b.response({url:"/point/gift/getExchangeDynamicTop10",type:"post",data:{room_id:$ROOM.room_id},success:function(e){0===+e.error&&(b.cache.dynamic=e.data||[],b.userDynamicRender(e.data))}})},userDynamicRender:function(e){if(0!==b.cache.dynamic.length){var t=a.string.join('<div class="ujifen-dynamic-desc"><span class="icon"></span>大家都在兑换</div>','<div class="ujifen-dynamic-cont">','<ul class="ujifen-dynamic-list">',"<% for( var i=0; i< list.length ;i ++) {%>","<% var item = list[i]; %>",'<li class="ujifen-dynamic-item">','<div class="exchange-user">','<span class="user-name ellipsis" title="<%= item.nickname%>"><%= item.nickname%></span>','<span class="user-desc">兑换了</span>',"</div>",'<div class="exchange-name ellipsis" title="<%= item.name %>"><%= item.name %></div>',"</li>","<%}%>","</ul></div>"),s=i.compile(t),n=s({list:b.cache.dynamic});b.$dialog.find(".ujifen-exchange-dynamic").html(n),b.createMarquee(b.$dialog.find(".ujifen-dynamic-list"))}},createMarquee:function(e){var t=e.find(".ujifen-dynamic-item");t.length>3&&(clearInterval(b.marqueeTimer),e.append(t.clone()),b.marqueeTimer=setInterval(function(){t=e.find(".ujifen-dynamic-item"),e.animate({marginTop:-165},600,function(){e.append(t.slice(0,3)),e.css("marginTop",0)})},6e3))},userGoodsRender:function(e){b.$dialog.find(".ujifen-goods-box").mCustomScrollbar("destroy");var t=a.string.join('<div class="ujifen-goods-box">',"<%if (list.length == 0){%>",'<div class="ujifen-nogoods "></div>',"<% } else {%>",'<ul class="ujifen-goods-list clearfix">',"<% for( var i=0; i< list.length ;i ++) {%>","<% var item = list[i]; %>",'<li class="ujifen-goods-item" ',' data-mid="<%= item.md5_id %>"',' data-point="<%= item.point %>"',' data-otype="<%= item.type_is_official %>"',' data-type="<%= item.type %>"',' data-num="<%= item.remain_number %>"',' data-gid="<%= item.gid %>">','<img class="goods-img" data-original="<%= item.pic %>" src="<%= item.type_is_official == 1 ? official : anchor %>" >',"<% if(item.user_type == 2){ %>",'<div class="goods-type-fans">粉丝专属</div>',"<%}%>",'<div class="goods-name" title="<%= item.name %>">',"<% if( item.type_is_official == 1){ %>",'<span class="goods-type-official">官方</span>',"<% } else {%>",'<span class="goods-type-anchor">主播提供</span>',"<%}%>","<%= item.name %>","</div>",'<div class="goods-cost">积分','<span class="goods-cost-num"><%= item.point %></span>',"</div>","<% if(item.status == 1) {%>",'<div class="goods-stock">库存','<span class="goods-stock-num"><%= item.remain_number %></span>',"</div>","<% } else if (item.status == 3) {%>",'<div class="goods-stop">已停售</div>',"<%}%>",'<div class="goods-btn <%= item.remain_number == 0 || item.status == 3 ? "disabled" : "" %>">兑换</div>',"</li>","<%}%>","</ul>","<%}%>","</div>",b.userPageRender()),s=Math.ceil(e.total/e.limit),n=i.compile(t),o=n({list:e.list,size:s,page:e.page,official:h.officalDef,anchor:h.anchorDef});b.$dialog.find(".js-ujifen-goods-box").html(o),b.$dialog.find(".ujifen-goods-box").mCustomScrollbar(),b.userJiFenUpdate(e.point),u.build()},userPageRender:function(){var e=a.string.join('<div class="ujifen-pagebar <%= size <=1 ?"hide":"" %>"',' data-page="<%= page %>" data-size="<%= size %>">','<span class="prev-btn <%= page === 1 ? "disabled" : ""%>">上一页</span>','<span class="page-num">','<span class="current"><%= page %></span>/<span class="total"><%= size %></span>',"</span>",'<span class="next-btn <%= page== size ? "disabled" : "" %>">下一页</span>',"</div>");return e},userTaskResponse:function(){b.cache.tasks&&0!==b.ajaxLoadStatus?b.userTaskRender(b.cache.tasks):b.response({url:"/member/point_task/getTaskList",data:{room_id:$ROOM.room_id},success:function(e){0===+e.error&&(b.cache.tasks=e.data,e.data.st&&(b.cache.online=e.data.st),b.userTaskFilter(e.data),b.userTaskRender(e.data))}}),b.ajaxLoadStatus=1,setTimeout(function(){b.ajaxLoadStatus=0},b.ajaxLoadDelay)},userTaskFilter:function(e){for(var t=0;t<e.games.length;t++){var i=e.games[t];if(i.taskName="",i.taskStatus=0,i.ios_task&&i.ios_task.length>0){i.ios_task=i.ios_task[0],i.taskName=i.ios_task.name,+i.ios_task.status&&(i.taskStatus=1),i.ios_task.task_id&&(i.taskid=i.ios_task.task_id),i.ios_task.point&&(i.point=i.ios_task.point),i.ioslink=i.ios_link+(-1!==i.ios_link.indexOf("?")?"&":"?"),i.ioslink+="callback=";var s=a.string.format("app_id={0}&room_id={1}&uid={2}",i.ios_app_id,$ROOM.room_id,$SYS.uid);-1===i.callback.indexOf("?")?i.ioslink+=encodeURIComponent(i.callback+"?"+s):i.ioslink+=encodeURIComponent(i.callback+"&"+s)}i.android_task&&i.android_task.length>0&&(i.android_task=i.android_task[0],i.taskName=i.android_task.name,+i.android_task.status&&(i.taskStatus=1),i.android_task.task_id&&(i.taskid=i.android_task.task_id),i.android_task.point&&(i.point=i.android_task.point),i.androidlink=i.android_task.link)}},userTaskShow:function(){b.$dialog.find(".js-ujifen-goods-box").hide(),b.$dialog.find(".js-ujifen-task-box").show()},userTaskRender:function(e){b.$dialog.find(".ujifen-task-content").mCustomScrollbar("destroy");var t=a.string.join('<div class="ujifen-task-content">','<div class="ujifen-task-list">','<div class="ujifen-task-item ujifen-bygift">','<div class="ujifen-task-intro">','<span class="icon"></span>','<span class="task-title">送礼物获积分</span>','<span class="title-more">送<span class="bygift-yc"><%= gift.num %>鱼翅</span>可以获得<span class="get-num"><%= gift.point %></span>积分</span>',"</div>","</div>",'<div class="ujifen-task-item ujifen-bywatch hide">',"</div>","<%if (follow && follow.length !== 0) {%>",'<div class="ujifen-task-item ujifen-byfollow" data-point="<%= follow.point %>">','<div class="ujifen-task-intro">','<span class="icon"></span>','<span class="task-title">关注该主播</span>','<span class="title-more">','<span class="get-num">+<%= follow.point %>积分</span>',"</span>","</div>",'<div data-taskid="<%= follow.task_id %>" class="ujifen-task-btn ','<%= follow.status == 0 ? "no-follow" : follow.status == 2 ? "complete" : "" %>">','<%= follow.status == 0 ? "关注" : follow.status ==1 ? "领取" : "已领取" %>',"</div>","</div>","<%}%>","<% for( var i = 0; i< games.length ; i ++ ) { %>","<% var item = games[i]; %>",'<div class="ujifen-task-item ujifen-bydownload" data-point="<%= item.point %>">','<div class="ujifen-task-intro">','<img class="ujifen-task-icon" src="<%= item.icon%>">','<span class="task-title"><%= item.taskName %></span>','<span class="title-more">','<span class="get-num">+<%= item.point %>积分</span>',"</span>","</div>",'<div class="ujifen-bydownload-remark">',"*本房间下载的游戏，只能在本房间领取积分","</div>","<% if(item.taskStatus == 0) {%>",'<div class="ujifen-task-btn js-task-download"',' data-androidlink="<%= item.androidlink %>"',' data-ioslink="<%= item.ioslink %>">下载</div>',"<%} else if(item.taskStatus == 1){%>",'<div class="ujifen-task-btn js-task-complete" data-taskid="<%= item.taskid%>" data-index="<%= i %>">领取</div>',"<%} else {%>",'<div class="ujifen-task-btn complete">已领取</div>',"<%}%>","</div>","<% } %>","</div>","</div>","</div>"),s=i.compile(t),n=s(e);b.$dialog.find(".js-ujifen-task-box").html(n),b.userOnlineTaskRender(),b.userFollowUpdate(b.cache.followed||0),b.$dialog.find(".ujifen-task-content").mCustomScrollbar()},showTaskDownload:function(t){var a=[];t.ioslink&&a.push('<span class="ujifen-ios-download"><div class="qrcode"></div><div class="os-text">【IOS】</div></span>'),t.androidlink&&a.push('<span class="ujifen-android-download"><div class="qrcode"></div><div class="os-text">【Android】</div></span>'),a.push("<div>请用手机“扫一扫”下载</div>"),e.dy_dialog(a.join(""),{title:"下载应用",mask:!0,onInit:function(){t.ioslink&&b.renderQRcode(e(".ujifen-ios-download .qrcode"),t.ioslink),t.androidlink&&b.renderQRcode(e(".ujifen-android-download .qrcode"),t.androidlink)}})},renderQRcode:function(t,a){var i="Microsoft Internet Explorer"==navigator.appName&&parseInt(navigator.userAgent.toLowerCase().match(/msie ([\d.]+)/)[1])<9?"table":"canvas";e(t).qrcode({render:i,width:110,height:110,text:a})},userFollowUpdate:function(e){if(b.cache.followed=+e||0,b.$dialog){var t=b.$dialog.find(".ujifen-byfollow .ujifen-task-btn");1==b.cache.followed?(t.removeClass("no-follow"),t.hasClass("complete")||t.text("领取")):(t.addClass("no-follow"),t.hasClass("complete")||t.text("关注"))}},userJiFenUpdate:function(e){b.cache.mineNum=e||0,b.$dialog.find(".mine-num").text(e)},userOnlineTaskRender:function(){if(b.cache.online&&b.$dialog){var e=b.$dialog.find(".ujifen-task-item.ujifen-bywatch"),t=b.cache.online;if(0===e.length)return;var s=a.string.join('<div class="ujifen-task-intro">','<span class="icon"></span>','<span class="task-title">看直播领积分</span>',"<% if(hasNext == 1) {%>",'<span class="title-more">再看<span class="bywatch-time"><%= nextTime %></span>即可获得<span class="get-num"><%= nextJifen %></span>积分，加油~</span>',"<%} else {%>",'<span class="title-more">恭喜您完成今日的观看任务，明天再继续努力~</span>',"<%}%>",'<span class="task-reset-tips">(每日04:00重置此任务)</span>',"</div>",'<div class="ujifen-bywatch-detail">','<div class="ujifen-watch-step-list clearfix">',"<% for(var i=0,j=list.length;i<j;i++){%>","<% var item = list[i];%>",'<div class="ujifen-watch-step <%= i== j-1 ? "last-child" : ""%>">','<div class="icon ','<%= item.complete == 0 ? "disabled" : "" %> ','<%= item.complete == 2 ? "chest-shake" : "" %>','<%= item.complete == 3 ? "chest-open" : "" %>','"></div>','<div class="ujifen-task-btn <%= item.complete != 2 ? "not-satisfy" : "" %>"',' data-taskid="<%= taskid %>" >',"<%= item.text %></div>","</div>","<%}%>","</div>",'<div class="ujifen-watch-progress">','<div class="progress-current" style="width:<%= width %>px">',"</div>","</div>","</div>"),n=i.compile(s),o=[32,186,342,499,530],r=o[0],l=[];t.otfl=+t.otfl,t.otpl=+t.otpl;for(var d=1;5>d;d++){var c={complete:0};d<=t.otfl&&(c.text="领取",c.complete=2,r=o[d]),d==t.otfl+1&&(c.text="进行中",c.complete=1),d>t.otfl+1&&(c.text="等待中",c.complete=0),d<=t.otpl&&(c.text="已领取",c.complete=3),l.push(c)}var u=1;t.otfl>=4&&(u=0);var g=n({list:l,nextTime:Math.ceil(t.nls/60)+"分钟",nextJifen:t.nlp,width:r,taskid:t.tid,hasNext:u});e.html(g).removeClass("hide")}},getTaskJiFen:function(t,a){b.response({url:"/member/point_task/awardGameTask",type:"post",data:{room_id:$ROOM.room_id,task_id:t},success:function(t){0===+t.error?(b.userJiFenUpdate(t.data.point),a&&a(t.data)):e.dialog.tips_black(t.data||"领取失败")},error:function(){e.dialog.tips_black("网络错误")}})},getOnlineJiFen:function(t,a){b.response({url:"/member/point_task/getPoint",type:"post",data:{room_id:$ROOM.room_id,task_id:t},success:function(t){0===+t.error?(e.dialog.tips_black(t.data.msg||"领取成功"),b.userJiFenUpdate(t.data.point),b.cache.online=t.data,b.userOnlineTaskRender(),a&&a()):e.dialog.tips_black(t.data||"领取失败")},error:function(){e.dialog.tips_black("网络错误")}})},userRecordReponse:function(e){var t=b.$dialog.find(".selected-month"),a={page:e,limit:7,month:t.data("month"),year:t.data("year"),room_id:$ROOM.room_id};b.response({url:"/member/point_user/getExchangeGiftLog",data:a,success:function(e){0===+e.error&&b.userRecordRender(e.data)}})},userRecordHide:function(){b.$dialog.removeClass("ujifen-record-dialog")},userRecordShow:function(e){b.$dialog.addClass("ujifen-record-dialog");var t=a.string.join('<div class="ujifen-record-calender clearfix">','<div class="ujifen-calender-select">','<div class="ujifen-calender-current">','<span class="icon calender"></span>','<span class="current-text">本月</span>','<span class="icon arrow"></span>',"</div>",'<ul class="ujifen-month-list">',"<% for(var j=0;j<monthList.length;j++){%>","<% date = monthList[j]; %>",'<li class="select-month <%= date.month == selected ? "selected-month " : ""%>','<%= date.month == currentMonth ? " current-month" : ""%>"',' data-month="<%= date.month %>"  data-year="<%= date.year %>" >','<%= date.month == currentMonth ? "本" : date.month %>月</li> ',"<%}%>","</ul>","</div>","</div>",'<div class="ujifen-dialog-tabcont">',"</div>"),s=i.compile(t),n=(new Date).getMonth(),o=(new Date).getFullYear(),r=(n-2+12)%12+1,l=(n-1+12)%12+1;n++;var d=[{year:r>n?o-1:o,month:r},{year:l>n?o-1:o,month:l},{year:o,month:n}];"undefined"==typeof e&&(e=n);var c=s({monthList:d,selected:e,currentMonth:n});b.$dialog.find(".ujifen-record-content").html(c),b.userRecordReponse(1)},userRecordRender:function(e){var t=a.string.join('<div class="ujifen-record-list">','<div class="ujifen-record-thead clearfix">','<div class="ujifen-record-td exchange-time">兑换时间</div>    ','<div class="ujifen-record-td exchange-desc">兑换信息</div>','<div class="ujifen-record-td exchange-used">使用积分</div>    ',"</div>",'<div class="ujifen-record-tbody">',"<% if (list.length === 0) {%>",'<div class="ujifen-record-none">暂无记录</div>',"<%} else {%>","<% for (var i = 0; i < list.length; i++) { %>","<% var item = list[i]; %>",'<div class="ujifen-record-tr clearfix">','<div class="ujifen-record-td exchange-time">',"<%= secondFormat(item.create_time) %></div>",'<div class="ujifen-record-td exchange-desc ellipsis" title="<%= item.name %>">','<img src="<%= item.pic %>" class="desc-icon" /><%= item.name %></div>','<div class="ujifen-record-td exchange-used">-<%= item.point %></div> ',"</div>","<%}%>","<%}%>","</div>","</div>",b.userPageRender()),s=i.compile(t),n=Math.ceil(e.total/7),o=s({list:e.list||[],size:n,page:e.page});b.$dialog.find(".ujifen-record-content .ujifen-dialog-tabcont").html(o)},changeNextRecord:function(){var e=b.$dialog.find(".ujifen-record-content .ujifen-pagebar"),t=e.data("page")||1,a=e.data("size");a>t&&(t+=1),b.userRecordReponse(t)},changePrevRecord:function(){var e=b.$dialog.find(".ujifen-record-content .ujifen-pagebar"),t=e.data("page")||1;t>1&&(t-=1),b.userRecordReponse(t)},userCenterRender:function(){var t=a.string.join('<div class="jifen-dialog-wrap">','<div class="jifen-dialog ujifen-dialog">','<div class="ujifen-dialog-title center-title">','<a class="ujifen-help" href="/member/point/point_instruction" target="_blank">','<span class="icon"></span>兑换中心说明',"</a>",'<span class="ujifen-title">礼品<span class="impt">兑换中心</span></span>',"</div>",'<div class="ujifen-dialog-title record-title">','<a class="ujifen-back" href="javascript:;"><span class="icon"></span>返回</a>','<span class="ujifen-title"><span class="impt">兑换</span>记录</span>',"</div>",'<div class="close-btn">&times;</div>','<div class="ujifen-dialog-content ujifen-taball-content">','<div class="ujifen-anchor-info">','<img class="ujifen-anchor-head" src="<%= anchor.pic %>" >','<div class="ujifen-anchor-name"><%= anchor.name %></div>','<div class="ujifen-anchor-desc">“感谢你们每天都来看我直播，大家可以用积分免费兑换各大礼品~”</div>','<div class="ujifen-anchor-btn">兑换记录</div>',"</div>",'<div class="ujifen-dialog-tabcont">','<div class="ujifen-left-menu">','<div class="ujifen-mine-num">','<div class="icon"></div>','<div class="mine-num"><%= mineNum %></div> ','<div class="mine-text">我的积分</div>   ',"</div>",'<div class="ujifen-goods-tab <%= activeTab =="goods" ? "active" : "" %>">','<div class="icon"></div>','<div class="ujifen-tab-box cleafix">','<div class="ujifen-tab-text1 fl">积分兑换</div>','<div class="ujifen-tab-text2 fl">多种好礼随意换</div>','<div class="ujifen-tab-arrow"></div>',"</div>","</div>",'<div class="ujifen-task-tab <%= activeTab == "task" ? "active" : "" %>">','<div class="icon"></div>','<div class="ujifen-tab-box cleafix">','<div class="ujifen-tab-text1 fl">积分任务</div>','<div class="ujifen-tab-text2 fl">每日任务，轻松拿积分</div>','<div class="ujifen-tab-arrow"></div>',"</div>","</div>",'<div class="ujifen-exchange-dynamic">',"</div>","</div>",'<div class="ujifen-tabcont-main js-ujifen-goods-box">',"</div>",'<div class="ujifen-tabcont-main js-ujifen-task-box">',"</div>","</div>","</div>",'<div class="ujifen-dialog-content ujifen-record-content" ></div>',"</div>",'<i class="after"></i>',"</div>"),s=i.compile(t),n=s({anchor:{pic:$ROOM.avatar.middle,name:$ROOM.owner_name},mineNum:b.cache.mineNum||0,activeTab:b.cache.activeTab});b.$dialog=e(n),b.$container.append(b.$dialog)},userCenterDestroy:function(){clearInterval(b.marqueeTimer),b.$dialog.remove(),b.$dialog=null},userGuideShow:function(){var t=s.get("user-jifen-guide",1)||0;if(1!==t){var i=a.string.join('<div class="jifen-guide-dialog">','<a href="javascript:;" class="close-btn js-anchor-guide-close"></a>','<div class="content">',"<h2><span>礼品兑换中心</span>上线啦，<br />为心爱的主播打call</h2>","<p>你可以到主播兑换中心兑换心仪礼品</p>","</div>","</div>");b.$guide=e(i),s.set("user-jifen-guide",1),e(".js-jifen-enter-wrap").append(b.$guide),b.$guide.on("click",".js-anchor-guide-close",function(){b.$guide.remove()})}}},y={init:function(t){this.config=e.extend(!0,{container:"#container",currentPage:1,firstStatus:"anchorScoreFirstShow",showAnchorDialog:!1},t),this.$container=e(this.config.container),this.$container.length&&(this.render(),this.bindEvent())},render:function(){this.renderEnter(),s.get(this.config.firstStatus)||(this.renderGuide(),s.set(this.config.firstStatus,1))},template:{guide:function(){return a.string.join('<div class="jifen-guide-dialog">','<a href="javascript:;" class="close-btn js-anchor-guide-close"></a>','<div class="content">',"<h2><span>礼品兑换中心</span>上线啦，<br />帮你留住粉丝，提高收入</h2>","<p>水友可以到你的兑换中心兑换礼品</p>","</div>","</div>")},anchor:function(){return a.string.join('<div class="jifen-dialog-wrap">','<div class="jifen-dialog jifen-anchor-dialog">','<div class="jifen-anchor-head">','<a href="/room/point/point_instruction" target="_blank" class="instruction"><i></i>兑换中心说明</a>',"<h2>我的<span>兑换中心</span></h2>",'<a href="javascript:;" class="close-btn js-anchor-dialog-close"></a>',"</div>",'<div class="jifen-anchor-info">',"<div>",'<div class="head">','<img src="<%= data.anchorAvatar %>" alt="">','<span class="head-mask"></span>',"</div>",'<div class="info">','<div class="anchor-name"><%= data.anchorName %><span class="anchor-level-icon" data-anchor-levelimg="<%= data.anchorLevel %>"></span></div>','<div class="slogan">“感谢你们每天都来看我直播，大家可以用积分免费兑换各大礼品~”</div>',"</div>","</div>",'<a href="/room/point/my" target="_blank" class="jifen-btn center-my-btn">去个人中心添加礼品</a>',"</div>",'<div class="jifen-anchor-container" selector="jfanchor-container">','<div class="loading"><img src="'+$SYS.web_url+'app/douyu/res/page/room-normal/loading.gif" />正在加载中</div>','<div class="jifen-anchor-box" selector="jfanchor-box"></div>',"</div>","</div>",'<i class="after"></i>',"</div>")},empty:function(){return a.string.join('<div class="jifen-anchor-empty">','<div class="empty-bg"></div>','<a href="/room/point/official" target="_blank" class="jifen-btn center-official-btn">去官方礼品池</a>',"</div>")},list:function(){return a.string.join('<div class="jifen-anchor-gift" selector="jfanchor-list">','<ul class="jifen-gift-list">',"<% var length = data.list.length || 0; %>","<% for (var i = 0; i < length; i++) { %>","<% var item = data.list[i]; %>","<li>",'<% if(item.type == 2) { %> <span class="gift-user-type"></span> <% } %>','<img src="<%= item.pic %>" alt="">','<div class="gift-info">','<div class="gift-name-box">','<span class="tag <%= item.tagClasName %>-tag"><%= item.tagText %></span>','<span class="gift-name" title="<%= item.name %>"><%= item.name %></span>',"</div>",'<div class="const-jifen"><span>积分<em><%= item.point %></em></span></div>','<div class="gift-num"><span>库存<em><%= item.number %></em></span><span>已兑换<em><%= item.sold %></em></span></div>',"</div>","</li>","<% } %>","</ul>","<% if(data.totalPage > 1) { %>",'<div class="pagination">','<a href="javascript:;" class="jifen-btn turn-btn <% if(data.isPrevDisable) { %> is-disable <% } %>" data-page="prev">上一页</a>','<span class="current"><%= data.currentPage %></span>/<span class="all"><%= data.totalPage %></span>','<a href="javascript:;" class="jifen-btn turn-btn <% if(data.isNextDisable) { %> is-disable <% } %>" data-page="next">下一页</a>',"</div>","<% } %>","</div>")},change:function(){return a.string.join('<div class="jifen-anchor-exchange">','<span class="bg"></span>','<div class="carousel-wrap">','<ul class="clearfix">',"<% for (var i = 0, length = data.length; i < length; i++) { %>","<% var item = data[i]; %>",'<li><span class="user-name" title="<%= item.nickname %>"><%= item.nickname %></span>兑换了<span class="gift" title="<%= item.name %>"><%= item.name %></span></li>',"<% } %>","</ul>","</div>","</div>")}},renderEnter:function(){var a=this;a.$btn=e('<div class=" js-jifen-enter-wrap"><div class="jifen-enter-btn"></div></div>'),t.trigger("mod.chat.action.view.add",{flag:"jifen",dom:a.$btn,tips:"礼品兑换中心"}),a.$btn.show()},renderGuide:function(){var t=this;t.$anchorGuide=e(t.template.guide()),e(".js-jifen-enter-wrap").append(t.$anchorGuide),t.$anchorGuide.on("click",".js-anchor-guide-close",function(){t.$anchorGuide.remove(),t.$anchorGuide=null})},renderScore:function(){var t=this;t.config.showAnchorDialog=!0,t.$anchorScore=e(i.compile(t.template.anchor())({data:{anchorAvatar:l.get("room.avatar.middle"),anchorName:l.get("room.owner_name"),anchorLevel:l.get("room.levelInfo.level")}})),t.$container.append(t.$anchorScore),t.$anchorScoreContainer=t.$anchorScore.find('[selector="jfanchor-container"]'),t.$anchorScoreBox=t.$anchorScoreContainer.find('[selector="jfanchor-box"]'),t.$anchorScore.on("click",".js-anchor-dialog-close",function(){t.$anchorScore.off("click").remove(),t.config.currentPage=1,t.config.showAnchorDialog=!1}),t.getListData()},getListData:function(e){var t=this;t.getData("/member/point_anchor/getAnchorStoreGiftList",{page:t.config.currentPage},function(a){var i=a.data||{};0===parseInt(a.error,10)&&parseInt(i.total,10)>0?(t.renderList(i),e||t.renderChange()):e||t.$anchorScoreContainer.html(t.template.empty())})},turnPage:function(t){var a=this;a.$anchorScoreContainer.off().on("click",".turn-btn",function(){var i=e(this).data("page");"prev"===i&&a.config.currentPage>1&&(a.config.currentPage-=1),"next"===i&&a.config.currentPage<t&&(a.config.currentPage+=1),a.getListData(!0)})},handleListData:function(t){var i=t||{},s=i.list||[],n={list:[],currentPage:parseInt(i.page,10)||1,totalPage:Math.ceil(t.total/t.limit)||1};return n.isPrevDisable=n.currentPage<=1,n.isNextDisable=n.currentPage>=n.totalPage,e.each(s,function(e,i){var s,o={};e>=parseInt(t.limit,10)||(parseInt(i.type_is_official,10)?(o.tagClasName="official",o.tagText="官方"):(o.tagClasName="anchor",o.tagText="主播提供"),o.defaultImg=a.string.format("{0}app/douyu/res/page/room-normal/room-jifen/{1}_gift_default.jpg?v=20171024",l.get("sys.web_url"),o.tagClasName),i.pic?(s=new Image,s.src=i.pic,s.onerror=function(){this.src=a.string.format("{0}app/douyu/res/page/room-normal/room-jifen/{1}_gift_default.jpg?v=20171024",l.get("sys.web_url"),o.tagClasName)},o.pic=s.src):o.pic=o.defaultImg,o.point=parseInt(i.point,10)||0,o.number=parseInt(i.remain_number,10)||0,o.sold=parseInt(i.sold_number,10)||0,o.name=i.name||"",o.type=parseInt(i.user_type,10)||1,n.list.push(o))}),n},renderList:function(e){var t=this,a=t.handleListData(e),s=i.compile(t.template.list())({data:a});s&&(t.$anchorScoreContainer.find(".loading").remove(),t.$anchorScoreBox.html(s),t.$anchorScoreBox.find(".jifen-gift-list").mCustomScrollbar("destroy").mCustomScrollbar(),t.turnPage(a.totalPage))},renderChange:function(){var e=this;e.getData("/point/gift/getExchangeDynamicTop10",{room_id:l.get("room.room_id")},function(t){var a=t.data||[],s=a.length;0===parseInt(t.error,10)&&s&&(e.$anchorScoreContainer.prepend(i.compile(e.template.change())({data:a})),s>2&&(e.$carousel=e.$anchorScoreContainer.find(".carousel-wrap"),e.carousel()))})},getData:function(t,a,i){v.getCSRFCookie(function(s){var n=e.extend(!0,{},a);n[s.name]=s.value,e.ajax({url:t||"",type:"POST",data:n,dataType:"json",async:!1,error:function(){e.dialog.tips_black("网络错误，稍后再试！")},success:function(t){e.isFunction(i)&&i(t)}})})},carousel:function(){function e(){n+=1,t.animate({marginTop:-(n*i)},600,function(){n>=s&&(n=0,t.css({marginTop:0}))})}var t=this.$carousel.find("ul"),a=t.height(),i=this.$carousel.height(),s=Math.ceil(a/i),n=0;this.$carousel.append(t.clone()),setInterval(function(){e()},5e3)},bindEvent:function(){var a=this;e(".jifen-enter-btn").on("click",function(){return t.trigger("dys",{key:"dys.room.jifen.giftbtn.click"}),d.check()?void(a.config.showAnchorDialog||a.renderScore()):void d.show("login")})}};return{init:function(){v.init()}}}),define("douyu/page/room/normal/mod/motorcade",["jquery","douyu/context","shark/observer","shark/util/template/2.0","shark/util/lang/1.0","douyu/page/room/base/api","shark/util/flash/data/1.0"],function(e,t,a,i,s,n,o){var r={enterArr:[],avatarDomain:t.get("sys.avatar_url"),defaultAvatar:t.get("sys.web_url")+"/app/douyu/res/com/defaultAvatar.png?v=20180110",vars:{embed:0,chat:0,flag:0}},l={renderMotorcadeEffect:function(){var e=['<div class="motorcade-call-enter" style="bottom: 30px;">','<div class="motorcade-enter" style="bottom: 0;">','<div class="motorcade-user-icon">','<img src="{{ handleAvatar(data.icon) }}">',"</div>",'<div class="motorcade-user-card">','<div class="motorcade-card-main">','<h2 title="{{ data.nn }}">{{ data.nn }}</h2>',"<p>正在召唤车队成员</p>","</div>","</div>","</div>","</div>"].join(""),t=i.compile(e);return t},handleAvatar:function(e){var t=r.defaultAvatar;return e&&(t=s.string.format("{0}upload/{1}_middle.jpg",r.avatarDomain,e)),t}},d={init:function(){this.renderHtml={renderMotorcadeEffect:l.renderMotorcadeEffect()},n.reg("room_data_handler",function(e){var t=o.decode(e).too();"clubcall"===t.type&&d.motorcadeCall(t)}),a.on("mod.chat.success",function(e){if(r.vars[e]=1,!r.vars.flag&&r.vars.embed&&r.vars.chat){var t=window.embedMsg;if(t&&t.driverInPlace)try{t.driverInPlace()}catch(a){}finally{r.vars.flag=1}}})},motorcadeCall:function(e){return e?void(r.enterArr.length?r.enterArr.push(e):(r.enterArr.push(e),d.appendMotorcadeEffect(e))):config},appendMotorcadeEffect:function(t){var a=this,i=a.renderHtml.renderMotorcadeEffect({data:t,handleAvatar:l.handleAvatar}),s=e(i);e("#js-chat-cont").append(s),s.animate({bottom:0},500,function(){setTimeout(function(){s.remove(),r.enterArr.splice(0,1),r.enterArr.length&&a.appendMotorcadeEffect(r.enterArr[0])},5e3)})}};return{init:function(){d.init()}}}),define("douyu/page/room/normal/mod/rec-video",["jquery","shark/observer","douyu/context","shark/util/template/1.0","douyu/com/insight"],function(e,t,a,i,s){var n=i.compile(['<ul class="lives" data-type="lives">',"<% for(var i=0; i<data.length;i++){%>","<% var item = data[i]; %>",'<li class="live <%= className %>">','<div class="">','<a href="'+$SYS.vsite_url+'/show/<%= item.hash_id %>" target="_blank" title="<%= item.title %>" data-rt="<%= item.ranktype %>" data-subrt="<%= item.recomType %>" data-vid="<%= item.vid %>" data-type="<%= item.rtype %>" data-tid="<%= item.cid2%>" data-rpos="<%= item.rpos%>" data-hashid="<%= item.hash_id %>">','<div class="live-preview">','<div class="img-box-cont">','<img src="<%= item.video_pic%>" >','<i class="play" ></i>',"</div>","<% if(item.is_short == 1){ %>",'<div class="duration short-video"><span></span><em>短视频</em></div>',"<%} else { %>",'<div class="duration"><span></span><em><%= formatDuration(item.video_duration) %></em></div>',"<%}%>","</div>",'<div class="live-details">',"<% if(item.is_short == 1){ %>","<% if(item.contents || item.topicTitle){ %>",'<h3 class="live-title"><%= item.contents ? item.contents : item.topicTitle  %></h3>',"<% }%>",'<div class="live-info">','<span class="u-name"><i class="icon"></i><%= item.author %></span>','<span class="w-num"><i class="icon"></i><%= item.view_num %></span>',"</div>","<% if(item.is_short == 1 && !item.contents && !item.topicTitle){ %>",'<h3 class="live-title">&nbsp;&nbsp;&nbsp;&nbsp;</h3>',"<%}%>","<%} else { %>",'<h3 class="live-title"><%= item.title %></h3>','<div class="live-info">','<span class="u-name"><i class="icon"></i><%= item.author %></span>','<span class="w-num"><i class="icon"></i><%= item.view_num %></span>',"</div>","<%}%>","</div>","<% if(item.isLive === true) {%>",'<div class="icon watch-back">回看</div>',"<%}%>","</a>","</div>","</li>","<%}%>","</ul>"].join("")),o={render:n,init:function(i){var n={selector:".tab-content.video",className:""};this.config=e.extend({},n,i),s.build({selectors:this.config.selector,appear:function(){e.ajax({url:"/swf_api/getRoomRecommVod/"+a.get("room.room_id"),type:"GET",dataType:"json",success:o.ajaxSuccess})}}),e("#js-recommand .tab-header .contribute").on("click",function(){t.trigger("dys",{key:"mod.normal.recom.hotv.click"})})},formatDuration:function(e){var t=parseInt(e,10),a=parseInt(t%60),i=parseInt(t/60),i=i>9?i:"0"+i;
a=a>9?a:"0"+a;var s="mm:ss";return s=s.replace("mm",i),s=s.replace("ss",a)},ajaxSuccess:function(a){if(0===a.error&&a.data&&a.data.length>0){a.className=o.config.className,a.formatDuration=o.formatDuration;var i=o.render(a);e(o.config.selector).html(i),t.trigger("mod.normal.recommand.layout"),e('[data-target="video"] li.live a').each(function(a,i){t.trigger("dys",{key:"dys.room.recom.show",pos:e(i).closest("li").index()+1,vid:e(i).data("vid"),rt:e(i).data("rt"),tid:e(i).data("tid"),rpos:e(i).data("rpos"),sub_rt:e(i).data("subrt")}),e(i).on("mousedown",function(){t.trigger("dys",{key:"dys.room.recom.click",pos:e(i).closest("li").index()+1,vid:e(i).data("vid"),rt:e(i).data("rt"),tid:e(i).data("tid"),rpos:e(i).data("rpos"),sub_rt:e(i).data("subrt")})})})}}};return o}),define("douyu/page/room/normal/mod/recommended",["jquery","shark/observer"],function(e,t){var a={videoWidht:283,promoteCount:3},i={},s={};return i.init=function(){i.$recommand=e("#js-recommand"),i.$trigger=i.$recommand.find('[data-type="trigger"]'),i.$target=i.$recommand.find('[data-type="target"]'),i.$promote=i.$recommand.find('[data-target="promote"]'),i.$video=i.$recommand.find('[data-target="video"]'),i.$equalLeft=e("#js-live-room-normal-equal-left"),i.$equalRight=e("#js-live-room-normal-equal-right"),i.$seprator=i.$recommand.find(".other").find(".sperator"),i.layout(),t.on("mod.normal.recommand.layout",function(){i.layout()})},i.layout=function(){i.$promote.length&&!i.$promote.hasClass("hide")&&(i.$promos=i.$promote.find('[data-type="promos"]'),a.promoteBoxWidht=i.$promos.width(),a.promoteRow=Math.floor(a.promoteBoxWidht/a.promoteWidht),i.promoteLayout()),i.$video.length&&!i.$video.hasClass("hide")&&(i.$lives=i.$video.find('[data-type="lives"]'),a.livesBoxWidht=i.$lives.width(),a.livesRow=Math.floor(a.livesBoxWidht/a.videoWidht),i.videoLayout())},i.promoteLayout=function(){var t=i.$promos.width(),s=30*a.promoteCount,n=(t-s)/a.promoteCount,o=204/362*n;i.$promos.each(function(){e(this).find("li").each(function(t){e(this).css({width:n,height:o})})}),i.$seprator.css({width:t+30})},i.videoLayout=function(){var t=i.$lives.width(),a=t/Math.ceil(t/283)-20;i.$lives.find("li").each(function(){e(this).width(a);var t=a-2,i=t/16*9;e(this).find("img").height(i);var s=(i-50)/2,n=(t-50)/2;e(this).find(".play").css({left:n,top:s})})},s.init=function(){var t="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;if(t&&window.ZeroClipboard){var a=e(".join-qq"),s=a.find("a");a.css("position","relative"),ZeroClipboard.config({swfPath:$SYS.web_url+"app/douyu/third/zclip-2.02/ZeroClipboard.swf?20171011"});var n=new ZeroClipboard(s);n.on("copy",function(t){if(n.setText(s.data("qqgroup")+""),"1"===s.data("lock"))return!1;s.data("lock","1");var i=e('<div style="position:absolute;left:37px;top:58px;width:240px;padding:5px 10px;line-height:16px;background:rgba(0,0,0,0.5);text-align:center;color:#fff;border-radius:4px;font-size:14px">QQ for Mac暂不支持一键加群功能<br>已为您将群号复制至剪贴板</div>').appendTo(a);i.delay(1500).animate({opacity:0},300,function(){i.remove(),s.data("lock","0")})}),s.on("click",function(){return!1})}i.$recommand.on("click",'[data-type="trigger"]',function(t){t.preventDefault(),t.stopPropagation();var a=e(this),s=a.data("trigger");i.$trigger.removeClass("current"),i.$target.addClass("hide"),a.addClass("current"),i.$recommand.find('[data-target="'+s+'"]').removeClass("hide"),i.layout();var n=i.$equalLeft.height(),o=i.$equalRight.height();i.$equalLeft.css({"min-height":o>n?o:""})}),i.$recommand.find('[data-type="trigger"]').eq(0).trigger("click")},{init:function(){i.init(),s.init()}}}),define("douyu/page/room/normal/mod/sign-rate",["douyu/com/sign","douyu/com/imgp","douyu/com/exjsonp","douyu/context","shark/util/storage/1.0"],function(e,t,a,i,s){var n={cateId:i.get("room.cate_id"),categoryId:i.get("room.category_id"),url:$SYS.webconfUrl.replace(/^http(s?):/,"").replace(/\/$/g,"")+"/resource/ap/live_room_ap_freq.json",fn:function(){},ctime:i.get("room.stsign_room.ctime")||0,roomChatAdid:"10020",roomTopAdid:"30009"},o={init:function(e){a.load(n.url,"setadrate",function(t){t&&t[n.roomChatAdid]&&t[n.roomTopAdid]&&(o.roomChat=$.extend(!0,o.roomChat,t[n.roomChatAdid]),o.roomTop=$.extend(!0,o.roomTop,t[n.roomTopAdid])),e()},e,n.fn,!0)},isShowAd:function(e,t){var a=this;a.isCateShowAd(t)?a.isTimeShowAd(e,t):t.setAd(e,!0)},isCateShowAd:function(e){var t=this,a=e.cate1,i=e.cate2,s=n.cateId,o=n.categoryId,r=t.isStrInArr(o,a),l=t.isStrInArr(s,i);return!(!r&&!l)},isTimeShowAd:function(e,t){var a=t.type,i=s.get(a+"ShowTime"),o=i?i:0,r=+new Date,l=(r-o)/1e3,d=t.daily_cap;d>=0&&t.interval>=0&&l>0?n.ctime===s.get(a)?l>=t.interval&&t.setAd(e):(s.set(a,n.ctime),t.setAd(e,null,!0)):t.setAd(e,!0)},isStrInArr:function(e,t){var a,t=t||[];if(0===t.length)return!1;for(var i=0,s=t.length;s>i;i+=1)t[i]==e&&(a=!0);return a},setStoreRate:function(e,t){s.set(e+"ShowTime",+new Date),s.set(e+"ShowRate",t)},getStoreRate:function(e){var t,a=s.get(e.type+"ShowRate");return t=null===a&&0!==a?e.daily_cap:a},roomChat:{type:"roomChat",showAgain:!0,timer:null,adid:n.roomChatAdid,init:function(e){var t=this;o.isShowAd(e,t)},setAd:function(e,t,a){var i=this;i.rate=a?i.daily_cap:o.getStoreRate(i);var s=$("[data-dysign="+i.adid+"]");!t&&i.rate>0&&(s.hasClass("hide")&&(i.rate--,o.setStoreRate(i.type,i.rate)),i.isShowAd(s,e,t)),t&&i.isShowAd(s,e,t)},isShowAd:function(e,a,i){var s=this;return e.html()?void(e.hasClass("hide")&&(s.setAdEvt(e,a,i),$("#js-chat-cont").append(e),e.removeClass("hide"),t.build())):void e.addClass("hide")},setAdEvt:function(e,t,a){var i=e.find(".chat-ad-cls"),s=e.data("showTime"),n=3;0===i.length&&(e.append('<a class="chat-ad-cls" href="javascript:;" title="关闭"><em>3S后可</em>关闭</a>'),i=e.find(".chat-ad-cls"));var o=i.find("em"),r=setInterval(function(){0===--n?(clearInterval(r),o.remove()):o.text(n+"S后可")},1e3);s&&setTimeout(function(){e.addClass("hide"),i.remove()},1e3*s),i.off("click").on("click",function(){0===n&&e.remove()})}},roomTop:{type:"roomTop",showAgain:!0,adid:n.roomTopAdid,init:function(e,t){var a=this;a.IsDiy=t,o.isShowAd(e,a)},setAd:function(e,t,a){var i=$(e.el),s=this;s.rate=a?s.daily_cap:o.getStoreRate(s),t||0===s.rate||(i.hasClass("hide")&&(s.rate&&s.rate--,o.setStoreRate(s.type,s.rate)),s.isShowRoomTop(i),s.showAgain=!1),t&&s.isShowRoomTop(i),s.timer&&clearTimeout(s.timer)},isShowRoomTop:function(e){var a=this;if(!e.html())return e.addClass("hide"),void(a.showAgain=!1);if(e.hasClass("hide")){e.removeClass("hide"),t.build(),e.find("a").addClass("adBoradius");var i=e.data("dysignShowtime")?e.data("dysignShowtime"):e.data("dysignShowtime");a.IsDiy&&i&&setTimeout(function(){e.addClass("hide")},1e3*i)}}}};return o}),define("douyu/page/room/normal/mod/sign",["douyu/com/sign","douyu/com/user","douyu/context","shark/util/cookie/1.0","shark/observer","shark/util/storage/1.0","shark/util/flash/data/1.0","douyu/page/room/base/api","douyu/page/room/normal/mod/sign-rate"],function(e,t,a,i,s,n,o,r,l){function d(e){for(var t=0,a=e.length;a>t;t++)e[t].isReverse=e[t].remark-1;return e}function c(){y||g.distributeBarrageByQueue(b),y=1}var u={count:0,adplaytime:60,distributeTaskTimer:0,distributeTaskDelay:6e4,athenaSwitch:a.get("colligate.athena_switch")||{zmd:0,sdm:0,lmt:60},giftBottomInterval:1e4,giftBottomTimer:0,marqueeCount:1,loadAdFlag:!1},g={},m={},p={},f=0,h=!1,v=window.$SYS?$SYS.sign_newver:!1,b=[],y=0,k={},w={},_=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();s.on("mod.chat.sign.video.state",function(e){f=e.state||0}),g.down15=function(t){var a=parseInt(t.posid);return 15===a||18===a?(u.count++,e.helper.defview(t),2===u.count&&($("[data-dysign=15]").removeClass("hide"),$("[data-dysign=15]").trigger("scroll"),setTimeout(function(){$("[data-dysign=15]").remove(),$("[data-dysign=18]").removeClass("hide"),$("[data-dysign=18]").trigger("scroll"),setTimeout(function(){$("[data-dysign=18]").remove()},15e3)},15e3)),!0):!1},m.roomVideoBottom=function(e){if(e&&11==e.id){var t=$(e.el);t[t.html()?"removeClass":"addClass"]("hide"),t.find("a").addClass("adBoradius");var a=t.data("dysign-showtime");h&&a&&setTimeout(function(){t.hide()},1e3*a)}},m.roomBottom=function(e){if(e&&30008==e.id){var t=$(e.el);t[t.html()?"removeClass":"addClass"]("hide"),t.find("a").addClass("adBoradius")}},m.roomGiftBottom=function(t,a){return t&&30012==t.posid?(_(function(){var i=$("[data-dysign=30012]"),s="",n="";if("string"==typeof a)s=a,n=a;else{var o=""==t.link?"":e.helper.innerLink(t);s='<a href="'+o+'" ',s+='class="room-dysign" ',s+='title="'+t.srcid+'" ',s+='data-dysign="'+t.posid+'" ',s+='data-gid="'+t.gid+'" ',s+='data-mid="'+t.mid+'" ',s+='data-adid="'+t.adid+'" ',s+='data-proid="'+t.proid+'" ',s+='target="_blank">'+t.srcid+"</a>",n='<a href="'+o+'" ',n+='class="room-dysign" ',n+='title="'+t.srcid+'" ',n+='target="_blank">'+t.srcid+"</a>"}if(0===i.find(".ft-roll-cont").length){i.append('<div class="laba"></div><div class="ft-roll-cont"></div> '),i.removeClass("hide");var r=$(n);r.removeClass("js-athena-sign"),i.find(".ft-roll-cont").append(r)}i.data({"dysign-mid":t.mid,"dysign-gid":t.gid}),i.find(".ft-roll-cont a:last").before(s),m.roomGiftBottomMarquee()}),!0):void 0},m.roomGiftBottomMarquee=function(){if(0===u.giftBottomTimer){var e=$("[data-dysign=30012]"),t=function(){if(2===e.find(".ft-roll-cont").children().length)return clearInterval(u.giftBottomTimer),void(u.giftBottomTimer=0);$(".ft-roll-cont").animate({top:18*-u.marqueeCount},function(){1===u.marqueeCount&&$(".ft-roll-cont").css("top","0"),$(document).trigger("scroll")});var t=e.find("a").eq(u.marqueeCount);m.athenaDys(t),u.marqueeCount===e.find(".ft-roll-cont").children().length-1&&(u.marqueeCount=0),u.marqueeCount++};m.athenaDys(e.find("a").eq(0)),u.giftBottomTimer=setInterval(function(){t()},u.giftBottomInterval)}},m.athenaDys=function(e){var t=$(e);if(t.hasClass("js-athena-sign")){var i=t.data();if("1"!==t.data("dys-athena")){$.get("/lapi/athena/room/dot",{t:(new Date).getTime(),bizid:i.bid,bthid:i.booth_id,conId:i.con_id,roomId:a.get("room.room_id")||0});var n=$.extend({key:"dys.room.normal.show.athena.zmd",ctid:$ROOM.cate_id},i);s.trigger("dys",n),t.data("dys-athena","1")}}},m.roomChatBottom=function(e){e&&30011==e.id&&(n.get("roomChatBottomAD")||setTimeout(function(){if(!f){var t=$(e.el);t.children().length>0&&(t[t.html()?"removeClass":"addClass"]("hide"),t.append("<span></span>"),t.find("span").on("click",function(){t.remove()}),$(document).trigger("scroll"),setTimeout(function(){t.remove()},15e3),n.set("roomChatBottomAD",1,259200))}},18e4))},p.room_15_18=function(){var e=$("[data-dysign=15]"),t=$("[data-dysign=18]"),a=u.adplaytime,i=e.children().length>0,o=t.children().length>0;a&&a==Number(n.get("adplaytime"))||(i?(e.removeClass("hide"),e.trigger("scroll"),e.is(":hidden")||s.trigger("mod.sign.start",{}),setTimeout(function(){e.remove(),s.trigger("mod.sign.end",{}),o&&(t.removeClass("hide"),t.is(":hidden")||s.trigger("mod.sign.start",{}),t.trigger("scroll"),setTimeout(function(){t.remove(),s.trigger("mod.sign.end",{})},15e3))},15e3)):o&&(t.removeClass("hide"),t.is(":hidden")||s.trigger("mod.sign.start",{}),setTimeout(function(){t.remove(),s.trigger("mod.sign.end",{})},15e3)),$("body").width()<=1366&&n.set("adplaytime",a,a))},g.loadDistributeInfo=function(){$.ajax({url:"/lapi/athena/room/barrage",type:"get",dataType:"json",data:{t:(new Date).getTime(),roomId:$ROOM.room_id,cid:$ROOM.cate_id},success:function(e){if(0===e.error&&e.data){var t=e.data.length>0?d(e.data):[];y?g.distributeBarrageByQueue(t):b=t}else g.distributeBarrageByQueue([])},error:function(){g.distributeBarrageByQueue([])}})},g.distributeBarrage=function(){var e=u.athenaSwitch.sdm||0,t=100*Math.random();e>t&&g.loadDistributeInfo()},g.distributeBarrageByQueue=function(e){clearTimeout(u.distributeTaskTimer);var t=u.athenaSwitch.lmt||60;if(t=1e3*t,e&&0!==e.length){var a=e.shift();r.exe("js_send_super_danmu",JSON.stringify([a])),u.distributeTaskTimer=setTimeout(function(){g.distributeBarrageByQueue(e)},t)}else u.distributeTaskTimer=setTimeout(function(){g.loadDistributeInfo()},u.distributeTaskDelay)},g.distributeRoomBottom=function(){var e=u.athenaSwitch.zmd||0,t=100*Math.random();e>t&&$.ajax({url:"/lapi/athena/room/marquee",type:"get",dataType:"json",data:{t:(new Date).getTime(),roomId:$ROOM.room_id,cid:$ROOM.cate_id},success:function(e){0===e.error&&e.data&&e.data.length>0&&g.renderRoomGiftBottom(e.data)}})},g.renderRoomGiftBottom=function(e){$(e).each(function(e,t){g.addRoomGiftBottom(t)})},g.addRoomGiftBottom=function(e){if(""!==$.trim(e.title)){e.jump_type=parseInt(e.jump_type,10),1===e.jump_type?(e.jurl=e.jump_to,e.rid="",e.vid=""):2===e.jump_type?(e.vid="",e.rid=e.jump_to,e.jurl="/"+e.jump_to):(e.rid="",e.vid=e.jump_to,e.jurl=$SYS.vsite_url+"/show/"+e.jump_to),e.booth_id=2;var t=[];t.push('<a target="_blank" class="js-athena-sign" '),t.push('data-bid="'+e.bid+'" '),t.push('data-booth_id="'+e.booth_id+'" '),t.push('data-ruleset_id="'+e.ruleset_id+'" '),t.push('data-con_id="'+e.con_id+'" '),t.push('data-rid="'+e.rid+'" '),t.push('data-vid="'+e.vid+'" '),t.push('data-jurl="'+e.jurl+'" '),t.push('href="'+e.jurl+'" >'),t.push(e.title),t.push("</a>"),t=t.join(""),m.roomGiftBottom({posid:30012},t)}},g.initEvent=function(){$("[data-dysign=30012]").on("click",".js-athena-sign",function(){var e=$(this).data(),t=$.extend({key:"dys.room.normal.click.athena.zmd",ctid:$ROOM.cate_id},e);$.get("/lapi/athena/room/catch",{t:(new Date).getTime(),bizid:e.bid,bthid:e.booth_id,conId:e.con_id,roomId:a.get("room.room_id")||0}),delete t.dysAthena,s.trigger("dys",t)})},r.reg("room_video_ready",c),r.reg("room_data_login",function(){1!==parseInt($ROOM.show_status,10)&&c()}),s.on("mod.normal.achorinfo.layout",function(){k.titleSignLayout()}),k={init:function(){$.ajax({url:"/lapi/sign/phonegameapi/getinfo",type:"post",data:{posidstr:"1",rid:$ROOM.room_id,cid:$ROOM.category_id,tid:$ROOM.cate_id},dataType:"json",success:function(e){0===e.code&&e.data&&e.data.length>0&&(k.titleSignData=e.data[0],k.renderTitleSign(),k.bindEvent())}})},renderTitleSign:function(t){var a="";2==k.titleSignData.ad_type&&(a='<i class="sign-spec"></i>');var i=e.helper.innerPath(k.titleSignData.ad_img),n=['<div class="sq-ad fl" style="position:relative">',a,'<a href="'+k.titleSignData.link+'" target="_blank">','<img src="'+i+'"  style="width:125px;height:25px"></a>',"</div>"].join("");k.titleSign=$(n).hide(),$("#anchor-info .sq-wrap").prepend(k.titleSign),s.trigger("mod.normal.achorinfo.layout")},titleSignLayout:function(){if(k.titleSign){var e=k.titleSign,t=$("#js-live-room-normal-left").width(),a=0===$(".no-anchor-impress").length,i=a?350:300,n=a?$("#anchor-info .anchor-impress"):$("#anchor-info .r-else");t-n.outerWidth(!0)-e.outerWidth(!0)-i>0?(e.show(),1!==e.data("dys-mgamead-show")&&(s.trigger("dys",{key:"mod.room.noraml.mgamead.show",tg_id:k.titleSignData.ad_id}),e.data("dys-mgamead-show",1))):e.hide()}},bindEvent:function(){k.titleSign.on("click",function(){s.trigger("dys",{key:"mod.room.noraml.mgamead.click",tg_id:k.titleSignData.ad_id})})}},w={init:function(){var e=this;s.on("direction.sign.10010",function(t){t&&e.renderTitleSign(t)})},renderTitleSign:function(t){var a="",i=this,s=e.helper.innerPath(t.srcid),n=e.helper.innerLink(t),o=this.makePhoneSignTpl(s,n,a),l=$(o).show();$("#anchor-info .sq-wrap").prepend(l),r.reg("room_data_tbredpacket",function(e){i.titleSignLayout()}),e.exposure()},titleSignLayout:function(){var e=$("#anchor-info .sq-wrap").find("[data-dysign]"),t=$("#js-live-room-normal-left").width(),a=0===$(".no-anchor-impress").length,i=a?350:300,s=a?$("#anchor-info .anchor-impress"):$("#anchor-info .r-else");t-s.outerWidth(!0)-e.outerWidth(!0)-i>0?$(e).show():$(e).hide()},makePhoneSignTpl:function(e,t,a){var i=['<div class="sq-ad fl" data-dysign="10010" style="position:relative">',a,'<a href="'+t+'" target="_blank">','<img src="'+e+'"  style="width:125px;height:25px"></a>',"</div>"].join("");return i}},m.recommendSign=function(t){return t&&30014==t.posid?(_(function(){var a,i=""==t.link?"":e.helper.innerLink(t);a='<a href="'+i+'" ',a+='class="room-dysign" ',a+='data-dysign="'+t.posid+'" ',a+='data-gid="'+t.gid+'" ',a+='data-mid="'+t.mid+'" ',a+='data-adid="'+t.adid+'" ',a+='data-proid="'+t.proid+'" ',a+='title="'+t.srcid+'" ',a+='target="_blank"><span class="icon-ad"></span>'+t.srcid+"</a>",$("[data-dysign=30014]").removeClass("hide").append(a)}),!0):void 0},m.roomChatCont=function(t){if(t&&10020==t.id){var a=e.helper.getAdInfoInData(t.id);e.helper.defview(a);var i=l.roomChat;i.init(t)}},m.roomDySign=function(t){var a=[12,13,14,10001,10002,10003,10004,10005,10006];e.helper.setSignNormalImg(t,a,"room-dysign")},m.roomChatRight=function(t){var a=[30005,30006,30007];e.helper.setSignNormalImg(t,a,"room-chatRight")};var x=function(){var e=new Image,t="http://cm.adxvip.com/CookieMapping?mid=REU1NjI2NTNERTZDMTRD&uid=";e.src=t+i.get("did")};if(window._pageadvar&&_pageadvar.length){for(var T=!1,C=0,S=_pageadvar.length;S>C;C++)if(2===_pageadvar[C].isthird){T=!0;break}T&&x()}$("#mainbody").on("click",".room-dysign",function(){if($SYS&&$SYS.sign_newver){var t=$(this).closest("[data-dysign]").data("dysign"),a=$(this).data("gid"),i=$(this).data("mid"),n=e.helper.getTextAdInfo(t,a,i);s.trigger("mod.sign.dot",t,n)}}),$("body").on("click",'[data-dysign="30010"] img',function(){var e=$(this).closest("[data-dysign]").data("dysign");s.trigger("mod.sign.dot",e)});var I=[30009,10010,10014],j={init:function(){var t=this;e.getAdInfo(I.join(","),t.distributeSign)},distributeSign:function(e){if(e.length>0)for(var t=e,a=0;a<t.length;a++){var i=parseInt(t[a].posid,10);-1!==$.inArray(i,I)&&s.trigger("direction.sign."+i,t[a])}}};return s.on("direction.sign.30009",function(t){if(t){e.helper.defview(t),t.id=30009,t.el=$('.room-ad-top[data-dysign="30009"]')[0];var a=l.roomTop;a.init(t,h)}}),{init:function(a){h=a,e.aop("clean","room-video-bottom",m.roomVideoBottom),e.aop("clean","room-bottom",m.roomBottom),e.aop("clean","room-chat-bottom",m.roomChatBottom),e.aop("view","room-gift-bottom",m.roomGiftBottom),e.aop("view","recommend-ad",m.recommendSign),e.aop("clean","room-chat-cont",m.roomChatCont),e.aop("clean","room-dysign",m.roomDySign),e.aop("clean","room-chatRight",m.roomChatRight),l.init(function(){j.init(),e.requestPage()}),t.check()&&(g.distributeBarrage(),g.distributeRoomBottom(),g.initEvent()),v?w.init():k.init()}}}),define("douyu/page/room/normal/mod/guide",["jquery","shark/observer","douyu/context","douyu/com/user","douyu/page/room/base/api"],function(e,t,a,i,s){var n={chat:{isLogin:i.check(),isShow:!1,$target:e("#js-chat-speak")},curBody:e("body")};return Guide=function(e){this.init(e)},e.extend(!0,Guide.prototype,{init:function(t){this.config=e.extend(!0,{speed:6e5,delay:!0},t),this.showWatch(),this.bindEvt()},interval:function(e,t,a){var i=this;this.timer=setTimeout(function(){e()!==!1&&i.interval(e,t)},t),a===!0&&e()},render:function(){var e=this;Number(a.get("sys.uid"))!==Number(a.get("room.owner_uid"))&&this.interval(function(){e._runtime()},this.config.speed,!this.config.delay)},_runtime:function(){n.chat.isShow||n.chat.isLogin||this.chat()},chat:function(){this.$chat=e('<div class="'+this.randomClass()+'"><div class="lead-close" data-type="live-lead-close"></div></div>'),n.chat.$target.append(this.$chat),n.chat.isShow=!0},randomClass:function(){var e=["live-lead","live-lead live-yw-lead","live-lead live-quality-lead","live-lead live-focus-lead","live-lead live-share-lead"];return e[Math.ceil(Math.random()*e.length)-1]},relayout:function(){if(this.$chat){var e=n.chat.$target.offset();this.$chat.css({left:e.left,top:e.top-this.$chat.outerHeight(!0)})}},bindEvt:function(){var a=this;e(document).on("click",'[data-type="live-lead-close"]',function(e){e.preventDefault(),e.stopPropagation(),a.$chat.hide().remove(),n.chat.isShow=!1,t.trigger("dys",{key:"dys.room.guide.close"})}).on("click",".live-lead",function(e){e.preventDefault(),i.show("login",{source:"click_msg_login_remind"}),t.trigger("dys",{key:"dys.room.guide.click"}),i.show("login",{source:"click_msg_login_remind"})}),e(window).resize(function(){a.relayout()})},showWatchTpl:function(t){var a=this;a.videoContent=e("#js-room-video");var n='<div class="show-watch" data-watch-content="content"><div class="close"><a href="#" data-watch-close="btn">关闭</a></div><div class="lead-txt" data-watch-content="txt"><div class="watchtxt"><p class="start"><span data-watch-time="second">5S</span>后将切换为 普通画质</p><p class="end">已切换为 普通画质</p><h4>登录继续畅享 超/高清画质</h4></div><div class="watchbtn"><a class="abtn1" href="#" data-watch-btn="login">登录</a><a class="abtn2" href="#" data-watch-btn="register">注册</a></div><div class="watchdown"><a target="_blank" href="/client" >[ 下载APP畅享超清 ]</a></div></div><div class="lead-txt hide" data-watch-content="normal"><div class="watchtxt"><p>当前观看的是普通画质</p><h4>登录继续畅享 超/高清画质</h4></div><div class="watchbtn"><a class="abtn1" href="#" data-watch-btn="login">登录</a><a class="abtn2" href="#" data-watch-btn="register">注册</a></div><div class="watchdown"><a target="_blank" href="/client">[ 下载APP畅享超清 ]</a></div></div></div>';e(".show-watch").remove(),a.videoContent.append(n),a.timSecond=e('[data-watch-time="second"]'),e('[data-watch-close="btn"]').on("click",function(){return e('[data-watch-content="content"]').hide(),s.exe("js_timeLoginTip"),!1}),e('[data-watch-btn="login"]').on("click",function(){return i.show("login"),!1}),e('[data-watch-btn="register"]').on("click",function(){return i.show("reg"),!1}),t?(e('[data-watch-content="txt"]').removeClass("hide"),e('[data-watch-content="normal"]').addClass("hide")):(e('[data-watch-content="txt"]').addClass("hide"),e('[data-watch-content="normal"]').removeClass("hide"))},showWatch:function(){var e=this;s.reg("room_bus_showwatchtipdown",function(){e.showWatchTpl(!0),e.showWatchtips()}),s.reg("room_bus_showwatchtip",function(){e.showWatchTpl(!1)})},showWatchtips:function(){var t=this,a=5;this.watchTimer=setInterval(function(){return a--,0>a?(clearInterval(t.watchTimer),e('[data-watch-content="txt"]').addClass("hide"),e('[data-watch-content="normal"]').removeClass("hide"),void s.exe("js_switchStream")):void t.timSecond.html(a+"S")},1e3)}}),{init:function(e){return new Guide(e)}}}),define("douyu/page/room/normal/mod/filter-keywords",["jquery","shark/observer","shark/util/storage/1.0","douyu/context","douyu/page/room/base/api"],function(e,t,a,i,s){var n="c_filter_keywords_data",o={localData:{globalKw:[],roomKw:{}},config:{roomId:parseInt(i.get("room.room_id"),10)||0,curScope:"room",curRoomKWData:[],noKwsRoomTx:"本房间",noKwsAllRoomTx:"全站",maxRoomNums:20,maxKWNums:20,maxKWLength:10,roomNums:0,tip1:"最多添加20个关键词",tip2:"请勿添加重复的关键词",tip3:"关键词长度最多为10个字",tip4:"最多设置20个直播间"},doms:{$jsFilterKeyWords:e("#js-filter-keywords")},init:function(){this.clickFilterKeywordsBtn()},dys:function(e){t.trigger("dys",e)},clickFilterKeywordsBtn:function(){var t=this;this.doms.$jsFilterKeyWords.find(".filter-keywords-btn").off().on("click",function(){var a=e("#room-filter-keywords-wrap");1===a.length?(a.remove(),t.config.curScope="room"):t.renderMainHtml(),t.dys({key:"dys.room.filterkeywords.enterbtn"})})},renderMainHtml:function(){this.getKeywordsData(),this.doms.$jsFilterKeyWords.append(this.render()),this.getDoms(),this.renderRoomKeywordsHtml(),this.addScrollBar(),this.bindEvent()},getKeywordsData:function(){this.localData=a.get(n)||this.localData,this.config.curRoomKWData=this.localData.roomKw[this.config.roomId]||[],this.getCurRoomNums(this.localData.roomKw)},getDoms:function(){this.doms.$roomFilterKwsWrap=e("#room-filter-keywords-wrap"),this.doms=e.extend(this.doms,{$roomFilterClose:this.doms.$roomFilterKwsWrap.find(".room-filter-close"),$roomFilterTabs:this.doms.$roomFilterKwsWrap.find(".room-filter-tabs"),$roomFilterContent:this.doms.$roomFilterKwsWrap.find(".room-filter-content"),$noKeywordsBox:this.doms.$roomFilterKwsWrap.find(".no-keywords-box"),$curKeywordsNums:this.doms.$roomFilterKwsWrap.find(".cur-keywords-nums"),$roomFilterInput:this.doms.$roomFilterKwsWrap.find(".room-filter-input"),$roomFilterAdd:this.doms.$roomFilterKwsWrap.find(".room-filter-add"),$fkMcBox:this.doms.$roomFilterKwsWrap.find(".fk-mc-box"),$filKeyMainContent:this.doms.$roomFilterKwsWrap.find(".filter-keywords-main-content"),$curFilterScope:this.doms.$roomFilterKwsWrap.find(".cur-filter-scope")})},getCurRoomNums:function(e){var t=0;for(var a in e)t++;this.config.roomNums=t},renderRoomKeywordsHtml:function(){var e=this.localData.roomKw[this.config.roomId]||[];e.length>0?(this.doms.$curKeywordsNums.text(e.length),this.renderKeywordsHtml(e)):this.isShowKeywordsContent(!1)},addScrollBar:function(){this.doms.$fkMcBox.mCustomScrollbar()},bindEvent:function(){this.clickCloseBtn(),this.clickTabsNav(),this.clickAddBtn(),this.clickDeleteBtn()},clickCloseBtn:function(){var e=this;this.doms.$roomFilterClose.off().on("click",function(){e.doms.$roomFilterKwsWrap.remove(),e.config.curScope="room"})},clickTabsNav:function(){var t=this;this.doms.$roomFilterTabs.off().on("click",".room-filter-tab",function(){var a=e(this).data("scope"),i=t.config.curScope;i!==a&&(e(this).addClass("active").siblings().removeClass("active"),"room"===a?(t.config.curScope="room",t.handleDataIsEmpty(t.config.curRoomKWData,t.config.noKwsRoomTx)):(t.config.curScope="global",t.handleDataIsEmpty(t.localData.globalKw,t.config.noKwsAllRoomTx)))})},handleDataIsEmpty:function(e,t){var e=e||[];e.length>0?(this.isShowKeywordsContent(!0),this.doms.$curKeywordsNums.text(e.length),this.renderKeywordsHtml(e)):(this.isShowKeywordsContent(!1),this.changeTipText(t)),this.doms.$curFilterScope.text(t)},clickAddBtn:function(){var e=this;this.doms.$roomFilterAdd.off().on("click",function(){var t=e.doms.$roomFilterInput.val();if(e.dys({key:"dys.room.filterkeywords.addbtn",kv:t,type:"room"===e.config.curScope?1:0}),0!==t.length){if(t.length>e.config.maxKWLength)return void e.showTipBox(e.config.tip3);if("room"===e.config.curScope){if(e.isExceedMaxRoomNum())return;if(e.isValidCondition(e.config.curRoomKWData,t))return;e.config.curRoomKWData.push(t),e.localData.roomKw[e.config.roomId]||e.config.roomNums++,e.localData.roomKw[e.config.roomId]=e.config.curRoomKWData,e.handleAddRenderData(e.config.curRoomKWData)}else{if(e.isValidCondition(e.localData.globalKw,t))return;e.localData.globalKw.push(t),e.handleAddRenderData(e.localData.globalKw)}a.set(n,e.localData),s.exe("js_filterKeywords",e.localData),e.doms.$roomFilterInput.val("")}})},isExceedMaxRoomNum:function(){return this.localData.roomKw[this.config.roomId]?!1:this.config.roomNums>=this.config.maxRoomNums?(this.showTipBox(this.config.tip4),!0):void 0},isValidCondition:function(e,t){return e.length>=this.config.maxKWNums?(this.showTipBox(this.config.tip1),!0):this.isRepeatAddKeyword(e,t,!1)?(this.showTipBox(this.config.tip2),!0):!1},handleAddRenderData:function(e){this.isShowKeywordsContent(!0),this.doms.$curKeywordsNums.text(e.length),this.renderKeywordsHtml(e)},clickDeleteBtn:function(){var t=this;this.doms.$filKeyMainContent.off().on("click",".room-filter-delete",function(){var i=e(this).parent().find(".room-filter-list").text();e(this).parent().remove(),t.dys({key:"dys.room.filterkeywords.deletebtn",kv:i,type:"room"===t.config.curScope?1:0}),"room"===t.config.curScope?(t.handleDeleteData(t.config.curRoomKWData,i,t.config.noKwsRoomTx),t.localData.roomKw[t.config.roomId]=t.config.curRoomKWData,0===t.config.curRoomKWData.length&&(delete t.localData.roomKw[t.config.roomId],t.config.roomNums--)):t.handleDeleteData(t.localData.globalKw,i,t.config.noKwsAllRoomTx),a.set(n,t.localData),s.exe("js_filterKeywords",t.localData)})},handleDeleteData:function(e,t,a){var i=this.isRepeatAddKeyword(e,t,!0);e.splice(i,1),this.doms.$curKeywordsNums.text(e.length),0===e.length&&(this.isShowKeywordsContent(!1),this.changeTipText(a))},isRepeatAddKeyword:function(e,t,a){if(e=e||[],0===e.length)return!1;for(var i=0,s=e.length;s>i;i++)if(e[i]===t)return a?i:!0;return!1},renderKeywordsHtml:function(e){for(var t="",a=0,i=e.length;i>a;a++)t+=this.renderKeywords(e[a]);this.doms.$filKeyMainContent.html(t)},changeTipText:function(e){this.doms.$noKeywordsBox.find(".title-scope-name").text(e),this.doms.$noKeywordsBox.find(".tip-scope-name").text(e)},showTipBox:function(t){var a=this.doms.$roomFilterKwsWrap.find(".fk-error-tip");a.length>0||(this.doms.$roomFilterKwsWrap.append(this.renderTip(t)),setTimeout(function(){e("#room-filter-keywords-wrap .fk-error-tip").remove()},2e3))},isShowKeywordsContent:function(e){e?(this.doms.$roomFilterContent.removeClass("active"),this.doms.$noKeywordsBox.removeClass("active")):(this.doms.$roomFilterContent.addClass("active"),this.doms.$noKeywordsBox.addClass("active"))},render:function(){var e=['<div id="room-filter-keywords-wrap" class="room-filter-keywords-wrap">','<div class="room-filter-close"></div>','<div class="room-filter-header">','<h2 class="room-filter-title">过滤关键词</h2>','<div class="room-filter-tabs">','<div class="room-filter-tab first active" data-scope="room">本房间</div>','<div class="room-filter-tab last" data-scope="global">全站</div>',"</div>","</div>",'<div class="room-filter-content">','<p class="filter-keywords-title"><span class="cur-filter-scope">本房间</span>过滤包含以下关键词的弹幕（<span class="cur-keywords-nums">10</span>/20）</p>','<div class="fk-mc-box">','<ul class="filter-keywords-main-content">',"</ul>","</div>","</div>",'<div class="no-keywords-box">','<p class="nkb-title"><span class="title-scope-name">当前房间</span>没有被过滤的关键词</p>','<p class="nkb-tip">设置后<span class="tip-scope-name">房间内</span>包含关键词的弹幕对您不可见</p>',"</div>",'<div class="room-filter-footer">','<input class="room-filter-input" type="text" placeholder="请输入关键词（支持通配符*、？）" maxlength="10" />','<div class="room-filter-add">添加</div>',"</div>","</div>"].join("");return e},renderKeywords:function(e){var t=e||"";t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;");var a=["<li>",'<span class="room-filter-list-icon"></span>','<span class="room-filter-list"><pre>',t,"</pre></span>",'<span class="room-filter-delete"></span>',"</li>"].join("");return a},renderTip:function(e){var t='<div class="fk-error-tip"><div class="fk-tip-content-box"><span class="fk-tip-content">'+e+"</span></div></div>";return t}};return{init:function(){o.init(),t.on("mod.room.filter.keywords.set",function(){var e=a.get(n)||o.localData;s.exe("js_filterKeywords",e)})}}}),define("douyu/page/room/normal/mod/anchor-like",["jquery","shark/util/lang/1.0","shark/util/template/1.0","douyu/context","douyu/com/insight","douyu/com/imgp","shark/observer"],function(e,t,a,i,s,n,o){var r={url:"/lapi/member/authorAbout/getAuthorLike",roomId:i.get("room.room_id"),maxItem:6,$anchorLike:e("#js-anchor-like"),$slider:e("#js-chat-right-ad")},l=function(){var l=function(e){return e?e.indexOf("#")>-1||e.indexOf("javascript")>-1?"":e.substring(e.lastIndexOf("/")+1):""},d=function(i){var s,n,d;return s=t.string.join("<% var _index = 1; %>","<% for (var key in list) { %>","<% if ( _index <= maxLength) { %>","<% var item = list[key]; %>",'<li class="live" data-point-2="<%= _index %>">','<a href="/<%= key %>" data-rt="<%= item.ranktype%>" data-sub_rt="<%= item.recomType%>" data-rpos="<%= item.rpos%>" target="_blank" title="<%= item.name %>" >','<div class="live-preview">','<img src="<%= item.room_src %>" />','<b class="border"></b>',"</div>",'<div class="live-details">','<h3 class="live-title"><%= item.name %></h3>','<p class="live-category">分类：<%= item.game_name %></p>','<p class="live-anchor">主播：<%= item.nickname %></p>',"</div>","</a>","</li>","<% _index++; %>","<% } %>","<% } %>"),n=a.compile(s),(d=n({list:i,maxLength:r.maxItem}))?(r.$anchorLike.show().html(d),void r.$anchorLike.on("mousedown","a",function(){var t=e(this),a=t.closest("li");o.trigger("dys",{key:"dys.room.anchorLike.click",pos:a.index()+1,rid:l(t.attr("href")),tid:0,
rt:t.data("rt"),sub_rt:t.data("sub_rt"),rpos:t.data("rpos")})})):void r.$anchorLike.hide()},c=function(e){var t,a,i=[];for(a in e)i.push(a);t=i.length;for(var s=0;t>s;s++)o.trigger("dys",{key:"dys.room.anchorLike.show",pos:s+1,rid:i[s],tid:0,rt:e[i[s]].ranktype,sub_rt:e[i[s]].recomType,rpos:e[i[s]].rpos||0})},u=function(){var e=r.$slider.find("ul li"),a=r.$slider.find("ol li"),i=0;t.interval(function(){e.css("opacity",0).hide(),a.removeClass("cur"),i=i>=2?-1:i,i++,e.eq(i).css("opacity",1).show(),a.eq(i).addClass("cur"),n.build()},5e3)};u(),s.build({selectors:"#js-anchor-like",appear:function(){e.ajax({url:r.url,type:"GET",dataType:"json",data:{userId:i.get("sys.uid")||i.get("room.device_id"),roomId:r.roomId},success:function(e){d(e),c(e)},error:function(){r.$anchorLike.hide()}})}})};e(l)}),define("douyu/com/footer",["jquery"],function(e){function t(){return!!(window.ActiveXObject||"ActiveXObject"in window)}var a={check:function(){var t=location.host,a=e("#footer-company-info-1"),i=e("#footer-company-info-2");a.hide(),i.hide(),"www.douyutv.com"===t?a.show():"www.douyu.com"===t&&i.show()}},i={print:function(){try{if(window.console&&window.console.log){var e=location.protocol;console.log("怀才不遇无处倾诉？\n快来斗鱼！JOIN US！\n我们重金悬赏各类有才之士，\n也包括优秀应届生哦！\n"),t()?console.log("请将简历发送至 jobs@douyu.tv（邮件标题请以“姓名-应聘XX职位-来自console”命名）"):console.log("请将简历发送至 %c jobs@douyu.tv（邮件标题请以“姓名-应聘XX职位-来自console”命名）","color:red"),console.log("职位介绍："+e+"//www.douyu.com/cms/about/jobs.html#page3")}}catch(a){}}},s=function(){a.check(),i.print()};e(s)});